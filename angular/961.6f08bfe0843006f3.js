"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[961],{76944:(Qt,tt)=>{tt.G=void 0,tt.G=class s{static generateIdRequired(J){let C="";const et="abcdefghijklmnopqrstuvwxyz0123456789",M=et.length;for(let Q=0;Q<J;Q++)C+=et.charAt(Math.floor(Math.random()*M));return Math.floor(Date.now()/1e3)+C}}},46707:(Qt,tt,w)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.PartsParser=void 0;const s=w(72151),o=w(43087),J=w(78730),C=w(98770),et=w(21150),M=w(65741);class Q{constructor(K){this.__idCssElement="qv_style_element",this.baseConfigEventListener=[],this.imgMaps=[],this.services=new Array;const z=this.__pushServices([new o.FirstPartService(this.baseConfigEventListener),new s.ImagePartService(this.baseConfigEventListener),new et.DocxImagePartService(this.baseConfigEventListener),new C.LibrariesPartService(this.baseConfigEventListener,K),new J.FindAnsPartService(this.baseConfigEventListener),new M.LatexPartService(this.baseConfigEventListener)]);this.__pushCss(z)}__pushCss(K){if(!document.getElementById(this.__idCssElement)&&document.head){const R=document.createElement("style");R.id=this.__idCssElement,R.innerHTML=K.replace(/  /g," ").replace(/\n/g," ").replace(/\t/g," "),document.head.appendChild(R)}}__pushServices(K){let z="";return K.forEach(R=>{R.outCss().forEach(y=>{z+=`.${y.className} { ${y.content} } \n`}),this.services.push(R)}),z}start(K){const z=document.createElement("div");return K.forEach(R=>{const j=document.createElement("p");j.classList.add("qv_line"),this.services.forEach(y=>{y.pushImages(this.imgMaps),R=y.parse(R)}),j.innerHTML=R.text||"",z.appendChild(j)}),0===z.innerText.indexOf(Q.IgnoreChar)?z.innerText.replace(Q.IgnoreChar,""):z.outerHTML}register(K){this.imgMaps=K}configEventListener(K){K.forEach(z=>{-1===this.baseConfigEventListener.findIndex(R=>R.eventName===z.eventName)&&this.baseConfigEventListener.push(z)})}doneRenderQuestions(){this.services.forEach(K=>{K.onEndAll()})}}tt.PartsParser=Q,Q.IgnoreChar="{!ignore}"},12128:(Qt,tt)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.BaseCaller=void 0,tt.BaseCaller=class w{getQuestion(o,J,C,et,M,Q){return new Promise(P=>{P([])})}}},77249:(Qt,tt)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.BeautyImageCrop=void 0;class w{static getRGB(o,J,C,et){return{red:et[4*(C.width*J+o)],green:et[4*(C.width*J+o)+1],blue:et[4*(C.width*J+o)+2],opacity:et[4*(C.width*J+o)+3]}}static isEmpty(o){return 255==o.red&&255==o.green&&255==o.blue||0===o.opacity}static scanX(o,J,C){for(var et=o?1:-1,M=o?0:J.width-1;o?M<J.width:M>-1;M+=et)for(var Q=0;Q<J.height;Q++)if(!w.isEmpty(w.getRGB(M,Q,J,C.data)))return M;return 0}static scanY(o,J,C){for(var et=o?1:-1,M=o?0:J.height-1;o?M<J.height:M>-1;M+=et)for(var Q=0;Q<J.width;Q++)if(!w.isEmpty(w.getRGB(Q,M,J,C.data)))return M;return 0}static cropImage(o,J,C){const M=o.canvas,Q=document.createElement("canvas"),P=Q.getContext("2d");var K=w.scanY(!0,M,J)-5,z=w.scanY(!1,M,J)+5,R=w.scanX(!0,M,J)-5,j=w.scanX(!1,M,J)+5;C&&(C.top||(z=0),C.bottom||(z=M.height),C.left||C.right?(C.left||(z=0),C.right||(z=M.width)):j=M.width+R);var y=j-R,T=z-K;return Q.width=y,Q.height=T,null==P||P.drawImage(M,R,K,y,T,0,0,y,T),Q}static removeBg(o){const J=document.createElement("canvas"),C=J.getContext("2d");if(C){J.width=o.width,J.height=o.height,C.drawImage(o,0,0);for(var et=C.getImageData(0,0,J.width,J.height),M=et.data,Q=0;Q<M.length;Q+=4){let K=M[Q+1],z=M[Q+2];M[Q]>=185&&K>=185&&z>=185&&(M[Q+3]=0)}C.putImageData(et,0,0)}return J}static cropCanvas(o,J){const C=o.getContext("2d");if(C){var et=C.getImageData(0,0,o.width,o.height);return w.cropImage(C,et,J)}return o}}tt.BeautyImageCrop=w},25482:(Qt,tt,w)=>{tt.rj=void 0;w(12128);const J=w(77249);Object.defineProperty(tt,"rj",{enumerable:!0,get:function(){return J.BeautyImageCrop}});w(46707)},21150:(Qt,tt)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.DocxImagePartService=void 0;class w{constructor(o){this.pattern_check=/@\[\]{"link":"[^"]+","data":{[^}]+}}@\[\]/i,this.images=[],this.indexImageLink=[],this.style=document.createElement("style"),this.baseConfigEventListener=o,document.head.appendChild(this.style)}parse(o){let et,J=0,C=o.text||"";for(;null!==(et=this.pattern_check.exec(C));){try{var M=JSON.parse(et[0].split("@[]")[1]);M.data={x:Math.floor(M.data.x),y:Math.floor(M.data.y),width:Math.floor(M.data.width),height:Math.floor(M.data.height)},this.indexImageLink.push(M.link),C=C.replace(this.pattern_check,`<div class="background_question_${this.indexImageLink.length-1}"><img width="1024" height="1024" src="${M.link}"></div>`),this.style.textContent+=`.background_question_${this.indexImageLink.length-1} {margin: 0 3px; width: ${M.data.width}px; height: ${M.data.height}px; display: inline-block;vertical-align: middle; overflow: hidden;} .background_question_${this.indexImageLink.length-1} img { margin-top: -${M.data.y}px; margin-left: -${M.data.x}px;}`}catch(Q){C=C.replace(this.pattern_check,"")}J++>1e4&&(C="")}return Object.assign(Object.assign({},o),{text:C})}outCss(){return[]}pushImages(o){this.images=o}onEndAll(){}}tt.DocxImagePartService=w,w.NAME_SERVICE="image_part:"},78730:(Qt,tt)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.FindAnsPartService=void 0,tt.FindAnsPartService=class w{constructor(o){this.pattern_check=/\[[ABCDEFGHI]:[^\]]+\]/i,this.images=[],this.baseConfigEventListener=o}parse(o){let et,J=0,C=o.text||"";for(;null!==(et=this.pattern_check.exec(C));){const M=et[0].replace("[","").replace("]",""),Q=M.substring(0,1),P=document.createElement("span");P.classList.add("qv_string_eng_ans"),P.innerHTML=Q;const K=M.substring(2),z=document.createElement("span");z.classList.add("qv_string_eng"),z.innerHTML=K,z.appendChild(P),C=C.replace(this.pattern_check,z.outerHTML),J++>1e4&&(C="")}return Object.assign(Object.assign({},o),{text:C})}outCss(){return[{className:"qv_string_eng",content:"\n                    cursor: pointer;\n                    padding: 0 5px;\n                    font-weight: bold;\n                    text-decoration: underline;\n                    position: relative;\n                    height: 40px;\n                    display: inline-block;\n                "},{className:"qv_string_eng_ans",content:"\n                    position: absolute;\n                    top: 20px;\n                    left: 45%;\n                "}]}pushImages(o){this.images=o}onEndAll(){}}},43087:(Qt,tt)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.FirstPartService=void 0,tt.FirstPartService=class w{constructor(o){this.images=[],this.baseConfigEventListener=o}parse(o){return Object.assign({},o)}outCss(){return[{className:"qv_line",content:"\n                    margin: 0 !important;\n                "},{className:"qv_qts_image",content:"\n                    width: 100%;\n                "},{className:"qv_ats_image",content:"\n                    width: 60%;\n                "}]}pushImages(o){this.images=o}onEndAll(){}}},72151:(Qt,tt)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.ImagePartService=void 0;class w{constructor(o){this.pattern_check=/\[!img:[afhci]+[\dABCDEFGHI]+\]/i,this.images=[],this.baseConfigEventListener=o}parse(o){let et,J=0,C=o.text||"";for(;null!==(et=this.pattern_check.exec(C));){const M=et[0].replace("[!img:","").replace("]",""),Q=this.images.find(P=>P.id===M);if(Q){const P=document.createElement("img");P.crossOrigin="anonymous",P.classList.add(0===M.indexOf("af")?"qv_full_a_img":0===M.indexOf("f")?"qv_full_img":"qv_img"),P.src=Q.link,C=C.replace(this.pattern_check,P.outerHTML)}else{const P=document.createElement("span");P.innerHTML="(Th\xeam h\xecnh \u1ea3nh)",P.classList.add("qv_none_image"),C=C.replace(this.pattern_check,P.outerHTML)}J++>1e4&&(C="")}return Object.assign(Object.assign({},o),{text:C})}outCss(){return[{className:"qv_full_a_img",content:"\n                    cursor: pointer;\n                    width: 60%\n                "},{className:"qv_full_img",content:"\n                    cursor: pointer;\n                    width: 100%\n                "},{className:"qv_img",content:"\n                    cursor: pointer;\n                    height: 25px;\n                "},{className:"qv_none_image",content:"\n                    display: inline-block;\n                    color: #2262ae;\n                    cursor: pointer;\n                "}]}pushImages(o){this.images=o}onEndAll(){}}tt.ImagePartService=w,w.NAME_SERVICE="image_part:"},65741:(Qt,tt)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.LatexPartService=void 0;class w{constructor(o){this.images=[],this.baseConfigEventListener=o}parse(o){let J=o.text||"";return Object.assign(Object.assign({},o),{text:J})}outCss(){return[]}pushImages(o){this.images=o}onEndAll(){}}tt.LatexPartService=w,w.NAME_SERVICE="latex:"},98770:(Qt,tt,w)=>{Object.defineProperty(tt,"__esModule",{value:!0}),tt.LibrariesHelper=tt.LibrariesPartService=void 0;const s=w(46707);class o{constructor(M,Q){this.pattern_check=/^(\[@[CTG]\d+:[^\]]+\]\.)+((\[@Q\d+:[^\]]+\])|(\[[^@:]+\]))$/i,this.pattern_content=/\[(.*?)\]/i,this.images=[],this.baseConfigEventListener=[],this.baseConfigEventListener=M,this.cacheProcess=new C(Q,this.baseConfigEventListener)}parse(M){let Q=0,P=M.text||"";if(this.pattern_check.test(P)){let K=[];for(;null!==this.pattern_content.exec(P);){const j=this.pattern_content.exec(P);if(!j)break;K.push(j[1]),P=P.substring(0,j.index)+P.substring(j.index+j[0].length)}const z=J.convertStringToTypeObject(K),R={numberQuestion:1,path:z[0],useCache:!0};"Random"===z[0].type?("G"===z[1].type?(R.groupId=z[1].id,R.examId=z[2].id):(R.catId="C"===z[1].type?z[1].id:void 0,R.examId="T"===z[1].type?z[1].id:void 0,R.questionId="Q"===z[1].type?z[1].id:void 0),R.numberQuestion=z[0].id):R.questionId=z[0].id,P=s.PartsParser.IgnoreChar+this.cacheProcess.pushCaller(R),Q++>1e4&&(P="")}return Object.assign(Object.assign({},M),{text:P})}outCss(){return[]}pushImages(M){this.images=M}onEndAll(){this.cacheProcess.startCaller()}}tt.LibrariesPartService=o,o.NAME_SERVICE="libraries_part:";class J{static convertStringToTypeObject(M){const Q=[];return M.forEach(P=>{let K=P.substring(1,2),z=Number(J.pattern_number.exec(P)),R="";if(J.char_types.includes(K)){let j=P.indexOf(":");-1!==j&&(R=P.substring(j))}else K="Random";Q.push({name:R,id:z,type:K,content:P})}),Q.reverse()}}tt.LibrariesHelper=J,J.pattern_number=/\d+/i,J.char_types="CTGQH";class C{constructor(M,Q){this.eventDoneKey=o.NAME_SERVICE+"done",this.cacheObjs=[],this.baseCaller=M,this.baseConfigEventListener=Q}pushEventValue(){const M=this.baseConfigEventListener.filter(P=>0===P.eventName.indexOf(this.eventDoneKey));let Q=[];M.forEach(P=>{const K=this.cacheObjs.filter(R=>"done"===R.step);P.func.call(P.caller,K)&&Q.push(P.eventName)}),Q.forEach(P=>{const K=this.baseConfigEventListener.findIndex(z=>z.eventName===P);-1!==K&&this.baseConfigEventListener.splice(K,1)})}pushCaller(M){const Q=M.catId+"_"+M.examId+"_"+M.groupId+"_"+M.questionId+"_"+M.numberQuestion;var P=this.cacheObjs.find(K=>K.key===Q);return P||this.cacheObjs.push(P={key:Q,value:[],step:"init",pars:M,count:0}),P.count++,Q+"_"+(null==P?void 0:P.count)}startCaller(){this.cacheObjs.forEach(M=>{M.count=0,"init"===M.step?(M.step="call",this.baseCaller.getQuestion(M.pars.numberQuestion,M.pars.useCache,M.pars.catId,M.pars.examId,M.pars.questionId,M.pars.groupId).then(Q=>{M.step="done",M.value=Q,this.pushEventValue()})):"done"===M.step&&this.pushEventValue()})}}},43977:(Qt,tt,w)=>{w.d(tt,{g:()=>J});var s=w(591),o=w(5e3);let J=(()=>{class C{constructor(){this.switchEssayTabSource=new s.X(!1),this.switchEssayTabMessage=this.switchEssayTabSource.asObservable()}changeSwitchEssayTabMessage(M){this.switchEssayTabSource.next(M)}}return C.\u0275fac=function(M){return new(M||C)},C.\u0275prov=o.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},47865:(Qt,tt,w)=>{w.d(tt,{l:()=>P});var s=w(55330),o=w(5e3),J=w(35018),C=w(69808),et=w(88847),M=w(1033);function Q(K,z){1&K&&(o.TgZ(0,"div",2),o._UZ(1,"img",3),o.ALo(2,"convertCdn"),o.qZA()),2&K&&(o.xp6(1),o.Q6J("src",o.lcZ(2,1,"azota_assets/svgs/Img2_dat-01.svg"),o.LSH))}let P=(()=>{class K extends s.Q{constructor(R,j){super(R),this.commonService=R,this.cd=j,this.noClass=!1}onLoad(){this.stopStatusObj()}get isLazyLoad(){return void 0!==this.width&&void 0!==this.height}ngOnInit(){this.initStatusObj(),super.ngOnInit()}}return K.\u0275fac=function(R){return new(R||K)(o.Y36(J.v),o.Y36(o.sBO))},K.\u0275cmp=o.Xpm({type:K,selectors:[["azt-loaded-img"]],inputs:{imgSrc:"imgSrc",id:"id",noClass:"noClass",width:"width",height:"height"},features:[o.qOj],decls:3,vars:10,consts:[["class","px-4 py-3 text-center",4,"ngIf"],["appImageFallback","",2,"width","100%",3,"width","height","hidden","src","load"],[1,"px-4","py-3","text-center"],["alt","image_loading_placeholer",3,"src"]],template:function(R,j){1&R&&(o.YNc(0,Q,3,3,"div",0),o.TgZ(1,"img",1),o.NdJ("load",function(){return j.onLoad()}),o.ALo(2,"mycdn"),o.qZA()),2&R&&(o.Q6J("ngIf",!j.isLazyLoad&&j.statusObj.loading),o.xp6(1),o.Tol(j.id?"img-fluid questionId_"+j.id:j.noClass?"w-auto":"img-fluid"),o.s9C("src",o.lcZ(2,8,j.imgSrc),o.LSH),o.Q6J("width",void 0!==j.width?j.width:null)("height",void 0!==j.height?j.height:null)("hidden",!j.isLazyLoad&&j.statusObj.loading),o.uIk("loading",j.isLazyLoad?"lazy":"eager"))},dependencies:[C.O5,et.H,M.GT,M.BI],encapsulation:2}),K})()},80826:(Qt,tt,w)=>{w.d(tt,{$:()=>Pr});var s=w(91159),o=w(5e3),J=w(20985),C=w(55330),et=w(81721),M=w(33502),Q=(()=>{return(p=Q||(Q={}))[p.TestPreview=1]="TestPreview",p[p.TakeTest=2]="TakeTest",p[p.AnswerTest=3]="AnswerTest",p[p.TestReview=4]="TestReview",p[p.EditTest=5]="EditTest",p[p.ExportPdf=6]="ExportPdf",p[p.TestFinderPreview=7]="TestFinderPreview",p[p.UpdateExam=8]="UpdateExam",p[p.TestFinder=9]="TestFinder",Q;var p})(),P=w(30345);class K{constructor(L,d){this.cdnService=L,this.commonService=d,this.services=[];const b=new P.$(this.cdnService,this.commonService,(I,G)=>{this.callbackPushImage&&this.caller&&this.callbackPushImage.call(this.caller,I,G)});b.isCropImage=!this.isIOS(),this.services.push(b)}render(L){return this.services.forEach(d=>{L=d.render(null!=L?L:"",[])}),null!=L?L:""}isIOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}}var z=w(35018),R=w(15043),j=w(60590),y=w(35191),T=w(90893),V=w(88161),H=w(69808),Z=w(26688),W=w(25245),it=w(67322),Y=w(43977),rt=w(1033);function gt(p,L){1&p&&(o.TgZ(0,"mat-icon",15),o._uU(1,"close"),o.qZA())}function Et(p,L){if(1&p&&o.YNc(0,gt,2,0,"mat-icon",14),2&p){const d=o.oxw().$implicit,b=o.oxw(5);o.Q6J("ngIf",b.isChosen(d))}}function pt(p,L){1&p&&(o.TgZ(0,"mat-icon",16),o._uU(1,"check_circle"),o.qZA())}function Dt(p,L){if(1&p&&(o.TgZ(0,"div",10),o.YNc(1,Et,1,1,"ng-template",11),o.YNc(2,pt,2,0,"mat-icon",12),o.TgZ(3,"span",13),o._uU(4),o.qZA()()),2&p){const d=L.$implicit,b=o.oxw(5);o.xp6(1),o.Q6J("ngIf",!(b.isKey(d)&&b.isChosen(d))),o.xp6(1),o.Q6J("ngIf",b.isKey(d)&&b.isChosen(d)),o.xp6(2),o.hij(" ",d.alpha?d.alpha:d.key?d.key:d," ")}}const jt=function(p){return{"border-color":p}};function Jt(p,L){if(1&p&&(o.TgZ(0,"div",8),o.YNc(1,Dt,5,3,"div",9),o.qZA()),2&p){const d=o.oxw(4);o.Q6J("ngStyle",o.VKq(2,jt,d.question.answerResult&&""!=d.question.answerResult[0]&&d.question.correctAnswer?"#00ac33":"red")),o.xp6(1),o.Q6J("ngForOf",d.labelArr)}}const Bt=function(p){return{color:p}};function Gt(p,L){if(1&p&&(o.TgZ(0,"div",5)(1,"span",6),o._uU(2),o.ALo(3,"mytranslate"),o.qZA(),o.YNc(4,Jt,2,4,"div",7),o.qZA()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("ngStyle",o.VKq(6,Bt,d.question.answerResult&&""!=d.question.answerResult[0]&&d.question.correctAnswer?"#00ac33":"red")),o.xp6(1),o.AsE("",o.lcZ(3,4,"lang_auto_dap_an_dung"),": ",d.key,""),o.xp6(2),o.Q6J("ngIf",d.OnlineTest)}}function de(p,L){if(1&p&&(o.TgZ(0,"span",6),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p){const d=o.oxw(4);o.Q6J("ngStyle",o.VKq(5,Bt,d.question.answerResult&&""!=d.question.answerResult[0]&&d.question.correctAnswer?"#00ac33":"red")),o.xp6(1),o.AsE("",o.lcZ(2,3,"lang_auto_dap_an_dung_"),"",d.keys.join("],["),"]")}}function Ne(p,L){if(1&p&&(o.TgZ(0,"div",19)(1,"div",20),o._uU(2),o.qZA()()),2&p){const d=o.oxw(4);o.Q6J("ngStyle",o.VKq(2,jt,d.question.answerResult&&""!=d.question.answerResult[0]&&d.question.correctAnswer?"#00ac33":"red")),o.xp6(2),o.hij(" ",d.userAnswersObj["id_"+d.question.id]&&""!=d.userAnswersObj["id_"+d.question.id]?d.userAnswersObj["id_"+d.question.id]:"Th\xed sinh kh\xf4ng nh\u1eadp th\xf4ng tin"," ")}}function ct(p,L){if(1&p&&(o.TgZ(0,"div",5),o.YNc(1,de,3,7,"span",17),o.YNc(2,Ne,3,4,"div",18),o.qZA()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("ngIf",d.keys),o.xp6(1),o.Q6J("ngIf",d.OnlineTest)}}function ot(p,L){if(1&p&&(o.TgZ(0,"div"),o.YNc(1,Gt,5,8,"div",4),o.ALo(2,"isOneChoiceAnswer"),o.YNc(3,ct,3,2,"div",4),o.ALo(4,"isFillAnswer"),o.qZA()),2&p){const d=o.oxw(2);o.xp6(1),o.Q6J("ngIf",o.lcZ(2,2,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(4,4,d.question.answerType))}}function Rt(p,L){if(1&p&&(o.TgZ(0,"span",6),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p){const d=o.oxw(4);o.Q6J("ngStyle",o.VKq(5,Bt,d.question.answerResult&&""!=d.question.answerResult[0]&&d.question.correctAnswer?"#00ac33":"red")),o.xp6(1),o.AsE("",o.lcZ(2,3,"lang_auto_dap_an_dung"),": ",d.key,"")}}function Ct(p,L){1&p&&o._UZ(0,"span",23)}function Ae(p,L){1&p&&(o.TgZ(0,"mat-icon",26),o._uU(1,"close"),o.qZA())}function yt(p,L){1&p&&(o.TgZ(0,"mat-icon"),o._uU(1,"check_circle"),o.qZA())}function _e(p,L){if(1&p&&(o.YNc(0,Ae,2,0,"mat-icon",25),o.YNc(1,yt,2,0,"mat-icon",0)),2&p){const d=o.oxw().$implicit,b=o.oxw(4);o.Q6J("ngIf",b.isChosen(d)&&2!=(null==b.examConfig?null:b.examConfig.whenShowAnswer)&&!b.notShowAnswerYet),o.xp6(1),o.Q6J("ngIf",b.isChosen(d)&&2!=(null==b.examConfig?null:b.examConfig.whenShowAnswer)&&b.notShowAnswerYet)}}function ke(p,L){1&p&&(o.TgZ(0,"mat-icon"),o._uU(1,"check_circle"),o.qZA())}function je(p,L){if(1&p&&o.YNc(0,ke,2,0,"mat-icon",0),2&p){const d=o.oxw().$implicit,b=o.oxw(4);o.Q6J("ngIf",b.isChosen(d)&&2==(null==b.examConfig?null:b.examConfig.whenShowAnswer))}}function ve(p,L){1&p&&(o.TgZ(0,"mat-icon",27),o._uU(1,"check_circle"),o.qZA())}function Me(p,L){if(1&p&&(o.TgZ(0,"div",10),o.YNc(1,_e,2,2,"ng-template",11),o.YNc(2,je,1,1,"ng-template",11),o.YNc(3,ve,2,0,"mat-icon",24),o.TgZ(4,"span",13),o._uU(5),o.qZA()()),2&p){const d=L.$implicit,b=o.oxw(4);o.xp6(1),o.Q6J("ngIf",!(b.isKey(d)&&b.isChosen(d))),o.xp6(1),o.Q6J("ngIf",!(b.isKey(d)&&b.isChosen(d))),o.xp6(1),o.Q6J("ngIf",b.isKey(d)&&b.isChosen(d)&&2!=(null==b.examConfig?null:b.examConfig.whenShowAnswer)),o.xp6(2),o.hij(" ",d.alpha?d.alpha:d.key?d.key:d," ")}}function hs(p,L){if(1&p&&(o.TgZ(0,"div",5),o.YNc(1,Rt,3,7,"span",17),o.YNc(2,Ct,1,0,"span",21),o.TgZ(3,"div",22),o.YNc(4,Me,6,4,"div",9),o.qZA()()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("ngIf",2!=(null==d.examConfig?null:d.examConfig.whenShowAnswer)&&!d.notShowAnswerYet),o.xp6(1),o.Q6J("ngIf",d.keys&&2==(null==d.examConfig?null:d.examConfig.whenShowAnswer)),o.xp6(2),o.Q6J("ngForOf",d.labelArr)}}function pi(p,L){if(1&p&&(o.TgZ(0,"span",6),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p){const d=o.oxw(4);o.Q6J("ngStyle",o.VKq(5,Bt,d.isFillAnswer?"#00ac33":"red")),o.xp6(1),o.AsE("",o.lcZ(2,3,"lang_auto_dap_an_dung_"),"",d.keys.join("],["),"]")}}function ds(p,L){1&p&&o._UZ(0,"span",23)}function pr(p,L){if(1&p&&(o.TgZ(0,"div",5),o.YNc(1,pi,3,7,"span",17),o.YNc(2,ds,1,0,"span",21),o.TgZ(3,"div",28)(4,"div",29),o._uU(5),o.qZA()()()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("ngIf",d.keys&&2!=(null==d.examConfig?null:d.examConfig.whenShowAnswer)&&!d.notShowAnswerYet),o.xp6(1),o.Q6J("ngIf",d.keys&&2==(null==d.examConfig?null:d.examConfig.whenShowAnswer)),o.xp6(3),o.hij(" ",d.userAnswersObj["id_"+d.question.id]&&""!=d.userAnswersObj["id_"+d.question.id]?d.userAnswersObj["id_"+d.question.id]:"Th\xed sinh kh\xf4ng nh\u1eadp th\xf4ng tin"," ")}}function cn(p,L){if(1&p&&(o.TgZ(0,"div"),o.YNc(1,hs,5,3,"div",4),o.ALo(2,"isOneChoiceAnswer"),o.YNc(3,pr,6,3,"div",4),o.ALo(4,"isFillAnswer"),o.qZA()),2&p){const d=o.oxw(2);o.xp6(1),o.Q6J("ngIf",o.lcZ(2,2,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(4,4,d.question.answerType))}}function _s(p,L){1&p&&o._UZ(0,"div",30)}function xe(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div")(1,"span",32),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(3);return o.KtG(I.switchToEssayTab())}),o._uU(2),o.ALo(3,"mytranslate"),o.qZA()()}2&p&&(o.xp6(2),o.Oqu(o.lcZ(3,1,"lang_auto_click_vao_day_de_xem_o_tab_tu_luan")))}function ms(p,L){1&p&&(o.TgZ(0,"div"),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function fr(p,L){if(1&p&&(o.TgZ(0,"div"),o._UZ(1,"div",33),o.ALo(2,"formatLineBreak"),o.qZA()),2&p){const d=o.oxw(4);o.xp6(1),o.Q6J("innerHtml",o.lcZ(2,1,d.userAnswersObj["id_"+d.question.id]),o.oJD)}}function gs(p,L){if(1&p&&(o.TgZ(0,"div"),o.YNc(1,ms,3,3,"div",0),o.YNc(2,fr,3,3,"div",0),o.qZA()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("ngIf",""==d.userAnswersObj["id_"+d.question.id]||!d.userAnswersObj["id_"+d.question.id]),o.xp6(1),o.Q6J("ngIf",!(""==d.userAnswersObj["id_"+d.question.id]||!d.userAnswersObj["id_"+d.question.id]))}}function Un(p,L){if(1&p&&(o.TgZ(0,"div",31),o.YNc(1,xe,4,3,"div",0),o.YNc(2,gs,3,2,"div",0),o.qZA()),2&p){const d=o.oxw(2);o.xp6(1),o.Q6J("ngIf","multiple_choice"==d.place),o.xp6(1),o.Q6J("ngIf","multiple_choice"!=d.place)}}function fi(p,L){1&p&&(o.TgZ(0,"div"),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_thi_sinh_khong_nhap_thong_tin")," "))}function Qn(p,L){if(1&p&&(o.TgZ(0,"div"),o._UZ(1,"div",33),o.ALo(2,"formatLineBreak"),o.qZA()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("innerHtml",o.lcZ(2,1,d.userAnswersObj["id_"+d.question.id]),o.oJD)}}function Bn(p,L){if(1&p&&(o.TgZ(0,"div",34),o.YNc(1,fi,3,3,"div",0),o.YNc(2,Qn,3,3,"div",0),o.qZA()),2&p){const d=o.oxw(2);o.xp6(1),o.Q6J("ngIf",""==d.userAnswersObj["id_"+d.question.id]||!d.userAnswersObj["id_"+d.question.id]),o.xp6(1),o.Q6J("ngIf",!(""==d.userAnswersObj["id_"+d.question.id]||!d.userAnswersObj["id_"+d.question.id]))}}function vr(p,L){if(1&p&&(o.ynx(0),o.YNc(1,ot,5,6,"div",0),o.YNc(2,cn,5,6,"div",0),o.YNc(3,_s,1,0,"div",1),o.ALo(4,"isMultipleChoiceAnswer"),o.ynx(5),o.YNc(6,Un,3,2,"div",2),o.ALo(7,"isEssayAnswer"),o.YNc(8,Bn,3,2,"div",3),o.ALo(9,"isEssayAnswer"),o.BQk()()),2&p){const d=o.oxw();o.xp6(1),o.Q6J("ngIf",null==d.examConfig?null:d.examConfig.isRoleTeacher),o.xp6(1),o.Q6J("ngIf",!(null!=d.examConfig&&d.examConfig.isRoleTeacher)),o.xp6(1),o.Q6J("ngIf",o.lcZ(4,5,d.question.answerType)),o.xp6(3),o.Q6J("ngIf",o.lcZ(7,7,d.question.answerType)&&!d.isDisplayInExportMode&&d.OnlineTest),o.xp6(2),o.Q6J("ngIf",o.lcZ(9,9,d.question.answerType)&&d.isDisplayInExportMode&&d.OnlineTest)}}const xr=["*"];let vi=(()=>{class p extends C.Q{constructor(d,b,I,G,_t){super(d),this.commonService=d,this.homeworkExamService=b,this.customQuestionAnswerConfig=I,this.answerTypeService=G,this.answerBoxService=_t,this.userAnswersObj={},this.notShowAnswerYet=!1,this.place="multiple_choice",this.isDisplayInExportMode=!0,this.OnlineTest=!0,this.statusResult=new o.vpe,this.key="",this.keys=[],this.labelArr=[],this.isFillAnswer=!1}switchToEssayTab(){this.answerBoxService.changeSwitchEssayTabMessage(!0)}isKey(d){var b;return!(!(null===(b=this.question)||void 0===b?void 0:b.answers)||!this.question.answerResult)&&(d.key?d.key==this.question.answerResult[0]:d==this.question.answerResult[0])}isChosen(d){var b,I,G;return!!this.userAnswersObj["id_"+(null===(b=this.question)||void 0===b?void 0:b.id)]&&(d.key?d.key.toString()==this.userAnswersObj["id_"+(null===(I=this.question)||void 0===I?void 0:I.id)]:d.toString()==this.userAnswersObj["id_"+(null===(G=this.question)||void 0===G?void 0:G.id)])}findKey(){var d,b;if(null!==(d=this.question)&&void 0!==d&&d.answerResult)for(let I=0;I<this.labelArr.length;I++)if(this.question&&this.question.answerResult&&this.question.answerResult[0]==this.labelArr[I].key&&this.labelArr[I].alpha){this.key=null!==(b=this.labelArr[I].alpha)&&void 0!==b?b:"";break}}actionIsFillAnswer(d){var b,I,G,_t;return!(void 0===d||!this.userAnswersObj["id_"+(null===(b=this.question)||void 0===b?void 0:b.id)])&&(this.userAnswersObj["id_"+(null===(I=this.question)||void 0===I?void 0:I.id)]=this.userAnswersObj["id_"+(null===(G=this.question)||void 0===G?void 0:G.id)].replace(/\n+/g,"\u21b5"),this.homeworkExamService.funcConvertFillAns(d.toString())===this.homeworkExamService.funcConvertFillAns(this.userAnswersObj["id_"+(null===(_t=this.question)||void 0===_t?void 0:_t.id)]))}ngOnInit(){var d,b,I,G,_t,mt;if(this.isFillAnswer=!1,!(null===(d=this.question)||void 0===d)&&d.answerResult&&(this.key=this.question.answerResult[0]),this.labelArr=null!==(I=null===(b=this.question)||void 0===b?void 0:b.answers)&&void 0!==I?I:[],this.findKey(),this.answerTypeService.isOneChoiceAnswer(null===(G=this.question)||void 0===G?void 0:G.answerType))for(let ft=0;ft<this.labelArr.length&&(this.isFillAnswer=this.isKey(this.labelArr[ft])&&this.isChosen(this.labelArr[ft]),!0!==this.isFillAnswer);ft++);if(this.answerTypeService.isFillAnswer(null===(_t=this.question)||void 0===_t?void 0:_t.answerType)&&(null===(mt=this.question)||void 0===mt?void 0:mt.answerResult)&&this.question.answerResult.length>0){this.keys=this.question.answerResult;for(let ft=0;ft<this.keys.length;ft++)if(this.actionIsFillAnswer(this.keys[ft])){this.isFillAnswer=!0;break}}this.statusResult.emit(this.isFillAnswer),super.ngOnInit()}}return p.\u0275fac=function(d){return new(d||p)(o.Y36(z.v),o.Y36(y.j),o.Y36(T.U),o.Y36(V.T),o.Y36(Y.g))},p.\u0275cmp=o.Xpm({type:p,selectors:[["azt-answer-box"]],inputs:{userAnswersObj:"userAnswersObj",question:"question",examConfig:"examConfig",notShowAnswerYet:"notShowAnswerYet",place:"place",isDisplayInExportMode:"isDisplayInExportMode",OnlineTest:"OnlineTest"},outputs:{statusResult:"statusResult"},features:[o.qOj],ngContentSelectors:xr,decls:2,vars:1,consts:[[4,"ngIf"],["class","answer-box answer-box-type2 ml-auto",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto notForPdfExport justify-content-between",4,"ngIf"],["class","answer-box answer-box-type3 ml-auto forPdfExport justify-content-between",4,"ngIf"],["class","answer-box-type1 row pl-0 pr-0 ml-0 mr-0",4,"ngIf"],[1,"answer-box-type1","row","pl-0","pr-0","ml-0","mr-0"],[1,"keyText","my-1",3,"ngStyle"],["class","answer-box ml-auto my-1","id","type_1",3,"ngStyle",4,"ngIf"],["id","type_1",1,"answer-box","ml-auto","my-1",3,"ngStyle"],["class","label-item",4,"ngFor","ngForOf"],[1,"label-item"],[3,"ngIf"],["class","rightIcon","style","color: #00ac33",4,"ngIf"],[1,"lalala"],["class","wrongIcon","style","color: red",4,"ngIf"],[1,"wrongIcon",2,"color","red"],[1,"rightIcon",2,"color","#00ac33"],["class","keyText my-1",3,"ngStyle",4,"ngIf"],["class","answer-box ml-auto my-1","id","type_2","style","padding: 0",3,"ngStyle",4,"ngIf"],["id","type_2",1,"answer-box","ml-auto","my-1",2,"padding","0",3,"ngStyle"],[1,"text-answer","answer-box","forPdfExport","justify-content-between"],["class","keyText my-1 ml-2",4,"ngIf"],["id","type_3",1,"answer-box","ml-auto","my-1",2,"border-color","00ac33"],[1,"keyText","my-1","ml-2"],["style","color: #00ac33",4,"ngIf"],["style","color: red",4,"ngIf"],[2,"color","red"],[2,"color","#00ac33"],["id","type_4",1,"answer-box","ml-auto","my-1",2,"border-color","00ac33"],[1,"text-answer"],[1,"answer-box","answer-box-type2","ml-auto"],[1,"answer-box","answer-box-type3","ml-auto","notForPdfExport","justify-content-between"],[1,"clickable",3,"click"],[3,"innerHtml"],[1,"answer-box","answer-box-type3","ml-auto","forPdfExport","justify-content-between"]],template:function(d,b){1&d&&(o.F$t(),o.Hsn(0),o.YNc(1,vr,10,11,"ng-container",0)),2&d&&(o.xp6(1),o.Q6J("ngIf",b.question))},dependencies:[H.sg,H.O5,H.PC,W.Hw,rt.bT,rt.QG,rt.DC,rt.nG,rt.Tf,rt.UG],styles:["[_nghost-%COMP%]{display:flex;justify-content:space-between;align-items:center}.answer-box-type1[_ngcontent-%COMP%]{display:flex;align-items:center}.answer-box-type1[_ngcontent-%COMP%]   .keyText[_ngcontent-%COMP%]{font-weight:500;font-size:18px;flex:auto;text-align:right;margin-right:15px}.answer-box[_ngcontent-%COMP%]{width:300px;display:flex;justify-content:space-around;background-color:#f7f7f7;padding:10px;border:1px solid #f1f1f1;border-radius:3px}.answer-box[_ngcontent-%COMP%]   .label-item[_ngcontent-%COMP%]{font-weight:500;display:flex;align-items:center;font-size:18px;width:40px;justify-content:flex-end}.answer-box.answer-box-type3[_ngcontent-%COMP%]{width:100%}.text-answer[_ngcontent-%COMP%]{width:100%;min-height:40px;max-height:120px;overflow:auto;padding:10px}textarea[_ngcontent-%COMP%]:focus{border:none!important}.ans-4[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical}@media screen and (max-width: 480px){.answer-box[_ngcontent-%COMP%]{width:auto}.text-answer[_ngcontent-%COMP%]{width:180px;max-height:auto}}"]}),p})();var ps=w(93075),yr=w(24096),wr=w(87238);function ae(p,L){1&p&&(o.TgZ(0,"span",9),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij("\xa0",o.lcZ(2,1,"lang_auto_het_luot"),""))}function In(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"mat-icon",15),o.NdJ("click",function(){o.CHM(d);const I=o.oxw().$implicit,G=o.oxw(4);let _t;return o.KtG(G.playAudio(G.questionObj.id||-1,null!==(_t=I.index)&&void 0!==_t?_t:0))}),o.ALo(1,"mytranslate"),o._uU(2,"play_arrow"),o.qZA()}2&p&&o.s9C("matTooltip",o.lcZ(1,1,"lang_auto_bat_dau"))}function br(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"mat-icon",16),o.NdJ("click",function(){o.CHM(d);const I=o.oxw().$implicit,G=o.oxw(4);let _t;return o.KtG(G.stopAudio(G.questionObj.id||-1,null!==(_t=I.index)&&void 0!==_t?_t:0))}),o.ALo(1,"mytranslate"),o._uU(2,"delete"),o.qZA()}2&p&&o.s9C("matTooltip",o.lcZ(1,1,"lang_auto_ket_thuc"))}function En(p,L){if(1&p&&(o.TgZ(0,"span",10),o.YNc(1,In,3,3,"mat-icon",11),o.YNc(2,br,3,3,"mat-icon",12),o.TgZ(3,"audio",13),o._UZ(4,"source",14),o.ALo(5,"safe"),o.ALo(6,"mycdn"),o.qZA()()),2&p){const d=L.$implicit,b=o.oxw(4);let I,G;o.Q6J("hidden",!d.status),o.xp6(1),o.Q6J("ngIf",!b.checkAudioPlay(b.questionObj.id||-1,null!==(I=d.index)&&void 0!==I?I:0)),o.xp6(1),o.Q6J("ngIf",b.checkAudioPlay(b.questionObj.id||-1,null!==(G=d.index)&&void 0!==G?G:0)),o.xp6(1),o.s9C("id",b.isShowList?"audio_list_"+b.questionObj.id+"_"+d.index:"audio_unit_"+b.questionObj.id+"_"+d.index),o.xp6(1),o.Q6J("src",o.lcZ(5,5,o.lcZ(6,7,b.questionObj.attachments[0].url)),o.LSH)}}function Tr(p,L){if(1&p&&(o.TgZ(0,"div",5)(1,"span",6),o._uU(2),o.ALo(3,"mytranslate"),o.qZA(),o.YNc(4,ae,3,3,"span",7),o.YNc(5,En,7,9,"ng-template",8),o.qZA()),2&p){const d=o.oxw(3);o.xp6(2),o.hij("",o.lcZ(3,3,"lang_auto_so_luot_nghe"),": "),o.xp6(2),o.Q6J("ngIf",d.questionObj.limitAudio==d.totalLimit),o.xp6(1),o.Q6J("ngForOf",d.questionObj.audioLimitObjs)}}function Ar(p,L){if(1&p&&(o.TgZ(0,"div",3),o.YNc(1,Tr,6,5,"div",4),o.qZA()),2&p){const d=o.oxw(2);o.xp6(1),o.Q6J("ngIf",(null!=d.questionObj.limitAudio?d.questionObj.limitAudio:d.totalLimit+1)<=d.totalLimit)}}function zn(p,L){if(1&p&&(o.TgZ(0,"div"),o.YNc(1,Ar,2,1,"div",2),o.qZA()),2&p){const d=o.oxw();o.xp6(1),o.Q6J("ngIf",d.questionObj.attachments&&d.questionObj.attachments.length>0)}}function Vn(p,L){if(1&p&&(o.TgZ(0,"div",18)(1,"audio",19),o._UZ(2,"source",14),o.ALo(3,"safe"),o.ALo(4,"mycdn"),o.qZA()()),2&p){const d=o.oxw(2);o.xp6(1),o.s9C("id","audio_"+d.questionObj.id),o.xp6(1),o.Q6J("src",o.lcZ(3,2,o.lcZ(4,4,d.questionObj.attachments[0].url)),o.LSH)}}function xi(p,L){if(1&p&&o.YNc(0,Vn,5,6,"div",17),2&p){const d=o.oxw();o.Q6J("ngIf",d.questionObj.attachments&&d.questionObj.attachments.length>0)}}let yi=(()=>{class p extends C.Q{constructor(d){super(d),this.commonService=d,this.questionObj={answerLabelsMockup:{}},this.totalLimit=0,this.isShowList=!0,this.sendAudioEmitter=new o.vpe,this.subscriptions=new yr.w,this.form=new ps.nJ({})}detectAllAudioPlaying(){var d=!1;let b=document.getElementsByTagName("audio");for(let I=0;I<b.length;I++)if(b[I].duration>0&&!b[I].paused){d=!0;break}return d}playAudio(d,b){var I=this.isShowList?document.getElementById("audio_list_"+d+"_"+b):document.getElementById("audio_unit_"+d+"_"+b);I&&(this.detectAllAudioPlaying()?this.commonService.getTranslate("lang_auto_file_dang_duoc_phat").subscribe(G=>{this.commonService.snackWarning(G,"")}):(this.sendAudioEmitter.emit({obj:this.questionObj,play:1,index:b}),I.play()))}stopAudio(d,b){var I=this.isShowList?document.getElementById("audio_list_"+d+"_"+b):document.getElementById("audio_unit_"+d+"_"+b);I&&I.duration>0&&!I.paused&&(I.pause(),I.currentTime=0,I.setAttribute("src",""),this.sendAudioEmitter.emit({obj:this.questionObj,play:0,index:b}))}checkAudioPlay(d,b){var I=this.isShowList?document.getElementById("audio_list_"+d+"_"+b):document.getElementById("audio_unit_"+d+"_"+b);return!!I&&(I.duration>0&&!I.paused||((I.ended||I.currentTime>0&&I.paused)&&(I.currentTime=0,I.setAttribute("src",""),this.sendAudioEmitter.emit({obj:this.questionObj,play:0,index:b})),!1))}ngOnInit(){super.ngOnInit()}}return p.\u0275fac=function(d){return new(d||p)(o.Y36(z.v))},p.\u0275cmp=o.Xpm({type:p,selectors:[["azt-test-audio-ui"]],inputs:{questionObj:"questionObj",totalLimit:"totalLimit",isShowList:"isShowList"},outputs:{sendAudioEmitter:"sendAudioEmitter"},features:[o.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["NormalAudio",""],["class","text-left ml-auto mr-auto",4,"ngIf"],[1,"text-left","ml-auto","mr-auto"],["class","limit_audio",4,"ngIf"],[1,"limit_audio"],[1,"mb-0",2,"font-size","14px","font-weight","400"],["class","mb-0","style","font-size: 14px; font-weight: 450;color: #da0522 ",4,"ngIf"],["ngFor","",3,"ngForOf"],[1,"mb-0",2,"font-size","14px","font-weight","450","color","#da0522"],[1,"audio-control",3,"hidden"],["style","vertical-align: middle; line-height: 1; color: #000",3,"matTooltip","click",4,"ngIf"],["style","vertical-align: middle; line-height: 1; color: #da0522",3,"matTooltip","click",4,"ngIf"],["preload","true",3,"id"],[3,"src"],[2,"vertical-align","middle","line-height","1","color","#000",3,"matTooltip","click"],[2,"vertical-align","middle","line-height","1","color","#da0522",3,"matTooltip","click"],["class","text-center ml-auto mr-auto",4,"ngIf"],[1,"text-center","ml-auto","mr-auto"],["controls","","preload","true",2,"margin-left","10px","margin-right","10px","max-width","70%",3,"id"]],template:function(d,b){if(1&d&&(o.YNc(0,zn,2,1,"div",0),o.YNc(1,xi,1,1,"ng-template",null,1,o.W1O)),2&d){const I=o.MAs(2);o.Q6J("ngIf",b.totalLimit>0)("ngIfElse",I)}},dependencies:[H.sg,H.O5,W.Hw,wr.gM,rt.bT,rt.GT,rt.yl],styles:[".limit_audio[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center}.audio-control[_ngcontent-%COMP%]{border-radius:50%;background-color:#f0f3f4;color:#000;padding:5px;height:35px;width:35px;margin-left:5px;cursor:pointer;text-align:center}"]}),p})();const wi=function(p,L){return{"selected-group":p,clickable:L}};function bi(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",11),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(4);let G;return o.KtG(9==I.displayScreen?I.handleClickGroup(null!==(G=null==I.question.groupInfo?null:I.question.groupInfo.groupId)&&void 0!==G?G:0):null)}),o.ALo(1,"safeContentQuestion"),o.qZA()}if(2&p){const d=o.oxw(4);o.Q6J("innerHtml",o.lcZ(1,2,(null==d.question.groupInfo?null:d.question.groupInfo.groupContent)||""),o.oJD)("ngClass",o.WLB(4,wi,9==d.displayScreen&&void 0!==d.state.chosenGroup&&(null==d.question.groupInfo?null:d.question.groupInfo.groupId)===d.state.chosenGroup,9==d.displayScreen))}}function fs(p,L){if(1&p&&(o.ynx(0),o.YNc(1,bi,2,7,"div",10),o.BQk()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("ngIf",null==d.question.groupInfo?null:d.question.groupInfo.isFirstInGroup)}}function vs(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"azt-test-audio-ui",12),o.NdJ("sendAudioEmitter",function(I){o.CHM(d);const G=o.oxw(3);return o.KtG(G.sendAudio(I))}),o.qZA()}if(2&p){const d=o.oxw(3);o.Q6J("questionObj",d.question)("isShowList",!0)("totalLimit",(d.examObj.limitAudio||-1)>0?d.examObj.limitAudio||-1:0)}}function Ir(p,L){if(1&p&&(o.TgZ(0,"div",15)(1,"b",16),o._uU(2),o.qZA(),o._UZ(3,"div",17),o.ALo(4,"safeContentQuestion"),o.qZA()),2&p){const d=L.$implicit;let b;o.xp6(2),o.hij("",null!==(b=d.alpha)&&void 0!==b?b:d.key,"."),o.xp6(1),o.Q6J("innerHtml",o.lcZ(4,2,d.content||""),o.oJD)}}function xs(p,L){if(1&p&&(o.TgZ(0,"div",13),o.YNc(1,Ir,5,4,"div",14),o.qZA()),2&p){const d=o.oxw(3);o.xp6(1),o.Q6J("ngForOf",d.question.answers)}}const ys=function(p,L,d,b,I){return{"box-slide-show":p,"quesion-test-finder":L,"mb-0":d,"border-none":b,"pb-2":I}},Ti=function(p,L){return{selected:p,clickable:L}};function ws(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",4),o.YNc(1,fs,2,1,"ng-container",3),o.TgZ(2,"div",5),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(2);return o.KtG(9==I.displayScreen?I.handleSelect(I.question):null)}),o.YNc(3,vs,1,3,"azt-test-audio-ui",6),o.TgZ(4,"div",7),o._uU(5),o.qZA(),o._UZ(6,"div",8),o.ALo(7,"safeContentQuestion"),o.YNc(8,xs,2,1,"div",9),o.qZA()()}if(2&p){const d=o.oxw(2);o.Q6J("ngClass",o.qbA(9,ys,2==d.displayScreen,9==d.displayScreen,2==d.displayScreen,8==d.displayScreen,d.question.attachments&&d.question.attachments.length>0)),o.xp6(1),o.Q6J("ngIf",!((d.examObj.hideGroupQuestion||null!=d.configExam&&d.configExam.hideGroupQuestion)&&!d.isBackEnd)),o.xp6(1),o.Q6J("ngClass",o.WLB(15,Ti,d.question.isSelected,9==d.displayScreen)),o.xp6(1),o.Q6J("ngIf",2==d.displayScreen&&d.question.attachments&&d.question.attachments.length>0),o.xp6(2),o.Oqu(d.labelType+" "+(d.index+1)),o.xp6(1),o.Q6J("innerHtml",o.lcZ(7,7,d.question.content||""),o.oJD),o.xp6(2),o.Q6J("ngIf",1==d.question.answerType&&d.question.answers&&d.question.answers.length>0)}}const Er=function(p){return{width:p}};function Ai(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"span",22),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(4);return o.KtG(I.showExplain())}),o._uU(1),o.ALo(2,"mytranslate"),o.TgZ(3,"mat-icon"),o._uU(4),o.qZA()()}if(2&p){const d=o.oxw(4);o.Q6J("ngStyle",o.VKq(6,Er,d.question.help?"125px":"0px")),o.uIk("style",d.question.help&&!d.notShowAnswerYet?"visibility:  visible !important":"visibility:  hidden !important",o.Ckj),o.xp6(1),o.hij(" ",o.lcZ(2,4,"lang_auto_giai_thich")," "),o.xp6(3),o.Oqu(d.isShowExplain?"expand_less":"expand_more")}}const Ii=function(p){return{"justify-content":p}};function Ei(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"azt-answer-box",20),o.NdJ("statusResult",function(I){o.CHM(d);const G=o.oxw(3);return o.KtG(G.returnStatusResult(I))}),o.YNc(1,Ai,5,8,"span",21),o.qZA()}if(2&p){const d=o.oxw(3);o.Q6J("question",d.question)("userAnswersObj",d.userAnswersObj)("place",d.place)("examConfig",d.configExam)("notShowAnswerYet",d.notShowAnswerYet)("ngStyle",o.VKq(7,Ii,2==(null==d.configExam?null:d.configExam.whenShowAnswer)?"flex-end":"space-between")),o.xp6(1),o.Q6J("ngIf",2!=(null==d.configExam?null:d.configExam.whenShowAnswer))}}const Wt=function(p,L){return{width:p,visibility:L}};function ne(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"azt-answer-box",23),o.NdJ("statusResult",function(I){o.CHM(d);const G=o.oxw(3);return o.KtG(G.returnStatusResult(I))}),o.TgZ(1,"span",22),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(3);return o.KtG(I.showExplain())}),o._uU(2),o.ALo(3,"mytranslate"),o.TgZ(4,"mat-icon"),o._uU(5),o.qZA()()()}if(2&p){const d=o.oxw(3);o.Q6J("place",d.place)("question",d.question)("userAnswersObj",d.userAnswersObj)("isDisplayInExportMode",!1)("examConfig",d.configExam)("OnlineTest",d.OnlineTest),o.xp6(1),o.Q6J("ngStyle",o.WLB(11,Wt,d.question.help?"125px":"0px",d.question.help?"visible":"hidden")),o.xp6(1),o.hij(" ",o.lcZ(3,9,"lang_auto_giai_thich")," "),o.xp6(3),o.Oqu(d.isShowExplain?"expand_less":"expand_more")}}function Jn(p,L){if(1&p&&(o.ynx(0),o.YNc(1,Ei,2,9,"azt-answer-box",18),o.YNc(2,ne,6,14,"azt-answer-box",19),o.BQk()),2&p){const d=o.oxw(2);o.xp6(1),o.Q6J("ngIf",!(null!=d.question&&d.question.isRoleTeacher)),o.xp6(1),o.Q6J("ngIf",null==d.question?null:d.question.isRoleTeacher)}}function Ci(p,L){if(1&p&&(o.TgZ(0,"span",31),o._uU(1),o.qZA()),2&p){const d=o.oxw(5);o.xp6(1),o.hij(" ",d.question.choseAnswer," ")}}function Cr(p,L){1&p&&(o.TgZ(0,"span")(1,"b",32),o._uU(2),o.ALo(3,"mytranslate"),o.qZA()()),2&p&&(o.xp6(2),o.Oqu(o.lcZ(3,1,"lang_auto_chua_tra_loi")))}function Or(p,L){if(1&p&&(o.TgZ(0,"div",28)(1,"p",29),o._uU(2),o.ALo(3,"mytranslate"),o.qZA(),o.YNc(4,Ci,2,1,"span",30),o.YNc(5,Cr,4,3,"span",3),o.qZA()),2&p){const d=o.oxw(4);o.xp6(2),o.hij("",o.lcZ(3,3,"lang_auto_dap_an_cua_ban"),": "),o.xp6(2),o.Q6J("ngIf",d.question.choseAnswer&&""!=d.question.choseAnswer),o.xp6(1),o.Q6J("ngIf",!d.question.choseAnswer||""==d.question.choseAnswer)}}function bs(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"textarea",36),o.NdJ("focus",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,4))}),o._uU(1),o.qZA()}if(2&p){const d=o.oxw(5);o.s9C("id","answer-0-all-"+d.question.id),o.uIk("question_id",d.question.id),o.xp6(1),o.hij("                                ",d.question.choseAnswer,"\n                            ")}}function Sr(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"textarea",36),o.NdJ("focus",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,4))}),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()}if(2&p){const d=o.oxw(5);o.s9C("id","answer-0-all-"+d.question.id),o.uIk("question_id",d.question.id),o.xp6(1),o.hij("                                ",o.lcZ(2,3,"lang_auto_thi_sinh_chua_nhap_thong_tin"),"\n                            ")}}const Cn=function(p){return{"w-100":p}};function Oi(p,L){if(1&p&&(o.TgZ(0,"div",28)(1,"p",29),o._uU(2),o.ALo(3,"mytranslate"),o.qZA(),o.TgZ(4,"div",33)(5,"div",34),o.YNc(6,bs,2,3,"textarea",35),o.YNc(7,Sr,3,5,"textarea",35),o.qZA()()()),2&p){const d=o.oxw(4);o.xp6(2),o.hij("",o.lcZ(3,4,"lang_auto_dap_an_cua_ban"),": "),o.xp6(2),o.Q6J("ngClass",o.VKq(6,Cn,d.isMobile)),o.xp6(2),o.Q6J("ngIf",d.question.choseAnswer&&""!=d.question.choseAnswer),o.xp6(1),o.Q6J("ngIf",!d.question.choseAnswer||""==d.question.choseAnswer)}}function Si(p,L){if(1&p&&(o.ynx(0),o.TgZ(1,"div",26),o.YNc(2,Or,6,5,"div",27),o.ALo(3,"isOneChoiceAnswer"),o.YNc(4,Oi,8,8,"div",27),o.ALo(5,"isEssayAnswer"),o.ALo(6,"isFillAnswer"),o.qZA(),o.BQk()),2&p){const d=o.oxw(3);o.xp6(2),o.Q6J("ngIf",o.lcZ(3,2,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(5,4,d.question.answerType)||o.lcZ(6,6,d.question.answerType))}}function kr(p,L){1&p&&(o.TgZ(0,"p",29),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_dap_an_cua_ban"),": "))}function ki(p,L){if(1&p&&(o.TgZ(0,"span",46),o._uU(1),o.qZA()),2&p){const d=o.oxw().$implicit;o.xp6(1),o.hij(" ",d.alpha?d.alpha:d.key," ")}}function Ts(p,L){if(1&p&&(o.TgZ(0,"span",47),o._uU(1),o.qZA()),2&p){const d=o.oxw().$implicit;o.xp6(1),o.hij(" ",d.alpha?d.alpha:d.key," ")}}function Mr(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"li",43),o.NdJ("click",function(){const I=o.CHM(d),G=I.$implicit,_t=I.index,mt=o.oxw(6);return o.KtG(mt.setAnswer(mt.question.id||-1,G,2,!1,_t,G.alpha,G.key,mt.index))}),o.YNc(1,ki,2,1,"span",44),o.YNc(2,Ts,2,1,"span",45),o.qZA()}if(2&p){const d=L.$implicit;o.xp6(1),o.Q6J("ngIf",!d.checked),o.xp6(1),o.Q6J("ngIf",d.checked)}}const un=function(p){return{"list-answer-mobile":p}};function Mi(p,L){if(1&p&&(o.TgZ(0,"div")(1,"div",28),o.YNc(2,kr,3,3,"p",39),o.TgZ(3,"div",40)(4,"ul",41),o.YNc(5,Mr,3,2,"li",42),o.qZA()()()()),2&p){const d=o.oxw(5);o.xp6(2),o.Q6J("ngIf",!d.isMobile),o.xp6(1),o.Q6J("ngClass",o.VKq(3,un,d.isMobile)),o.xp6(2),o.Q6J("ngForOf",d.question.answers)}}function Di(p,L){1&p&&(o.TgZ(0,"p",53),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_bai_lam_cua_ban"),": "))}const On=function(p,L){return{"justify-content-between":p,"justify-content-center":L}};function Gn(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",48)(1,"div",49),o.YNc(2,Di,3,3,"p",50),o.TgZ(3,"div",51)(4,"div",34)(5,"textarea",52),o.NdJ("focus",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,4))})("keyup",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,4))})("change",function(I){o.CHM(d);const G=o.oxw(5);return o.KtG(G.setAnswerType3(G.question.id||-1,I,3,!1,0))}),o.qZA()()()()()}if(2&p){const d=o.oxw(5);o.Q6J("ngClass",o.WLB(8,On,!d.isMobile,d.isMobile)),o.xp6(1),o.Q6J("ngClass",o.VKq(11,un,d.isMobile)),o.xp6(1),o.Q6J("ngIf",!d.isMobile),o.xp6(1),o.Q6J("ngClass",o.VKq(13,Cn,d.isMobile)),o.xp6(2),o.s9C("id","answer-0-all-"+d.question.id),o.Q6J("value",d.question.essayText),o.uIk("isImage",!1)("question_id",d.question.id)}}function Sn(p,L){1&p&&(o.TgZ(0,"p",53),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_dap_an_cua_ban"),": "))}function As(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",48)(1,"div",49),o.YNc(2,Sn,3,3,"p",50),o.TgZ(3,"div",51)(4,"div",34)(5,"textarea",52),o.NdJ("focus",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,4))})("keyup",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,4))})("change",function(I){o.CHM(d);const G=o.oxw(5);return o.KtG(G.setAnswerType3(G.question.id||-1,I,3,!1,0))}),o.qZA()()()()()}if(2&p){const d=o.oxw(5);o.Q6J("ngClass",o.WLB(8,On,!d.isMobile,d.isMobile)),o.xp6(1),o.Q6J("ngClass",o.VKq(11,un,d.isMobile)),o.xp6(1),o.Q6J("ngIf",!d.isMobile),o.xp6(1),o.Q6J("ngClass",o.VKq(13,Cn,d.isMobile)),o.xp6(2),o.s9C("id","answer-0-all-"+d.question.id),o.Q6J("value",d.question.essayText),o.uIk("isImage",!1)("question_id",d.question.id)}}function Is(p,L){if(1&p&&(o.ynx(0),o.TgZ(1,"div",26),o.YNc(2,Mi,6,5,"div",3),o.ALo(3,"isOneChoiceAnswer"),o.YNc(4,Gn,6,15,"div",38),o.ALo(5,"isEssayAnswer"),o.YNc(6,As,6,15,"div",38),o.ALo(7,"isFillAnswer"),o.qZA(),o.BQk()),2&p){const d=o.oxw(4);o.xp6(2),o.Q6J("ngIf",o.lcZ(3,3,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(5,5,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(7,7,d.question.answerType))}}function Es(p,L){1&p&&(o.TgZ(0,"p",29),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_dap_an_cua_ban"),": "))}function Kn(p,L){if(1&p&&(o.TgZ(0,"span",46),o._uU(1),o.qZA()),2&p){const d=o.oxw().$implicit;o.xp6(1),o.hij(" ",d.alpha?d.alpha:d.key," ")}}function Dr(p,L){if(1&p&&(o.TgZ(0,"span",47),o._uU(1),o.qZA()),2&p){const d=o.oxw().$implicit;o.xp6(1),o.hij(" ",d.alpha?d.alpha:d.key," ")}}function Rr(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"li",43),o.NdJ("click",function(){const I=o.CHM(d),G=I.$implicit,_t=I.index,mt=o.oxw(6);return o.KtG(mt.setAnswer(mt.question.id||-1,G,2,!1,_t,G.alpha,G.key,mt.index))}),o.YNc(1,Kn,2,1,"span",44),o.YNc(2,Dr,2,1,"span",45),o.qZA()}if(2&p){const d=L.$implicit;o.xp6(1),o.Q6J("ngIf",!d.checked),o.xp6(1),o.Q6J("ngIf",d.checked)}}function hn(p,L){1&p&&(o.TgZ(0,"mat-icon",63),o._uU(1," arrow_forward "),o.qZA())}function Lr(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div")(1,"div",28),o.YNc(2,Es,3,3,"p",39),o.TgZ(3,"div",57)(4,"ul",58),o.YNc(5,Rr,3,2,"li",59),o.qZA()(),o.TgZ(6,"a",60),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.last?I.openSubmitExam():I.nextQuestion(I.index))}),o.TgZ(7,"span",61),o._uU(8),o.ALo(9,"mytranslate"),o.ALo(10,"mytranslate"),o.qZA(),o.YNc(11,hn,2,0,"mat-icon",62),o.qZA()()()}if(2&p){const d=o.oxw(5);o.xp6(2),o.Q6J("ngIf",!d.isMobile),o.xp6(3),o.Q6J("ngForOf",d.question.answers),o.xp6(3),o.lnq("",d.last?o.lcZ(9,6,"lang_auto_nop_bai"):o.lcZ(10,8,"lang_auto_cau_tiep"),"\xa0(",d.index+1,"/",d.countQuestion,")"),o.xp6(3),o.Q6J("ngIf",!d.last)}}function Nr(p,L){1&p&&(o.TgZ(0,"p",53),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_bai_lam_cua_ban"),": "))}const Je=function(p){return{disabled:p}};function Cs(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",48)(1,"div",64),o.YNc(2,Nr,3,3,"p",50),o.TgZ(3,"div",51)(4,"div",34)(5,"textarea",52),o.NdJ("focus",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,2))})("keyup",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,2))})("change",function(I){o.CHM(d);const G=o.oxw(5);return o.KtG(G.setAnswerType3(G.question.id||-1,I,3,!1,0))}),o.qZA()()()(),o.TgZ(6,"div",65)(7,"a",66),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.nextQuestion(I.index))}),o.TgZ(8,"span",61),o._uU(9),o.ALo(10,"mytranslate"),o.qZA(),o.TgZ(11,"mat-icon",63),o._uU(12," arrow_forward "),o.qZA()()()()}if(2&p){const d=o.oxw(5);o.Q6J("ngClass",o.WLB(13,On,!d.isMobile,d.isMobile)),o.xp6(2),o.Q6J("ngIf",!d.isMobile),o.xp6(1),o.Q6J("ngClass",o.VKq(16,Cn,d.isMobile)),o.xp6(2),o.s9C("id","answer-0-unit-"+d.question.id),o.Q6J("value",d.question.essayText),o.uIk("isImage",!1)("question_id",d.question.id),o.xp6(2),o.Q6J("ngClass",o.VKq(18,Je,d.last)),o.xp6(2),o.lnq("",o.lcZ(10,11,"lang_auto_cau_tiep_"),"",d.index+1,"/",d.countQuestion,")")}}function Yn(p,L){1&p&&(o.TgZ(0,"p",53),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&p&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_auto_dap_an_cua_ban"),": "))}function Os(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",48)(1,"div",64),o.YNc(2,Yn,3,3,"p",50),o.TgZ(3,"div",51)(4,"div",34)(5,"textarea",52),o.NdJ("focus",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,2))})("keyup",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.autoResizeEssayAnswer(I.question.id||-1,2))})("change",function(I){o.CHM(d);const G=o.oxw(5);return o.KtG(G.setAnswerType3(G.question.id||-1,I,3,!1,0))}),o.qZA()()()(),o.TgZ(6,"div",65)(7,"a",66),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(5);return o.KtG(I.nextQuestion(I.index))}),o.TgZ(8,"span",61),o._uU(9),o.ALo(10,"mytranslate"),o.qZA(),o.TgZ(11,"mat-icon",63),o._uU(12," arrow_forward "),o.qZA()()()()}if(2&p){const d=o.oxw(5);o.Q6J("ngClass",o.WLB(13,On,!d.isMobile,d.isMobile)),o.xp6(2),o.Q6J("ngIf",!d.isMobile),o.xp6(1),o.Q6J("ngClass",o.VKq(16,Cn,d.isMobile)),o.xp6(2),o.s9C("id","answer-0-unit-"+d.question.id),o.Q6J("value",d.question.essayText),o.uIk("isImage",!1)("question_id",d.question.id),o.xp6(2),o.Q6J("ngClass",o.VKq(18,Je,d.last)),o.xp6(2),o.lnq("",o.lcZ(10,11,"lang_auto_cau_tiep_"),"",d.index+1,"/",d.countQuestion,")")}}function kn(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",26),o.YNc(1,Lr,12,10,"div",3),o.ALo(2,"isOneChoiceAnswer"),o.YNc(3,Cs,13,20,"div",38),o.ALo(4,"isEssayAnswer"),o.YNc(5,Os,13,20,"div",38),o.ALo(6,"isFillAnswer"),o.qZA(),o.TgZ(7,"a",54),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(4);return o.KtG(I.prevQuestion(I.index))}),o.TgZ(8,"mat-icon",55),o._uU(9,"arrow_back_ios_new"),o.qZA()(),o.TgZ(10,"a",56),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(4);return o.KtG(I.nextQuestion(I.index))}),o.TgZ(11,"mat-icon",55),o._uU(12,"arrow_forward_ios"),o.qZA()()}if(2&p){const d=o.oxw(4);o.xp6(1),o.Q6J("ngIf",o.lcZ(2,5,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(4,7,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(6,9,d.question.answerType)),o.xp6(2),o.Q6J("hidden",0==d.index),o.xp6(3),o.Q6J("hidden",d.index==d.questionListLength-1)}}function Ri(p,L){if(1&p&&(o.YNc(0,Is,8,9,"ng-container",24),o.YNc(1,kn,13,11,"ng-template",null,37,o.W1O)),2&p){const d=o.MAs(2),b=o.oxw(3);o.Q6J("ngIf",b.showList)("ngIfElse",d)}}function le(p,L){if(1&p&&(o.ynx(0),o.YNc(1,Si,7,8,"ng-container",24),o.YNc(2,Ri,3,2,"ng-template",null,25,o.W1O),o.BQk()),2&p){const d=o.MAs(3),b=o.oxw(2);o.xp6(1),o.Q6J("ngIf",b.overTime)("ngIfElse",d)}}function Ss(p,L){if(1&p&&(o.TgZ(0,"span",46),o._uU(1),o.qZA()),2&p){const d=o.oxw().$implicit;o.xp6(1),o.hij(" ",d.key," ")}}function Mn(p,L){if(1&p&&(o.TgZ(0,"span",47),o._uU(1),o.qZA()),2&p){const d=o.oxw().$implicit;o.xp6(1),o.hij(" ",d.key," ")}}function Hn(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"li",43),o.NdJ("click",function(){const I=o.CHM(d),G=I.$implicit,_t=I.index,mt=o.oxw(4);let ft;return o.KtG(mt.setAnswerOnUpdate(null!==(ft=mt.question.id)&&void 0!==ft?ft:0,G,2,!1,null!==(ft=mt.question.scorePerQuestion)&&void 0!==ft?ft:0,_t))}),o.YNc(1,Ss,2,1,"span",71),o.YNc(2,Mn,2,1,"span",72),o.qZA()}if(2&p){const d=L.$implicit;o.xp6(1),o.Q6J("ngIf",!d.isTrue),o.xp6(1),o.Q6J("ngIf",d.isTrue)}}function ks(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"a",73),o.NdJ("click",function(){o.CHM(d);const I=o.oxw(4);let G;return o.KtG(I.showResultQuestion(null!==(G=I.question.id)&&void 0!==G?G:0))}),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()}2&p&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"lang_auto_xem_giai_thich")))}function Li(p,L){if(1&p&&(o.TgZ(0,"div",26)(1,"div")(2,"div",57)(3,"ul",41),o.YNc(4,Hn,3,2,"li",42),o.qZA()()(),o.TgZ(5,"div",69),o.YNc(6,ks,3,3,"a",70),o.qZA()()),2&p){const d=o.oxw(3);o.xp6(4),o.Q6J("ngForOf",d.question.answers),o.xp6(2),o.Q6J("ngIf",d.question.answerMedia&&d.question.answerMedia.length>0)}}function Ms(p,L){1&p&&(o.TgZ(0,"mat-icon",84),o._uU(1,"cancel"),o.qZA())}function Ds(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"mat-chip",82),o.NdJ("removed",function(){const G=o.CHM(d).$implicit,_t=o.oxw(4);let mt;return o.KtG(_t.removeAnswerType4(null!==(mt=_t.question.id)&&void 0!==mt?mt:0,G))}),o._uU(1),o.YNc(2,Ms,2,0,"mat-icon",83),o.qZA()}if(2&p){const d=L.$implicit,b=o.oxw(4);o.Q6J("selectable",b.selectable)("removable",b.removable),o.xp6(1),o.hij(" ",d," "),o.xp6(1),o.Q6J("ngIf",b.removable)}}const Dn=function(p){return{"on-change":p}};function Ni(p,L){if(1&p){const d=o.EpF();o.TgZ(0,"div",74)(1,"div",75)(2,"mat-form-field",76)(3,"mat-label",77),o._uU(4),o.ALo(5,"mytranslate"),o.ALo(6,"mytranslate"),o.qZA(),o.TgZ(7,"mat-chip-list",78,79),o.ALo(9,"mytranslate"),o.YNc(10,Ds,3,4,"mat-chip",80),o.TgZ(11,"input",81),o.NdJ("matChipInputTokenEnd",function(I){o.CHM(d);const G=o.oxw(3);let _t;return o.KtG(G.setAnswerType4(null!==(_t=G.question.id)&&void 0!==_t?_t:0,I))}),o.ALo(12,"mytranslate"),o.qZA()()()()()}if(2&p){const d=o.MAs(8),b=o.oxw(3);o.xp6(2),o.Q6J("ngClass",o.VKq(16,Dn,b.question.onChanges)),o.xp6(2),o.hij(" ",b.question.onChanges?o.lcZ(5,8,"lang_testbank_update_exam_changed_answer"):o.lcZ(6,10,"lang_testbank_update_exam_lisst_recognize_answer"),""),o.xp6(3),o.s9C("aria-label",o.lcZ(9,12,"lang_testbank_update_exam_recognize_answer")),o.xp6(3),o.Q6J("ngForOf",b.question.answerResult),o.xp6(1),o.s9C("placeholder",o.lcZ(12,14,"lang_testbank_update_exam_add_ansswer")),o.Q6J("matChipInputFor",d)("matChipInputSeparatorKeyCodes",b.separatorKeysCodes)("matChipInputAddOnBlur",b.addOnBlur)}}function Pi(p,L){if(1&p&&(o.ynx(0),o.YNc(1,Li,7,2,"div",67),o.ALo(2,"isOneChoiceAnswer"),o.YNc(3,Ni,13,18,"div",68),o.ALo(4,"isFillAnswer"),o.BQk()),2&p){const d=o.oxw(2);o.xp6(1),o.Q6J("ngIf",o.lcZ(2,2,d.question.answerType)),o.xp6(2),o.Q6J("ngIf",o.lcZ(4,4,d.question.answerType))}}function qi(p,L){if(1&p&&(o.YNc(0,ws,9,18,"div",2),o.YNc(1,Jn,3,2,"ng-container",3),o.YNc(2,le,4,2,"ng-container",3),o.YNc(3,Pi,5,6,"ng-container",3),o.Hsn(4)),2&p){const d=o.oxw();o.Q6J("ngIf",d.question),o.xp6(1),o.Q6J("ngIf",3==d.displayScreen||4==d.displayScreen),o.xp6(1),o.Q6J("ngIf",d.question&&2==d.displayScreen),o.xp6(1),o.Q6J("ngIf",d.question&&8==d.displayScreen)}}function $n(p,L){1&p&&o.GkF(0)}const Ge=[[["","customSlot",""]]],$e=["[customSlot]"];let Pr=(()=>{class p extends C.Q{constructor(d,b,I,G,_t,mt){super(d),this.commonService=d,this.cdnService=b,this.store=I,this.homeworkExamService=G,this.customQuestionAnswerConfig=_t,this.answerTypeService=mt,this.index=0,this.last=!1,this.userAnswersObj={},this.labelType="C\xe2u",this.displayScreen=1,this.notShowAnswerYet=!1,this.isDisplayInExportMode=!1,this.place="multiple_choice",this.OnlineTest=!0,this.allowAskQuestion=0,this.isShowExplain=!1,this.isMobile=!1,this.showList=!1,this.overTime=!1,this.countQuestion=0,this.examObj={},this.sendAudioEmit=new o.vpe,this.autoResizeEssayAnswerEmitter=new o.vpe,this.setAnswerEmitter=new o.vpe,this.setAnswerEssayEmitter=new o.vpe,this.setResultTracking=new o.vpe,this.removeImgEmitter=new o.vpe,this.openSubmitExamEmitter=new o.vpe,this.nextQuestionEmitter=new o.vpe,this.prevQuestionEmitter=new o.vpe,this.goToQuestionEmitter=new o.vpe,this.goToQuestionAllEmitter=new o.vpe,this.statusResult=new o.vpe,this.removable=!0,this.separatorKeysCodes=[s.K5],this.selectable=!0,this.addOnBlur=!0,this.showResultQuestionEmit=new o.vpe,this.setAnswerOnUpdateEmit=new o.vpe,this.setAnswerType4UpdateEmit=new o.vpe,this.removeAnswerType4Emit=new o.vpe,this.partRenderService=new K(b,d),this.partRenderService.callbackPushImage=this.pushImage,this.partRenderService.caller=this}handleClickGroup(d){this.store.dispatch(et.AJ({groupId:d}))}handleSelect(d){d.isSelected=!d.isSelected}showExplain(){this.isShowExplain=!this.isShowExplain}returnStatusResult(d){this.statusResult.emit(d)}openSubmitExam(){this.openSubmitExamEmitter.emit(!0)}nextQuestion(d){this.nextQuestionEmitter.emit(d)}prevQuestion(d){this.prevQuestionEmitter.emit(d)}sendAudio(d){d&&this.sendAudioEmit.emit(d)}autoResizeEssayAnswer(d,b){this.autoResizeEssayAnswerEmitter.emit({id:d,type:b})}setAnswer(d,b,I,G,_t,mt,ft,We){var Xe,Wn,tn={id:d,answerConfig:b,event:null,type:I,isImage:G,index:_t},Rn=null!==(Xe=b.content)&&void 0!==Xe?Xe:"";(mt||ft)&&void 0!==We?(Wn=[We.toString(),null!=mt?mt:"",null!=ft?ft:"",d.toString()],this.setResultTracking.emit(Wn)):!mt&&!ft&&Rn&&void 0!==We&&(mt=Rn,ft=Rn,Wn=[We.toString(),null!=mt?mt:"",null!=ft?ft:"",d.toString()],this.setResultTracking.emit(Wn)),this.setAnswerEmitter.emit(tn)}setAnswerType3(d,b,I,G,_t){var mt={id:d,answerConfig:null,event:b,type:I,isImage:G,index:_t};if(this.showList)3==I&&(G?(ft=document.getElementById("answer-1-unit-"+d))&&(ft.value=b.target.value.trim()):(ft=document.getElementById("answer-0-unit-"+d))&&(ft.value=b.target.value.trim()));else if(3==I)if(G)(ft=document.getElementById("answer-1-all-"+d))&&(ft.value=b.target.value.trim());else{var ft;(ft=document.getElementById("answer-0-all-"+d))&&(ft.value=b.target.value.trim())}this.setAnswerEssayEmitter.emit(mt)}get extraSpace(){return J.Z}showResultQuestion(d){d&&this.showResultQuestionEmit.emit(d)}setAnswerOnUpdate(d,b,I,G,_t,mt){this.setAnswerOnUpdateEmit.emit({idQuestion:d,event:b,type:I,isImage:G,score:_t,index:null!=mt?mt:0})}removeAnswerType4(d,b){this.removeAnswerType4Emit.emit({questionId:d,answerObj:b})}setAnswerType4(d,b){this.setAnswerType4UpdateEmit.emit({questionId:d,event:b})}ngOnInit(){console.log("is back end ",this.isBackEnd),this.question&&this.displayScreen==Q.TestFinder&&this.store.select(M.Y).subscribe(d=>{this.state=d}),setTimeout(()=>{this.question&&(this.question.content&&(this.question.content=this.partRenderService.render(this.question.content)),this.question.answers&&this.question.answers.forEach(d=>{d.content=this.partRenderService.render(d.content||"")}),this.question.help&&(this.question.help=this.partRenderService.render(this.question.help)),this.question.groupInfo&&this.question.groupInfo.groupContent&&(this.question.groupInfo.groupContent=this.partRenderService.render(this.question.groupInfo.groupContent)))},0),window.setInputValueTextarea=d=>{var b=Number(d.target.getAttribute("question_id")),I=Boolean(d.target.getAttribute("isImage"));this.setAnswerType3(b,d,3,I,0)},super.ngOnInit()}ngOnDestroy(){window.setInputValueTextarea=null,super.ngDestroy()}pushImage(d,b){setTimeout(()=>{if(this.question){let I=new RegExp("<img id='"+d+"'[^>]+>","g");this.question.content&&(this.question.content=this.question.content.replace(I,null!=b?b:"")),this.question.answers&&this.question.answers.forEach(G=>{var _t;G.content=null===(_t=G.content)||void 0===_t?void 0:_t.replace(I,null!=b?b:"")}),this.question.help&&(this.question.help=this.question.help.replace(I,null!=b?b:"")),this.question.groupInfo&&this.question.groupInfo.groupContent&&(this.question.groupInfo.groupContent=this.question.groupInfo.groupContent.replace(I,null!=b?b:""))}},0)}}return p.\u0275fac=function(d){return new(d||p)(o.Y36(z.v),o.Y36(R.U),o.Y36(j.yh),o.Y36(y.j),o.Y36(T.U),o.Y36(V.T))},p.\u0275cmp=o.Xpm({type:p,selectors:[["azt-standalone-question"]],inputs:{isBackEnd:"isBackEnd",showButtonCommentToteacher:"showButtonCommentToteacher",cur_result:"cur_result",index:"index",last:"last",questionListLength:"questionListLength",userAnswersObj:"userAnswersObj",configExam:"configExam",labelType:"labelType",question:"question",customTemplateQuestion:"customTemplateQuestion",displayScreen:"displayScreen",notShowAnswerYet:"notShowAnswerYet",isDisplayInExportMode:"isDisplayInExportMode",place:"place",newFirstInGroupIndexes:"newFirstInGroupIndexes",OnlineTest:"OnlineTest",allowAskQuestion:"allowAskQuestion",isMobile:"isMobile",showList:"showList",overTime:"overTime",countQuestion:"countQuestion",examObj:"examObj",removable:"removable",selectable:"selectable",addOnBlur:"addOnBlur"},outputs:{sendAudioEmit:"sendAudioEmit",autoResizeEssayAnswerEmitter:"autoResizeEssayAnswerEmitter",setAnswerEmitter:"setAnswerEmitter",setAnswerEssayEmitter:"setAnswerEssayEmitter",setResultTracking:"setResultTracking",removeImgEmitter:"removeImgEmitter",openSubmitExamEmitter:"openSubmitExamEmitter",nextQuestionEmitter:"nextQuestionEmitter",prevQuestionEmitter:"prevQuestionEmitter",goToQuestionEmitter:"goToQuestionEmitter",goToQuestionAllEmitter:"goToQuestionAllEmitter",statusResult:"statusResult",showResultQuestionEmit:"showResultQuestionEmit",setAnswerOnUpdateEmit:"setAnswerOnUpdateEmit",setAnswerType4UpdateEmit:"setAnswerType4UpdateEmit",removeAnswerType4Emit:"removeAnswerType4Emit"},features:[o.qOj],ngContentSelectors:$e,decls:3,vars:1,consts:[["defaultQuestionTemplate",""],[4,"ngTemplateOutlet"],["class","question-container",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"question-container",3,"ngClass"],[1,"question-block",3,"ngClass","click"],[3,"questionObj","isShowList","totalLimit","sendAudioEmitter",4,"ngIf"],[1,"question-label"],[1,"question-content",3,"innerHtml"],["class","row answers",4,"ngIf"],["class","group-content",3,"innerHtml","ngClass","click",4,"ngIf"],[1,"group-content",3,"innerHtml","ngClass","click"],[3,"questionObj","isShowList","totalLimit","sendAudioEmitter"],[1,"row","answers"],["class","answer col-sm-12 col-md-6",4,"ngFor","ngForOf"],[1,"answer","col-sm-12","col-md-6"],[1,"answer-label"],[1,"answer-content",3,"innerHtml"],[3,"question","userAnswersObj","place","examConfig","notShowAnswerYet","ngStyle","statusResult",4,"ngIf"],[3,"place","question","userAnswersObj","isDisplayInExportMode","examConfig","OnlineTest","statusResult",4,"ngIf"],[3,"question","userAnswersObj","place","examConfig","notShowAnswerYet","ngStyle","statusResult"],["class","explainTxt clickable",3,"ngStyle","click",4,"ngIf"],[1,"explainTxt","clickable",3,"ngStyle","click"],[3,"place","question","userAnswersObj","isDisplayInExportMode","examConfig","OnlineTest","statusResult"],[4,"ngIf","ngIfElse"],["NormalShow",""],[1,"answer-box","ml-auto","mr-auto"],["class","answer-content",4,"ngIf"],[1,"answer-content"],[1,"h5","mb-0","mr-2","text-white",2,"align-self","center"],["class","answer-review","style","background-color: rgba(243, 156, 18, 1); color: rgb(255, 255, 255)",4,"ngIf"],[1,"answer-review",2,"background-color","rgba(243, 156, 18, 1)","color","rgb(255, 255, 255)"],[2,"color","#cd1324","font-weight","450"],[1,"row",2,"width","80%",3,"ngClass"],[1,"col-sm-12","mb-1"],["class","form-control mt-1","readonly","",3,"id","focus",4,"ngIf"],["readonly","",1,"form-control","mt-1",3,"id","focus"],["showUnit",""],["class","answer-content",3,"ngClass",4,"ngIf"],["class","h5 mb-0 mr-2 text-white","style","align-self: center;",4,"ngIf"],[1,"list-answer","mt-auto","mb-auto",3,"ngClass"],[1,"listda","mt-0","mb-0","pl-0"],["class","listli",3,"click",4,"ngFor","ngForOf"],[1,"listli",3,"click"],["class","no-answered","style","background: #fff; color: #111;",4,"ngIf"],["class","no-answered","style","background-color: rgba(243, 156, 18, 1);color: rgb(255, 255, 255);",4,"ngIf"],[1,"no-answered",2,"background","#fff","color","#111"],[1,"no-answered",2,"background-color","rgba(243, 156, 18, 1)","color","rgb(255, 255, 255)"],[1,"answer-content",3,"ngClass"],[1,"list-answer","d-flex",2,"width","100%",3,"ngClass"],["class","h5 mb-1 mr-2 text-white","style","align-self: center;",4,"ngIf"],[1,"row",2,"width","75%",3,"ngClass"],["oninput","setInputValueTextarea($event)",1,"form-control","ml-2","mt-1","mr-2",3,"id","value","focus","keyup","change"],[1,"h5","mb-1","mr-2","text-white",2,"align-self","center"],[1,"prev_question_btn","clickable",3,"hidden","click"],[1,"arrow_btn"],[1,"next_question_btn","clickable",3,"hidden","click"],[1,"list-answer","mt-auto","mb-auto"],[1,"listda","mt-0","pl-0","mb-0"],["class","listli ",3,"click",4,"ngFor","ngForOf"],[1,"btn","btn-ans-result","ml-auto",3,"click"],[2,"vertical-align","middle","color","#fff"],["style","vertical-align: middle; color: #fff; font-weight: bold;",4,"ngIf"],[2,"vertical-align","middle","color","#fff","font-weight","bold"],[1,"list-answer","d-flex",2,"width","100%"],[1,"text-right"],[1,"btn","btn-ans-result","ml-auto",3,"ngClass","click"],["class","answer-box ml-auto mr-auto",4,"ngIf"],["class","answer-box ml-autp mr-auto",4,"ngIf"],[1,"d-flex","float-right"],["class","clickable show_explain mr-3","style","user-select: none",3,"click",4,"ngIf"],["class","no-answered","style","background: #fff; color: #111",4,"ngIf"],["class","no-answered","style","background-color: rgba(243, 156, 18, 1); color: rgb(255, 255, 255)",4,"ngIf"],[1,"clickable","show_explain","mr-3",2,"user-select","none",3,"click"],[1,"answer-box","ml-autp","mr-auto"],[1,"list-answer","mt-auto","mb-auto","w-100","align-self-center"],["appearance","fill",1,"example-chip-list","w-100","bg-white",2,"border-radius","5px","color","#000",3,"ngClass"],[2,"font-size","15px","font-weight","450"],[3,"aria-label"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],[3,"placeholder","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""]],template:function(d,b){if(1&d&&(o.F$t(Ge),o.YNc(0,qi,5,4,"ng-template",null,0,o.W1O),o.YNc(2,$n,1,0,"ng-container",1)),2&d){const I=o.MAs(1);o.xp6(2),o.Q6J("ngTemplateOutlet",b.customTemplateQuestion||I)}},dependencies:[H.mk,H.sg,H.O5,H.tP,H.PC,Z.qn,Z.HS,Z.oH,Z.qH,W.Hw,it.KE,it.hX,vi,yi,rt.bT,rt.Ev,rt.DC,rt.Tf,rt.UG],styles:['[_nghost-%COMP%]{margin-bottom:30px;display:block}.question-container[_ngcontent-%COMP%]{border:1px solid rgb(237,237,237);margin-bottom:5px;padding:15px}.question-container.quesion-test-finder[_ngcontent-%COMP%]{border:none;margin-bottom:0;padding:0}.question-container.quesion-test-finder[_ngcontent-%COMP%]   .group-content[_ngcontent-%COMP%], .question-container.quesion-test-finder[_ngcontent-%COMP%]   .question-block[_ngcontent-%COMP%]{padding:15px;border:1px solid rgb(228,228,228)}.question-container.quesion-test-finder[_ngcontent-%COMP%]   .group-content.selected-group[_ngcontent-%COMP%]{border:1px solid green;outline:3px solid rgba(0,193,0,.321)}.question-container.quesion-test-finder[_ngcontent-%COMP%]   .question-block.selected[_ngcontent-%COMP%]{border:1px solid #2262AE;outline:3px solid rgba(125,160,201,.65)}.answer[_ngcontent-%COMP%]{display:flex;align-items:center}.group-content[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:700}.question-label[_ngcontent-%COMP%]{font-weight:700}.answer-label[_ngcontent-%COMP%]{width:30px;height:30px;min-width:30px;min-height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;border-width:2px;border-style:solid;border-color:transparent}.answer-label.user-choice[_ngcontent-%COMP%]{border-color:#000}.answer-label.answer-key[_ngcontent-%COMP%]{border-color:orange}.answer-label.answer-key.user-choice[_ngcontent-%COMP%]{border-color:green;background-color:green;color:#fff}.used[_ngcontent-%COMP%]{position:relative}.used[_ngcontent-%COMP%]:after{content:"";display:block;width:100%;height:100%;position:absolute;z-index:3;background-color:#44444429;left:0;top:0}.image_group[_ngcontent-%COMP%], .image_question[_ngcontent-%COMP%]{padding:15px;margin-bottom:20px}.box-slide-show[_ngcontent-%COMP%]{background:inherit;background-color:#fff;border-width:1px;border-style:solid;border-color:#e7e7e7;border-radius:3px 3px 0 0;padding-bottom:20px;padding-right:15px;padding-left:15px;border-bottom:none}.margin_question_bar[_ngcontent-%COMP%]{margin-top:calc(2rem + 40px)!important}.col-game-bar[_ngcontent-%COMP%]{position:fixed;top:calc(2rem + 30px);right:10vw;max-width:180px}.sheet-Screen[_ngcontent-%COMP%]{max-height:calc(100vh - 140px);overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.sheet-Screen[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.box-show-sheet[_ngcontent-%COMP%]{margin-top:14px!important;width:75%;margin:auto;background:inherit;background-color:#fff;border-width:1px;border-style:solid;border-color:#e7e7e7;border-radius:5px}.disable-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.question-content[_ngcontent-%COMP%]{position:relative}.next_question_btn[_ngcontent-%COMP%]{position:absolute;right:10px;top:35%;padding:.35rem .45rem;background-color:#a3a5a670;border-radius:50%}.prev_question_btn[_ngcontent-%COMP%]{position:absolute;left:10px;top:35%;padding:.35rem .45rem;background-color:#a3a5a670;border-radius:50%}.arrow_btn[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;width:20px;height:20px;color:#fff;margin-left:auto!important;margin-right:auto!important;-webkit-user-select:none;user-select:none}.button-note[_ngcontent-%COMP%]{position:relative;display:flex;-webkit-user-select:none;user-select:none}.show-sheet[_ngcontent-%COMP%]   .sheet_content[_ngcontent-%COMP%], .list-answer[_ngcontent-%COMP%]   .sheet_content[_ngcontent-%COMP%]{animation:revealFromLeft .5s 0s ease both 1}.show-sheet[_ngcontent-%COMP%]   .sheet_content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .list-answer[_ngcontent-%COMP%]   .sheet_content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:700}.show-sheet[_ngcontent-%COMP%]   .listda[_ngcontent-%COMP%], .list-answer[_ngcontent-%COMP%]   .listda[_ngcontent-%COMP%]{margin-top:30px;padding-left:20px}.show-sheet[_ngcontent-%COMP%]   .ng-binding[_ngcontent-%COMP%], .list-answer[_ngcontent-%COMP%]   .ng-binding[_ngcontent-%COMP%]{font-size:24px;font-weight:400}.show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%], .list-answer[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]{padding:0;margin-right:5px;display:inline-block}.show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .list-answer[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;cursor:pointer;-webkit-user-select:none;user-select:none}.show-sheet[_ngcontent-%COMP%]   .no-answered[_ngcontent-%COMP%], .list-answer[_ngcontent-%COMP%]   .no-answered[_ngcontent-%COMP%]{background:#273044}.note-box[_ngcontent-%COMP%]{display:none;background-color:#f7f3cf;margin-bottom:5px;min-height:30px}.answer-content[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap}.answer-box[_ngcontent-%COMP%]{background:rgb(0,167,208);border-radius:0 0 3px 3px;color:#fff;padding:8px 20px}.btn-ans-result[_ngcontent-%COMP%]{color:#fff;background-color:#f39c12}.bottom_action[_ngcontent-%COMP%]{position:fixed;padding:15px;bottom:0;left:0;background:#312e2e;color:#fff;width:100%}.bottom_action[_ngcontent-%COMP%]   .collapse[_ngcontent-%COMP%]{display:block}.show-list[_ngcontent-%COMP%]{max-width:200px}.show-list[_ngcontent-%COMP%]   .show-sheet[_ngcontent-%COMP%]   .listli[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:27px;height:27px;border-radius:50%;border:1px solid #347da5;display:flex;align-items:center;color:#fff;justify-content:center;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.top_action[_ngcontent-%COMP%]{position:fixed;padding:10px;top:0;left:0;background:#312e2e;color:#fff;width:100%}.scrollSheetMobile[_ngcontent-%COMP%]{max-height:200px;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollSheetMobile[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}.notify-badge[_ngcontent-%COMP%]{position:absolute;right:3px;top:3px;text-align:center;color:#afafaf;padding:0;font-size:20px;cursor:pointer}.attach-container[_ngcontent-%COMP%]{background:#fff;padding:10px 0 0;border-radius:5px;width:83.33%;border:1px solid #e8e8e8}#examHeader[_ngcontent-%COMP%]{display:block;border:1px solid #e7e7e7;border-radius:3px;overflow:hidden}.answer-review[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:1px solid rgb(52,125,165);display:flex;align-items:center;color:#fff;justify-content:center;font-size:15px;-webkit-user-select:none;user-select:none}.border-none[_ngcontent-%COMP%]{border:none!important}@media (max-width: 768px){.answer-content[_ngcontent-%COMP%]{justify-content:center}.btn-ans-result[_ngcontent-%COMP%]{margin-right:auto!important}.list-answer[_ngcontent-%COMP%]{margin-bottom:14px!important}.list-answer-mobile[_ngcontent-%COMP%]{margin-bottom:0!important}}.bg-question[_ngcontent-%COMP%]{margin-top:15px;padding:15px 10px;background:#fff}.question-offline-title[_ngcontent-%COMP%]{font-weight:500;margin-bottom:15px}.question-offline-answer[_ngcontent-%COMP%]{max-width:300px;padding:10px;display:flex;justify-content:space-between;font-weight:500}.question-offline-answer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}']}),p})()},73828:(Qt,tt,w)=>{w.d(tt,{$:()=>T});var s=w(55330),o=w(5e3),J=w(35018),C=w(98674),et=w(69808),M=w(53251),Q=w(1033);function P(V,H){if(1&V&&(o.TgZ(0,"td",13),o._uU(1),o.qZA()),2&V){const Z=o.oxw().$implicit,W=o.oxw().$implicit,it=o.oxw(2);o.uIk("rowspan",W.length),o.xp6(1),o.Oqu(it.toNumber(Z.index)+1)}}const K=function(V){return{"font-700":V}};function z(V,H){if(1&V&&(o.ynx(0),o.TgZ(1,"tr"),o.YNc(2,P,2,2,"td",11),o.TgZ(3,"td"),o._uU(4),o.ALo(5,"date"),o.qZA(),o.TgZ(6,"td",12),o._uU(7),o.qZA(),o.TgZ(8,"td"),o._uU(9),o.ALo(10,"mytranslate"),o.qZA()(),o.BQk()),2&V){const Z=H.$implicit,W=H.index,it=o.oxw().$implicit;o.xp6(2),o.Q6J("ngIf",0==W),o.xp6(2),o.Oqu(o.Dn7(5,5,1e3*Z.second,"dd/MM/yyyy HH:mm:ss","UTC+timezoneOffset")),o.xp6(2),o.Q6J("ngClass",o.VKq(11,K,W==it.length-1)),o.xp6(1),o.Oqu(Z.alpha?Z.alpha:Z.key),o.xp6(2),o.Oqu(o.lcZ(10,9,"lang_auto_dang_cap_nhat"))}}function R(V,H){if(1&V&&(o.ynx(0),o.YNc(1,z,11,13,"ng-container",10),o.BQk()),2&V){const Z=H.$implicit;o.xp6(1),o.Q6J("ngForOf",Z)}}function j(V,H){if(1&V&&(o.TgZ(0,"table",5)(1,"tr")(2,"th",6),o._uU(3),o.ALo(4,"mytranslate"),o.qZA(),o.TgZ(5,"th",7),o._uU(6),o.ALo(7,"mytranslate"),o.qZA(),o.TgZ(8,"th",8),o._uU(9),o.ALo(10,"mytranslate"),o.qZA(),o.TgZ(11,"th",9),o._uU(12),o.ALo(13,"mytranslate"),o.qZA()(),o.YNc(14,R,2,1,"ng-container",10),o.qZA()),2&V){const Z=o.oxw();o.xp6(3),o.Oqu(o.lcZ(4,5,"lang_auto_cau_hoi")),o.xp6(3),o.Oqu(o.lcZ(7,7,"lang_auto_thoi_gian")),o.xp6(3),o.Oqu(o.lcZ(10,9,"lang_auto_dap_an")),o.xp6(3),o.Oqu(o.lcZ(13,11,"lang_auto_noi_dung_cau_hoi")),o.xp6(2),o.Q6J("ngForOf",Z.groupObjs)}}function y(V,H){1&V&&(o.TgZ(0,"div",14),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&V&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}let T=(()=>{class V extends s.Q{constructor(Z,W){super(Z),this.commonService=Z,this.dictionaryService=W,this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}findReTapQuesions(){var Z,W=this.dictionaryService.getDictionaryByGroupFieldTS(null!==(Z=this.dataResultObjs)&&void 0!==Z?Z:[],"index");for(var it in W)W.hasOwnProperty(it)&&this.groupObjs.push(W[it])}toNumber(Z){return parseInt(Z,10)}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}}return V.\u0275fac=function(Z){return new(Z||V)(o.Y36(J.v),o.Y36(C.E))},V.\u0275cmp=o.Xpm({type:V,selectors:[["azt-test-result-tracking"]],inputs:{dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs"},features:[o.qOj],decls:8,vars:5,consts:[[3,"label"],[1,"row","mt-2","mx-0"],[1,"col-md-12"],["id","tracktable",4,"ngIf","ngIfElse"],["noData",""],["id","tracktable"],["id","questionNum"],["id","timeStamp"],["id","answerLabel"],["id","questionContent"],[4,"ngFor","ngForOf"],["class","test",4,"ngIf"],[3,"ngClass"],[1,"test"],[1,"alert","alert-info","p-2"]],template:function(Z,W){if(1&Z&&(o.TgZ(0,"mat-tab-group")(1,"mat-tab",0),o.ALo(2,"mytranslate"),o.TgZ(3,"div",1)(4,"div",2),o.YNc(5,j,15,13,"table",3),o.YNc(6,y,3,3,"ng-template",null,4,o.W1O),o.qZA()()()()),2&Z){const it=o.MAs(7);o.xp6(1),o.s9C("label",o.lcZ(2,3,"lang_auto_chi_tiet_chon_dap_an")),o.xp6(4),o.Q6J("ngIf",W.groupObjs.length>0)("ngIfElse",it)}},dependencies:[et.mk,et.sg,et.O5,M.SP,M.uX,et.uU,Q.bT],styles:["#tracktable[_ngcontent-%COMP%]{background-color:#fff;border-collapse:collapse;width:100%}#tracktable[_ngcontent-%COMP%]   #timeStamp[_ngcontent-%COMP%]{width:200px}#tracktable[_ngcontent-%COMP%]   #questionNum[_ngcontent-%COMP%], #tracktable[_ngcontent-%COMP%]   #answerLabel[_ngcontent-%COMP%]{width:100px}#tracktable[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:500;padding:8px}#tracktable[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background-color:#999;color:#fff}#tracktable[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], #tracktable[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:left;padding:8px;text-align:center}#stickyDiv[_ngcontent-%COMP%]{position:sticky;top:10px}#listRetap[_ngcontent-%COMP%]{max-height:calc(100vh - 200px);overflow:scroll}#trackCount[_ngcontent-%COMP%]{background:#fff;border:1px solid #dddddd}#trackCount[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:500;text-align:center;border-bottom:1px solid #dddddd;padding:8px}#trackCount[_ngcontent-%COMP%]   .retap-item[_ngcontent-%COMP%]{padding:10px;text-align:center}#trackCount[_ngcontent-%COMP%]   .retap-item[_ngcontent-%COMP%]:last-child{border-bottom:none}#trackCount[_ngcontent-%COMP%]   .retap-item.selected[_ngcontent-%COMP%]{background-color:#999;color:#fff;border-bottom:none}#trackCount[_ngcontent-%COMP%]   .retap-item[_ngcontent-%COMP%]:hover{background-color:#b9b9b9;color:#fff;border-bottom:none}.font-700[_ngcontent-%COMP%]{font-weight:700}"]}),V})()},49518:(Qt,tt,w)=>{w.d(tt,{K:()=>Ya});var s=w(5e3),o=w(98723),J=w(36053),C=w(20259),et=w(55330),M=w(84847),Q=w(90893),P=w(35018),K=w(37389),z=w(74202),R=w(60590),j=w(54569),y=w(61828),T=w(15043),V=w(54729),H=w(72491),Z=w(35191),W=w(41752),it=w(51225),Y=w(2366);let gt=(()=>{class _{constructor(c,g){this.commonService=c,this.zipdataService=g}drawScanFileToCanvas(c){return new Promise(g=>{var f,E="",S=this.commonService.willDeleteParseJson(this.zipdataService.decodeContentGzip(null!==(f=c.images)&&void 0!==f?f:""));if(S){var F=new Image;F.src=S.url?S.url:"",F.crossOrigin="anonymous",F.onload=()=>{var at,lt,bt,Lt,wt,Nt,kt,St,Ot,ce,Pe,Ke,_n,nn,sn,mn,De=document.createElement("canvas");De.width=F.width,De.height=F.height;const Mt=De.getContext("2d");null==Mt||Mt.drawImage(F,0,0,De.width,De.height);var rn=null!==(lt=null===(at=c.resultsData)||void 0===at?void 0:at.answerObjs)&&void 0!==lt?lt:[],Ie=this.commonService.willDeleteParseJson(null!==(Lt=null===(bt=c.resultsData)||void 0===bt?void 0:bt.pos)&&void 0!==Lt?Lt:"");if("2.0"==Ie.version){let xn=new it.ay(Ie.resultFilledPos).parseDrawData(),Ha=null!==(Nt=null===(wt=xn.studentId)||void 0===wt?void 0:wt.answers)&&void 0!==Nt?Nt:[];for(var Pt=0;Pt<Ha.length;Pt++)this.tickStudentIdAndExamId(Ha[Pt],Mt,null!==(St=null===(kt=xn.answerTable)||void 0===kt?void 0:kt.radius)&&void 0!==St?St:0);let U=null!==(ce=null===(Ot=xn.examId)||void 0===Ot?void 0:Ot.answers)&&void 0!==ce?ce:[];for(Pt=0;Pt<U.length;Pt++)this.tickStudentIdAndExamId(U[Pt],Mt,null!==(Ke=null===(Pe=xn.answerTable)||void 0===Pe?void 0:Pe.radius)&&void 0!==Ke?Ke:0);let Kt=null!==(nn=null===(_n=xn.answerTable)||void 0===_n?void 0:_n.answers)&&void 0!==nn?nn:[];for(Pt=0;Pt<Kt.length;Pt++)this.answerPaintedRightOrWrong(Kt[Pt],Mt,null!==(mn=null===(sn=xn.answerTable)||void 0===sn?void 0:sn.radius)&&void 0!==mn?mn:0,rn);E=De.toDataURL("image/jpeg",.9),g(E)}else{var gn=Ie.configurationPos.split("_"),pn=Ie.resultFilledPos.split("_"),Pn=Ie.tableAnchorPos.split("_"),on=this.checkWrongOrTrueAnswer(rn),ie=0;for(Pt=0;Pt<gn.length;Pt++)if(1==Pt||2==Pt){var ei=gn[Pt].split("*");ie+=parseInt(ei[1],10)}var fn=0;for(Pt=0;Pt<Pn.length;Pt++)if(Pt>=2){var Ee={},Ye={},Uo=Pn[Pt].split("*"),js=Uo[0].split(":"),Qo=Uo[1].split(":"),ni={},Fs=gn[Pt].split("*");ni.row=parseInt(Fs[0],10),ni.col=parseInt(Fs[1],10),ni.radius=parseInt(Fs[2],10),Ee.x=parseInt(js[0],10),Ee.y=parseInt(js[1],10),Ye.x=parseInt(Qo[0],10),Ye.y=parseInt(Qo[1],10);for(var Bo=(Ye.y-Ee.y)/(ni.row+1),qn=Ee.y,an=0;an<ni.row;an++)if((qn+=Bo)>Ee.y&&qn<Ye.y){var Br=fn<rn.length?this.checkAnswerStudentRight(fn,rn):0;fn++,0!=Br&&Mt&&(Mt.beginPath(),Mt.arc(Ee.x+Bo*Br,qn,ni.radius,0,2*Math.PI,!1),Mt.lineWidth=3,Mt.strokeStyle="#f3c12c",Mt.stroke())}}var se=0;for(an=0;an<pn.length;an++)if("empty"!=pn[an]){var vn=pn[an].split(":"),qe={x:parseInt(vn[0],10),y:parseInt(vn[1],10),line:parseInt(vn[2],10)};an<ie+on.length&&(an>=ie?(Mt&&(Mt.beginPath(),Mt.arc(qe.x,qe.y,qe.line,0,2*Math.PI,!1),Mt.lineWidth=3,Mt.strokeStyle=on[se],Mt.stroke()),se++):Mt&&(Mt.beginPath(),Mt.arc(qe.x,qe.y,qe.line,0,2*Math.PI,!1),Mt.lineWidth=3,Mt.strokeStyle="#00ff00",Mt.stroke()))}E=De.toDataURL("image/jpeg",.9),g(E)}}}else g("")})}checkAnswerStudentRight(c,g){var f=0;return g[c]&&""!=g[c].rightAnswer&&0==g[c].isRight&&(f="A"==g[c].rightAnswer?1:"B"==g[c].rightAnswer?2:"C"==g[c].rightAnswer?3:"D"==g[c].rightAnswer?4:"E"==g[c].rightAnswer?5:"F"==g[c].rightAnswer?6:"G"==g[c].rightAnswer?7:"H"==g[c].rightAnswer?8:0),f}checkWrongOrTrueAnswer(c){for(var g=[],f=0;f<c.length;f++)""!=c[f].content&&(1==c[f].isRight?g.push("#00ff00"):0==c[f].isRight&&g.push("red"));return g}tickStudentIdAndExamId(c,g,f){var E,S,F,at=256*Math.floor((null!==(E=c.position)&&void 0!==E?E:0)/16)+c.x,lt=(null!==(S=c.position)&&void 0!==S?S:0)%16*256+c.y;(null!==(F=c.filledCols)&&void 0!==F?F:0)>=128&&g&&(g.beginPath(),g.arc(at,lt,f,0,2*Math.PI,!1),g.lineWidth=3,g.strokeStyle="#00ff00",g.stroke())}answerPaintedRightOrWrong(c,g,f,E){var S,F,at,lt,bt,Lt=256*Math.floor((null!==(S=c.position)&&void 0!==S?S:0)/16)+c.x,wt=(null!==(F=c.position)&&void 0!==F?F:0)%16*256+c.y,Nt=null!==(at=c.rows)&&void 0!==at?at:0,kt=(null!==(lt=c.filledCols)&&void 0!==lt?lt:0)%128,St="#fff0";E.length>Nt&&((null!==(bt=c.filledCols)&&void 0!==bt?bt:0)>=128?St=1==E[Nt].isRight?"#00ff00":"red":kt+1==this.checkAnswerStudentRight(Nt,E)&&(St="#f3c12c"),g&&(g.beginPath(),g.arc(Lt,wt,f,0,2*Math.PI,!1),g.lineWidth=3,g.strokeStyle=St,g.stroke()))}}return _.\u0275fac=function(c){return new(c||_)(s.LFG(P.v),s.LFG(Y.n))},_.\u0275prov=s.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})();var Et=w(51930),pt=w(88161),Dt=w(43977),jt=w(69808),Jt=w(69287),Bt=w(47423),Gt=w(25245),de=w(92181),Ne=w(2638),ct=w(53251),ot=w(87238),Rt=w(88386),Ct=w(64123),Ae=w(73547),yt=w(1033);function _e(_,A){if(1&_&&(s.TgZ(0,"p",8),s._uU(1),s.qZA()),2&_){const c=s.oxw();s.xp6(1),s.Oqu(null==c.studentObj?null:c.studentObj.fullName)}}const ke=function(){return{}};function je(_,A){if(1&_&&(s.TgZ(0,"p",8),s._UZ(1,"img",9),s.qZA()),2&_){const c=s.oxw();s.xp6(1),s.Q6J("nameImages",(null==c.studentObj?null:c.studentObj.nameImages)||s.DdM(1,ke))}}function ve(_,A){if(1&_&&(s.TgZ(0,"p",10),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"date"),s.qZA()),2&_){const c=s.oxw();s.xp6(1),s.AsE("",s.lcZ(2,2,"lang_auto_ngay_sinh"),": ",s.xi3(3,4,null==c.studentObj?null:c.studentObj.birthday,"dd/MM/yyyy"),"")}}function Me(_,A){if(1&_&&(s.TgZ(0,"p",11),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"anonymousPhone"),s.qZA()),2&_){const c=s.oxw();s.xp6(1),s.AsE("",s.lcZ(2,2,"lang_auto_dien_thoai"),": ",c.studentObj?s.lcZ(3,4,c.studentObj.phone):"","")}}const hs=["*"];let pi=(()=>{class _ extends et.Q{constructor(c,g){super(c),this.commonService=c,this.userService=g}returnTooltip(){var c,g,f,E;return null==(null===(c=this.studentObj)||void 0===c?void 0:c.parentPhone)?"ID: "+(null===(g=this.studentObj)||void 0===g?void 0:g.parentId)+" - Phone: "+this.userService.anonymousPhone(null!==(E=null===(f=this.studentObj)||void 0===f?void 0:f.phone)&&void 0!==E?E:""):"ID: "+this.studentObj.parentId+" - Phone: "+this.userService.anonymousPhone(this.studentObj.parentPhone)+" - Name: "+this.studentObj.parentFullName}ngOnInit(){super.ngOnInit()}}return _.\u0275fac=function(c){return new(c||_)(s.Y36(P.v),s.Y36(Rt.K))},_.\u0275cmp=s.Xpm({type:_,selectors:[["azt-basic-info-box"]],inputs:{studentObj:"studentObj"},features:[s.qOj],ngContentSelectors:hs,decls:10,vars:8,consts:[[1,"azt_container"],[1,"avatar","azt_item"],[2,"cursor","pointer",3,"nameCreateAvatar","matTooltip","size","linkAvatar"],[1,"info_text","azt_item"],[1,"wrap-content"],["class","info_text-item bold",4,"ngIf"],["class","info_text-item",4,"ngIf"],["class","info_text-item truncate",4,"ngIf"],[1,"info_text-item","bold"],["appDrawNameImage","","loading","lazy","alt","",1,"img-fluid",2,"max-width","95%!important",3,"nameImages"],[1,"info_text-item"],[1,"info_text-item","truncate"]],template:function(c,g){if(1&c&&(s.F$t(),s.TgZ(0,"div",0)(1,"div",1),s._UZ(2,"azt-create-avatar",2),s.qZA(),s.TgZ(3,"div",3)(4,"div",4),s.YNc(5,_e,2,1,"p",5),s.YNc(6,je,2,2,"p",5),s.YNc(7,ve,4,7,"p",6),s.YNc(8,Me,4,6,"p",7),s.Hsn(9),s.qZA()()()),2&c){let f,E;s.xp6(2),s.s9C("matTooltip",g.returnTooltip()),s.Q6J("nameCreateAvatar",null==g.studentObj?null:g.studentObj.fullName)("size",50)("linkAvatar",null==g.studentObj?null:g.studentObj.avatar),s.xp6(3),s.Q6J("ngIf",!(null!=g.studentObj&&g.studentObj.nameImages)||(null!==(f=null==g.studentObj?null:g.studentObj.id)&&void 0!==f?f:0)>0),s.xp6(1),s.Q6J("ngIf",(null==g.studentObj?null:g.studentObj.nameImages)&&(null!==(E=null==g.studentObj?null:g.studentObj.id)&&void 0!==E?E:0)<=0),s.xp6(1),s.Q6J("ngIf",null==g.studentObj?null:g.studentObj.birthday),s.xp6(1),s.Q6J("ngIf",g.studentObj&&10==(null==g.studentObj.phone?null:g.studentObj.phone.length))}},dependencies:[jt.O5,ot.gM,Ct.t,Ae.L,jt.uU,yt.bT,yt.C5],styles:[".azt_container[_ngcontent-%COMP%]{display:flex;align-items:center}.azt_container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:65px;margin-right:10px}.azt_container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   .wrap-content[_ngcontent-%COMP%]{width:100%;height:80px;border-radius:50%;overflow:hidden}.azt_container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   .wrap-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.azt_container[_ngcontent-%COMP%]   .info_text[_ngcontent-%COMP%]{flex:auto;overflow:hidden}.azt_container[_ngcontent-%COMP%]   .info_text[_ngcontent-%COMP%]   .info_text-item[_ngcontent-%COMP%]{margin-bottom:0}.azt_container[_ngcontent-%COMP%]   .info_text[_ngcontent-%COMP%]   .info_text-item.bold[_ngcontent-%COMP%]{font-weight:500}.azt_container[_ngcontent-%COMP%]   .info_text[_ngcontent-%COMP%]   .info_text-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]}),_})();var ds=w(47691),pr=w(47865),cn=w(73852),_s=w(40520),xe=w(93075),ms=w(60519),fr=w(43147),gs=w(15431),Un=w(73105),fi=w(12813),Qn=w(80826);const Bn=function(_){return{"is-invalid":_}};function vr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",10)(1,"mat-icon",11),s.NdJ("click",function(f){const S=s.CHM(c).index,F=s.oxw();return s.KtG(F.toggleVisibility(f,S))}),s.ALo(2,"mytranslate"),s._uU(3,"visibility"),s.qZA(),s.TgZ(4,"span",12),s._uU(5),s.ALo(6,"mytranslate"),s.TgZ(7,"span",13),s.ALo(8,"mytranslate"),s._uU(9),s.ALo(10,"mytranslate"),s.qZA()(),s.TgZ(11,"input",14),s.NdJ("keydown",function(f){const E=s.CHM(c),S=E.index,F=E.$implicit,at=s.oxw();return s.KtG(at.validateForm(f,at.form.controls["cau"+S].value,F.essMaxPoint,S))}),s.ALo(12,"mytranslate"),s.qZA()()}if(2&_){const c=A.$implicit,g=A.index,f=s.oxw();s.xp6(1),s.s9C("matTooltip",s.lcZ(2,10,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),s.xp6(4),s.AsE("",s.lcZ(6,12,"lang_auto_cau")," ",c.indexLabel+1," "),s.xp6(2),s.s9C("matTooltip",s.lcZ(8,14,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),s.xp6(2),s.AsE("(",c.essMaxPoint," ",s.lcZ(10,16,"lang_auto_diem_brackets"),""),s.xp6(2),s.s9C("placeholder",s.lcZ(12,18,"lang_auto_nhap_diem")),s.MGl("formControlName","cau",g,""),s.Q6J("readonly",!f.isBackEnd)("ngClass",s.VKq(20,Bn,f.form.controls["cau"+g]&&f.form.controls["cau"+g].invalid))}}function xr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",15)(1,"button",16),s.NdJ("click",function(){s.CHM(c);const f=s.oxw();return s.KtG(f.getMnoteJsonData())}),s._uU(2),s.ALo(3,"mytranslate"),s.ALo(4,"mytranslate"),s.qZA()()}if(2&_){const c=s.oxw();s.xp6(1),s.Q6J("disabled",c.isLoading||c.form.invalid),s.xp6(1),s.hij(" ",c.isLoading?s.lcZ(3,2,"lang_auto_dang_luu_doing"):s.lcZ(4,4,"lang_auto_luu_diem")," ")}}function vi(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",21)(1,"form",22)(2,"label",23),s._uU(3),s.ALo(4,"mytranslate"),s.TgZ(5,"span",13),s.ALo(6,"mytranslate"),s._uU(7),s.ALo(8,"mytranslate"),s.qZA(),s._uU(9,":"),s.qZA(),s.TgZ(10,"input",24),s.NdJ("keydown",function(f){s.CHM(c);const E=s.oxw(),S=E.index,F=E.$implicit,at=s.oxw();return s.KtG(at.validateForm(f,at.form.controls["cau"+S].value,F.essMaxPoint,S))}),s.ALo(11,"mytranslate"),s.qZA()()()}if(2&_){const c=s.oxw(),g=c.index,f=c.$implicit,E=s.oxw();s.xp6(1),s.Q6J("formGroup",E.form),s.xp6(1),s.s9C("for","cau_"+g),s.xp6(1),s.AsE("",s.lcZ(4,12,"lang_auto_nhap_diem_cau")," ",f.indexLabel+1," "),s.xp6(2),s.s9C("matTooltip",s.lcZ(6,14,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),s.xp6(2),s.AsE("(",f.essMaxPoint," ",s.lcZ(8,16,"lang_auto_diem_brackets"),""),s.xp6(3),s.s9C("placeholder",s.lcZ(11,18,"lang_auto_nhap_diem")),s.MGl("formControlName","cau",g,""),s.Q6J("readonly",!E.isBackEnd)("ngClass",s.VKq(20,Bn,E.form.controls["cau"+g]&&E.form.controls["cau"+g].invalid))("id","cau_"+g)}}function ps(_,A){if(1&_&&(s.TgZ(0,"div",17)(1,"div",18),s._UZ(2,"azt-standalone-question",19),s.YNc(3,vi,12,22,"div",20),s.qZA()()),2&_){const c=A.$implicit,g=A.index,f=s.oxw();s.xp6(1),s.MGl("id","q_",g,""),s.xp6(1),s.Q6J("displayScreen",f.displayScreen)("place","essay")("isBackEnd",f.isBackEnd)("examObj",f.examObj)("question",c)("index",c.indexLabel)("configExam",f.configExam)("userAnswersObj",f.userAnswersObj)("place","essay"),s.xp6(1),s.Q6J("ngIf",f.isBackEnd)}}function yr(_,A){1&_&&(s.TgZ(0,"div",25)(1,"b"),s._uU(2),s.ALo(3,"mytranslate"),s.qZA(),s._uU(4),s.ALo(5,"mytranslate"),s.qZA()),2&_&&(s.xp6(2),s.hij("",s.lcZ(3,2,"lang_auto_anh_bai_lam_tu_luan"),": "),s.xp6(2),s.Oqu(s.lcZ(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh")))}function wr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",26)(1,"button",27),s.NdJ("click",function(){s.CHM(c);const f=s.oxw();return s.KtG(f.getMnoteJsonData())}),s._uU(2),s.ALo(3,"mytranslate"),s.ALo(4,"mytranslate"),s.qZA()()}if(2&_){const c=s.oxw();s.xp6(1),s.Q6J("disabled",c.isLoading||c.form.invalid),s.xp6(1),s.hij(" ",c.isLoading?s.lcZ(3,2,"lang_auto_dang_luu_doing"):s.lcZ(4,4,"lang_auto_luu_diem")," ")}}const ae=function(_){return{display:_}};let In=(()=>{class _ extends et.Q{constructor(c,g,f,E,S,F,at,lt){super(f),this.baseApiService=c,this.fb=g,this.commonService=f,this.permissionService=E,this.cdnService=S,this.envService=F,this.examResultService=at,this.apiUploadService=lt,this.isBackEnd=!0,this.displayScreen=3,this.resultID=0,this.files=[],this.questions=[],this.userAnswersObj={},this.examResultObj={},this.iframeSrc="",this.examQuestionObjs=[],this.hasLoadedData=!1,this.notShowAnswerYet=!1,this.configExam={},this.examObj={},this.saveResultEvent=new s.vpe,this.hasSendDataToIframe=!1,this.totalMaxPoint=0,this.form=new xe.nJ({}),this.maxPointPerQuestion=[],this.isLoading=!1,this.formValue={},this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.handleIframe=bt=>{"MNoteJson"==bt.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=bt.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==bt.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}uploadBase64ToCDN(c,g){var f=this.baseApiService.dataURItoBlob(c);this.apiUploadService.commonUploadForMarkResult(f,`essay_note_${g}_${this.resultID}.png`,"image/png",1e4).subscribe(E=>{var S;E.type!=_s.dt.UploadProgress&&(1==E.success?(this.mnoteJsonData.pages[g].draw=null===(S=E.data)||void 0===S?void 0:S.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}parseValue(c){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult)[c]}uploadAll(c){this.pagesCount=0;for(let g=0;g<c.length;g++)c[g].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let g=0;g<c.length;g++)c[g].draw&&this.uploadBase64ToCDN(c[g].draw,g)}sendDataToIframe(){const c=document.getElementById("mNote"),g=c?c.contentWindow:null;if(null!==g)if(this.examResultObj.confirmedAt){if(this.examResultObj.result){var f=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=f){for(let S=0;S<f.pages.length;S++)f.pages[S].backgroundImage&&(f.pages[S].backgroundImage=this.cdnService.getMyCdn(f.pages[S].backgroundImage)),f.pages[S].draw&&(f.pages[S].draw=this.cdnService.getMyCdn(f.pages[S].draw));f=JSON.stringify(f),this.examResultObj.result=f}}var E=this.checkMapBGImageWithFileLength(this.examResultObj.result);if(this.jsonData=this.commonService.willDeleteParseJson(E?this.examResultObj.result:this.addBGImageByFileUrl(this.examResultObj.result)),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let S=0;S<this.jsonData.pages.length;S++)this.jsonData.pages[S].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[S].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[S].backgroundImage)),this.jsonData.pages[S].hasOwnProperty("draw")&&(this.jsonData.pages[S].draw=this.cdnService.getMyCdn(this.jsonData.pages[S].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.context="exam"),g.postMessage(this.jsonData,"*")}else{let S=[];this.files.forEach(at=>{var lt=this.cdnService.getMyCdn(at.url);lt&&S.push({backgroundImage:lt})}),g.postMessage({cmd:"initMNote",pages:S,mode:"edit",context:"exam"},"*")}}getMaxPoint(c){var g=0;for(let E=0;E<this.examQuestionObjs.length;E++)if(this.examQuestionObjs[E].questionId==c){g=this.commonService.willDeleteParseJson(this.examQuestionObjs[E].config).ScorePerQuestion;break}return g}remark(c){if(this.checkMapBGImageWithFileLength(c)){for(const S in this.form.value)"string"==typeof this.form.value[S]&&this.form.value[S].includes(",")&&(this.form.value[S]=this.form.value[S].replace(",","."));let E=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var f={id:this.resultID,result:c,essasyResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(f,E).subscribe(S=>{var F;1==S.success?(this.commonService.snackSuccess("Ch\u1ea5m \u0111i\u1ec3m t\u1ef1 lu\u1eadn th\xe0nh c\xf4ng",""),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.myTranslate([null!==(F=S.message)&&void 0!==F?F:""]).subscribe(at=>{var lt;this.commonService.snackError(at[null!==(lt=S.message)&&void 0!==lt?lt:""],"")}),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}checkMapBGImageWithFileLength(c){var g=this.commonService.willDeleteParseJson(c);let f=!1;if(0==this.files.length)f=!0;else if(this.files.length>0&&g.pages&&this.files.length==g.pages.length){let E=0;this.files.forEach((S,F)=>{g.pages[F]&&g.pages[F].backgroundImage&&g.pages[F].backgroundImage.indexOf(S.path)>-1&&E++}),E==this.files.length&&(f=!0)}return f}addBGImageByFileUrl(c){var g=this.commonService.willDeleteParseJson(c);return this.files.forEach((f,E)=>{var S,F;let at=!1;if(g.pages){for(var lt=0;lt<g.pages.length;lt++)if(g.pages[lt]&&g.pages[lt].backgroundImage&&g.pages[lt].backgroundImage.indexOf(f.path)>-1){at=!0;break}!1===at&&(g.pages[E]&&g.pages[E].id==E?g.pages[E].backgroundImage=this.cdnService.getMyCdn(null!==(S=f.url)&&void 0!==S?S:""):g.pages.splice(E,0,{backgroundImage:this.cdnService.getMyCdn(null!==(F=f.url)&&void 0!==F?F:"")}))}}),JSON.stringify(g)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj.permissionObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj.permissionObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");if(this.files&&this.files.length>0){const c=document.getElementById("mNote"),g=c?c.contentWindow:null;null!==g&&g.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}toggleVisibility(c,g){var f=c.target,E=document.getElementById(`q_${g}`);E&&("block"==(null==E?void 0:E.style.display)?(E.style.display="none",f&&(f.textContent="visibility_off")):(E.style.display="block",f&&(f.textContent="visibility")))}isValidPoint(){let c=0;var g=this.form.value;for(var f in g){var E=Number(f.substring(3));g[f]>this.maxPointPerQuestion[E]&&c++}return!(c>0)}validateForm(c,g,f,E){var S;let F="";null===(S=this.form.get("cau"+E))||void 0===S||S.valueChanges.pipe((0,ms.G)()).subscribe(([at,lt])=>{if(F="string"==typeof lt&&lt.includes(",")?lt.replace(",","."):lt,isNaN(+F))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+E].setValue(g);else{let bt=parseFloat(F);bt>f&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),bt<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}ngOnInit(){var c;this.iframeSrc=null!==(c=this.envService.getEnvValue("classliveUrl"))&&void 0!==c?c:"";var g={};let f;this.examResultObj.confirmedAt&&(f=this.commonService.willDeleteParseJson(this.examResultObj.essayResult)),this.questions.forEach(S=>{let F=this.getMaxPoint(S.id);this.totalMaxPoint+=F,S.essMaxPoint=F,this.maxPointPerQuestion.push(S.essMaxPoint)});for(let S=0;S<this.questions.length;S++){var E=`cau${S}`;g[E]=new xe.p4(f?f[E]:"",[xe.kI.pattern("^[0-9]((.|,){0,1})[0-9]{0,4}"),xe.kI.min(0),xe.kI.max(this.questions[S].essMaxPoint)])}this.form=this.fb.group(g),this.form.valueChanges.subscribe(S=>{let F=JSON.stringify(S);F!=this.prevData&&(this.prevData=F,this.form.patchValue(S))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngDestroy()}}return _.\u0275fac=function(c){return new(c||_)(s.Y36(fr._),s.Y36(xe.QS),s.Y36(P.v),s.Y36(gs.$),s.Y36(T.U),s.Y36(W.D),s.Y36(Un.k),s.Y36(fi.$))},_.\u0275cmp=s.Xpm({type:_,selectors:[["azt-mark-essay"]],inputs:{isBackEnd:"isBackEnd",displayScreen:"displayScreen",resultID:"resultID",files:"files",questions:"questions",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",iframeSrc:"iframeSrc",examQuestionObjs:"examQuestionObjs",hasLoadedData:"hasLoadedData",notShowAnswerYet:"notShowAnswerYet",configExam:"configExam",examObj:"examObj"},outputs:{saveResultEvent:"saveResultEvent"},features:[s.qOj],decls:11,vars:12,consts:[["id","essayBoxButtons"],[1,"listSTT",3,"formGroup"],["class","col-wrap",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["id","mNote","frameborder","0",2,"width","100%","height","100%",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-wrap"],[3,"matTooltip","click"],[1,"stt"],[1,"maxPoint",3,"matTooltip"],["type","text","step",".01",1,"form-control",3,"readonly","placeholder","ngClass","formControlName","keydown"],[1,"BWrap-one"],["id","btn-1",1,"mt-3","btn","btn-primary",3,"disabled","click"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"displayScreen","place","isBackEnd","examObj","question","index","configExam","userAnswersObj"],["class","block-input",4,"ngIf"],[1,"block-input"],[1,"form-mark",3,"formGroup"],[3,"for"],["type","text","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","placeholder","formControlName","keydown"],[1,"mb-2","mt-2"],[1,"BWrap"],["id","btn-2",1,"mt-3","btn","btn-primary",3,"disabled","click"]],template:function(c,g){1&c&&(s.TgZ(0,"div",0)(1,"form",1),s.YNc(2,vr,13,22,"div",2),s.qZA(),s.YNc(3,xr,5,6,"div",3),s.qZA(),s.TgZ(4,"div",4),s.YNc(5,ps,4,11,"div",5),s.qZA(),s.YNc(6,yr,6,6,"div",6),s.TgZ(7,"div",7),s._UZ(8,"iframe",8),s.ALo(9,"safe"),s.qZA(),s.YNc(10,wr,5,6,"div",9)),2&c&&(s.xp6(1),s.Q6J("formGroup",g.form),s.xp6(1),s.Q6J("ngForOf",g.questions),s.xp6(1),s.Q6J("ngIf",g.isBackEnd),s.xp6(2),s.Q6J("ngForOf",g.questions),s.xp6(1),s.Q6J("ngIf",g.files&&0==g.files.length),s.xp6(1),s.Q6J("ngStyle",s.VKq(10,ae,g.files&&0==g.files.length?"none":"block")),s.xp6(1),s.Q6J("src",s.lcZ(9,8,g.iframeSrc),s.uOi),s.xp6(2),s.Q6J("ngIf",g.isBackEnd))},dependencies:[jt.mk,jt.sg,jt.O5,jt.PC,Gt.Hw,ot.gM,xe._Y,xe.Fj,xe.JJ,xe.JL,xe.sg,xe.u,Qn.$,yt.bT,yt.yl],styles:["#essayBoxButtons[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;padding:10px;border:1px solid #f1f1f1}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%;border-bottom:1px solid #f1f1f1}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;border-right:1px solid #f1f1f1;margin-bottom:5px;width:19.5%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:help}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.btn-primary[_ngcontent-%COMP%]{transition:all .5s;display:inline-block;background:#3f51b5;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f;font-family:Roboto,Helvetica Neue,sans-serif;font-size:14px;font-weight:500}.btn-primary[_ngcontent-%COMP%]:hover{background:#0e2399}.form-input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{background-color:#fff;width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:30px 30px 0}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:19.4%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),_})();function br(_,A){1&_&&s._UZ(0,"azt-loading-effect")}function En(_,A){if(1&_&&(s.TgZ(0,"td",22),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw().$implicit;s.xp6(1),s.AsE(" ",s.lcZ(2,2,"lang_auto_cau")," ",c.indexLabel+1," ")}}function Tr(_,A){if(1&_&&(s.TgZ(0,"td",22),s._uU(1),s.qZA()),2&_){const c=s.oxw().$implicit;s.xp6(1),s.hij(" ",c.answerResult[0]," ")}}function Ar(_,A){if(1&_&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"date"),s._UZ(3,"br"),s.qZA()),2&_){const c=s.oxw().$implicit,g=s.oxw(2).$implicit,f=s.oxw(4);s.xp6(1),s.AsE(" ",f.convertAnswer(c.answer,g)," (",s.Dn7(2,2,c.createdAt,"dd/MM/yyyy HH:mm:ss","UTC+timezoneOffset"),")")}}function zn(_,A){if(1&_&&(s.TgZ(0,"span",26),s.YNc(1,Ar,4,6,"span",23),s.qZA()),2&_){const c=A.$implicit;s.xp6(1),s.Q6J("ngIf",null!=c.answer)}}function Vn(_,A){if(1&_&&(s.ynx(0),s.YNc(1,zn,2,1,"span",25),s.BQk()),2&_){const c=s.oxw().$implicit;s.xp6(1),s.Q6J("ngForOf",c.answerLogs)}}function xi(_,A){}function yi(_,A){if(1&_&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw().$implicit;s.xp6(1),s.AsE(" ",c.scorePerQuestionLogs[0].scorePerQuestion," ",s.lcZ(2,2,"lang_auto_diem"),"")}}function wi(_,A){if(1&_&&(s.TgZ(0,"span",26),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"date"),s._UZ(4,"br"),s.qZA()),2&_){const c=A.$implicit;s.xp6(1),s.lnq(" ",c.scorePerQuestion," ",s.lcZ(2,3,"lang_auto_diem")," - (",s.Dn7(3,5,c.createdAt,"dd/MM/yyyy HH:mm:ss","UTC+timezoneOffset"),")")}}function bi(_,A){if(1&_&&(s.ynx(0),s.YNc(1,wi,5,9,"span",25),s.BQk()),2&_){const c=s.oxw().$implicit;s.xp6(1),s.Q6J("ngForOf",c.scorePerQuestionLogs)}}function fs(_,A){}function vs(_,A){if(1&_&&(s.ynx(0),s.TgZ(1,"tr"),s.YNc(2,En,3,4,"td",19),s.YNc(3,Tr,2,1,"td",19),s.TgZ(4,"td",20),s.YNc(5,Vn,2,1,"ng-container",3),s.YNc(6,xi,0,0,"ng-template",null,21,s.W1O),s.qZA(),s.TgZ(8,"td",22),s.YNc(9,yi,3,4,"span",23),s.qZA(),s.TgZ(10,"td",20),s.YNc(11,bi,2,1,"ng-container",3),s.YNc(12,fs,0,0,"ng-template",null,24,s.W1O),s.qZA()(),s.BQk()),2&_){const c=A.$implicit,g=s.MAs(7),f=s.MAs(13);s.xp6(2),s.Q6J("ngIf",void 0!==c.indexLabel),s.xp6(1),s.Q6J("ngIf",c.answerResult),s.xp6(2),s.Q6J("ngIf",c.answerLogs&&c.answerLogs.length>0)("ngIfElse",g),s.xp6(4),s.Q6J("ngIf",c.scorePerQuestionLogs&&c.scorePerQuestionLogs.length>0),s.xp6(2),s.Q6J("ngIf",c.scorePerQuestionLogs&&c.scorePerQuestionLogs.length>0)("ngIfElse",f)}}function Ir(_,A){1&_&&(s.TgZ(0,"div",27)(1,"div",28)(2,"div",29)(3,"span",30),s._uU(4,"Loading..."),s.qZA()()()())}function xs(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",31)(1,"button",32),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(4);return s.KtG(f.getData())}),s.ALo(2,"mytranslate"),s.TgZ(3,"mat-icon"),s._uU(4,"keyboard_arrow_down"),s.qZA()()()}if(2&_){const c=s.oxw(4);s.xp6(1),s.s9C("matTooltip",s.lcZ(2,2,"lang_auto_xem_them")),s.Q6J("disabled",""==c.nextPage)}}function ys(_,A){if(1&_&&(s.ynx(0),s.TgZ(1,"table",13)(2,"tr")(3,"th",14),s._uU(4),s.ALo(5,"mytranslate"),s.qZA(),s.TgZ(6,"th"),s._uU(7),s.ALo(8,"mytranslate"),s.qZA(),s.TgZ(9,"th"),s._uU(10),s.ALo(11,"mytranslate"),s.qZA(),s.TgZ(12,"th"),s._uU(13),s.ALo(14,"mytranslate"),s.qZA(),s.TgZ(15,"th"),s._uU(16),s.ALo(17,"mytranslate"),s.qZA()(),s.YNc(18,vs,14,7,"ng-container",15),s.qZA(),s.TgZ(19,"div",16),s.YNc(20,Ir,5,0,"div",17),s.YNc(21,xs,5,4,"div",18),s.qZA(),s.BQk()),2&_){const c=s.oxw(3);s.xp6(4),s.Oqu(s.lcZ(5,8,"lang_auto_cau_hoi")),s.xp6(3),s.Oqu(s.lcZ(8,10,"lang_auto_dap_an_hien_tai")),s.xp6(3),s.Oqu(s.lcZ(11,12,"lang_auto_lich_su_sua_dap_an")),s.xp6(3),s.Oqu(s.lcZ(14,14,"lang_auto_diem_hien_tai")),s.xp6(3),s.Oqu(s.lcZ(17,16,"lang_auto_lich_su_sua_diem")),s.xp6(2),s.Q6J("ngForOf",c.logQuestionDataList),s.xp6(2),s.Q6J("ngIf",c.isLoadingMore),s.xp6(1),s.Q6J("ngIf",!c.isLoadingMore)}}function Ti(_,A){1&_&&(s.TgZ(0,"div",35),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_khong_co_du_lieu")))}function ws(_,A){if(1&_&&(s.TgZ(0,"div",36),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(4);s.xp6(1),s.Oqu(s.lcZ(2,1,c.statusObj.errorMessage))}}function Er(_,A){if(1&_&&(s.YNc(0,Ti,3,3,"div",33),s.YNc(1,ws,3,3,"div",34)),2&_){const c=s.oxw(3);s.Q6J("ngIf",!c.statusObj.errorMessage),s.xp6(1),s.Q6J("ngIf",c.statusObj.errorMessage)}}function Ai(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"h3",8),s._uU(4),s.ALo(5,"mytranslate"),s.qZA(),s.TgZ(6,"div",9),s.YNc(7,ys,22,18,"ng-container",3),s.YNc(8,Er,2,2,"ng-template",null,10,s.W1O),s.qZA()()(),s.TgZ(10,"div",11)(11,"button",12),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(2);return s.KtG(f.btnCloseDialog(!1))}),s._uU(12),s.ALo(13,"mytranslate"),s.qZA()()()}if(2&_){const c=s.MAs(9),g=s.oxw(2);s.xp6(4),s.Oqu(s.lcZ(5,4,"lang_auto_lich_su_sua_de")),s.xp6(3),s.Q6J("ngIf",g.logQuestionDataList.length>0)("ngIfElse",c),s.xp6(5),s.hij(" ",s.lcZ(13,6,"lang_auto_dong")," ")}}function Ii(_,A){if(1&_&&(s.TgZ(0,"div",1)(1,"div",2),s.YNc(2,br,1,0,"azt-loading-effect",3),s.YNc(3,Ai,14,8,"ng-template",null,4,s.W1O),s.qZA()()),2&_){const c=s.MAs(4),g=s.oxw();s.xp6(2),s.Q6J("ngIf",g.statusObj.loading)("ngIfElse",c)}}let Ei=(()=>{class _ extends et.Q{constructor(c,g,f){super(c),this.commonService=c,this.frontExamLogService=g,this.activeRoute=f,this.closeDialog=new s.vpe,this.logQuestionDataList=[],this.nextPage="",this.timezoneOffset=(new Date).getTimezoneOffset(),this.isLoadingMore=!1}processData(c){var g,f,E,S,F,at,lt;if(c.data){this.nextPage=null!==(g=c.data.nextPage)&&void 0!==g?g:"";let bt=c.data.answerLogs,Lt=c.data.scorePerQuestionLogs,wt=null!==(S=null===(E=null===(f=this.data)||void 0===f?void 0:f.obj)||void 0===E?void 0:E.length)&&void 0!==S?S:0;for(let Nt=0;Nt<wt;Nt++){const kt=null===(at=null===(F=this.data)||void 0===F?void 0:F.obj)||void 0===at?void 0:at[Nt];let St=null!==(lt=this.commonService.castJsonToClassObj(Wt,JSON.stringify(kt)))&&void 0!==lt?lt:{answerLabelsMockup:{}};for(const Ot in bt)Object.prototype.hasOwnProperty.call(bt,Ot)&&(null==kt?void 0:kt.id)==Number(Ot)&&(St.answerLogs=bt[Ot]);for(const Ot in Lt)Object.prototype.hasOwnProperty.call(Lt,Ot)&&(null==kt?void 0:kt.id)==Number(Ot)&&(St.scorePerQuestionLogs=Lt[Ot]);(St.answerLogs||St.scorePerQuestionLogs)&&this.logQuestionDataList.push(St)}}}convertAnswer(c,g){var f,E;let S=c.split('"')[1];if(null!==(f=g.answers)&&void 0!==f&&f[0].alpha){for(let F=0;F<g.answers.length;F++)return S==g.answers[F].key?null!==(E=g.answers[F].alpha)&&void 0!==E?E:"":S;return S}return S}btnCloseDialog(c){this.closeDialog.emit(!1)}getData(){var c;let g=null!==(c=this.activeRoute.snapshot.paramMap.get("hash_id"))&&void 0!==c?c:"",f=Number(this.activeRoute.snapshot.paramMap.get("result_id")),E=this.commonService.getMyQueryParam("offline");""==this.nextPage?this.initStatusObj():this.isLoadingMore=!0,this.subscriptions.add(this.frontExamLogService.apiFrontExamLogGetObjsV2Get(g,f,E,this.nextPage).subscribe(S=>{var F;1==S.success?(this.processData(S),this.successStatusObj()):this.errorStatusObj(null!==(F=S.message)&&void 0!==F?F:"",!1),this.isLoadingMore=!1}))}ngOnInit(){this.getData(),super.ngOnInit()}}return _.\u0275fac=function(c){return new(c||_)(s.Y36(P.v),s.Y36(Et.bW),s.Y36(z.gz))},_.\u0275cmp=s.Xpm({type:_,selectors:[["app-log-edit-exam"]],inputs:{data:"data"},outputs:{closeDialog:"closeDialog"},features:[s.qOj],decls:1,vars:1,consts:[["class","school-info_bg",4,"ngIf"],[1,"school-info_bg"],[1,"school-info","p-4"],[4,"ngIf","ngIfElse"],["doneLoading",""],[1,"container-fluid","mt-3","mb-5"],[1,"block-table"],[1,"mt-3","mb-2"],[1,"title-table"],[1,"table-responsive"],["noEditExam",""],[1,"d-flex","float-right","mt-3"],["mat-raised-button","",1,"btn-light",2,"margin-left","15px",3,"click"],["id","tracktable"],["id","questionNum"],[4,"ngFor","ngForOf"],[1,"row","my-1","m-2"],["class","col-md-12",4,"ngIf"],["class","col-md-12 text-center",4,"ngIf"],["class","test",4,"ngIf"],[1,"text-center"],["noLogAnswer",""],[1,"test"],[4,"ngIf"],["noLogScore",""],["class","block-item",4,"ngFor","ngForOf"],[1,"block-item"],[1,"col-md-12"],[1,"d-flex","justify-content-center","mt-3"],["role","status",1,"spinner-border","text-secondary"],[1,"sr-only"],[1,"col-md-12","text-center"],["mat-button","",1,"btn-all-add",3,"matTooltip","disabled","click"],["class","alert alert-info p-2",4,"ngIf"],["class","alert alert-danger p-2",4,"ngIf"],[1,"alert","alert-info","p-2"],[1,"alert","alert-danger","p-2"]],template:function(c,g){1&c&&s.YNc(0,Ii,5,2,"div",0),2&c&&s.Q6J("ngIf",g.data)},dependencies:[jt.sg,jt.O5,Bt.lW,Gt.Hw,ot.gM,ds.Q,jt.uU,yt.bT],styles:[".school-info_bg[_ngcontent-%COMP%]{z-index:899;width:100%;display:flex;left:0;top:0;position:fixed;height:100%;min-height:100vh;background:rgba(0,0,0,.5607843137)}.school-info[_ngcontent-%COMP%]{z-index:900;top:50%;left:50%;min-width:30%;min-height:70vh;width:80%;transform:translate(-50%,-50%);position:fixed;background:#fff;margin-left:auto;margin-right:auto;box-shadow:0 0 13px 3px #00000094}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;max-width:90%;padding:5px 0;white-space:nowrap}.preview-file[_ngcontent-%COMP%]{cursor:pointer;color:#007bff}.block-table[_ngcontent-%COMP%]{height:60vh;overflow:auto;overflow-x:hidden}.block-table-v2[_ngcontent-%COMP%]{height:60vh;overflow:hidden}.block-table[_ngcontent-%COMP%]::-webkit-scrollbar{background-color:#fff;width:16px}.block-table[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:#fff}.block-table[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#babac0;border-radius:16px;border:4px solid #fff}.block-table[_ngcontent-%COMP%]::-webkit-scrollbar-button{display:none}.close-btn[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-7px;padding:5px 10px;background:#dadada;cursor:pointer;border-radius:20px}.box-content[_ngcontent-%COMP%]{padding:0 15px;border:1px solid #dadada;border-radius:5px;height:calc(100% - 50px)}.box-scroll-able[_ngcontent-%COMP%]{overflow:auto;height:70%}.stdimg[_ngcontent-%COMP%]{display:flex;margin-right:5px;margin-left:5px}.list-time[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{height:calc(100vh - 250px);overflow:auto;list-style:none;margin-bottom:0;background-color:#fff;padding:10px}.list-time[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.list-time[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.list-time[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.select[_ngcontent-%COMP%]{font-weight:500}.list-question[_ngcontent-%COMP%]{overflow:auto;height:calc(100vh - 250px);padding:10px;margin-bottom:10px}.title-table[_ngcontent-%COMP%]{font-size:18px;text-align:center}#tracktable[_ngcontent-%COMP%]{background-color:#fff;border-collapse:collapse;width:100%}#tracktable[_ngcontent-%COMP%]   #timeStamp[_ngcontent-%COMP%]{width:200px}#tracktable[_ngcontent-%COMP%]   #questionNum[_ngcontent-%COMP%], #tracktable[_ngcontent-%COMP%]   #answerLabel[_ngcontent-%COMP%]{width:100px}#tracktable[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:500;padding:8px}#tracktable[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%]{background-color:#999;color:#fff}#tracktable[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], #tracktable[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:1px solid #dddddd;text-align:left;padding:8px;text-align:center}@media only screen and (max-width: 1024px){.school-info[_ngcontent-%COMP%]{width:95%;max-width:95%}}"]}),_})();class Wt extends C.v{}const ne=["drawerTestReview"];function Jn(_,A){if(1&_&&s._UZ(0,"azt-basic-info-box",23),2&_){const c=s.oxw(4);s.Q6J("studentObj",c.studentObj)}}function Ci(_,A){1&_&&(s.TgZ(0,"div")(1,"div",24),s._uU(2),s.ALo(3,"mytranslate"),s.qZA()()),2&_&&(s.xp6(2),s.Oqu(s.lcZ(3,1,"lang_auto_thi_sinh_chua_thi_lan_nao")))}function Cr(_,A){if(1&_&&(s.TgZ(0,"span",36),s._uU(1),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.Oqu(null!=(null==c.examResultObj?null:c.examResultObj.mark)?null==c.examResultObj?null:c.examResultObj.mark:"Ch\u01b0a c\xf3 \u0111i\u1ec3m")}}function Or(_,A){1&_&&(s.TgZ(0,"span",36),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_chua_duoc_xem")))}function bs(_,A){if(1&_&&(s.TgZ(0,"span",40),s._uU(1),s.qZA()),2&_){const c=s.oxw(7);s.xp6(1),s.AsE("(",c.examResultObj.rightAnswer,"/",c.examResultObj.totalQuestion-c.countEssayQuestion,")")}}function Sr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",41),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(7);return s.KtG(f.clickFrontResultTrack())}),s.ALo(1,"mytranslate"),s._uU(2,"view_timeline"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_xem_chi_tiet_qua_trinh_lam_bai_trac_nghiem"))}function Cn(_,A){if(1&_&&(s.TgZ(0,"li",37)(1,"div"),s._uU(2),s.ALo(3,"mytranslate"),s.YNc(4,bs,2,2,"span",38),s.qZA(),s.YNc(5,Sr,3,3,"mat-icon",39),s.qZA()),2&_){const c=s.oxw(6);s.xp6(2),s.AsE(" ",s.lcZ(3,4,"lang_auto_trac_nghiem"),": ",null!=c.examResultObj.trueFalseMark?c.examResultObj.trueFalseMark:"Ch\u01b0a c\xf3 \u0111i\u1ec3m"," "),s.xp6(2),s.Q6J("ngIf",null!=(null==c.examResultObj?null:c.examResultObj.rightAnswer)),s.xp6(1),s.Q6J("ngIf",c.checkHasType1Question&&!c.offlineHashId)}}function Oi(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.HOy("",s.lcZ(2,4,"lang_auto_tu_luan"),": ",null!=c.examResultObj&&c.examResultObj.confirmedAt?null==c.examResultObj?null:c.examResultObj.essayMark:"Ch\u01b0a ch\u1ea5m"," (",c.countEssayQuestion," ",s.lcZ(3,6,"lang_auto_cau_brackets"),"")}}function Si(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.AsE("",s.lcZ(2,2,"lang_auto_so_file_da_nop"),": ",c.files.length,"")}}function kr(_,A){1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_trac_nghiem_chua_duoc_xem")))}function ki(_,A){1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_tu_luan_chua_duoc_xem")))}function Ts(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA(),s.TgZ(3,"li"),s._uU(4),s.ALo(5,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.AsE("",s.lcZ(2,4,"lang_auto_so_lan_thoat_man_hinh"),": ",c.examTracks.exitFullScreen,""),s.xp6(3),s.AsE("",s.lcZ(5,6,"lang_auto_so_lan_thoat_trinh_duyet"),": ",c.examTracks.blurWindow,"")}}function Mr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"button",42),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.showCopySuccess())}),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()}if(2&_){const c=s.oxw(6);s.Q6J("cdkCopyToClipboard",c.copyLinkToClipboard()),s.xp6(1),s.Oqu(s.lcZ(2,2,"lang_auto_copy_link_gui_giao_vien"))}}function un(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"a",48),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(8);return s.KtG(f.onShowFile(f.fileScanUrl))}),s._UZ(1,"img",49),s.qZA()}if(2&_){const c=s.oxw(8);s.xp6(1),s.Q6J("src",c.fileScanUrl,s.LSH)}}function Mi(_,A){1&_&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_luu_trong_app_mobile")))}function Di(_,A){if(1&_&&(s.TgZ(0,"li")(1,"span",46),s._uU(2),s.ALo(3,"mytranslate"),s.qZA(),s.YNc(4,un,2,1,"a",47),s.YNc(5,Mi,3,3,"span",3),s.qZA()),2&_){const c=s.oxw(7);s.xp6(2),s.hij("",s.lcZ(3,3,"lang_auto_anh_cham"),": "),s.xp6(2),s.Q6J("ngIf",c.checkHttpLinkImg),s.xp6(1),s.Q6J("ngIf",!c.checkHttpLinkImg)}}function On(_,A){if(1&_&&(s.TgZ(0,"div",43)(1,"div",30)(2,"span"),s._uU(3,"Thi Offline"),s.qZA()(),s.TgZ(4,"ul")(5,"li")(6,"span",44),s._uU(7),s.ALo(8,"mytranslate"),s.ALo(9,"formatOfflineExamHashIdToNumber"),s.qZA(),s.TgZ(10,"span",45),s.ALo(11,"mytranslate"),s._uU(12),s.ALo(13,"formatStudentCodeToNumber"),s.qZA()(),s.YNc(14,Di,6,5,"li",3),s.qZA()()),2&_){const c=s.oxw(6);let g,f;s.xp6(7),s.AsE("",s.lcZ(8,5,"lang_auto_ma_de_thi"),": ",s.xi3(9,7,null!==(g=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMixquestionObj?null:c.initDataResult.data.offlineMixquestionObj.hashId)&&void 0!==g?g:0,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.offlineMixquestionHashidLength),""),s.xp6(3),s.s9C("matTooltip",s.lcZ(11,10,"lang_auto_so_bao_danh")),s.xp6(2),s.hij("SBD: ",s.xi3(13,12,(null!==(f=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode)&&void 0!==f?f:0)<0||(null!==(f=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentId)&&void 0!==f?f:0)<=0?0:null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCodeLength),""),s.xp6(2),s.Q6J("ngIf",c.imgOfflineTest)}}const Gn=function(_){return{"margin-top":_}};function Sn(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div")(1,"div",26)(2,"span",27),s._uU(3),s.ALo(4,"mytranslate"),s.qZA(),s.YNc(5,Cr,2,1,"span",28),s.YNc(6,Or,3,3,"span",28),s.qZA(),s.TgZ(7,"div",29)(8,"div",30)(9,"span"),s._uU(10),s.ALo(11,"mytranslate"),s.qZA()(),s.TgZ(12,"ul"),s.YNc(13,Cn,6,6,"li",31),s.YNc(14,Oi,4,8,"li",3),s.YNc(15,Si,3,4,"li",3),s.YNc(16,kr,3,3,"li",3),s.YNc(17,ki,3,3,"li",3),s.YNc(18,Ts,6,8,"ng-template",32),s.TgZ(19,"li"),s._uU(20),s.ALo(21,"mytranslate"),s.TgZ(22,"mat-icon",33),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(5);return s.KtG(f.openLogEditExam())}),s.ALo(23,"mytranslate"),s._uU(24,"history_edu"),s.qZA()(),s.TgZ(25,"li"),s.YNc(26,Mr,3,4,"button",34),s.qZA()()(),s.YNc(27,On,15,15,"div",35),s.qZA()}if(2&_){const c=s.oxw(5);s.xp6(1),s.Q6J("ngStyle",s.VKq(23,Gn,c.isBackEnd?"15px":"0px")),s.xp6(2),s.hij("",s.lcZ(4,15,"lang_auto_diem_cuoi"),": "),s.xp6(2),s.Q6J("ngIf",2!=(null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.examObj?null:c.initDataResult.data.examObj.whenShowResult)),s.xp6(1),s.Q6J("ngIf",2==(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(4),s.hij(" ",s.lcZ(11,17,"lang_auto_thong_tin_chi_tiet")," "),s.xp6(3),s.Q6J("ngIf",c.multipleChoiceList.length>0&&2!=(null==c.examConfig?null:c.examConfig.whenShowResult)&&c.examResultObj&&c.examResultObj.totalQuestion),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0&&2!=(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(1),s.Q6J("ngIf",c.countEssayQuestion>0),s.xp6(1),s.Q6J("ngIf",c.multipleChoiceList.length>0&&2==(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0&&2==(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(1),s.Q6J("ngIf",c.examTracks&&0!=(null==c.examObj?null:c.examObj.autoMonitor)),s.xp6(2),s.hij("",s.lcZ(21,19,"lang_auto_lich_su_sua_de"),": "),s.xp6(2),s.s9C("matTooltip",s.lcZ(23,21,"lang_auto_lich_su_sua_de")),s.xp6(4),s.Q6J("ngIf",!c.offlineHashId),s.xp6(1),s.Q6J("ngIf",c.offlineMarkObj)}}function As(_,A){if(1&_&&(s.TgZ(0,"button",56)(1,"mat-icon"),s._uU(2,"more_vert"),s.qZA()()),2&_){s.oxw();const c=s.MAs(9);s.Q6J("matMenuTriggerFor",c)}}function Is(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",57),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.clickExportPdf())}),s.ALo(1,"mytranslate"),s._uU(2,"file_download"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_tai_bai_lam_duoi_dang_pdf"))}function Es(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",41),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(7);return s.KtG(f.clickResultTrack())}),s.ALo(1,"mytranslate"),s._uU(2,"view_timeline"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_xem_chi_tiet_qua_trinh_lam_bai_trac_nghiem"))}function Kn(_,A){if(1&_&&(s.TgZ(0,"li",37),s._uU(1),s.ALo(2,"mytranslate"),s.YNc(3,Es,3,3,"mat-icon",39),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.HOy(" ",s.lcZ(2,5,"lang_auto_trac_nghiem"),": ",c.examResultObj.trueFalseMark," (",c.examResultObj.rightAnswer,"/",c.examResultObj.totalQuestion-c.countEssayQuestion,") "),s.xp6(2),s.Q6J("ngIf",c.checkHasType1Question)}}function Dr(_,A){if(1&_&&(s.TgZ(0,"span"),s._UZ(1,"azt-create-avatar",58),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(7);s.xp6(1),s.s9C("matTooltip",s.lcZ(2,4,"lang_auto_giao_vien_cham")+": "+(null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.markedByObj?null:c.initDataResult.data.markedByObj.fullName)),s.Q6J("nameCreateAvatar",null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.markedByObj?null:c.initDataResult.data.markedByObj.fullName)("size",25)("linkAvatar",null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.markedByObj?null:c.initDataResult.data.markedByObj.avatar)}}function Rr(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.ALo(4,"mytranslate"),s.YNc(5,Dr,3,6,"span",3),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.HOy(" ",s.lcZ(2,5,"lang_auto_tu_luan"),": ",null!=c.examResultObj&&c.examResultObj.confirmedAt?null==c.examResultObj?null:c.examResultObj.essayMark:s.lcZ(3,7,"lang_testbank_statistical_not_mark")," (",c.countEssayQuestion," ",s.lcZ(4,9,"lang_auto_cau_brackets")," "),s.xp6(4),s.Q6J("ngIf",null==c.examResultObj?null:c.examResultObj.confirmedAt)}}function hn(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.AsE("",s.lcZ(2,2,"lang_auto_so_file_da_nop"),": ",c.files.length,"")}}function Lr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.TgZ(3,"mat-icon",33),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.openResultHistoryReview())}),s.ALo(4,"mytranslate"),s._uU(5,"history"),s.qZA()()}2&_&&(s.xp6(1),s.hij("",s.lcZ(2,2,"lang_auto_phuc_khao"),": "),s.xp6(2),s.s9C("matTooltip",s.lcZ(4,4,"lang_auto_phuc_khao")))}function Nr(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA(),s.TgZ(3,"li"),s._uU(4),s.ALo(5,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.AsE("",s.lcZ(2,4,"lang_auto_so_lan_thoat_man_hinh"),": ",c.examTracks.exitFullScreen,""),s.xp6(3),s.AsE("",s.lcZ(5,6,"lang_auto_so_lan_thoat_trinh_duyet"),": ",c.examTracks.blurWindow,"")}}function Je(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"a",48),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(8);return s.KtG(f.onShowFile(f.fileScanUrl))}),s._UZ(1,"img",49),s.qZA()}if(2&_){const c=s.oxw(8);s.xp6(1),s.Q6J("src",c.fileScanUrl,s.LSH)}}function Cs(_,A){1&_&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_luu_trong_app_mobile")))}function Yn(_,A){if(1&_&&(s.TgZ(0,"li")(1,"span",46),s._uU(2),s.ALo(3,"mytranslate"),s.qZA(),s.YNc(4,Je,2,1,"a",47),s.YNc(5,Cs,3,3,"span",3),s.qZA()),2&_){const c=s.oxw(7);s.xp6(2),s.hij("",s.lcZ(3,3,"lang_auto_anh_cham"),": "),s.xp6(2),s.Q6J("ngIf",c.checkHttpLinkImg),s.xp6(1),s.Q6J("ngIf",!c.checkHttpLinkImg)}}function Os(_,A){if(1&_&&(s.TgZ(0,"div",43)(1,"div",30)(2,"span"),s._uU(3,"Thi Offline"),s.qZA()(),s.TgZ(4,"ul")(5,"li")(6,"span",44),s._uU(7),s.ALo(8,"mytranslate"),s.ALo(9,"formatOfflineExamHashIdToNumber"),s.qZA(),s.TgZ(10,"span",45),s.ALo(11,"mytranslate"),s._uU(12),s.ALo(13,"formatStudentCodeToNumber"),s.qZA()(),s.YNc(14,Yn,6,5,"li",3),s.qZA()()),2&_){const c=s.oxw(6);let g,f;s.xp6(7),s.AsE("",s.lcZ(8,5,"lang_auto_ma_de_thi"),": ",s.xi3(9,7,null!==(g=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMixquestionObj?null:c.initDataResult.data.offlineMixquestionObj.hashId)&&void 0!==g?g:0,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.offlineMixquestionHashidLength),""),s.xp6(3),s.s9C("matTooltip",s.lcZ(11,10,"lang_auto_so_bao_danh")),s.xp6(2),s.hij("SBD: ",s.xi3(13,12,(null!==(f=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode)&&void 0!==f?f:0)<0||(null!==(f=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentId)&&void 0!==f?f:0)<=0?0:null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCodeLength),""),s.xp6(2),s.Q6J("ngIf",c.imgOfflineTest)}}function kn(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div")(1,"div",50)(2,"span",27),s._uU(3),s.ALo(4,"mytranslate"),s.qZA(),s.TgZ(5,"span",36),s._uU(6),s.qZA(),s.YNc(7,As,3,1,"button",51),s.TgZ(8,"mat-menu",null,52)(10,"button",53),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(5);return s.KtG(f.redirectToTestedList())}),s._uU(11),s.ALo(12,"mytranslate"),s.qZA()()(),s.TgZ(13,"div",29)(14,"div",54)(15,"span"),s._uU(16),s.ALo(17,"mytranslate"),s.qZA(),s.YNc(18,Is,3,3,"mat-icon",55),s.qZA(),s.TgZ(19,"ul"),s.YNc(20,Kn,4,7,"li",31),s.YNc(21,Rr,6,11,"li",3),s.YNc(22,hn,3,4,"li",3),s.YNc(23,Lr,6,6,"li",3),s.YNc(24,Nr,6,8,"ng-template",32),s.qZA()(),s.YNc(25,Os,15,15,"div",35),s.qZA()}if(2&_){const c=s.oxw(5);s.xp6(1),s.Q6J("ngStyle",s.VKq(19,Gn,c.isBackEnd?"15px":"0px")),s.xp6(2),s.hij("",s.lcZ(4,13,"lang_auto_diem_cuoi"),": "),s.xp6(3),s.Oqu(null==c.examResultObj?null:c.examResultObj.mark),s.xp6(1),s.Q6J("ngIf",c.isBackEnd&&!c.isMobile),s.xp6(4),s.Oqu(s.lcZ(12,15,"lang_auto_danh_sach_da_thi")),s.xp6(5),s.Oqu(s.lcZ(17,17,"lang_auto_thong_tin_chi_tiet")),s.xp6(2),s.Q6J("ngIf",c.isBackEnd),s.xp6(2),s.Q6J("ngIf",c.multipleChoiceList.length>0&&c.examResultObj&&c.examResultObj.totalQuestion),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0),s.xp6(1),s.Q6J("ngIf",c.countEssayQuestion>0),s.xp6(1),s.Q6J("ngIf",c.checkShowIconHistory()),s.xp6(1),s.Q6J("ngIf",c.examTracks&&0!=(null==c.examObj?null:c.examObj.autoMonitor)),s.xp6(1),s.Q6J("ngIf",c.isBackEnd&&c.offlineMarkObj)}}const Ri=function(_){return{select:_}},le=function(_){return{"border-bottom":_}};function Ss(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"li",64),s.NdJ("click",function(){const E=s.CHM(c).$implicit,S=s.oxw(6);return s.KtG(S.getAndProcessAnswers(E.id))}),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.TgZ(4,"div",65),s._uU(5),s.ALo(6,"date"),s.ALo(7,"date"),s.qZA(),s.TgZ(8,"div",65),s._uU(9),s.ALo(10,"mytranslate"),s.qZA()()}if(2&_){const c=A.$implicit,g=A.index,f=s.oxw(6);s.Q6J("ngClass",s.VKq(22,Ri,c.id===f.curResult))("ngStyle",s.VKq(24,le,g==f.examResultObjList.length-1?"none":"1px dashed #f1f1f1")),s.xp6(1),s.HOy(" ",s.lcZ(2,10,"lang_auto_lan")," ",f.examResultObjList.length-g," [",s.lcZ(3,12,"lang_auto_diem")," ",c.mark,"] "),s.xp6(4),s.AsE("",s.xi3(6,14,c.startedTest,"dd/MM/yyyy, HH:mm")," - ",s.xi3(7,17,c.createdAt,"HH:mm"),""),s.xp6(4),s.AsE("",s.lcZ(10,20,"lang_auto_thoi_gian_lam_bai"),": ",f.calculateTime(c.startedTest,c.createdAt),"")}}function Mn(_,A){if(1&_&&(s.TgZ(0,"div",29)(1,"button",59),s._uU(2),s.ALo(3,"mytranslate"),s.qZA(),s.TgZ(4,"mat-menu",60,61)(6,"ul",62),s.YNc(7,Ss,11,26,"ng-template",63),s.qZA()()()),2&_){const c=s.MAs(5),g=s.oxw(5);s.xp6(1),s.Q6J("matMenuTriggerFor",c),s.xp6(1),s.AsE("",s.lcZ(3,4,"lang_auto_xem_cac_lan_thi_"),"",g.examResultObjList.length,")"),s.xp6(5),s.Q6J("ngForOf",g.examResultObjList)}}function Hn(_,A){if(1&_&&(s.YNc(0,Sn,28,25,"div",3),s.YNc(1,kn,26,21,"div",3),s.YNc(2,Mn,8,6,"div",25)),2&_){const c=s.oxw(4);s.Q6J("ngIf",!c.isBackEnd),s.xp6(1),s.Q6J("ngIf",c.isBackEnd),s.xp6(1),s.Q6J("ngIf",c.isBackEnd&&c.examResultObjList)}}function ks(_,A){if(1&_&&(s.TgZ(0,"div",66)(1,"span"),s._uU(2),s.qZA(),s.TgZ(3,"span"),s._uU(4),s.ALo(5,"mytranslate"),s.qZA()()),2&_){const c=s.oxw(4);s.xp6(2),s.Oqu(null==c.studentObj?null:c.studentObj.fullName),s.xp6(2),s.AsE("",s.lcZ(5,3,"lang_auto_diem_cuoi"),": ",null==c.examResultObj?null:c.examResultObj.mark,"")}}function Li(_,A){1&_&&(s.TgZ(0,"div",67),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_thi_sinh_chua_lam_bai_thi")))}function Ms(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",68),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(4);return s.KtG(f.handleNavigate("next"))}),s._uU(1,"navigate_next"),s.qZA()}}function Ds(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",69),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(4);return s.KtG(f.handleNavigate("prev"))}),s._uU(1,"navigate_before"),s.qZA()}}function Dn(_,A){if(1&_&&(s.TgZ(0,"div",84)(1,"button",85)(2,"span",86),s._uU(3),s.ALo(4,"mytranslate"),s.ALo(5,"mytranslate"),s.ALo(6,"mytranslate"),s.qZA(),s.TgZ(7,"mat-icon",87),s._uU(8,"filter_alt"),s.qZA()()()),2&_){s.oxw();const c=s.MAs(4),g=s.oxw(5);s.xp6(1),s.Q6J("matMenuTriggerFor",c),s.xp6(2),s.Oqu("viewRight"==g.viewOption?s.lcZ(4,2,"lang_auto_cau_dung"):"viewWrong"==g.viewOption?s.lcZ(5,4,"lang_auto_cau_sai"):s.lcZ(6,6,"lang_testbank_testted_list_sort"))}}function Ni(_,A){1&_&&(s.TgZ(0,"mat-icon",88),s._uU(1,"clear"),s.qZA())}function Pi(_,A){1&_&&(s.TgZ(0,"mat-icon",88),s._uU(1,"clear"),s.qZA())}function qi(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",89),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.showButtonComment(!0))}),s.ALo(1,"mytranslate"),s._uU(2,"speaker_notes_off"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_click_de_hien_nut_hoi_giao_vien"))}function $n(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",89),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.showButtonComment(!1))}),s.ALo(1,"mytranslate"),s._uU(2,"speaker_notes"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_click_de_an_nut_hoi_giao_vien"))}const Ge=function(){return{"background-color":"orange",color:"white"}},$e=function(){return{}};function Pr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",75)(1,"div",76),s.YNc(2,Dn,9,8,"div",77),s.TgZ(3,"mat-menu",78,79)(5,"div",80),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(5);return s.KtG(f.onChangeViewOption("viewRight"))}),s._uU(6),s.ALo(7,"mytranslate"),s.YNc(8,Ni,2,0,"mat-icon",81),s.qZA(),s.TgZ(9,"div",82),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(5);return s.KtG(f.onChangeViewOption("viewWrong"))}),s._uU(10),s.ALo(11,"mytranslate"),s.YNc(12,Pi,2,0,"mat-icon",81),s.qZA()(),s.YNc(13,qi,3,3,"mat-icon",83),s.YNc(14,$n,3,3,"mat-icon",83),s.qZA()()}if(2&_){const c=s.oxw(5);s.xp6(2),s.Q6J("ngIf",!c.notShowAnswerYet),s.xp6(3),s.Q6J("ngStyle","viewRight"==c.viewOption?s.DdM(13,Ge):s.DdM(14,$e)),s.xp6(1),s.hij(" ",s.lcZ(7,9,"lang_auto_cau_dung")," "),s.xp6(2),s.Q6J("ngIf","viewRight"==c.viewOption),s.xp6(1),s.Q6J("ngStyle","viewWrong"==c.viewOption?s.DdM(15,Ge):s.DdM(16,$e)),s.xp6(1),s.hij(" ",s.lcZ(11,11,"lang_auto_cau_sai")," "),s.xp6(2),s.Q6J("ngIf","viewWrong"==c.viewOption),s.xp6(1),s.Q6J("ngIf",!c.isBackEnd&&0==c.showButtonCommentToteacher&&1==(null==c.initDataResult||null==c.initDataResult.data?null:c.initDataResult.data.allowAskQuestion)),s.xp6(1),s.Q6J("ngIf",!c.isBackEnd&&1==c.showButtonCommentToteacher&&1==(null==c.initDataResult||null==c.initDataResult.data?null:c.initDataResult.data.allowAskQuestion))}}function p(_,A){if(1&_&&s._UZ(0,"azt-loaded-img",94),2&_){const c=s.oxw(6);s.Q6J("imgSrc",null==c.examObj?null:c.examObj.examHeader)}}function L(_,A){if(1&_&&(s.TgZ(0,"div",95),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.lnq("",s.lcZ(2,3,"lang_auto_danh_sach_cau")," ","viewRight"==c.viewOption?"\u0111\xfang":"sai"," ",s.lcZ(3,5,"lang_auto_trong"),"")}}function d(_,A){if(1&_&&(s.TgZ(0,"div",95),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.lnq("",s.lcZ(2,3,"lang_auto_tong_so_cau")," ","viewRight"==c.viewOption?"\u0111\xfang":"sai"," ",c.totalQuestionRight(),".")}}const b=function(){return{display:"none"}},I=function(_,A){return{correct:_,incorrect:A}};function G(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"azt-standalone-question",96),s.NdJ("statusResult",function(f){const S=s.CHM(c).$implicit,F=s.oxw(6);return s.KtG(F.setClassStatusResult(f,S))}),s.ALo(1,"isEssayAnswer"),s.qZA()}if(2&_){const c=A.$implicit,g=A.index,f=s.oxw(6);s.Q6J("ngStyle",s.lcZ(1,16,c.answerType)&&"viewAll"!=f.viewOption?s.DdM(18,b):null)("ngClass",s.WLB(19,I,null==c?null:c.isStatusResult,!c.isStatusResult))("userAnswersObj",f.userAnswersObj)("question",c)("index",g)("userAnswersObj",0!=f.examResultObjList.length?f.userAnswersObj:s.DdM(22,$e))("configExam",f.examConfig)("isRoleTeacher",f.isBackEnd)("index",g)("notShowAnswerYet",f.notShowAnswerYet)("isBackEnd",f.isBackEnd)("cur_result",f.curResult)("newFirstInGroupIndexes",f.newFirstInGroupIndexes)("showButtonCommentToteacher",f.showButtonCommentToteacher)("allowAskQuestion",f.allowAskQuestion)("displayScreen",f.displayScreen)}}function _t(_,A){if(1&_&&(s.TgZ(0,"mat-tab",90),s.ALo(1,"mytranslate"),s.TgZ(2,"div",91),s.YNc(3,p,1,1,"azt-loaded-img",92),s.YNc(4,L,4,7,"div",93),s.YNc(5,d,3,5,"div",93),s.YNc(6,G,2,23,"ng-template",63),s.qZA()()),2&_){const c=s.oxw(5);s.s9C("label",s.lcZ(1,8,"lang_auto_trac_nghiem")),s.xp6(2),s.Tol(c.viewOption),s.xp6(1),s.Q6J("ngIf",null==c.examObj?null:c.examObj.examHeader),s.xp6(1),s.Q6J("ngIf",0==c.totalQuestionRight()&&"viewAll"!=c.viewOption),s.xp6(1),s.Q6J("ngIf",0!=c.totalQuestionRight()&&"viewAll"!=c.viewOption),s.xp6(1),s.Q6J("ngForOf",c.questionList)}}function mt(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",101)(1,"azt-mark-essay",102),s.NdJ("saveResultEvent",function(f){s.CHM(c);const E=s.oxw(6);return s.KtG(E.saveResultEvent(f))}),s.qZA()()}if(2&_){const c=s.oxw(6);let g;s.xp6(1),s.Q6J("displayScreen",c.displayScreen)("resultID",null!==(g=c.curResult)&&void 0!==g?g:0)("files",c.files)("questions",c.essayQuestionList)("userAnswersObj",c.userAnswersObj)("iframeSrc",c.iframeSrc)("notShowAnswerYet",c.notShowAnswerYet)("examQuestionObjs",c.examQuestionObjs)("examResultObj",c.examResultObj)("configExam",c.examConfig)("isBackEnd",c.isBackEnd)("examObj",c.examObj)("hasLoadedData",c.hasLoadedData)}}function ft(_,A){1&_&&(s.TgZ(0,"p",103),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_khong_co_cau_tu_luan")))}function We(_,A){if(1&_&&(s.TgZ(0,"mat-tab",97),s.ALo(1,"mytranslate"),s.YNc(2,mt,2,13,"div",98),s.YNc(3,ft,3,3,"ng-template",99,100,s.W1O),s.qZA()),2&_){const c=s.MAs(4),g=s.oxw(5);s.s9C("label",s.lcZ(1,3,"lang_auto_tu_luan")),s.xp6(2),s.Q6J("ngIf",g.essayQuestionList.length>0)("ngIfElse",c)}}function Xe(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",70),s.YNc(1,Pr,15,17,"div",71),s.TgZ(2,"mat-tab-group",72),s.NdJ("selectedTabChange",function(f){s.CHM(c);const E=s.oxw(4);return s.KtG(E.onTabChanged(f))})("selectedIndexChange",function(f){s.CHM(c);const E=s.oxw(4);return s.KtG(E.curSelectedTab=f)}),s.YNc(3,_t,7,10,"mat-tab",73),s.YNc(4,We,5,5,"mat-tab",74),s.qZA()()}if(2&_){const c=s.oxw(4);s.xp6(1),s.Q6J("ngIf",(null==c.examResultObjList?null:c.examResultObjList.length)&&0==c.matTabGroupIndex),s.xp6(1),s.Q6J("selectedIndex",c.curSelectedTab),s.xp6(1),s.Q6J("ngIf",c.multipleChoiceList.length>0),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0)}}function tn(_,A){if(1&_&&(s.TgZ(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12),s.YNc(4,Jn,1,1,"azt-basic-info-box",13),s.qZA(),s.YNc(5,Ci,4,3,"div",14),s.YNc(6,Hn,3,3,"ng-template",null,15,s.W1O),s.qZA()(),s.YNc(8,ks,6,5,"div",16),s.TgZ(9,"div",17)(10,"div",18),s.YNc(11,Li,3,3,"div",19),s.YNc(12,Ms,2,0,"mat-icon",20),s.YNc(13,Ds,2,0,"mat-icon",21),s.YNc(14,Xe,5,4,"ng-template",null,22,s.W1O),s.qZA()()()),2&_){const c=s.MAs(7),g=s.MAs(15),f=s.oxw(3);s.xp6(4),s.Q6J("ngIf",f.isBackEnd),s.xp6(1),s.Q6J("ngIf",0===(null==f.initDataResult||null==f.initDataResult.data||null==f.initDataResult.data.historyExamResultObjs?null:f.initDataResult.data.historyExamResultObjs.length))("ngIfElse",c),s.xp6(3),s.Q6J("ngIf",f.isBackEnd),s.xp6(3),s.Q6J("ngIf",!(null!=f.examResultObjList&&f.examResultObjList.length))("ngIfElse",g),s.xp6(1),s.Q6J("ngIf",f.hasNext()),s.xp6(1),s.Q6J("ngIf",f.hasPrev())}}function Rn(_,A){if(1&_&&(s.TgZ(0,"span",36),s._uU(1),s.qZA()),2&_){const c=s.oxw(5);s.xp6(1),s.Oqu(null!=(null==c.examResultObj?null:c.examResultObj.mark)?null==c.examResultObj?null:c.examResultObj.mark:"Ch\u01b0a c\xf3 \u0111i\u1ec3m")}}function Wn(_,A){1&_&&(s.TgZ(0,"span",36),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_chua_duoc_xem")))}function qr(_,A){if(1&_&&(s.TgZ(0,"span"),s._uU(1),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.AsE("(",c.examResultObj.rightAnswer,"/",c.examResultObj.totalQuestion-c.countEssayQuestion,")")}}function Xn(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",41),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.clickFrontResultTrack())}),s.ALo(1,"mytranslate"),s._uU(2,"view_timeline"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_xem_chi_tiet_qua_trinh_lam_bai_trac_nghiem"))}function Zr(_,A){if(1&_&&(s.TgZ(0,"li",37),s._uU(1),s.ALo(2,"mytranslate"),s.YNc(3,qr,2,2,"span",3),s.YNc(4,Xn,3,3,"mat-icon",39),s.qZA()),2&_){const c=s.oxw(5);s.xp6(1),s.AsE(" ",s.lcZ(2,4,"lang_auto_trac_nghiem"),": ",null!=c.examResultObj.trueFalseMark?c.examResultObj.trueFalseMark:"Ch\u01b0a c\xf3 \u0111i\u1ec3m"," "),s.xp6(2),s.Q6J("ngIf",null!=(null==c.examResultObj?null:c.examResultObj.rightAnswer)),s.xp6(1),s.Q6J("ngIf",c.checkHasType1Question)}}function Ln(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.qZA()),2&_){const c=s.oxw(5);s.xp6(1),s.HOy("",s.lcZ(2,4,"lang_auto_tu_luan"),": ",null!=c.examResultObj&&c.examResultObj.confirmedAt?null==c.examResultObj?null:c.examResultObj.essayMark:"Ch\u01b0a ch\u1ea5m"," (",c.countEssayQuestion," ",s.lcZ(3,6,"lang_auto_cau_brackets"),"")}}function Oo(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(5);s.xp6(1),s.AsE("",s.lcZ(2,2,"lang_auto_so_file_da_nop"),": ",c.files.length,"")}}function Ma(_,A){1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_trac_nghiem_chua_duoc_xem")))}function Nn(_,A){1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_tu_luan_chua_duoc_xem")))}function en(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA(),s.TgZ(3,"li"),s._uU(4),s.ALo(5,"mytranslate"),s.qZA()),2&_){const c=s.oxw(5);s.xp6(1),s.AsE("",s.lcZ(2,4,"lang_auto_so_lan_thoat_man_hinh"),": ",c.examTracks.exitFullScreen,""),s.xp6(3),s.AsE("",s.lcZ(5,6,"lang_auto_so_lan_thoat_trinh_duyet"),": ",c.examTracks.blurWindow,"")}}function Rs(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"a",114),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(7);return s.KtG(f.onShowFile(f.fileScanUrl))}),s._UZ(1,"img",115),s.qZA()}if(2&_){const c=s.oxw(7);s.xp6(1),s.Q6J("src",c.fileScanUrl,s.LSH)}}function Ls(_,A){1&_&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.hij(" ",s.lcZ(2,1,"lang_auto_luu_trong_app_mobile")," "))}function Ns(_,A){if(1&_&&(s.TgZ(0,"li")(1,"span"),s._uU(2),s.ALo(3,"mytranslate"),s.qZA(),s.YNc(4,Rs,2,1,"a",113),s.YNc(5,Ls,3,3,"span",3),s.qZA()),2&_){const c=s.oxw(6);s.xp6(2),s.hij("",s.lcZ(3,3,"lang_auto_anh_cham"),": "),s.xp6(2),s.Q6J("ngIf",c.checkHttpLinkImg),s.xp6(1),s.Q6J("ngIf",!c.checkHttpLinkImg)}}function So(_,A){if(1&_&&(s.TgZ(0,"div",43)(1,"div",30)(2,"span"),s._uU(3,"Thi Offline"),s.qZA()(),s.TgZ(4,"ul")(5,"li"),s._uU(6),s.ALo(7,"mytranslate"),s.ALo(8,"formatOfflineExamHashIdToNumber"),s.qZA(),s.TgZ(9,"li"),s._uU(10),s.ALo(11,"mytranslate"),s.ALo(12,"formatStudentCodeToNumber"),s.qZA(),s.YNc(13,Ns,6,5,"li",3),s.qZA()()),2&_){const c=s.oxw(5);let g,f;s.xp6(6),s.AsE("",s.lcZ(7,5,"lang_auto_ma_de_thi"),": ",s.xi3(8,7,null!==(g=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMixquestionObj?null:c.initDataResult.data.offlineMixquestionObj.hashId)&&void 0!==g?g:0,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.offlineMixquestionHashidLength),""),s.xp6(4),s.AsE("",s.lcZ(11,10,"lang_auto_so_bao_danh"),": ",s.xi3(12,12,(null!==(f=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode)&&void 0!==f?f:0)<0?0:null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCodeLength),""),s.xp6(3),s.Q6J("ngIf",c.imgOfflineTest)}}function Ft(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",112)(1,"div",26)(2,"span"),s._uU(3),s.ALo(4,"mytranslate"),s.qZA(),s.YNc(5,Rn,2,1,"span",28),s.YNc(6,Wn,3,3,"span",28),s.qZA(),s.TgZ(7,"div",29)(8,"div",30)(9,"span"),s._uU(10),s.ALo(11,"mytranslate"),s.qZA()(),s.TgZ(12,"ul"),s.YNc(13,Zr,5,6,"li",31),s.YNc(14,Ln,4,8,"li",3),s.YNc(15,Oo,3,4,"li",3),s.YNc(16,Ma,3,3,"li",3),s.YNc(17,Nn,3,3,"li",3),s.YNc(18,en,6,8,"ng-template",32),s.TgZ(19,"li"),s._uU(20),s.ALo(21,"mytranslate"),s.TgZ(22,"mat-icon",33),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(4);return s.KtG(f.openLogEditExam())}),s.ALo(23,"mytranslate"),s._uU(24,"history_edu"),s.qZA()(),s.TgZ(25,"li")(26,"button",42),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(4);return s.KtG(f.showCopySuccess())}),s._uU(27),s.ALo(28,"mytranslate"),s.qZA()()()(),s.YNc(29,So,14,15,"div",35),s.qZA()}if(2&_){const c=s.oxw(4);s.xp6(1),s.Q6J("ngStyle",s.VKq(26,Gn,c.isBackEnd?"15px":"0px")),s.xp6(2),s.hij("",s.lcZ(4,16,"lang_auto_diem_cuoi"),": "),s.xp6(2),s.Q6J("ngIf",2!=(null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.examObj?null:c.initDataResult.data.examObj.whenShowResult)),s.xp6(1),s.Q6J("ngIf",2==(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(4),s.hij(" ",s.lcZ(11,18,"lang_auto_thong_tin_chi_tiet")," "),s.xp6(3),s.Q6J("ngIf",c.multipleChoiceList.length>0&&2!=(null==c.examConfig?null:c.examConfig.whenShowResult)&&c.examResultObj&&c.examResultObj.totalQuestion),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0&&2!=(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(1),s.Q6J("ngIf",c.countEssayQuestion>0),s.xp6(1),s.Q6J("ngIf",c.multipleChoiceList.length>0&&2==(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0&&2==(null==c.examConfig?null:c.examConfig.whenShowResult)),s.xp6(1),s.Q6J("ngIf",c.examTracks&&0!=(null==c.examObj?null:c.examObj.autoMonitor)),s.xp6(2),s.hij("",s.lcZ(21,20,"lang_auto_lich_su_sua_de"),": "),s.xp6(2),s.s9C("matTooltip",s.lcZ(23,22,"lang_auto_lich_su_sua_de")),s.xp6(4),s.Q6J("cdkCopyToClipboard",c.copyLinkToClipboard()),s.xp6(1),s.Oqu(s.lcZ(28,24,"lang_auto_copy_link_gui_giao_vien")),s.xp6(2),s.Q6J("ngIf",c.offlineMarkObj)}}function Ps(_,A){if(1&_&&s._UZ(0,"azt-basic-info-box",23),2&_){const c=s.oxw(5);s.Q6J("studentObj",c.studentObj)}}function Da(_,A){1&_&&(s.TgZ(0,"div")(1,"div",24),s._uU(2),s.ALo(3,"mytranslate"),s.qZA()()),2&_&&(s.xp6(2),s.Oqu(s.lcZ(3,1,"lang_auto_thi_sinh_chua_thi_lan_nao")))}function Ra(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",57),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.clickExportPdf())}),s.ALo(1,"mytranslate"),s._uU(2,"file_download"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_tai_bai_lam_duoi_dang_pdf"))}function Zi(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",41),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(7);return s.KtG(f.clickResultTrack())}),s.ALo(1,"mytranslate"),s._uU(2,"view_timeline"),s.qZA()}2&_&&s.s9C("matTooltip",s.lcZ(1,1,"lang_auto_xem_chi_tiet_qua_trinh_lam_bai_trac_nghiem"))}function ji(_,A){if(1&_&&(s.TgZ(0,"li",37),s._uU(1),s.ALo(2,"mytranslate"),s.YNc(3,Zi,3,3,"mat-icon",39),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.HOy(" ",s.lcZ(2,5,"lang_auto_trac_nghiem"),": ",c.examResultObj.trueFalseMark," (",c.examResultObj.rightAnswer,"/",c.examResultObj.totalQuestion-c.countEssayQuestion,") "),s.xp6(2),s.Q6J("ngIf",c.checkHasType1Question)}}function La(_,A){if(1&_&&(s.TgZ(0,"span"),s._UZ(1,"azt-create-avatar",116),s.qZA()),2&_){const c=s.oxw(7);s.xp6(1),s.Q6J("linkAvatar",null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.markedByObj?null:c.initDataResult.data.markedByObj.avatar)("nameCreateAvatar",null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.markedByObj?null:c.initDataResult.data.markedByObj.fullName)("size",25)}}function ko(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.YNc(4,La,2,3,"span",3),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.HOy(" ",s.lcZ(2,5,"lang_auto_tu_luan"),": ",null!=c.examResultObj&&c.examResultObj.confirmedAt?null==c.examResultObj?null:c.examResultObj.essayMark:"Ch\u01b0a ch\u1ea5m"," (",c.countEssayQuestion," ",s.lcZ(3,7,"lang_auto_cau_brackets")," "),s.xp6(3),s.Q6J("ngIf",null==c.examResultObj?null:c.examResultObj.confirmedAt)}}function Na(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.AsE("",s.lcZ(2,2,"lang_auto_so_file_da_nop"),": ",c.files.length,"")}}function Pa(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.TgZ(3,"mat-icon",33),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.openResultHistoryReview())}),s.ALo(4,"mytranslate"),s._uU(5,"history"),s.qZA()()}2&_&&(s.xp6(1),s.hij("",s.lcZ(2,2,"lang_auto_phuc_khao"),": "),s.xp6(2),s.s9C("matTooltip",s.lcZ(4,4,"lang_auto_phuc_khao")))}function qa(_,A){if(1&_&&(s.TgZ(0,"li"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA(),s.TgZ(3,"li"),s._uU(4),s.ALo(5,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.AsE("",s.lcZ(2,4,"lang_auto_so_lan_thoat_man_hinh"),": ",c.examTracks.exitFullScreen,""),s.xp6(3),s.AsE("",s.lcZ(5,6,"lang_auto_so_lan_thoat_trinh_duyet"),": ",c.examTracks.blurWindow,"")}}function Za(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"a",114),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(8);return s.KtG(f.onShowFile(f.fileScanUrl))}),s._UZ(1,"img",115),s.qZA()}if(2&_){const c=s.oxw(8);s.xp6(1),s.Q6J("src",c.fileScanUrl,s.LSH)}}function Fi(_,A){1&_&&(s.TgZ(0,"span"),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.hij(" ",s.lcZ(2,1,"lang_auto_luu_trong_app_mobile")," "))}function dn(_,A){if(1&_&&(s.TgZ(0,"li")(1,"span"),s._uU(2),s.ALo(3,"mytranslate"),s.qZA(),s.YNc(4,Za,2,1,"a",113),s.YNc(5,Fi,3,3,"span",3),s.qZA()),2&_){const c=s.oxw(7);s.xp6(2),s.hij("",s.lcZ(3,3,"lang_auto_anh_cham"),": "),s.xp6(2),s.Q6J("ngIf",c.checkHttpLinkImg),s.xp6(1),s.Q6J("ngIf",!c.checkHttpLinkImg)}}function Mo(_,A){if(1&_&&(s.TgZ(0,"div",43)(1,"div",30)(2,"span"),s._uU(3,"Thi Offline"),s.qZA()(),s.TgZ(4,"ul")(5,"li"),s._uU(6),s.ALo(7,"mytranslate"),s.ALo(8,"formatOfflineExamHashIdToNumber"),s.qZA(),s.TgZ(9,"li"),s._uU(10),s.ALo(11,"mytranslate"),s.ALo(12,"formatStudentCodeToNumber"),s.qZA(),s.YNc(13,dn,6,5,"li",3),s.qZA()()),2&_){const c=s.oxw(6);let g,f;s.xp6(6),s.AsE("",s.lcZ(7,5,"lang_auto_ma_de_thi"),": ",s.xi3(8,7,null!==(g=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMixquestionObj?null:c.initDataResult.data.offlineMixquestionObj.hashId)&&void 0!==g?g:0,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.offlineMixquestionHashidLength),""),s.xp6(4),s.AsE("",s.lcZ(11,10,"lang_auto_so_bao_danh"),": ",s.xi3(12,12,(null!==(f=null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode)&&void 0!==f?f:0)<0?0:null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCode,null==c.initDataResult||null==c.initDataResult.data||null==c.initDataResult.data.offlineMarkObj?null:c.initDataResult.data.offlineMarkObj.studentCodeLength),""),s.xp6(3),s.Q6J("ngIf",c.imgOfflineTest)}}function Do(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"li",64),s.NdJ("click",function(){const E=s.CHM(c).$implicit,S=s.oxw(7);return s.KtG(S.getAndProcessAnswers(E.id))}),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.TgZ(4,"div",65),s._uU(5),s.ALo(6,"date"),s.ALo(7,"date"),s.qZA(),s.TgZ(8,"div",65),s._uU(9),s.ALo(10,"mytranslate"),s.qZA()()}if(2&_){const c=A.$implicit,g=A.index,f=s.oxw(7);s.Q6J("ngClass",s.VKq(22,Ri,c.id===f.curResult))("ngStyle",s.VKq(24,le,g==f.examResultObjList.length-1?"none":"1px dashed #f1f1f1")),s.xp6(1),s.HOy(" ",s.lcZ(2,10,"lang_auto_lan")," ",f.examResultObjList.length-g," [",s.lcZ(3,12,"lang_auto_diem")," ",c.mark,"] "),s.xp6(4),s.AsE("",s.xi3(6,14,c.startedTest,"dd/MM/yyyy, HH:mm")," - ",s.xi3(7,17,c.createdAt,"HH:mm"),""),s.xp6(4),s.AsE("",s.lcZ(10,20,"lang_auto_thoi_gian_lam_bai"),": ",f.calculateTime(c.startedTest,c.createdAt),"")}}function Ro(_,A){if(1&_&&(s.TgZ(0,"div",43)(1,"div",30)(2,"span"),s._uU(3),s.ALo(4,"mytranslate"),s.qZA()(),s.TgZ(5,"ul"),s.YNc(6,Do,11,26,"ng-template",63),s.qZA()()),2&_){const c=s.oxw(6);s.xp6(3),s.Oqu(s.lcZ(4,2,"lang_auto_cac_lan_thi")),s.xp6(3),s.Q6J("ngForOf",c.examResultObjList)}}function ti(_,A){if(1&_&&(s.TgZ(0,"div",26)(1,"span"),s._uU(2),s.ALo(3,"mytranslate"),s.qZA(),s.TgZ(4,"span",36),s._uU(5),s.qZA()(),s.TgZ(6,"div",29)(7,"div",54)(8,"span"),s._uU(9),s.ALo(10,"mytranslate"),s.qZA(),s.YNc(11,Ra,3,3,"mat-icon",55),s.qZA(),s.TgZ(12,"ul"),s.YNc(13,ji,4,7,"li",31),s.YNc(14,ko,5,9,"li",3),s.YNc(15,Na,3,4,"li",3),s.YNc(16,Pa,6,6,"li",3),s.YNc(17,qa,6,8,"ng-template",32),s.qZA()(),s.YNc(18,Mo,14,15,"div",35),s.YNc(19,Ro,7,4,"div",35)),2&_){const c=s.oxw(5);s.Q6J("ngStyle",s.VKq(16,Gn,c.isBackEnd?"15px":"0px")),s.xp6(2),s.hij("",s.lcZ(3,12,"lang_auto_diem_cuoi"),": "),s.xp6(3),s.Oqu(null==c.examResultObj?null:c.examResultObj.mark),s.xp6(4),s.Oqu(s.lcZ(10,14,"lang_auto_thong_tin_chi_tiet")),s.xp6(2),s.Q6J("ngIf",c.isBackEnd),s.xp6(2),s.Q6J("ngIf",c.multipleChoiceList.length>0&&c.examResultObj&&c.examResultObj.totalQuestion),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0),s.xp6(1),s.Q6J("ngIf",c.countEssayQuestion>0),s.xp6(1),s.Q6J("ngIf",c.checkShowIconHistory()),s.xp6(1),s.Q6J("ngIf",c.examTracks&&0!=(null==c.examObj?null:c.examObj.autoMonitor)),s.xp6(1),s.Q6J("ngIf",c.offlineMarkObj),s.xp6(1),s.Q6J("ngIf",c.isBackEnd&&c.examResultObjList)}}function ja(_,A){if(1&_&&(s.TgZ(0,"div",112)(1,"div",12),s.YNc(2,Ps,1,1,"azt-basic-info-box",13),s.qZA(),s.YNc(3,Da,4,3,"div",14),s.YNc(4,ti,20,18,"ng-template",null,15,s.W1O),s.qZA()),2&_){const c=s.MAs(5),g=s.oxw(4);s.xp6(2),s.Q6J("ngIf",g.isBackEnd),s.xp6(1),s.Q6J("ngIf",0===(null==g.initDataResult||null==g.initDataResult.data||null==g.initDataResult.data.historyExamResultObjs?null:g.initDataResult.data.historyExamResultObjs.length))("ngIfElse",c)}}function Fa(_,A){1&_&&(s.TgZ(0,"div",67),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_thi_sinh_chua_lam_bai_thi")))}function Lo(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",68),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(4);return s.KtG(f.handleNavigate("next"))}),s._uU(1,"navigate_next"),s.qZA()}}function Ua(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",69),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(4);return s.KtG(f.handleNavigate("prev"))}),s._uU(1,"navigate_before"),s.qZA()}}function No(_,A){if(1&_&&(s.TgZ(0,"div",84)(1,"button",85)(2,"span",86),s._uU(3),s.qZA(),s.TgZ(4,"mat-icon",87),s._uU(5,"filter_alt"),s.qZA()()()),2&_){s.oxw();const c=s.MAs(4),g=s.oxw(5);s.xp6(1),s.Q6J("matMenuTriggerFor",c),s.xp6(2),s.Oqu("viewRight"==g.viewOption?"C\xe2u \u0111\xfang":"viewWrong"==g.viewOption?"C\xe2u sai":"B\u1ed9 l\u1ecdc")}}function Po(_,A){1&_&&(s.TgZ(0,"mat-icon",88),s._uU(1,"clear"),s.qZA())}function jr(_,A){1&_&&(s.TgZ(0,"mat-icon",88),s._uU(1,"clear"),s.qZA())}function Fr(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",120),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.showButtonComment(!0))}),s._uU(1,"speaker_notes_off"),s.qZA()}}function qo(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-icon",121),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(6);return s.KtG(f.showButtonComment(!1))}),s._uU(1,"speaker_notes"),s.qZA()}}function Zo(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",75)(1,"div",76),s.YNc(2,No,6,2,"div",77),s.TgZ(3,"mat-menu",78,79)(5,"div",80),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(5);return s.KtG(f.onChangeViewOption("viewRight"))}),s._uU(6),s.ALo(7,"mytranslate"),s.YNc(8,Po,2,0,"mat-icon",81),s.qZA(),s.TgZ(9,"div",82),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(5);return s.KtG(f.onChangeViewOption("viewWrong"))}),s._uU(10),s.ALo(11,"mytranslate"),s.YNc(12,jr,2,0,"mat-icon",81),s.qZA()(),s.YNc(13,Fr,2,0,"mat-icon",118),s.YNc(14,qo,2,0,"mat-icon",119),s.qZA()()}if(2&_){const c=s.oxw(5);s.xp6(2),s.Q6J("ngIf",!c.notShowAnswerYet),s.xp6(3),s.Q6J("ngStyle","viewRight"==c.viewOption?s.DdM(13,Ge):s.DdM(14,$e)),s.xp6(1),s.hij(" ",s.lcZ(7,9,"lang_auto_cau_dung")," "),s.xp6(2),s.Q6J("ngIf","viewRight"==c.viewOption),s.xp6(1),s.Q6J("ngStyle","viewWrong"==c.viewOption?s.DdM(15,Ge):s.DdM(16,$e)),s.xp6(1),s.hij(" ",s.lcZ(11,11,"lang_auto_cau_sai")," "),s.xp6(2),s.Q6J("ngIf","viewWrong"==c.viewOption),s.xp6(1),s.Q6J("ngIf",!c.isBackEnd&&0==c.showButtonCommentToteacher),s.xp6(1),s.Q6J("ngIf",!c.isBackEnd&&1==c.showButtonCommentToteacher)}}function Ur(_,A){if(1&_&&s._UZ(0,"azt-loaded-img",94),2&_){const c=s.oxw(6);s.Q6J("imgSrc",null==c.examObj?null:c.examObj.examHeader)}}function Qa(_,A){if(1&_&&(s.TgZ(0,"div",95),s._uU(1),s.ALo(2,"mytranslate"),s.ALo(3,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.lnq("",s.lcZ(2,3,"lang_auto_danh_sach_cau")," ","viewRight"==c.viewOption?"\u0111\xfang":"sai"," ",s.lcZ(3,5,"lang_auto_trong"),"")}}function Ba(_,A){if(1&_&&(s.TgZ(0,"div",95),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_){const c=s.oxw(6);s.xp6(1),s.lnq("",s.lcZ(2,3,"lang_auto_tong_so_cau")," ","viewRight"==c.viewOption?"\u0111\xfang":"sai"," ",c.totalQuestionRight(),".")}}function za(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"azt-standalone-question",122),s.NdJ("statusResult",function(f){const S=s.CHM(c).$implicit,F=s.oxw(6);return s.KtG(F.setClassStatusResult(f,S))}),s.ALo(1,"isEssayAnswer"),s.qZA()}if(2&_){const c=A.$implicit,g=A.index,f=s.oxw(6);s.Q6J("ngStyle",s.lcZ(1,17,c.answerType)&&"viewAll"!=f.viewOption?s.DdM(19,b):null)("ngClass",s.WLB(20,I,null==c?null:c.isStatusResult,!c.isStatusResult))("userAnswersObj",f.userAnswersObj)("question",c)("index",g)("userAnswersObj",0!=f.examResultObjList.length?f.userAnswersObj:s.DdM(23,$e))("configExam",f.examConfig)("isRoleTeacher",f.isBackEnd)("index",g)("examObjPermission",f.examObj)("notShowAnswerYet",f.notShowAnswerYet)("isBackEnd",f.isBackEnd)("cur_result",f.curResult)("newFirstInGroupIndexes",f.newFirstInGroupIndexes)("showButtonCommentToteacher",f.showButtonCommentToteacher)("allowAskQuestion",f.allowAskQuestion)("displayScreen",f.displayScreen)}}function qs(_,A){if(1&_&&(s.TgZ(0,"mat-tab",90),s.ALo(1,"mytranslate"),s.TgZ(2,"div",91),s.YNc(3,Ur,1,1,"azt-loaded-img",92),s.YNc(4,Qa,4,7,"div",93),s.YNc(5,Ba,3,5,"div",93),s.YNc(6,za,2,24,"ng-template",63),s.qZA()()),2&_){const c=s.oxw(5);s.s9C("label",s.lcZ(1,8,"lang_auto_trac_nghiem")),s.xp6(2),s.Tol(c.viewOption),s.xp6(1),s.Q6J("ngIf",null==c.examObj?null:c.examObj.examHeader),s.xp6(1),s.Q6J("ngIf",0==c.totalQuestionRight()&&"viewAll"!=c.viewOption),s.xp6(1),s.Q6J("ngIf",0!=c.totalQuestionRight()&&"viewAll"!=c.viewOption),s.xp6(1),s.Q6J("ngForOf",c.questionList)}}function Ui(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",101)(1,"azt-mark-essay",123),s.NdJ("saveResultEvent",function(f){s.CHM(c);const E=s.oxw(6);return s.KtG(E.saveResultEvent(f))}),s.qZA()()}if(2&_){const c=s.oxw(6);let g;s.xp6(1),s.Q6J("displayScreen",c.displayScreen)("resultID",null!==(g=c.curResult)&&void 0!==g?g:0)("files",c.files)("questions",c.essayQuestionList)("userAnswersObj",c.userAnswersObj)("iframeSrc",c.iframeSrc)("notShowAnswerYet",c.notShowAnswerYet)("examQuestionObjs",c.examQuestionObjs)("examResultObj",c.examResultObj)("configExam",c.examConfig)("isBackEnd",c.isBackEnd)("examObj",c.examObj)("hasLoadedData",c.hasLoadedData)}}function Zs(_,A){1&_&&(s.TgZ(0,"p",103),s._uU(1),s.ALo(2,"mytranslate"),s.qZA()),2&_&&(s.xp6(1),s.Oqu(s.lcZ(2,1,"lang_auto_khong_co_cau_tu_luan")))}function Qr(_,A){if(1&_&&(s.TgZ(0,"mat-tab",97),s.ALo(1,"mytranslate"),s.YNc(2,Ui,2,13,"div",98),s.YNc(3,Zs,3,3,"ng-template",99,100,s.W1O),s.qZA()),2&_){const c=s.MAs(4),g=s.oxw(5);s.s9C("label",s.lcZ(1,3,"lang_auto_tu_luan")),s.xp6(2),s.Q6J("ngIf",g.essayQuestionList.length>0)("ngIfElse",c)}}function jo(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div",70),s.YNc(1,Zo,15,17,"div",71),s.TgZ(2,"mat-tab-group",117),s.NdJ("selectedTabChange",function(f){s.CHM(c);const E=s.oxw(4);return s.KtG(E.onTabChanged(f))}),s.YNc(3,qs,7,10,"mat-tab",73),s.YNc(4,Qr,5,5,"mat-tab",74),s.qZA()()}if(2&_){const c=s.oxw(4);s.xp6(1),s.Q6J("ngIf",(null==c.examResultObjList?null:c.examResultObjList.length)&&0==c.matTabGroupIndex),s.xp6(2),s.Q6J("ngIf",c.multipleChoiceList.length>0),s.xp6(1),s.Q6J("ngIf",c.essayQuestionList.length>0)}}const Qi=function(_){return{"w-70":_}};function Bi(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"mat-drawer-container",104)(1,"mat-drawer",105,106),s.YNc(3,Ft,30,28,"div",107),s.YNc(4,ja,6,3,"div",107),s.qZA(),s.TgZ(5,"mat-drawer-content")(6,"div",108)(7,"a",109),s.NdJ("click",function(){s.CHM(c);const f=s.oxw(3);return s.KtG(f.openDrawer())}),s.ALo(8,"mytranslate"),s.TgZ(9,"mat-icon",110),s._uU(10,"menu_open"),s.qZA()(),s.TgZ(11,"span"),s._uU(12),s.qZA(),s.TgZ(13,"span"),s._uU(14),s.ALo(15,"mytranslate"),s.qZA()(),s.TgZ(16,"div",111)(17,"div",18),s.YNc(18,Fa,3,3,"div",19),s.YNc(19,Lo,2,0,"mat-icon",20),s.YNc(20,Ua,2,0,"mat-icon",21),s.YNc(21,jo,5,3,"ng-template",null,22,s.W1O),s.qZA()()()()}if(2&_){const c=s.MAs(22),g=s.oxw(3);s.Q6J("hasBackdrop",g.hasBackdrop),s.xp6(1),s.s9C("opened",g.isOpenSideNav?"true":"false"),s.Q6J("mode",g.mode)("ngClass",s.VKq(18,Qi,g.isMobile)),s.xp6(2),s.Q6J("ngIf",!g.isBackEnd),s.xp6(1),s.Q6J("ngIf",g.isBackEnd),s.xp6(3),s.s9C("matTooltip",s.lcZ(8,14,"lang_auto_mo_menu")),s.xp6(5),s.Oqu(null==g.studentObj?null:g.studentObj.fullName),s.xp6(2),s.AsE("",s.lcZ(15,16,"lang_auto_diem_cuoi"),": ",null==g.examResultObj?null:g.examResultObj.mark,""),s.xp6(4),s.Q6J("ngIf",!(null!=g.examResultObjList&&g.examResultObjList.length))("ngIfElse",c),s.xp6(1),s.Q6J("ngIf",g.hasNext()),s.xp6(1),s.Q6J("ngIf",g.hasPrev())}}function Va(_,A){if(1&_&&(s.TgZ(0,"div",6),s.YNc(1,tn,16,8,"div",7),s.YNc(2,Bi,23,20,"mat-drawer-container",8),s.qZA()),2&_){const c=s.oxw(2);s.xp6(1),s.Q6J("ngIf",!c.isMobile),s.xp6(1),s.Q6J("ngIf",c.isMobile)}}function Xt(_,A){if(1&_&&(s._UZ(0,"div",4),s.YNc(1,Va,3,2,"div",5)),2&_){const c=s.oxw();s.xp6(1),s.Q6J("ngIf",!c.errorLoadMixedAssets)}}function Fo(_,A){if(1&_&&s._UZ(0,"azt-loading-effect",124),2&_){const c=s.oxw();s.Q6J("customText","\u0110ang t\u1ea3i d\u1eef li\u1ec7u \u0111\u1ec1 thi: "+c.loadMixedExamProgress+"%")}}function Ja(_,A){1&_&&(s.TgZ(0,"div",125)(1,"mat-icon",126),s._uU(2,"error"),s.qZA(),s._uU(3),s.ALo(4,"mytranslate"),s.qZA()),2&_&&(s.xp6(3),s.hij(" ",s.lcZ(4,1,"lang_auto_co_loi_khi_tai_du_lieu_de_thi_hay_thu_lai_bang_cach_tai_lai_trang_web"),""))}function Ga(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div")(1,"azt-preview-media",127),s.NdJ("closePreview",function(){s.CHM(c);const f=s.oxw();return s.KtG(f.onFileClose())}),s.qZA()()}if(2&_){const c=s.oxw();s.xp6(1),s.Q6J("linkUrl",c.previewFile)("typePreview",1)("fileNameCustom","D\u1eef li\u1ec7u ch\u1ea5m b\xe0i")}}function Ka(_,A){if(1&_){const c=s.EpF();s.TgZ(0,"div")(1,"app-log-edit-exam",128),s.NdJ("closeDialog",function(f){s.CHM(c);const E=s.oxw();return s.KtG(E.closeDialogEditExam(f))}),s.qZA()()}if(2&_){const c=s.oxw();s.xp6(1),s.Q6J("data",c.dataLogEditExam)}}let Ya=(()=>{class _ extends et.Q{constructor(c,g,f,E,S,F,at,lt,bt,Lt,wt,Nt,kt,St,Ot,ce,Pe,Ke){super(g),this.iCustomQuestionAnswerConfig=c,this.commonService=g,this.localize=f,this.activeRoute=E,this.store=S,this.mixService=F,this.mixService2=at,this.cdnService=lt,this.docxService=bt,this.timeService=Lt,this.homeworkExamService=wt,this.customQuestionInterface=Nt,this.envService=kt,this.drawScanExamService=St,this.examResultService=Ot,this.zipdataService=ce,this.answerTypeService=Pe,this.answerBoxService=Ke,this.isBackEnd=!0,this.displayScreen=3,this.curResultId=0,this.curExamId=0,this.curUserId="",this.curStudentId=0,this.openResultHistory=new s.vpe,this.curSelectedTab=0,this.curResult=0,this.drawer=void 0,this.isOpenSideNav=!1,this.hasBackdrop=!1,this.mode="over",this.isMobile=!1,this.backToLink="",this.viewOption="viewAll",this.examResultObjList=[],this.essayQuestionList=[],this.multipleChoiceList=[],this.userAnswersObj={},this.files=[],this.correctQuestionIds=[],this.fileScanUrl="",this.checkHttpLinkImg=!1,this.iframeSrc="",this.hasLoadedData=!1,this.isMixedService_2=!1,this.doneLoadMixedExamAssets=!1,this.errorLoadMixedAssets=!1,this.showButtonCommentToteacher=!0,this.notShowAnswerYet=!1,this.countLoadedMixedAssets=0,this.totalMixedExamAssets=0,this.countEssayQuestion=0,this.matTabGroupIndex=0,this.allowAskQuestion=0,this.isShowPreviewFile=!1,this.dataLogEditExam={isShow:!1}}get loadMixedExamProgress(){return Math.round(this.countLoadedMixedAssets/this.totalMixedExamAssets*100)}get checkHasType1Question(){var c,g,f;let E=!1;for(let S=0;S<(null!==(g=null===(c=this.questionList)||void 0===c?void 0:c.length)&&void 0!==g?g:0);S++)if(this.answerTypeService.isOneChoiceAnswer(null===(f=this.questionList)||void 0===f?void 0:f[S].answerType)){E=!0;break}return E}checkHttpUrl(c){return!!c&&!!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(c)}calculateTime(c,g){return this.timeService.calculationTestedTime(c,g)}essayQuestionCounter(c){var g=0;return null==c||c.forEach(f=>{this.answerTypeService.isEssayAnswer(f.answerType)&&g++}),g}openDrawer(){var c;null===(c=this.drawer)||void 0===c||c.open(),this.isOpenSideNav=!0}closeDrawer(){var c;null===(c=this.drawer)||void 0===c||c.close(),this.isOpenSideNav=!1}processConvertData(c){var g,f,E,S,F,at,lt,bt;if(c.data){this.examQuestionObjs=c.data.examQuestionObjs,this.examResultObj=c.data.examResultObj,this.examResultTrack=c.data.resultTracks,this.examConfig=c.data.examObj,c.data.correctQuestionIds&&(this.correctQuestionIds=c.data.correctQuestionIds),this.questionList=this.commonService.castJsonToClassObjs(C.v,JSON.stringify(null!==(g=c.data.questionObjs)&&void 0!==g?g:[])),null===(f=this.questionList)||void 0===f||f.forEach(wt=>{wt.correctAnswer=this.commonService.filterArray(this.correctQuestionIds,wt.id),wt.isRoleTeacher=this.isBackEnd}),this.countEssayQuestion=this.essayQuestionCounter(null!==(E=this.questionList)&&void 0!==E?E:[]),this.docxService.replaceCanvasBackgroundTS(null!==(S=this.questionList)&&void 0!==S?S:[]),this.checkEssay(),this.checkMultipleChoice();let Lt=this.castJsonToObj(null!==(at=null===(F=c.data.examResultObj)||void 0===F?void 0:F.answers)&&void 0!==at?at:"");this.convertAnswersArr(null!=Lt?Lt:[]),this.processUserFiles(null!==(bt=null===(lt=c.data.examResultObj)||void 0===lt?void 0:lt.files)&&void 0!==bt?bt:""),this.hasLoadedData=!0}}processUserFiles(c){var g;this.files=null!==(g=this.commonService.myParseJson(c))&&void 0!==g?g:[]}convertAnswersArr(c){0!=c.length&&c.forEach(g=>{var f;this.userAnswersObj[`id_${g.QuestionId}`]=null===(f=null==g?void 0:g.AnswerContent)||void 0===f?void 0:f[0].Content})}getAndProcessAnswers(c){let g=this.activeRoute.snapshot.paramMap.get("user_id"),f=this.activeRoute.snapshot.paramMap.get("student_id"),E=this.activeRoute.snapshot.paramMap.get("exam_id");var S=this.commonService.getLocalRouter("/admin/testbank/test-review/"+E+"/"+g+"/"+f+"/"+c)+"?backto="+encodeURIComponent(this.backToLink);window.location.href=S.toString()}checkEssay(){var c,g,f,E;for(let S=0;S<(null!==(g=null===(c=this.questionList)||void 0===c?void 0:c.length)&&void 0!==g?g:0);S++)this.answerTypeService.isEssayAnswer(null===(f=this.questionList)||void 0===f?void 0:f[S].answerType)&&null!==(E=this.questionList)&&void 0!==E&&E[S]&&(this.questionList[S].indexLabel=S,this.essayQuestionList.push(this.questionList[S]))}checkMultipleChoice(){var c,g,f,E,S;for(let F=0;F<(null!==(g=null===(c=this.questionList)||void 0===c?void 0:c.length)&&void 0!==g?g:0);F++)(this.answerTypeService.isOneChoiceAnswer(null===(f=this.questionList)||void 0===f?void 0:f[F].answerType)||this.answerTypeService.isFillAnswer(null===(E=this.questionList)||void 0===E?void 0:E[F].answerType))&&null!==(S=this.questionList)&&void 0!==S&&S[F]&&(this.questionList[F].indexLabel=F,this.multipleChoiceList.push(this.questionList[F]))}mapStudentObjWithTestedObj(){var c,g,f,E=null===(c=this.testedUserObjs)||void 0===c?void 0:c.filter(S=>{var F;return S.userId==(null===(F=this.studentObj)||void 0===F?void 0:F.parentId)});E&&E.length>0&&(this.studentObj=Object.assign(Object.assign({},this.studentObj),{offlineMarkObj:null!==(g=E[0].offlineMarkObj)&&void 0!==g?g:{},nameImage:null!==(f=E[0].nameImage)&&void 0!==f?f:""}))}totalQuestionRight(){var c,g,f,E,S,F=[];for(let at=0;at<(null!==(g=null===(c=this.questionList)||void 0===c?void 0:c.length)&&void 0!==g?g:0);at++)this.answerTypeService.isEssayAnswer(null===(f=this.questionList)||void 0===f?void 0:f[at].answerType)||(1==(null===(E=this.questionList)||void 0===E?void 0:E[at].isStatusResult)&&"viewRight"==this.viewOption||0==(null===(S=this.questionList)||void 0===S?void 0:S[at].isStatusResult)&&"viewWrong"==this.viewOption)&&F.push(this.questionList[at].id);return F.length}showButtonComment(c){this.showButtonCommentToteacher=c}setClassStatusResult(c,g){(0,o.H)(100).subscribe(()=>g.isStatusResult=c)}onChangeViewOption(c){this.viewOption=this.viewOption==c?"viewAll":c}onTabChanged(c){this.matTabGroupIndex=c.index}saveResultEvent(c){var g,f;if(c){let E=Number(this.activeRoute.snapshot.paramMap.get("exam_id")),S=null!==(g=this.activeRoute.snapshot.paramMap.get("user_id"))&&void 0!==g?g:"",F=null!==(f=this.activeRoute.snapshot.paramMap.get("student_id"))&&void 0!==f?f:"",at=Number(this.activeRoute.snapshot.paramMap.get("result_id"));this.examResultService.apiExamResultGetLastExamResultByIdGet(E,S,F,at).subscribe(lt=>{var bt,Lt,wt,Nt,kt,St,Ot,ce;1==lt.success?(this.examResultObj=null===(bt=null==lt?void 0:lt.data)||void 0===bt?void 0:bt.examResultObj,null!==(wt=null===(Lt=this.initDataResult)||void 0===Lt?void 0:Lt.data)&&void 0!==wt&&wt.markedByObj&&(this.initDataResult.data.markedByObj.fullName=null===(kt=null===(Nt=lt.data)||void 0===Nt?void 0:Nt.markedByObj)||void 0===kt?void 0:kt.fullName,this.initDataResult.data.markedByObj.avatar=null===(Ot=null===(St=lt.data)||void 0===St?void 0:St.markedByObj)||void 0===Ot?void 0:Ot.avatar)):this.errorStatusObj(null!==(ce=lt.message)&&void 0!==ce?ce:"",!0)})}}checkShowIconHistory(){var c,g,f,E;let S=!1;return this.examResultObjList&&this.examResultObjList.length>0&&(S=!0),this.homeworkExamService.isOnlyTrueFalse(null!==(g=null===(c=this.examObj)||void 0===c?void 0:c.examType)&&void 0!==g?g:0)?!(!S||!this.homeworkExamService.checkEmptyAnswerExamAll(this.examResultData)):!(!S||""!=(null===(f=this.examResultData)||void 0===f?void 0:f.files)&&null!=(null===(E=this.examResultData)||void 0===E?void 0:E.files)&&!this.homeworkExamService.checkEmptyAnswerExamAll(this.examResultData))}openResultHistoryReview(){this.openResultHistory.emit({examObj:this.examObj,resultObj:this.examResultData,studentObj:this.studentObj})}openLogEditExam(){this.dataLogEditExam={isShow:!0,obj:this.questionList}}closeDialogEditExam(c){this.dataLogEditExam.isShow=c}copyLinkToClipboard(){var c,g,f,E,S;let F=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),at=null!=(null===(c=this.studentObj)||void 0===c?void 0:c.id)?this.studentObj.id:null===(g=this.examResultObj)||void 0===g?void 0:g.userId;return`${F}/en/admin/testbank/test-review/${null===(f=this.examObj)||void 0===f?void 0:f.id}/${null===(E=this.examResultObj)||void 0===E?void 0:E.userId}/${at}/${null===(S=this.examResultObj)||void 0===S?void 0:S.id}`}showCopySuccess(){this.showSuccessSnack("lang_auto_sao_chep_thanh_cong")}hasNext(){let c=this.activeRoute.snapshot.paramMap.get("user_id"),g=Number(this.activeRoute.snapshot.paramMap.get("student_id"));var f=-1;if(this.testedUserObjs){for(var E=0;E<this.testedUserObjs.length;E++)if(this.testedUserObjs[E].userId==c&&this.testedUserObjs[E].studentId==g){f=E;break}return f<this.testedUserObjs.length-1}return!1}hasPrev(){let c=this.activeRoute.snapshot.paramMap.get("user_id"),g=Number(this.activeRoute.snapshot.paramMap.get("student_id"));var f=-1;if(this.testedUserObjs){for(var E=0;E<this.testedUserObjs.length;E++)if(this.testedUserObjs[E].userId==c&&this.testedUserObjs[E].studentId==g){f=E;break}return f>0}return!1}handleNavigate(c){var g,f,E,S,F,at;let lt=this.activeRoute.snapshot.paramMap.get("user_id"),bt=Number(this.activeRoute.snapshot.paramMap.get("student_id")),Lt=Number(this.activeRoute.snapshot.paramMap.get("exam_id"));var wt=-1;if(this.testedUserObjs){for(var Nt=0;Nt<this.testedUserObjs.length;Nt++)if(this.testedUserObjs[Nt].userId==lt&&this.testedUserObjs[Nt].studentId==bt){wt=Nt;break}if("next"==c){if(wt>=0&&wt<=this.testedUserObjs.length-2){var kt=null===(g=this.testedUserObjs[wt+1].userId)||void 0===g?void 0:g.toString(),St=null===(f=this.testedUserObjs[wt+1].studentId)||void 0===f?void 0:f.toString(),Ot=null===(E=this.testedUserObjs[wt+1].resultId)||void 0===E?void 0:E.toString(),ce=this.commonService.getLocalRouter("/admin/testbank/test-review/"+Lt+"/"+kt+"/"+St+"/"+(null!=Ot?Ot:0))+"?backto="+encodeURIComponent(this.backToLink);window.location.href=ce.toString(),this.matTabGroupIndex=0}}else wt>0&&wt<=this.testedUserObjs.length-1&&(kt=null===(S=this.testedUserObjs[wt-1].userId)||void 0===S?void 0:S.toString(),St=null===(F=this.testedUserObjs[wt-1].studentId)||void 0===F?void 0:F.toString(),Ot=null===(at=this.testedUserObjs[wt-1].resultId)||void 0===at?void 0:at.toString(),ce=this.commonService.getLocalRouter("/admin/testbank/test-review/"+Lt+"/"+kt+"/"+St+"/"+(null!=Ot?Ot:0))+"?backto="+encodeURIComponent(this.backToLink),window.location.href=ce.toString(),this.matTabGroupIndex=0)}}redirectToTestedList(){let c=Number(this.activeRoute.snapshot.paramMap.get("exam_id"));this.commonService.myNavigation("/admin/testbank/tested-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+c+"/0")}clickExportPdf(){var c;let g=this.activeRoute.snapshot.paramMap.get("user_id"),f=this.activeRoute.snapshot.paramMap.get("student_id"),E=this.activeRoute.snapshot.paramMap.get("exam_id");if(this.essayQuestionList.length>0&&(null===(c=this.examResultObj)||void 0===c||!c.confirmedAt))this.showErrorSnack("lang_auto_ban_chi_co_the_tai_file_pdf_khi_cham_xong_tu_luan");else{this.commonService.gaEvent("click_exp_pdf_in_test_review");const S=this.localize.translateRoute("/admin/testbank/export-pdf-by-user")+"/"+E+"/"+g+"/"+f+"/"+this.curResult;window.open(S,"_blank")}}clickResultTrack(){this.commonService.gaEvent("click_exp_pdf_in_test_review");let c=this.activeRoute.snapshot.paramMap.get("user_id"),g=this.activeRoute.snapshot.paramMap.get("student_id"),f=this.activeRoute.snapshot.paramMap.get("exam_id");const E=this.localize.translateRoute("/admin/testbank/test-result-tracking")+"/"+f+"/"+c+"/"+g+"/"+this.curResult;window.open(E,"_blank")}clickFrontResultTrack(){var c;const g=this.localize.translateRoute("/test/test-result-tracking")+"/"+this.curResult+"/"+(null===(c=this.examObj)||void 0===c?void 0:c.hashId);window.open(g,"_blank")}toggleQA(){this.store.dispatch(M._S())}continueQA(){var c,g;this.store.dispatch(M.QV({selectTest:{id:null===(c=this.examObj)||void 0===c?void 0:c.id,name:null===(g=this.examObj)||void 0===g?void 0:g.name},resultId:this.curResult})),this.commonService.myNavigation("/student-qa")}onFileClose(){this.isShowPreviewFile=!1,this.previewFile=void 0}onShowFile(c){this.isShowPreviewFile=!0,this.previewFile=c}InitData(){var c,g,f,E,S,F,at,lt,bt,Lt,wt,Nt,kt,St,Ot,ce,Pe,Ke,_n,nn,sn,mn,De,Mt,rn,Ie,Pt,gn,pn,Pn,on,ie,ei,fn;if(this.curResult=Number(this.activeRoute.snapshot.paramMap.get("result_id")),this.isBackEnd){if(this.studentObj=this.commonService.castJsonToObj(JSON.stringify(null===(g=null===(c=this.initDataResult)||void 0===c?void 0:c.data)||void 0===g?void 0:g.studentObj)),this.mapStudentObjWithTestedObj(),this.examResultObjList=null!==(S=null===(E=null===(f=this.initDataResult)||void 0===f?void 0:f.data)||void 0===E?void 0:E.historyExamResultObjs)&&void 0!==S?S:[],(null===(at=null===(F=this.initDataResult)||void 0===F?void 0:F.data)||void 0===at?void 0:at.historyExamResultObjs)&&this.initDataResult.data.historyExamResultObjs.length>0){this.curResult=0==this.curResult?this.initDataResult.data.historyExamResultObjs[0].id:this.curResult,this.examTracks=null===(bt=null===(lt=this.initDataResult)||void 0===lt?void 0:lt.data)||void 0===bt?void 0:bt.examTracks,this.examObj=null===(wt=null===(Lt=this.initDataResult)||void 0===Lt?void 0:Lt.data)||void 0===wt?void 0:wt.examObj,this.offlineMarkObj=null===(kt=null===(Nt=this.initDataResult)||void 0===Nt?void 0:Nt.data)||void 0===kt?void 0:kt.offlineMarkObj,this.examResultData=null===(Ot=null===(St=this.initDataResult)||void 0===St?void 0:St.data)||void 0===Ot?void 0:Ot.examResultObj;let Ee=this.zipdataService.decodeContentGzip(null!==(Pe=null===(ce=this.offlineMarkObj)||void 0===ce?void 0:ce.images)&&void 0!==Pe?Pe:"");this.imgOfflineTest=this.castJsonToObj(Ee),this.checkHttpLinkImg=this.checkHttpUrl(null===(Ke=this.imgOfflineTest)||void 0===Ke?void 0:Ke.url),this.drawScanExamService.drawScanFileToCanvas(null!==(_n=this.offlineMarkObj)&&void 0!==_n?_n:{}).then(Ye=>{Ye&&(this.fileScanUrl=Ye)}),this.processConvertData(null!==(nn=this.initDataResult)&&void 0!==nn?nn:{})}}else{this.examResultObjList=[{id:-1}],this.examObj=null===(mn=null===(sn=this.initDataResult)||void 0===sn?void 0:sn.data)||void 0===mn?void 0:mn.examObj,this.allowAskQuestion=null!==(rn=null===(Mt=null===(De=this.initDataResult)||void 0===De?void 0:De.data)||void 0===Mt?void 0:Mt.allowAskQuestion)&&void 0!==rn?rn:0,this.examResultData=null===(Pt=null===(Ie=this.initDataResult)||void 0===Ie?void 0:Ie.data)||void 0===Pt?void 0:Pt.examResultObj,this.offlineMarkObj=null===(pn=null===(gn=this.initDataResult)||void 0===gn?void 0:gn.data)||void 0===pn?void 0:pn.offlineMarkObj;let Ee=this.zipdataService.decodeContentGzip(null!==(on=null===(Pn=this.offlineMarkObj)||void 0===Pn?void 0:Pn.images)&&void 0!==on?on:"");this.imgOfflineTest=this.castJsonToObj(Ee),this.checkHttpLinkImg=this.checkHttpUrl(null===(ie=this.imgOfflineTest)||void 0===ie?void 0:ie.url),this.drawScanExamService.drawScanFileToCanvas(null!==(ei=this.offlineMarkObj)&&void 0!==ei?ei:{}).then(Ye=>{Ye&&(this.fileScanUrl=Ye)}),this.processConvertData(null!==(fn=this.initDataResult)&&void 0!==fn?fn:{})}}ngOnInit(){var c;this.subscriptions.add(this.store.subscribe(g=>{this.state=g})),this.iframeSrc=null!==(c=this.envService.getEnvValue("classliveUrl"))&&void 0!==c?c:"",this.commonService.checkMobile()?(this.mode="over",this.hasBackdrop=!0,this.isMobile=!0):(this.mode="side",this.hasBackdrop=!1,this.isMobile=!1),(0,J.aj)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([])=>{var g;this.backToLink=null!==(g=this.commonService.getMyQueryParam("backto"))&&void 0!==g?g:"",this.offlineHashId=this.commonService.getMyQueryParam("offline"),this.InitData()}),this.answerBoxService.switchEssayTabMessage.subscribe(g=>{g&&(this.curSelectedTab=1,setTimeout(()=>{window.scroll(0,0)},0))}),super.ngOnInit()}}return _.\u0275fac=function(c){return new(c||_)(s.Y36(Q.U),s.Y36(P.v),s.Y36(K.An),s.Y36(z.gz),s.Y36(R.yh),s.Y36(j.f),s.Y36(y.V),s.Y36(T.U),s.Y36(V.x),s.Y36(H.O),s.Y36(Z.j),s.Y36(Q.U),s.Y36(W.D),s.Y36(gt),s.Y36(Et.kS),s.Y36(Y.n),s.Y36(pt.T),s.Y36(Dt.g))},_.\u0275cmp=s.Xpm({type:_,selectors:[["azt-test-review"]],viewQuery:function(c,g){if(1&c&&s.Gf(ne,5),2&c){let f;s.iGM(f=s.CRH())&&(g.drawer=f.first)}},inputs:{isBackEnd:"isBackEnd",displayScreen:"displayScreen",initDataResult:"initDataResult",testedUserObjs:"testedUserObjs",curResultId:"curResultId",curExamId:"curExamId",curUserId:"curUserId",curStudentId:"curStudentId"},outputs:{openResultHistory:"openResultHistory"},features:[s.qOj],decls:6,vars:5,consts:[["myContent",""],[3,"customText",4,"ngIf","ngIfElse"],["class","p-5 m-5 text-center alert alert-danger",4,"ngIf"],[4,"ngIf"],["id","canvas_draw"],["id","test_review_container","class","container-fluid mt-2",4,"ngIf"],["id","test_review_container",1,"container-fluid","mt-2"],["id","tabRowExam","class","row","style","margin-bottom: 10px",4,"ngIf"],["class","tested_list_container","style","border-radius: 5px;",3,"hasBackdrop",4,"ngIf"],["id","tabRowExam",1,"row",2,"margin-bottom","10px"],["id","col_std_info",1,"col-md-4","col-lg-3"],["id","tester-info"],[2,"position","relative"],[3,"studentObj",4,"ngIf"],[4,"ngIf","ngIfElse"],["allReadyTested",""],["style","position: relative","id","short_cut_mobile","class","col-md-4 col-lg-3 mb-3",4,"ngIf"],["id","test_review_area",1,"col-md-8","col-lg-9"],["id","col_examContent_wrap"],["class","text-center",4,"ngIf","ngIfElse"],["class","clickable next_icon",3,"click",4,"ngIf"],["class","clickable prev_icon",3,"click",4,"ngIf"],["TestedUser",""],[3,"studentObj"],[1,"d-flex","justify-content-center","py-2"],["class","tested-times",4,"ngIf"],["id","fullPoint",3,"ngStyle"],[1,"mr-3"],["class","point",4,"ngIf"],[1,"tested-times"],[1,"label","d-flex","justify-content-between","align-items-center",2,"position","relative"],["class","d-flex justify-content-between align-items-center",4,"ngIf"],[3,"ngIf"],[2,"vertical-align","middle","margin-top","2px","color","#2e2e2e","cursor","pointer",3,"matTooltip","click"],["class","btn-copy",3,"cdkCopyToClipboard","click",4,"ngIf"],["class","tested-times","style","overflow: auto",4,"ngIf"],[1,"point"],[1,"d-flex","justify-content-between","align-items-center"],["class","ml-2",4,"ngIf"],["class","ml-1 clickable","style","color: #2e2e2e",3,"matTooltip","click",4,"ngIf"],[1,"ml-2"],[1,"ml-1","clickable",2,"color","#2e2e2e",3,"matTooltip","click"],[1,"btn-copy",3,"cdkCopyToClipboard","click"],[1,"tested-times",2,"overflow","auto"],[1,"mr-4"],[3,"matTooltip"],[1,"mr-2"],["style","color: #007bff;",3,"click",4,"ngIf"],[2,"color","#007bff",3,"click"],[2,"height","60px !important",3,"src"],["id","fullPoint",2,"position","relative",3,"ngStyle"],["mat-icon-button","","class","pos-menu-v2",3,"matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"label","d-flex","justify-content-between","align-items-center"],["class","clickable","style","color: #2e2e2e",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","",1,"pos-menu-v2",3,"matMenuTriggerFor"],[1,"clickable",2,"color","#2e2e2e",3,"matTooltip","click"],[2,"cursor","pointer",3,"matTooltip","nameCreateAvatar","size","linkAvatar"],["mat-button","",1,"btn","btn-times",3,"matMenuTriggerFor"],["yPosition","below"],["menuTimeTest","matMenu"],[1,"list-time"],["ngFor","",3,"ngForOf"],[1,"clickable",2,"padding-bottom","10px",3,"ngClass","ngStyle","click"],[2,"color","#666"],["id","short_cut_mobile",1,"col-md-4","col-lg-3","mb-3",2,"position","relative"],[1,"text-center"],[1,"clickable","next_icon",3,"click"],[1,"clickable","prev_icon",3,"click"],["id","mbTestContent"],["id","filterWrap",4,"ngIf"],[1,"test-review-tab",3,"selectedIndex","selectedTabChange","selectedIndexChange"],[3,"label",4,"ngIf"],["id","tabEssay","aria-labelledby","tabEssay",3,"label",4,"ngIf"],["id","filterWrap"],[1,"d-flex","justify-items-center",2,"height","48px","font-weight","500"],["class","button-show-filter p-2 m-auto clickable",4,"ngIf"],["xPosition","before"],["beforeMenu","matMenu"],[1,"button-show-success","p-2","m-auto","clickable",3,"ngStyle","click"],["style","font-size: 9px; height: auto; width: auto",4,"ngIf"],[1,"button-show-error","p-2","m-auto","clickable",3,"ngStyle","click"],["class","pl-2 pr-2 m-auto w-auto clickable",3,"matTooltip","click",4,"ngIf"],[1,"button-show-filter","p-2","m-auto","clickable"],["mat-button","",1,"menu-button-filter",3,"matMenuTriggerFor"],[2,"vertical-align","middle","color","#828282"],[2,"font-size","16px","height","16px"],[2,"font-size","9px","height","auto","width","auto"],[1,"pl-2","pr-2","m-auto","w-auto","clickable",3,"matTooltip","click"],[3,"label"],["id","multipleChoiceWrap"],["style","display: block","class","mb-1",3,"imgSrc",4,"ngIf"],["class","p-2 font-weight-bold",4,"ngIf"],[1,"mb-1",2,"display","block",3,"imgSrc"],[1,"p-2","font-weight-bold"],[3,"ngStyle","ngClass","userAnswersObj","question","index","configExam","isRoleTeacher","notShowAnswerYet","isBackEnd","cur_result","newFirstInGroupIndexes","showButtonCommentToteacher","allowAskQuestion","displayScreen","statusResult"],["id","tabEssay","aria-labelledby","tabEssay",3,"label"],["id","markEssay",4,"ngIf","ngIfElse"],["class","pt-2"],["notHaveEssay",""],["id","markEssay"],[3,"displayScreen","resultID","files","questions","userAnswersObj","iframeSrc","notShowAnswerYet","examQuestionObjs","examResultObj","configExam","isBackEnd","examObj","hasLoadedData","saveResultEvent"],[1,"p-3"],[1,"tested_list_container",2,"border-radius","5px",3,"hasBackdrop"],[2,"background-color","rgba(242, 247, 251, 1)","border","none",3,"mode","opened","ngClass"],["drawerTestReview",""],["class","pr-2",4,"ngIf"],["id","short_cut_mobile",1,"pl-1","pr-1",2,"margin-top","10px"],[1,"clickable",3,"matTooltip","click"],[2,"vertical-align","middle","color","#646464","transform","rotateY(180deg)"],["id","test_review_area"],[1,"pr-2"],["class","ml-1","style","color: #007bff;",3,"click",4,"ngIf"],[1,"ml-1",2,"color","#007bff",3,"click"],[2,"height","75px !important",3,"src"],["matTooltip","{{ ('lang_auto_giao_vien_cham' | mytranslate): ' + initDataResult?.data?.markedByObj?.fullName }}",2,"cursor","pointer",3,"linkAvatar","nameCreateAvatar","size"],[1,"test-review-tab",3,"selectedTabChange"],["class","pl-2 pr-2 m-auto w-auto clickable","matTooltip","('lang_auto_click_de_hien_nut' | mytranslate) ('lang_auto_hoi_giao_vien' | mytranslate)",3,"click",4,"ngIf"],["class","pl-2 pr-2 m-auto w-auto clickable","matTooltip","('lang_auto_click_de_an_nut' | mytranslate) ('lang_auto_hoi_giao_vien' | mytranslate)",3,"click",4,"ngIf"],["matTooltip","('lang_auto_click_de_hien_nut' | mytranslate) ('lang_auto_hoi_giao_vien' | mytranslate)",1,"pl-2","pr-2","m-auto","w-auto","clickable",3,"click"],["matTooltip","('lang_auto_click_de_an_nut' | mytranslate) ('lang_auto_hoi_giao_vien' | mytranslate)",1,"pl-2","pr-2","m-auto","w-auto","clickable",3,"click"],[3,"ngStyle","ngClass","userAnswersObj","question","index","configExam","isRoleTeacher","examObjPermission","notShowAnswerYet","isBackEnd","cur_result","newFirstInGroupIndexes","showButtonCommentToteacher","allowAskQuestion","displayScreen","statusResult"],["`","",3,"displayScreen","resultID","files","questions","userAnswersObj","iframeSrc","notShowAnswerYet","examQuestionObjs","examResultObj","configExam","isBackEnd","examObj","hasLoadedData","saveResultEvent"],[3,"customText"],[1,"p-5","m-5","text-center","alert","alert-danger"],[2,"vertical-align","bottom"],[3,"linkUrl","typePreview","fileNameCustom","closePreview"],[3,"data","closeDialog"]],template:function(c,g){if(1&c&&(s.YNc(0,Xt,2,1,"ng-template",null,0,s.W1O),s.YNc(2,Fo,1,1,"azt-loading-effect",1),s.YNc(3,Ja,5,3,"div",2),s.YNc(4,Ga,2,3,"div",3),s.YNc(5,Ka,2,1,"div",3)),2&c){const f=s.MAs(1);s.xp6(2),s.Q6J("ngIf",g.isMixedService_2&&!g.doneLoadMixedExamAssets&&!g.errorLoadMixedAssets)("ngIfElse",f),s.xp6(1),s.Q6J("ngIf",g.errorLoadMixedAssets),s.xp6(1),s.Q6J("ngIf",g.isShowPreviewFile),s.xp6(1),s.Q6J("ngIf",g.dataLogEditExam.isShow)}},dependencies:[jt.mk,jt.sg,jt.O5,jt.PC,Jt.i3,Bt.lW,Gt.Hw,de.VK,de.OP,de.p6,Ne.jA,Ne.kh,Ne.LW,ct.SP,ct.uX,ot.gM,pi,ds.Q,pr.l,cn.x,Ct.t,In,Ei,Qn.$,jt.uU,yt.bT,yt.Tf,yt.t9,yt.q7],styles:["#test_review_container[_ngcontent-%COMP%]{background:#ecf0f5;flex:auto;padding-top:15px}.w-70[_ngcontent-%COMP%]{width:70%}.pos-menu[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);right:0}.pos-menu-v2[_ngcontent-%COMP%]{position:absolute;top:-2%;right:0}#tester-info[_ngcontent-%COMP%]::-webkit-scrollbar{background-color:#fff;width:16px}#tester-info[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:#fff}#tester-info[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#babac0;border-radius:16px;border:4px solid #fff}#tester-info[_ngcontent-%COMP%]::-webkit-scrollbar-button{display:none}#tester-info[_ngcontent-%COMP%]{width:300px;padding:15px;background-color:#fff;margin:0 auto;position:sticky;top:10px;max-height:calc(100vh - 10px);overflow-x:hidden;display:flex;flex-direction:column;max-width:100%;border-radius:3px;border:1px solid #f1f1f1}#short_cut_mobile[_ngcontent-%COMP%]{display:none}#fullPoint[_ngcontent-%COMP%]{border:1px solid #f1f1f1;background-color:#fafafa;padding:10px;margin-top:15px}#fullPoint[_ngcontent-%COMP%]   .point[_ngcontent-%COMP%]{font-weight:500;font-size:130%}.list-time[_ngcontent-%COMP%]{list-style:none;background-color:#fff;margin:0 10px;padding:10px}.list-time[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.list-time[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.list-time[_ngcontent-%COMP%]   li.select[_ngcontent-%COMP%]{font-weight:500}.btn-times[_ngcontent-%COMP%]{display:block;transition:all .5s;background:#fafafa;width:100%}.tested-times[_ngcontent-%COMP%]{margin-top:15px}.tested-times[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{border:1px solid #f1f1f1;background-color:#fafafa;padding:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;border:1px solid #f1f1f1;border-top:none;margin-bottom:0;background-color:#fff;padding:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.select[_ngcontent-%COMP%]{font-weight:500}.tested-times[_ngcontent-%COMP%]:last-child{flex:auto;overflow:auto}#multipleChoiceWrap[_ngcontent-%COMP%]{background-color:#fff;padding:30px;position:relative}.fading_layer[_ngcontent-%COMP%]{position:absolute;z-index:9;background-color:#ffffffe3;width:100%;height:100%;top:0;left:0;padding-top:200px;text-align:center;color:#a9a9a9;font-size:16px}#filterWrap[_ngcontent-%COMP%]{position:absolute;right:0;top:0px}.button-show-error[_ngcontent-%COMP%]:hover, .button-show-success[_ngcontent-%COMP%]:hover{background-color:#d8d8d8;color:#00f}.button-show-all[_ngcontent-%COMP%]:hover{color:#00f}.viewWrong[_ngcontent-%COMP%]   .correct[_ngcontent-%COMP%], .viewRight[_ngcontent-%COMP%]   .incorrect[_ngcontent-%COMP%]{display:none}.menu-button-filter[_ngcontent-%COMP%]{font-size:12px;font-weight:400!important;border:1px solid rgba(234,234,234,.8901960784);border-radius:3px;text-transform:none;padding-right:6px;padding-bottom:3px;color:#414141;line-height:20px;background:whitesmoke}#col_examContent_wrap[_ngcontent-%COMP%]{width:1100px}#col_examContent_wrap[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{position:fixed;right:5px;top:50%;z-index:999;font-size:35px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;background-color:#c9c9c9c5;border-radius:50%;color:#fff;margin-top:-20px}#col_examContent_wrap[_ngcontent-%COMP%] > mat-icon.prev_icon[_ngcontent-%COMP%]{left:5px}#mbTestContent[_ngcontent-%COMP%]{position:relative}#mbTestContent[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{display:none;position:absolute;top:12px;color:#646464;z-index:100}#test_review_container.toggleNavInfo[_ngcontent-%COMP%]   #col_std_info[_ngcontent-%COMP%]{left:0}#close_button[_ngcontent-%COMP%]{color:red;position:absolute;right:5px;top:5px}@media screen and (max-width: 320px){#tester-info[_ngcontent-%COMP%]{width:100%}}@media screen and (max-width: 480px){#mbTestContent[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{display:inline-block}#boxQAButtons[_ngcontent-%COMP%]{position:fixed;right:20px;z-index:99999999999999;bottom:10px;background-color:#fff;border:1px solid #a3a3a3;padding:5px;border-radius:4px}#test_review_container[_ngcontent-%COMP%]{padding-top:0}#col_std_info[_ngcontent-%COMP%]{position:fixed;top:0;left:-100%;z-index:99999;background:rgba(0,0,0,.6117647059);bottom:0;padding:0;transition:all .5s}#short_cut_mobile[_ngcontent-%COMP%]{display:flex;font-weight:500;font-size:18px;justify-content:space-between;color:#4a4a4a}#header-app-component[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{padding-left:0!important}#tester-info[_ngcontent-%COMP%]{margin:0;position:relative;height:100%;max-height:unset;top:0}#multipleChoiceWrap[_ngcontent-%COMP%]{padding-right:5px;padding-left:5px;padding-top:5px}}.btn-copy[_ngcontent-%COMP%]{font-size:14px;transition:all .5s;border:none;background:transparent;text-transform:inherit;padding-left:0;color:#00b2c3}.btn-copy[_ngcontent-%COMP%]:hover{color:#047781}@media screen and (max-width: 768px){#tester-info[_ngcontent-%COMP%]{height:auto}}@media screen and (max-width: 1600px){#col_examContent_wrap[_ngcontent-%COMP%]{width:100%}}.icon-click-show-button[_ngcontent-%COMP%]{position:absolute;top:0;right:0;background:lightgrey;font-size:25px;text-align:center;height:auto;width:30px;padding:3px 0;border-radius:3px}"]}),_})()},51225:(Qt,tt,w)=>{w.d(tt,{ay:()=>s});class s{constructor(T){let V=Uint8Array.from(atob(T.toString()),H=>H.charCodeAt(0));this.bytes=V,this.cursor=0}parseUchar(){let T=this.bytes[this.cursor];return this.cursor++,T}parseInt(){let T=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.cursor+=4,new DataView(T).getInt32(0)}parseDouble(){let T=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.cursor+=8,new DataView(T).getFloat64(0,!0)}parseString(){let T=new TextDecoder("utf-8"),V=this.cursor,H=this.bytes[this.cursor];for(;0!=H;)this.cursor++,H=this.bytes[this.cursor];let Z=this.bytes.slice(V,this.cursor),W=T.decode(Z);return this.cursor++,W}parseBool(){let T=this.bytes[this.cursor];return this.cursor++,T>0}parseCvPoint2u(){let T=new o;return T.x=this.parseUchar(),T.y=this.parseUchar(),T}parseCvPoint2f(){let T=new J;return T.x=this.parseDouble(),T.y=this.parseDouble(),T}parseAnswerCircle(){let T=new C;return T.center=this.parseCvPoint2f(),T.filled=this.parseBool(),T}parseTableAnswer(){let T=new et,V=0;T.rows=this.parseInt(),T.cols=this.parseInt(),T.radius=this.parseInt(),V=this.parseInt();for(let H=0;H<V;H++)T.answers.push(this.parseAnswerCircle());return T}parseResultRect(){let T=new M;return T.top=this.parseCvPoint2f(),T.left=this.parseCvPoint2f(),T.bottom=this.parseCvPoint2f(),T.right=this.parseCvPoint2f(),T}parseCropRegion(){let T=new Q;return T.x=this.parseDouble(),T.y=this.parseDouble(),T.width=this.parseDouble(),T.height=this.parseDouble(),T}parseResultOutput(){let T=new P;return T.type=this.parseInt(),T.errorCode=this.parseInt(),T.paperCorner=this.parseResultRect(),T.studentId=this.parseTableAnswer(),T.examId=this.parseTableAnswer(),T.answerTable=this.parseTableAnswer(),T.nameRegion=this.parseCropRegion(),T.imageWidth=this.parseInt(),T.imageHeight=this.parseInt(),T.imageSize=this.parseInt(),T}parseAnswerSheetInput(){let T=new K;return T.templateType=this.parseInt(),T.imageWidth=this.parseInt(),T.imageHeight=this.parseInt(),T}parseSmallAnswerCircle(){let T=new z;return T.position=this.parseUchar(),T.x=this.parseUchar(),T.y=this.parseUchar(),T.filledCols=this.parseUchar(),T.rows=this.parseUchar(),T}parseSmallTableAnswer(){let T=new R,V=0;T.rows=this.parseUchar(),T.cols=this.parseUchar(),T.radius=this.parseUchar(),V=this.parseInt();for(let H=0;H<V;H++)T.answers.push(this.parseSmallAnswerCircle());return T}parseDrawData(){let T=new j;return T.studentId=this.parseSmallTableAnswer(),T.examId=this.parseSmallTableAnswer(),T.answerTable=this.parseSmallTableAnswer(),T}}class o{constructor(){this.x=0,this.y=0}}class J{constructor(){this.x=0,this.y=0}}class C{constructor(){this.center=new J,this.filled=!1}}class et{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}}class M{constructor(){this.top=new J,this.left=new J,this.bottom=new J,this.right=new J}}class Q{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}}class P{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new M,this.studentId=new et,this.examId=new et,this.answerTable=new et,this.nameRegion=new Q,this.imageWidth=0,this.imageHeight=0,this.imageSize=0}}class K{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}}class z{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}}class R{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}}class j{constructor(){this.studentId=new R,this.examId=new R,this.answerTable=new R}}},20985:(Qt,tt,w)=>{w.d(tt,{Z:()=>s});const s=100},88847:(Qt,tt,w)=>{w.d(tt,{H:()=>J});var s=w(5e3),o=w(15043);let J=(()=>{class C{constructor(M){this.cdnService=M}convertUrl(){this.src=this.cdnService.getRawCdnLink(this.src)}}return C.\u0275fac=function(M){return new(M||C)(s.Y36(o.U))},C.\u0275dir=s.lG2({type:C,selectors:[["","appImageFallback",""]],hostVars:1,hostBindings:function(M,Q){1&M&&s.NdJ("error",function(){return Q.convertUrl()}),2&M&&s.Ikx("src",Q.src,s.P3R)},inputs:{src:"src"}}),C})()},20259:(Qt,tt,w)=>{w.d(tt,{v:()=>s});class s{constructor(){this.answerLabelsMockup={}}}},61828:(Qt,tt,w)=>{w.d(tt,{V:()=>K});var s=w(70655),o=w(24096),J=w(20985),C=w(5e3),et=w(35018),M=w(51930),Q=w(15043),P=w(88161);let K=(()=>{class z{constructor(j,y,T,V){this.commonService=j,this.trackLogService=y,this.cdnService=T,this.answerTypeService=V,this.labelsImgs=[],this.questionLabelMap=[],this.abcdLabelPos={},this.subscription=new o.w,this.drawMixQuestionTS=(H,Z,W)=>{if(void 0===W)return;this.labelsImgs=H,this.questionLabelMap=Z[0].questionContentParse[0].questionLabelMap?Z[0].questionContentParse[0].questionLabelMap:this.commonService.willDeleteParseJson(W.questionLabelMap||""),this.abcdLabelPos=Z[0].questionContentParse[0].abcdLabelPos?Z[0].questionContentParse[0].abcdLabelPos:this.commonService.willDeleteParseJson(W.abcdLabelPos||"");const it={width:1,height:1,top:1,left:1};Z.forEach(Y=>{1==Y.isImage&&(Y.mixDataImg=this.cdnService.convertLinkCdn("azota_assets/svgs/Img2_dat-01.svg"),Y.answerLabelsMockup={"label-A":it,"label-B":it,"label-C":it,"label-D":it,"label-E":it,"label-F":it})});for(let Y=0;Y<Z.length;Y++)this.answerTypeService.isOneChoiceAnswer(Z[Y].answerType)?this.drawForMultipleChoiceQuestion(Z[Y].answerConfigParse,Z[Y].questionContentParse[0],Y,Z):this.prepareImageForOtherTypes(Z[Y].questionContentParse[0],Y,Z)},this.getBase64Image=H=>new Promise(function(Z,W){const it=new Image;it.setAttribute("crossOrigin","anonymous"),it.onload=()=>{const Y=document.createElement("canvas");Y.width=it.width,Y.height=it.height;const rt=Y.getContext("2d");null==rt||rt.drawImage(it,0,0);const gt=Y.toDataURL("image/png");Z(gt)},it.onerror=()=>{W(new Error("Can not convert url to base64"))},it.src=H})}drawForMultipleChoiceQuestion(j,y,T,V){var H;if(y.metaData&&y.metaData.answers&&y.metaData.question){let Z=j.map(ct=>this.commonService.willDeleteParseJson(ct.content));const W=this.questionLabelMap.hasOwnProperty(T)&&this.questionLabelMap[T].width>y.metaData.question.remove.width?this.questionLabelMap[T].width-y.metaData.question.remove.width:0;let it=document.createElement("canvas");it.width=y.metaData.question.width+W+J.Z,it.height=y.metaData.question.height;let Y=it.getContext("2d");null==Y||Y.drawImage(this.labelsImgs[y.metaData.question.posit.locate],y.metaData.question.posit.left,y.metaData.question.posit.top,y.metaData.question.width,y.metaData.question.height,W,0,y.metaData.question.width,y.metaData.question.height),this.questionLabelMap.hasOwnProperty(T)&&(null==Y||Y.drawImage(void 0===this.questionLabelMap[T].locate?this.labelsImgs[0]:this.labelsImgs[this.questionLabelMap[T].locate],this.questionLabelMap[T].left,this.questionLabelMap[T].top,this.questionLabelMap[T].width,this.questionLabelMap[T].height,y.metaData.question.remove.x,y.metaData.question.remove.y,this.questionLabelMap[T].width,this.questionLabelMap[T].height));let rt=Z[0],gt=0,Et=0,pt=0,Dt=y.metaData.answers[0].x,jt=y.metaData.answers[0].y;gt=Dt,Et=Dt+rt.width,pt=Dt+rt.width;let Jt=Z[0].height-y.metaData.answers[0].height;null==Y||Y.drawImage(this.labelsImgs[rt.posit.locate],rt.posit.left,rt.posit.top,rt.width,rt.height,Dt,jt,rt.width,rt.height);let Bt=j[0].alpha?j[0].alpha:j[0].key,Gt=0;if(j[0].alpha){let ct=j[0].key;for(let ot=0;ot<j.length;ot++)if(ct==j[ot].alpha){Gt=ot;break}}let Ne,de={left:void 0!==y.metaData.answers[Gt].remove.xAns?Dt+y.metaData.answers[Gt].remove.xAns:y.metaData.answers[0].remove.x,top:void 0!==y.metaData.answers[Gt].remove.yAns?jt+y.metaData.answers[Gt].remove.yAns:y.metaData.answers[0].remove.y,width:y.metaData.answers[0].remove.width,height:y.metaData.answers[0].remove.height};this.abcdLabelPos&&this.abcdLabelPos.hasOwnProperty(Bt)&&(null==Y||Y.drawImage(this.labelsImgs[0],this.abcdLabelPos[Bt].left,this.abcdLabelPos[Bt].top,y.metaData.answers[0].remove.width,y.metaData.answers[0].remove.height,de.left,de.top,de.width,de.height)),V[T].answerLabelsMockup[`label-${j[0].alpha?j[0].alpha:j[0].key}`]=de;for(let ct=1;ct<j.length;ct++){let ot=y.metaData.answers[ct].x,Rt=y.metaData.answers[ct].y;if(gt+30<ot){let _e=Z[ct].height-y.metaData.answers[ct].height;_e<0?_e<Jt&&(Jt=_e):_e>=Jt&&(Jt=_e),null!=Ne&&(Rt=Ne);let ke=[pt,Et];ot<Math.max(...ke)&&(ot=Math.max(...ke),ot+Z[ct].width>it.width&&(ot-=ot+Z[ct].width-it.width),y.metaData.answers[ct].remove.x=ot),Et+=Math.max(Z[ct].width,y.metaData.answers[ct].width)}else Et=gt+Z[ct].width,Rt+=Jt,Ne=Rt,Jt+=Z[ct].height-y.metaData.answers[ct].height;if(Rt+Z[ct].height>it.height){let _e=Rt+Z[ct].height-it.height;Rt-=_e,y.metaData&&y.metaData.answers&&(y.metaData.answers[ct].remove.y-=_e)}null==Y||Y.drawImage(this.labelsImgs[Z[ct].posit.locate],Z[ct].posit.left,Z[ct].posit.top,Z[ct].width,Z[ct].height,ot,Rt,Z[ct].width,Z[ct].height);let Ct=ct,Ae=null!==(H=j[ct].alpha)&&void 0!==H?H:j[ct].key;if(j[ct].alpha){let _e=j[ct].key;for(let ke=0;ke<j.length;ke++)if(_e==j[ke].alpha){Ct=ke;break}}let yt={left:0,top:0,width:0,height:0};y.metaData&&y.metaData.answers&&(yt={left:void 0!==y.metaData.answers[Ct].remove.xAns?ot+y.metaData.answers[Ct].remove.xAns:y.metaData.answers[ct].remove.x,top:void 0!==y.metaData.answers[Ct].remove.yAns?Rt+y.metaData.answers[Ct].remove.yAns:y.metaData.answers[ct].remove.y,width:y.metaData.answers[ct].remove.width,height:y.metaData.answers[ct].remove.height}),this.abcdLabelPos&&this.abcdLabelPos.hasOwnProperty(Ae)&&(null==Y||Y.drawImage(this.labelsImgs[0],this.abcdLabelPos[Ae].left,this.abcdLabelPos[Ae].top,y.metaData.answers[ct].remove.width,y.metaData.answers[ct].remove.height,yt.left,yt.top,yt.width,yt.height)),V[T].answerLabelsMockup[`label-${j[ct].alpha?j[ct].alpha:j[ct].key}`]=yt}V[T].mixDataImg=it.toDataURL("image/png")}}prepareImageForOtherTypes(j,y,T){return(0,s.mG)(this,void 0,void 0,function*(){if(j.metaData&&j.metaData.question){const V=this.questionLabelMap.hasOwnProperty(y)&&this.questionLabelMap[y].width>j.metaData.question.remove.width?this.questionLabelMap[y].width-j.metaData.question.remove.width:0;let H=document.createElement("canvas");H.width=j.metaData.question.width+V,H.height=j.metaData.question.height;let Z=H.getContext("2d"),W=j.metaData.question.urlExcludeLabelOnly;if(W&&-1===W.indexOf("base64"))try{W=yield this.getBase64Image(W)}catch(gt){return void console.log(gt)}const it=j.metaData.question.remove.x,Y=j.metaData.question.remove.y,rt=()=>{this.questionLabelMap.hasOwnProperty(y)&&(null==Z||Z.drawImage(void 0===this.questionLabelMap[y].locate?this.labelsImgs[0]:this.labelsImgs[this.questionLabelMap[y].locate],this.questionLabelMap[y].left,this.questionLabelMap[y].top,this.questionLabelMap[y].width,this.questionLabelMap[y].height,it,Y,this.questionLabelMap[y].width,this.questionLabelMap[y].height)),T[y].mixDataImg=H.toDataURL("image/png")};if(W){let gt=new Image;gt.onload=()=>{null==Z||Z.drawImage(gt,V,0),rt()},gt.src=W}else null==Z||Z.drawImage(this.labelsImgs[j.metaData.question.posit.locate],j.metaData.question.posit.left,j.metaData.question.posit.top,j.metaData.question.width,j.metaData.question.height,V,0,j.metaData.question.width,j.metaData.question.height),rt()}})}refindFirstInGroupIndexes(j,y){j=[];let T=-1;for(let V=0;V<y.length;V++)null!=y[V].groupId&&y[V].groupId!=T&&(T=y[V].groupId,j.push(V));return j}trackPdfV2Error(j){let y;try{var T=localStorage.getItem("user_obj");if(T){var V=this.commonService.myParseJson(T);V&&(y=V.id)}y=0}catch(W){y=0}let H=document.URL.split("?")[0].split("/"),Z={userId:y,trackKey:"V2_ERR_DISPLAY",name:"Track l\u1ed7i kh\xf4ng hi\u1ec3n th\u1ecb c\xe2u h\u1ecfi v2",userAgent:navigator.userAgent,url:document.URL,content:j,error:H[H.length-1]};this.subscription.add(this.trackLogService.apiTrackLogSaveObjPost(Z).subscribe(()=>{console.log("Track l\u1ed7i th\xe0nh c\xf4ng!")}))}}return z.\u0275fac=function(j){return new(j||z)(C.LFG(et.v),C.LFG(M.vT),C.LFG(Q.U),C.LFG(P.T))},z.\u0275prov=C.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"}),z})()},54569:(Qt,tt,w)=>{w.d(tt,{f:()=>z});var s=w(70655),o=w(17489),C=w(24096),et=w(5e3),M=w(35018),Q=w(15043),P=w(79152),K=w(88161);let z=(()=>{class R{constructor(y,T,V,H){this.commonService=y,this.cdnService=T,this.trackLogService=V,this.answerTypeService=H,this.labelsImg=new Image,this.questionLabelMap=[],this.abcdLabelPos={},this.subscription=new C.w,this.drawMixQuestionTS=(Z,W,it)=>(0,s.mG)(this,void 0,void 0,function*(){if(void 0===it)return;this.questionLabelMap=W[0].questionContentParse[0].questionLabelMap?W[0].questionContentParse[0].questionLabelMap:this.commonService.willDeleteParseJson(it.questionLabelMap||""),this.abcdLabelPos=W[0].questionContentParse[0].abcdLabelPos?W[0].questionContentParse[0].abcdLabelPos:this.commonService.willDeleteParseJson(it.abcdLabelPos||"");const Y={width:1,height:1,top:1,left:1};W.forEach(rt=>{1==rt.isImage&&(rt.mixDataImg=this.cdnService.convertLinkCdn("azota_assets/svgs/Img2_dat-01.svg"),rt.answerLabelsMockup={"label-A":Y,"label-B":Y,"label-C":Y,"label-D":Y,"label-E":Y,"label-F":Y})}),this.labelsImg.crossOrigin="anonymous",this.labelsImg.onload=()=>(0,s.mG)(this,void 0,void 0,function*(){let rt=o.chunk(W,5);const gt=Et=>(0,s.mG)(this,void 0,void 0,function*(){for(let pt=0;pt<Et.length;pt++)1==Et[pt].isImage&&(this.answerTypeService.isOneChoiceAnswer(Et[pt].answerType)?this.prepareImageToDrawForType1(Et[pt].answerConfigParse,Et[pt].questionContentParse[0],Et[pt].rawIndex||0,W):this.prepareImageForOtherTypes(Et[pt].questionContentParse[0],Et[pt].rawIndex||0,W));return new Promise(function(pt,Dt){setTimeout(pt,3e3)}).then(function(){console.log("Start process next chunk!")})});for(const Et of rt)yield gt(Et)}),this.makeRetry(this.labelsImg,3,2e3),this.labelsImg.onerror=()=>{this.commonService.snackError("Kh\xf4ng load \u0111\u01b0\u1ee3c d\u1eef li\u1ec7u \u1ea3nh b\xe0i th\xec!","")},this.labelsImg.src=this.cdnService.getMyCdn(Z)})}cancelSubscription(){this.subscription.unsubscribe()}makeRetry(y,T,V,H,Z,W,it,Y){y.crossOrigin="anonymous",y.setAttribute("totalRetry","0"),y.onerror=()=>{let rt=parseInt(y.getAttribute("totalRetry")||"0");if(rt++,rt<=T)setTimeout(()=>{if(rt>Math.floor(T/2))y.src=this.cdnService.getRawCdnLink(y.src);else{let Dt=y.src.split("?")[0];y.src=Dt+"?t="+Date.now()}y.setAttribute("totalRetry",rt.toString())},V);else{var gt;try{var Et=localStorage.getItem("user_obj");if(Et){var pt=this.commonService.myParseJson(Et);pt&&(gt=pt.id)}gt=0}catch(Jt){gt=0}let Dt=document.URL.split("?")[0].split("/"),jt={userId:gt,trackKey:"V2_ERR_DISPLAY",name:"Track l\u1ed7i kh\xf4ng hi\u1ec3n th\u1ecb c\xe2u h\u1ecfi v2",userAgent:navigator.userAgent,url:document.URL,content:y.src,error:Dt[Dt.length-1]};if(this.subscription.add(this.trackLogService.apiTrackLogSaveObjPost(jt).subscribe(()=>{console.log("Track l\u1ed7i th\xe0nh c\xf4ng!")})),(H||0===H)&&Z&&W&&it){it[H].mixDataImg=this.cdnService.convertLinkCdn("azota_assets/svgs/Img_dat-01.svg");let Jt=document.getElementById("questionPlaceholder_"+H);null==Jt||Jt.setAttribute("loadSuccess","0");let Bt=document.getElementById("media_content_all_"+it[H].id);null==Bt||Bt.setAttribute("loadSuccess","0");const Gt=de=>{"0"===(null==de?void 0:de.getAttribute("loadSuccess"))&&(Y?this.prepareImageForOtherTypes(W,H,it):this.prepareImageToDrawForType1(Z,W,H,it))};Bt?Bt.onclick=()=>{Gt(Bt)}:Jt&&(Jt.onclick=()=>{Gt(Jt)})}}}}prepareImageToDrawForType1(y,T,V,H){if(T.metaData&&T.metaData.question){let Z=1+y.length,W=0,it=new Image;it.crossOrigin="anonymous",it.onload=()=>{W++,W==Z&&this.drawEachQuestion(y,T,V,it,Y,H)},this.makeRetry(it,3,1e3,V,y,T,H),it.src=this.cdnService.getMyCdn(T.metaData.question.url||"");let Y=[];for(let rt=0;rt<y.length;rt++)Y[rt]=new Image,Y[rt].crossOrigin="anonymous",Y[rt].onload=()=>{W++,W==Z&&this.drawEachQuestion(y,T,V,it,Y,H)},this.makeRetry(Y[rt],3,1e3,V,y,T,H),Y[rt].src=this.cdnService.getMyCdn(y[rt].content)}}prepareImageForOtherTypes(y,T,V){if(y.metaData&&y.metaData.question){let H=document.createElement("canvas");H.width=y.metaData.question.width+10,H.height=y.metaData.question.height;let Z=H.getContext("2d"),W=new Image;W.crossOrigin="anonymous";const it=y.metaData.question.remove.x,Y=y.metaData.question.remove.y;W.onload=()=>{null==Z||Z.drawImage(W,10,0),null==Z||Z.drawImage(this.labelsImg,this.questionLabelMap[T].left,this.questionLabelMap[T].top,this.questionLabelMap[T].width,this.questionLabelMap[T].height,it,Y,this.questionLabelMap[T].width,this.questionLabelMap[T].height),V[T].mixDataImg=H.toDataURL("image/png")},this.makeRetry(W,3,1e3,void 0,void 0,void 0,void 0,"others"),W.src=this.cdnService.getMyCdn(y.metaData.question.url||"")}}drawEachQuestion(y,T,V,H,Z,W){if(T.metaData&&T.metaData.answers&&T.metaData.question){let it=document.createElement("canvas");it.width=T.metaData.question.width+15,it.height=T.metaData.question.height;let Y=it.getContext("2d");null==Y||Y.drawImage(H,15,0),null==Y||Y.drawImage(this.labelsImg,this.questionLabelMap[V].left,this.questionLabelMap[V].top,this.questionLabelMap[V].width,this.questionLabelMap[V].height,T.metaData.question.remove.x,T.metaData.question.remove.y,this.questionLabelMap[V].width,this.questionLabelMap[V].height);let rt=Z[0],gt=0,Et=0,pt=0,Dt=T.metaData.answers[0].x,jt=T.metaData.answers[0].y;gt=Dt,Et=Dt+rt.width,pt=Dt+rt.width;let Jt=Z[0].height-T.metaData.answers[0].height;null==Y||Y.drawImage(rt,Dt,jt);let Bt=y[0].alpha?y[0].alpha:y[0].key,Gt=0;if(y[0].alpha){let ot=y[0].key;for(let Rt=0;Rt<y.length;Rt++)if(ot==y[Rt].alpha){Gt=Rt;break}}const de=T.metaData.answers[Gt].remove.xAns||0,Ne=T.metaData.answers[Gt].remove.yAns||0;let ct={left:void 0!==T.metaData.answers[Gt].remove.xAns?Dt+de:T.metaData.answers[0].remove.x,top:void 0!==T.metaData.answers[Gt].remove.yAns?jt+Ne:T.metaData.answers[0].remove.y,width:T.metaData.answers[0].remove.width,height:T.metaData.answers[0].remove.height};this.abcdLabelPos&&this.abcdLabelPos.hasOwnProperty(Bt)&&(null==Y||Y.drawImage(this.labelsImg,this.abcdLabelPos[Bt].left,this.abcdLabelPos[Bt].top,T.metaData.answers[0].remove.width,T.metaData.answers[0].remove.height,ct.left,ct.top,ct.width,ct.height)),W[V].answerLabelsMockup[`label-${y[0].alpha?y[0].alpha:y[0].key}`]=ct;for(let ot=1;ot<y.length;ot++){let Rt=T.metaData.answers[ot].x,Ct=T.metaData.answers[ot].y;if(gt+30<Rt){let ve=[pt,Et];Rt<Math.max(...ve)&&(Rt=Math.max(...ve),Rt+Z[ot].width>it.width&&(Rt-=Rt+Z[ot].width-it.width),T.metaData.answers[ot].remove.x=Rt),Et+=Z[ot].width}else if(Et=gt+Z[ot].width,Ct+=Jt,Jt+=Z[ot].height-T.metaData.answers[ot].height,Ct+Z[ot].height>it.height){let ve=Ct+Z[ot].height-it.height;Ct-=ve,T.metaData.answers[ot].remove.y-=ve}null==Y||Y.drawImage(Z[ot],Rt,Ct);let Ae=ot,yt=y[ot].alpha?y[ot].alpha:y[ot].key;if(y[ot].alpha){let ve=y[ot].key;for(let Me=0;Me<y.length;Me++)if(ve==y[Me].alpha){Ae=Me;break}}const _e=T.metaData.answers[Ae].remove.xAns||0,ke=T.metaData.answers[Ae].remove.yAns||0;let je={left:void 0!==T.metaData.answers[Ae].remove.xAns?Rt+_e:T.metaData.answers[ot].remove.x,top:void 0!==T.metaData.answers[Ae].remove.yAns?Ct+ke:T.metaData.answers[ot].remove.y,width:T.metaData.answers[ot].remove.width,height:T.metaData.answers[ot].remove.height};if(this.abcdLabelPos&&this.abcdLabelPos.hasOwnProperty(yt||"a")&&(null==Y||Y.drawImage(this.labelsImg,this.abcdLabelPos[yt||"a"].left,this.abcdLabelPos[yt||"b"].top,T.metaData.answers[ot].remove.width,T.metaData.answers[ot].remove.height,je.left,je.top,je.width,je.height)),W[V].answerLabelsMockup[`label-${y[ot].alpha?y[ot].alpha:y[ot].key}`]=je,ot==y.length-1){W[V].mixDataImg=it.toDataURL("image/png");let ve=document.getElementById("media_content_all_"+W[V].id);null==ve||ve.setAttribute("loadSuccess","1");let Me=document.getElementById("questionPlaceholder_"+V);null==Me||Me.setAttribute("loadSuccess","1")}}}}}return R.\u0275fac=function(y){return new(y||R)(et.LFG(M.v),et.LFG(Q.U),et.LFG(P.v),et.LFG(K.T))},R.\u0275prov=et.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})()},80383:(Qt,tt,w)=>{w.d(tt,{C:()=>Cp});var R,s=w(70655),o=w(15867),J=w(98937),C=w(15861),et=w(49681),M=w(34859),Q=w(41877),P=w(42090),K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},z={},j=j||{},y=K||self;function T(){}function V(n){var t=typeof n;return"array"==(t="object"!=t?t:n?Array.isArray(n)?"array":t:"null")||"object"==t&&"number"==typeof n.length}function H(n){var t=typeof n;return"object"==t&&null!=n||"function"==t}var W="closure_uid_"+(1e9*Math.random()>>>0),it=0;function Y(n,t,e){return n.call.apply(n.bind,arguments)}function rt(n,t,e){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(t,r)}}return function(){return n.apply(t,arguments)}}function gt(n,t,e){return(gt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Y:rt).apply(null,arguments)}function Et(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var i=e.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function pt(n,t){function e(){}e.prototype=t.prototype,n.Z=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.Vb=function(i,r,a){for(var l=Array(arguments.length-2),u=2;u<arguments.length;u++)l[u-2]=arguments[u];return t.prototype[r].apply(i,l)}}function Dt(){this.s=this.s,this.o=this.o}var Jt={};Dt.prototype.s=!1,Dt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function Z(n){return Object.prototype.hasOwnProperty.call(n,W)&&n[W]||(n[W]=++it)}(this);delete Jt[n]}},Dt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Bt=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if("string"==typeof n)return"string"!=typeof t||1!=t.length?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1},Gt=Array.prototype.forEach?function(n,t,e){Array.prototype.forEach.call(n,t,e)}:function(n,t,e){const i=n.length,r="string"==typeof n?n.split(""):n;for(let a=0;a<i;a++)a in r&&t.call(e,r[a],a,n)};function Ne(n){return Array.prototype.concat.apply([],arguments)}function ct(n){const t=n.length;if(0<t){const e=Array(t);for(let i=0;i<t;i++)e[i]=n[i];return e}return[]}function ot(n){return/^[\s\xa0]*$/.test(n)}var yt,Rt=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Ct(n,t){return-1!=n.indexOf(t)}function Ae(n,t){return n<t?-1:n>t?1:0}t:{var _e=y.navigator;if(_e){var ke=_e.userAgent;if(ke){yt=ke;break t}}yt=""}function je(n,t,e){for(const i in n)t.call(e,n[i],i,n)}function ve(n){const t={};for(const e in n)t[e]=n[e];return t}var Me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function hs(n,t){let e,i;for(let r=1;r<arguments.length;r++){for(e in i=arguments[r],i)n[e]=i[e];for(let a=0;a<Me.length;a++)e=Me[a],Object.prototype.hasOwnProperty.call(i,e)&&(n[e]=i[e])}}function pi(n){return pi[" "](n),n}pi[" "]=T;var Un,n,pr=Ct(yt,"Opera"),cn=Ct(yt,"Trident")||Ct(yt,"MSIE"),_s=Ct(yt,"Edge"),xe=_s||cn,ms=Ct(yt,"Gecko")&&!(Ct(yt.toLowerCase(),"webkit")&&!Ct(yt,"Edge"))&&!(Ct(yt,"Trident")||Ct(yt,"MSIE"))&&!Ct(yt,"Edge"),fr=Ct(yt.toLowerCase(),"webkit")&&!Ct(yt,"Edge");function gs(){var n=y.document;return n?n.documentMode:void 0}t:{var fi="",Qn=(n=yt,ms?/rv:([^\);]+)(\)|;)/.exec(n):_s?/Edge\/([\d\.]+)/.exec(n):cn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):fr?/WebKit\/(\S+)/.exec(n):pr?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Qn&&(fi=Qn?Qn[1]:""),cn){var Bn=gs();if(null!=Bn&&Bn>parseFloat(fi)){Un=String(Bn);break t}}Un=fi}var vr={};var yr=y.document&&cn&&(gs()||parseInt(Un,10))||void 0,wr=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{y.addEventListener("test",T,t),y.removeEventListener("test",T,t)}catch(e){}return n}();function ae(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}function In(n,t){if(ae.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(ms){t:{try{pi(t.nodeName);var r=!0;break t}catch(a){}r=!1}r||(t=null)}}else"mouseover"==e?t=n.fromElement:"mouseout"==e&&(t=n.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:br[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&In.Z.h.call(this)}}ae.prototype.h=function(){this.defaultPrevented=!0},pt(In,ae);var br={2:"touch",3:"pen",4:"mouse"};In.prototype.h=function(){In.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var En="closure_listenable_"+(1e6*Math.random()|0),Tr=0;function Ar(n,t,e,i,r){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!i,this.ia=r,this.key=++Tr,this.ca=this.fa=!1}function zn(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function Vn(n){this.src=n,this.g={},this.h=0}function xi(n,t){var e=t.type;if(e in n.g){var a,i=n.g[e],r=Bt(i,t);(a=0<=r)&&Array.prototype.splice.call(i,r,1),a&&(zn(t),0==n.g[e].length&&(delete n.g[e],n.h--))}}function yi(n,t,e,i){for(var r=0;r<n.length;++r){var a=n[r];if(!a.ca&&a.listener==t&&a.capture==!!e&&a.ia==i)return r}return-1}Vn.prototype.add=function(n,t,e,i,r){var a=n.toString();(n=this.g[a])||(n=this.g[a]=[],this.h++);var l=yi(n,t,i,r);return-1<l?(t=n[l],e||(t.fa=!1)):((t=new Ar(t,this.src,a,!!i,r)).fa=e,n.push(t)),t};var wi="closure_lm_"+(1e6*Math.random()|0),bi={};function fs(n,t,e,i,r){if(i&&i.once)return xs(n,t,e,i,r);if(Array.isArray(t)){for(var a=0;a<t.length;a++)fs(n,t[a],e,i,r);return null}return e=Ei(e),n&&n[En]?n.N(t,e,H(i)?!!i.capture:!!i,r):vs(n,t,e,!1,i,r)}function vs(n,t,e,i,r,a){if(!t)throw Error("Invalid event type");var l=H(r)?!!r.capture:!!r,u=Ai(n);if(u||(n[wi]=u=new Vn(n)),(e=u.add(t,e,i,l,a)).proxy)return e;if(i=function Ir(){var t=Er;return function n(e){return t.call(n.src,n.listener,e)}}(),e.proxy=i,i.src=n,i.listener=e,n.addEventListener)wr||(r=l),void 0===r&&(r=!1),n.addEventListener(t.toString(),i,r);else if(n.attachEvent)n.attachEvent(ws(t.toString()),i);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(i)}return e}function xs(n,t,e,i,r){if(Array.isArray(t)){for(var a=0;a<t.length;a++)xs(n,t[a],e,i,r);return null}return e=Ei(e),n&&n[En]?n.O(t,e,H(i)?!!i.capture:!!i,r):vs(n,t,e,!0,i,r)}function ys(n,t,e,i,r){if(Array.isArray(t))for(var a=0;a<t.length;a++)ys(n,t[a],e,i,r);else i=H(i)?!!i.capture:!!i,e=Ei(e),n&&n[En]?(n=n.i,(t=String(t).toString())in n.g&&-1<(e=yi(a=n.g[t],e,i,r))&&(zn(a[e]),Array.prototype.splice.call(a,e,1),0==a.length&&(delete n.g[t],n.h--))):n&&(n=Ai(n))&&(t=n.g[t.toString()],n=-1,t&&(n=yi(t,e,i,r)),(e=-1<n?t[n]:null)&&Ti(e))}function Ti(n){if("number"!=typeof n&&n&&!n.ca){var t=n.src;if(t&&t[En])xi(t.i,n);else{var e=n.type,i=n.proxy;t.removeEventListener?t.removeEventListener(e,i,n.capture):t.detachEvent?t.detachEvent(ws(e),i):t.addListener&&t.removeListener&&t.removeListener(i),(e=Ai(t))?(xi(e,n),0==e.h&&(e.src=null,t[wi]=null)):zn(n)}}}function ws(n){return n in bi?bi[n]:bi[n]="on"+n}function Er(n,t){if(n.ca)n=!0;else{t=new In(t,this);var e=n.listener,i=n.ia||n.src;n.fa&&Ti(n),n=e.call(i,t)}return n}function Ai(n){return(n=n[wi])instanceof Vn?n:null}var Ii="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ei(n){return"function"==typeof n?n:(n[Ii]||(n[Ii]=function(t){return n.handleEvent(t)}),n[Ii])}function Wt(){Dt.call(this),this.i=new Vn(this),this.P=this,this.I=null}function ne(n,t){var e,i=n.I;if(i)for(e=[];i;i=i.I)e.push(i);if(n=n.P,i=t.type||t,"string"==typeof t)t=new ae(t,n);else if(t instanceof ae)t.target=t.target||n;else{var r=t;hs(t=new ae(i,n),r)}if(r=!0,e)for(var a=e.length-1;0<=a;a--){var l=t.g=e[a];r=Jn(l,i,!0,t)&&r}if(r=Jn(l=t.g=n,i,!0,t)&&r,r=Jn(l,i,!1,t)&&r,e)for(a=0;a<e.length;a++)r=Jn(l=t.g=e[a],i,!1,t)&&r}function Jn(n,t,e,i){if(!(t=n.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,a=0;a<t.length;++a){var l=t[a];if(l&&!l.ca&&l.capture==e){var u=l.listener,h=l.ia||l.src;l.fa&&xi(n.i,l),r=!1!==u.call(h,i)&&r}}return r&&!i.defaultPrevented}pt(Wt,Dt),Wt.prototype[En]=!0,Wt.prototype.removeEventListener=function(n,t,e,i){ys(this,n,t,e,i)},Wt.prototype.M=function(){if(Wt.Z.M.call(this),this.i){var t,n=this.i;for(t in n.g){for(var e=n.g[t],i=0;i<e.length;i++)zn(e[i]);delete n.g[t],n.h--}}this.I=null},Wt.prototype.N=function(n,t,e,i){return this.i.add(String(n),t,!1,e,i)},Wt.prototype.O=function(n,t,e,i){return this.i.add(String(n),t,!0,e,i)};var Ci=y.JSON.stringify;function Cr(){var n=Ts;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var Si,bs=new class{constructor(n,t){this.i=n,this.j=t,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new Sr,n=>n.reset());class Sr{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Cn(n){y.setTimeout(()=>{throw n},0)}function Oi(n,t){Si||function kr(){var n=y.Promise.resolve(void 0);Si=function(){n.then(Mr)}}(),ki||(Si(),ki=!0),Ts.add(n,t)}var ki=!1,Ts=new class Or{constructor(){this.h=this.g=null}add(t,e){const i=bs.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}};function Mr(){for(var n;n=Cr();){try{n.h.call(n.g)}catch(e){Cn(e)}var t=bs;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}ki=!1}function un(n,t){Wt.call(this),this.h=n||1,this.g=t||y,this.j=gt(this.kb,this),this.l=Date.now()}function Mi(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function Di(n,t,e){if("function"==typeof n)e&&(n=gt(n,e));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=gt(n.handleEvent,n)}return 2147483647<Number(t)?-1:y.setTimeout(n,t||0)}function On(n){n.g=Di(()=>{n.g=null,n.i&&(n.i=!1,On(n))},n.j);const t=n.h;n.h=null,n.m.apply(null,t)}pt(un,Wt),(R=un.prototype).da=!1,R.S=null,R.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ne(this,"tick"),this.da&&(Mi(this),this.start()))}},R.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},R.M=function(){un.Z.M.call(this),Mi(this),delete this.g};class Gn extends Dt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:On(this)}M(){super.M(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Sn(n){Dt.call(this),this.h=n,this.g={}}pt(Sn,Dt);var As=[];function Is(n,t,e,i){Array.isArray(e)||(e&&(As[0]=e.toString()),e=As);for(var r=0;r<e.length;r++){var a=fs(t,e[r],i||n.handleEvent,!1,n.h||n);if(!a)break;n.g[a.key]=a}}function Es(n){je(n.g,function(t,e){this.g.hasOwnProperty(e)&&Ti(t)},n),n.g={}}function Kn(){this.g=!0}function hn(n,t,e,i){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+function Nr(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e)for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var i=e[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var a=r[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var l=1;l<r.length;l++)r[l]=""}}}return Ci(e)}catch(u){return t}}(n,e)+(i?" "+i:"")})}Sn.prototype.M=function(){Sn.Z.M.call(this),Es(this)},Sn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kn.prototype.Aa=function(){this.g=!1},Kn.prototype.info=function(){};var Je={},Cs=null;function Yn(){return Cs=Cs||new Wt}function Os(n){ae.call(this,Je.Ma,n)}function kn(n){const t=Yn();ne(t,new Os(t,n))}function Ri(n,t){ae.call(this,Je.STAT_EVENT,n),this.stat=t}function le(n){const t=Yn();ne(t,new Ri(t,n))}function Ss(n,t){ae.call(this,Je.Na,n),this.size=t}function Mn(n,t){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){n()},t)}Je.Ma="serverreachability",pt(Os,ae),Je.STAT_EVENT="statevent",pt(Ri,ae),Je.Na="timingevent",pt(Ss,ae);var Hn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ks={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Li(){}function Ds(){}Li.prototype.h=null;var qi,Dn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ni(){ae.call(this,"d")}function Pi(){ae.call(this,"c")}function $n(){}function Ge(n,t,e,i){this.l=n,this.j=t,this.m=e,this.X=i||1,this.V=new Sn(this),this.P=Pr,this.W=new un(n=xe?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new $e}function $e(){this.i=null,this.g="",this.h=!1}pt(Ni,ae),pt(Pi,ae),pt($n,Li),$n.prototype.g=function(){return new XMLHttpRequest},$n.prototype.i=function(){return{}},qi=new $n;var Pr=45e3,p={},L={};function d(n,t,e){n.K=1,n.v=Ps(en(t)),n.s=e,n.U=!0,b(n,null)}function b(n,t){n.F=Date.now(),mt(n),n.A=en(n.v);var e=n.A,i=n.X;Array.isArray(i)||(i=[String(i)]),Ro(e.h,"t",i),n.C=0,e=n.l.H,n.h=new $e,n.g=pn(n.l,e?t:null,!n.s),0<n.O&&(n.L=new Gn(gt(n.Ia,n,n.g),n.O)),Is(n.V,n.g,"readystatechange",n.gb),t=n.H?ve(n.H):{},n.s?(n.u||(n.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,t)):(n.u="GET",n.g.ea(n.A,n.u,null,t)),kn(1),function Dr(n,t,e,i,r,a){n.info(function(){if(n.g)if(a)for(var l="",u=a.split("&"),h=0;h<u.length;h++){var m=u[h].split("=");if(1<m.length){var v=m[0];m=m[1];var x=v.split("_");l=2<=x.length&&"type"==x[1]?l+(v+"=")+m+"&":l+(v+"=redacted&")}}else l=null;else l=a;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+e+"\n"+l})}(n.j,n.u,n.A,n.m,n.X,n.s)}function I(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function G(n,t,e){let r,i=!0;for(;!n.I&&n.C<e.length;){if(r=_t(n,e),r==L){4==t&&(n.o=4,le(14),i=!1),hn(n.j,n.m,null,"[Incomplete Response]");break}if(r==p){n.o=4,le(15),hn(n.j,n.m,e,"[Invalid Chunk]"),i=!1;break}hn(n.j,n.m,r,null),Rn(n,r)}I(n)&&r!=L&&r!=p&&(n.h.g="",n.C=0),4!=t||0!=e.length||n.h.h||(n.o=1,le(16),i=!1),n.i=n.i&&i,i?0<e.length&&!n.aa&&(n.aa=!0,(t=n.l).g==n&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+e.length),sn(t),t.L=!0,le(11))):(hn(n.j,n.m,e,"[Invalid Chunked Response]"),tn(n),Xe(n))}function _t(n,t){var e=n.C,i=t.indexOf("\n",e);return-1==i?L:(e=Number(t.substring(e,i)),isNaN(e)?p:(i+=1)+e>t.length?L:(t=t.substr(i,e),n.C=i+e,t))}function mt(n){n.Y=Date.now()+n.P,ft(n,n.P)}function ft(n,t){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Mn(gt(n.eb,n),t)}function We(n){n.B&&(y.clearTimeout(n.B),n.B=null)}function Xe(n){0==n.l.G||n.I||Mt(n.l,n)}function tn(n){We(n);var t=n.L;t&&"function"==typeof t.na&&t.na(),n.L=null,Mi(n.W),Es(n.V),n.g&&(t=n.g,n.g=null,t.abort(),t.na())}function Rn(n,t){try{var e=n.l;if(0!=e.G&&(e.g==n||jr(e.i,n)))if(e.I=n.N,!n.J&&jr(e.i,n)&&3==e.G){try{var i=e.Ca.g.parse(t)}catch(m){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){t:if(!e.u){if(e.g){if(!(e.g.F+3e3<n.F))break t;De(e),wt(e)}nn(e),le(18)}}else e.ta=r[1],0<e.ta-e.U&&37500>r[2]&&e.N&&0==e.A&&!e.v&&(e.v=Mn(gt(e.ab,e),6e3));if(1>=Po(e.i)&&e.ka){try{e.ka()}catch(m){}e.ka=void 0}}else Ie(e,11)}else if((n.J||e.g==n)&&De(e),!ot(t))for(r=e.Ca.g.parse(t),t=0;t<r.length;t++){let m=r[t];if(e.U=m[0],m=m[1],2==e.G)if("c"==m[0]){e.J=m[1],e.la=m[2];const v=m[3];null!=v&&(e.ma=v,e.h.info("VER="+e.ma));const x=m[4];null!=x&&(e.za=x,e.h.info("SVER="+e.za));const O=m[5];null!=O&&"number"==typeof O&&0<O&&(e.K=i=1.5*O,e.h.info("backChannelRequestTimeoutMs_="+i)),i=e;const N=n.g;if(N){const q=N.g?N.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(q){var a=i.i;!a.g&&(Ct(q,"spdy")||Ct(q,"quic")||Ct(q,"h2"))&&(a.j=a.l,a.g=new Set,a.h&&(Fr(a,a.h),a.h=null))}if(i.D){const nt=N.g?N.g.getResponseHeader("X-HTTP-Session-Id"):null;nt&&(i.sa=nt,Ft(i.F,i.D,nt))}}e.G=3,e.j&&e.j.xa(),e.$&&(e.O=Date.now()-n.F,e.h.info("Handshake RTT: "+e.O+"ms"));var l=n;if((i=e).oa=gn(i,i.H?i.la:null,i.W),l.J){qo(i.i,l);var u=l,h=i.K;h&&u.setTimeout(h),u.B&&(We(u),mt(u)),i.g=l}else _n(i);0<e.l.length&&St(e)}else"stop"!=m[0]&&"close"!=m[0]||Ie(e,7);else 3==e.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?Ie(e,7):Lt(e):"noop"!=m[0]&&e.j&&e.j.wa(m),e.A=0)}kn(4)}catch(m){}}function qr(n,t){if(n.forEach&&"function"==typeof n.forEach)n.forEach(t,void 0);else if(V(n)||"string"==typeof n)Gt(n,t,void 0);else{if(n.T&&"function"==typeof n.T)var e=n.T();else if(n.R&&"function"==typeof n.R)e=void 0;else if(V(n)||"string"==typeof n){e=[];for(var i=n.length,r=0;r<i;r++)e.push(r)}else for(r in e=[],i=0,n)e[i++]=r;i=function Wn(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(V(n)){for(var t=[],e=n.length,i=0;i<e;i++)t.push(n[i]);return t}for(i in t=[],e=0,n)t[e++]=n[i];return t}(n),r=i.length;for(var a=0;a<r;a++)t.call(void 0,i[a],e&&e[a],n)}}function Xn(n,t){this.h={},this.g=[],this.i=0;var e=arguments.length;if(1<e){if(e%2)throw Error("Uneven number of arguments");for(var i=0;i<e;i+=2)this.set(arguments[i],arguments[i+1])}else if(n)if(n instanceof Xn)for(e=n.T(),i=0;i<e.length;i++)this.set(e[i],n.get(e[i]));else for(i in n)this.set(i,n[i])}function Zr(n){if(n.i!=n.g.length){for(var t=0,e=0;t<n.g.length;){var i=n.g[t];Ln(n.h,i)&&(n.g[e++]=i),t++}n.g.length=e}if(n.i!=n.g.length){var r={};for(e=t=0;t<n.g.length;)Ln(r,i=n.g[t])||(n.g[e++]=i,r[i]=1),t++;n.g.length=e}}function Ln(n,t){return Object.prototype.hasOwnProperty.call(n,t)}(R=Ge.prototype).setTimeout=function(n){this.P=n},R.gb=function(n){n=n.target;const t=this.L;t&&3==E(n)?t.l():this.Ia(n)},R.Ia=function(n){try{if(n==this.g)t:{const v=E(this.g);var t=this.g.Da();const x=this.g.ba();if(!(3>v)&&(3!=v||xe||this.g&&(this.h.h||this.g.ga()||S(this.g)))){this.I||4!=v||7==t||kn(8==t||0>=x?3:2),We(this);var e=this.g.ba();this.N=e;e:if(I(this)){var i=S(this.g);n="";var r=i.length,a=4==E(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tn(this),Xe(this);var l="";break e}this.h.i=new y.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,n+=this.h.i.decode(i[t],{stream:a&&t==r-1});i.splice(0,r),this.h.g+=n,this.C=0,l=this.h.g}else l=this.g.ga();if(this.i=200==e,function Rr(n,t,e,i,r,a,l){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+e+"\n"+a+" "+l})}(this.j,this.u,this.A,this.m,this.X,v,e),this.i){if(this.$&&!this.J){e:{if(this.g){var u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ot(u)){var m=u;break e}}m=null}if(!(e=m)){this.i=!1,this.o=3,le(12),tn(this),Xe(this);break t}hn(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Rn(this,e)}this.U?(G(this,v,l),xe&&this.i&&3==v&&(Is(this.V,this.W,"tick",this.fb),this.W.start())):(hn(this.j,this.m,l,null),Rn(this,l)),4==v&&tn(this),this.i&&!this.I&&(4==v?Mt(this.l,this):(this.i=!1,mt(this)))}else 400==e&&0<l.indexOf("Unknown SID")?(this.o=3,le(12)):(this.o=0,le(13)),tn(this),Xe(this)}}}catch(v){}},R.fb=function(){if(this.g){var n=E(this.g),t=this.g.ga();this.C<t.length&&(We(this),G(this,n,t),this.i&&4!=n&&mt(this))}},R.cancel=function(){this.I=!0,tn(this)},R.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function Lr(n,t){n.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(kn(3),le(17)),tn(this),this.o=2,Xe(this)):ft(this,this.Y-n)},(R=Xn.prototype).R=function(){Zr(this);for(var n=[],t=0;t<this.g.length;t++)n.push(this.h[this.g[t]]);return n},R.T=function(){return Zr(this),this.g.concat()},R.get=function(n,t){return Ln(this.h,n)?this.h[n]:t},R.set=function(n,t){Ln(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=t},R.forEach=function(n,t){for(var e=this.T(),i=0;i<e.length;i++){var r=e[i],a=this.get(r);n.call(t,a,r,this)}};var Oo=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Nn(n,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof Nn){this.g=void 0!==t?t:n.g,Rs(this,n.j),this.s=n.s,Ls(this,n.i),Ns(this,n.m),this.l=n.l,t=n.h;var e=new Fi;e.i=t.i,t.g&&(e.g=new Xn(t.g),e.h=t.h),So(this,e),this.o=n.o}else n&&(e=String(n).match(Oo))?(this.g=!!t,Rs(this,e[1]||"",!0),this.s=Zi(e[2]||""),Ls(this,e[3]||"",!0),Ns(this,e[4]),this.l=Zi(e[5]||"",!0),So(this,e[6]||"",!0),this.o=Zi(e[7]||"")):(this.g=!!t,this.h=new Fi(null,this.g))}function en(n){return new Nn(n)}function Rs(n,t,e){n.j=e?Zi(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function Ls(n,t,e){n.i=e?Zi(t,!0):t}function Ns(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function So(n,t,e){t instanceof Fi?(n.h=t,function ja(n,t){t&&!n.j&&(dn(n),n.i=null,n.g.forEach(function(e,i){var r=i.toLowerCase();i!=r&&(Mo(this,i),Ro(this,r,e))},n)),n.j=t}(n.h,n.g)):(e||(t=ji(t,qa)),n.h=new Fi(t,n.g))}function Ft(n,t,e){n.h.set(t,e)}function Ps(n){return Ft(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Zi(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function ji(n,t,e){return"string"==typeof n?(n=encodeURI(n).replace(t,La),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function La(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Nn.prototype.toString=function(){var n=[],t=this.j;t&&n.push(ji(t,ko,!0),":");var e=this.i;return(e||"file"==t)&&(n.push("//"),(t=this.s)&&n.push(ji(t,ko,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.m)&&n.push(":",String(e))),(e=this.l)&&(this.i&&"/"!=e.charAt(0)&&n.push("/"),n.push(ji(e,"/"==e.charAt(0)?Pa:Na,!0))),(e=this.h.toString())&&n.push("?",e),(e=this.o)&&n.push("#",ji(e,Za)),n.join("")};var ko=/[#\/\?@]/g,Na=/[#\?:]/g,Pa=/[#\?]/g,qa=/[#\?@]/g,Za=/#/g;function Fi(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function dn(n){n.g||(n.g=new Xn,n.h=0,n.i&&function Ma(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var i=n[e].indexOf("="),r=null;if(0<=i){var a=n[e].substring(0,i);r=n[e].substring(i+1)}else a=n[e];t(a,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Mo(n,t){dn(n),t=ti(n,t),Ln(n.g.h,t)&&(n.i=null,n.h-=n.g.get(t).length,Ln((n=n.g).h,t)&&(delete n.h[t],n.i--,n.g.length>2*n.i&&Zr(n)))}function Do(n,t){return dn(n),t=ti(n,t),Ln(n.g.h,t)}function Ro(n,t,e){Mo(n,t),0<e.length&&(n.i=null,n.g.set(ti(n,t),ct(e)),n.h+=e.length)}function ti(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function Lo(n){this.l=n||Ua,n=y.PerformanceNavigationTiming?0<(n=y.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(y.g&&y.g.Ea&&y.g.Ea()&&y.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(R=Fi.prototype).add=function(n,t){dn(this),this.i=null,n=ti(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this},R.forEach=function(n,t){dn(this),this.g.forEach(function(e,i){Gt(e,function(r){n.call(t,r,i,this)},this)},this)},R.T=function(){dn(this);for(var n=this.g.R(),t=this.g.T(),e=[],i=0;i<t.length;i++)for(var r=n[i],a=0;a<r.length;a++)e.push(t[i]);return e},R.R=function(n){dn(this);var t=[];if("string"==typeof n)Do(this,n)&&(t=Ne(t,this.g.get(ti(this,n))));else{n=this.g.R();for(var e=0;e<n.length;e++)t=Ne(t,n[e])}return t},R.set=function(n,t){return dn(this),this.i=null,Do(this,n=ti(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this},R.get=function(n,t){return n&&0<(n=this.R(n)).length?String(n[0]):t},R.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],t=this.g.T(),e=0;e<t.length;e++){var i=t[e],r=encodeURIComponent(String(i));i=this.R(i);for(var a=0;a<i.length;a++){var l=r;""!==i[a]&&(l+="="+encodeURIComponent(String(i[a]))),n.push(l)}}return this.i=n.join("&")};var Ua=10;function No(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Po(n){return n.h?1:n.g?n.g.size:0}function jr(n,t){return n.h?n.h==t:!!n.g&&n.g.has(t)}function Fr(n,t){n.g?n.g.add(t):n.h=t}function qo(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}function Zo(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let t=n.i;for(const e of n.g.values())t=t.concat(e.D);return t}return ct(n.i)}function Ur(){}function Qa(){this.g=new Ur}function Ba(n,t,e){const i=e||"";try{qr(n,function(r,a){let l=r;H(r)&&(l=Ci(r)),t.push(i+a+"="+encodeURIComponent(l))})}catch(r){throw t.push(i+"type="+encodeURIComponent("_badmap")),r}}function qs(n,t,e,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(a){}}function Ui(n){this.l=n.$b||null,this.j=n.ib||!1}function Zs(n,t){Wt.call(this),this.D=n,this.u=t,this.m=void 0,this.readyState=Qr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Lo.prototype.cancel=function(){if(this.i=Zo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},Ur.prototype.stringify=function(n){return y.JSON.stringify(n,void 0)},Ur.prototype.parse=function(n){return y.JSON.parse(n,void 0)},pt(Ui,Li),Ui.prototype.g=function(){return new Zs(this.l,this.j)},Ui.prototype.i=function(n){return function(){return n}}({}),pt(Zs,Wt);var Qr=0;function jo(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function Qi(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Bi(n)}function Bi(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(R=Zs.prototype).open=function(n,t){if(this.readyState!=Qr)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,Bi(this)},R.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.D||y).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},R.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Qi(this)),this.readyState=Qr},R.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Bi(this)),this.g&&(this.readyState=3,Bi(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==y.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;jo(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},R.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?Qi(this):Bi(this),3==this.readyState&&jo(this)}},R.Ua=function(n){this.g&&(this.response=this.responseText=n,Qi(this))},R.Ta=function(n){this.g&&(this.response=n,Qi(this))},R.ha=function(){this.g&&Qi(this)},R.setRequestHeader=function(n,t){this.v.append(n,t)},R.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},R.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],t=this.h.entries();for(var e=t.next();!e.done;)n.push((e=e.value)[0]+": "+e[1]),e=t.next();return n.join("\r\n")},Object.defineProperty(Zs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Va=y.JSON.parse;function Xt(n){Wt.call(this),this.headers=new Xn,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Fo,this.K=this.L=!1}pt(Xt,Wt);var Fo="",Ja=/^https?$/i,Ga=["POST","PUT"];function Ya(n){return"content-type"==n.toLowerCase()}function _(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,A(n),g(n)}function A(n){n.D||(n.D=!0,ne(n,"complete"),ne(n,"error"))}function c(n){if(n.h&&void 0!==j&&(!n.C[1]||4!=E(n)||2!=n.ba()))if(n.v&&4==E(n))Di(n.Fa,0,n);else if(ne(n,"readystatechange"),4==E(n)){n.h=!1;try{const u=n.ba();t:switch(u){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var i;if(i=0===u){var r=String(n.H).match(Oo)[1]||null;if(!r&&y.self&&y.self.location){var a=y.self.location.protocol;r=a.substr(0,a.length-1)}i=!Ja.test(r?r.toLowerCase():"")}e=i}if(e)ne(n,"complete"),ne(n,"success");else{n.m=6;try{var l=2<E(n)?n.g.statusText:""}catch(h){l=""}n.j=l+" ["+n.ba()+"]",A(n)}}finally{g(n)}}}function g(n,t){if(n.g){f(n);const e=n.g,i=n.C[0]?T:null;n.g=null,n.C=null,t||ne(n,"ready");try{e.onreadystatechange=i}catch(r){}}}function f(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(y.clearTimeout(n.A),n.A=null)}function E(n){return n.g?n.g.readyState:0}function S(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Fo:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(t){return null}}function at(n,t,e){t:{for(i in e){var i=!1;break t}i=!0}i||(e=function F(n){let t="";return je(n,function(e,i){t+=i,t+=":",t+=e,t+="\r\n"}),t}(e),"string"==typeof n?null!=e&&encodeURIComponent(String(e)):Ft(n,t,e))}function lt(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function bt(n){this.za=0,this.l=[],this.h=new Kn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=lt("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=lt("baseRetryDelayMs",5e3,n),this.$a=lt("retryDelaySeedMs",1e4,n),this.Ya=lt("forwardChannelMaxRetries",2,n),this.ra=lt("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new Lo(n&&n.concurrentRequestLimit),this.Ca=new Qa,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function Lt(n){if(Nt(n),3==n.G){var t=n.V++,e=en(n.F);Ft(e,"SID",n.J),Ft(e,"RID",t),Ft(e,"TYPE","terminate"),Pe(n,e),(t=new Ge(n,n.h,t,void 0)).K=2,t.v=Ps(en(e)),e=!1,y.navigator&&y.navigator.sendBeacon&&(e=y.navigator.sendBeacon(t.v.toString(),"")),!e&&y.Image&&((new Image).src=t.v,e=!0),e||(t.g=pn(t.l,null),t.g.ea(t.v)),t.F=Date.now(),mt(t)}Pt(n)}function wt(n){n.g&&(sn(n),n.g.cancel(),n.g=null)}function Nt(n){wt(n),n.u&&(y.clearTimeout(n.u),n.u=null),De(n),n.i.cancel(),n.m&&("number"==typeof n.m&&y.clearTimeout(n.m),n.m=null)}function kt(n,t){n.l.push(new class{constructor(n,t){this.h=n,this.g=t}}(n.Za++,t)),3==n.G&&St(n)}function St(n){No(n.i)||n.m||(n.m=!0,Oi(n.Ha,n),n.C=0)}function ce(n,t){var e;e=t?t.m:n.V++;const i=en(n.F);Ft(i,"SID",n.J),Ft(i,"RID",e),Ft(i,"AID",n.U),Pe(n,i),n.o&&n.s&&at(i,n.o,n.s),e=new Ge(n,n.h,e,n.C+1),null===n.o&&(e.H=n.s),t&&(n.l=t.D.concat(n.l)),t=Ke(n,e,1e3),e.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),Fr(n.i,e),d(e,i,t)}function Pe(n,t){n.j&&qr({},function(e,i){Ft(t,i,e)})}function Ke(n,t,e){e=Math.min(n.l.length,e);var i=n.j?gt(n.j.Oa,n.j,n):null;t:{var r=n.l;let a=-1;for(;;){const l=["count="+e];-1==a?0<e?(a=r[0].h,l.push("ofs="+a)):a=0:l.push("ofs="+a);let u=!0;for(let h=0;h<e;h++){let m=r[h].h;const v=r[h].g;if(m-=a,0>m)a=Math.max(0,r[h].h-100),u=!1;else try{Ba(v,l,"req"+m+"_")}catch(x){i&&i(v)}}if(u){i=l.join("&");break t}}}return n=n.l.splice(0,e),t.D=n,i}function _n(n){n.g||n.u||(n.Y=1,Oi(n.Ga,n),n.A=0)}function nn(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=Mn(gt(n.Ga,n),rn(n,n.A)),n.A++,0))}function sn(n){null!=n.B&&(y.clearTimeout(n.B),n.B=null)}function mn(n){n.g=new Ge(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var t=en(n.oa);Ft(t,"RID","rpc"),Ft(t,"SID",n.J),Ft(t,"CI",n.N?"0":"1"),Ft(t,"AID",n.U),Pe(n,t),Ft(t,"TYPE","xmlhttp"),n.o&&n.s&&at(t,n.o,n.s),n.K&&n.g.setTimeout(n.K);var e=n.g;n=n.la,e.K=1,e.v=Ps(en(t)),e.s=null,e.U=!0,b(e,n)}function De(n){null!=n.v&&(y.clearTimeout(n.v),n.v=null)}function Mt(n,t){var e=null;if(n.g==t){De(n),sn(n),n.g=null;var i=2}else{if(!jr(n.i,t))return;e=t.D,qo(n.i,t),i=1}if(n.I=t.N,0!=n.G)if(t.i)if(1==i){e=t.s?t.s.length:0,t=Date.now()-t.F;var r=n.C;ne(i=Yn(),new Ss(i,e,t,r)),St(n)}else _n(n);else if(3==(r=t.o)||0==r&&0<n.I||!(1==i&&function Ot(n,t){return!(Po(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=t.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=Mn(gt(n.Ha,n,t),rn(n,n.C)),n.C++,0)))}(n,t)||2==i&&nn(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),r){case 1:Ie(n,5);break;case 4:Ie(n,10);break;case 3:Ie(n,6);break;default:Ie(n,2)}}function rn(n,t){let e=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(e*=2),e*t}function Ie(n,t){if(n.h.info("Error code "+t),2==t){var e=null;n.j&&(e=null);var i=gt(n.jb,n);e||(e=new Nn("//www.google.com/images/cleardot.gif"),y.location&&"http"==y.location.protocol||Rs(e,"https"),Ps(e)),function za(n,t){const e=new Kn;if(y.Image){const i=new Image;i.onload=Et(qs,e,i,"TestLoadImage: loaded",!0,t),i.onerror=Et(qs,e,i,"TestLoadImage: error",!1,t),i.onabort=Et(qs,e,i,"TestLoadImage: abort",!1,t),i.ontimeout=Et(qs,e,i,"TestLoadImage: timeout",!1,t),y.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else t(!1)}(e.toString(),i)}else le(2);n.G=0,n.j&&n.j.va(t),Pt(n),Nt(n)}function Pt(n){n.G=0,n.I=-1,n.j&&((0!=Zo(n.i).length||0!=n.l.length)&&(n.i.i.length=0,ct(n.l),n.l.length=0),n.j.ua())}function gn(n,t,e){let i=function Da(n){return n instanceof Nn?en(n):new Nn(n,void 0)}(e);if(""!=i.i)t&&Ls(i,t+"."+i.i),Ns(i,i.m);else{const r=y.location;i=function Ra(n,t,e,i){var r=new Nn(null,void 0);return n&&Rs(r,n),t&&Ls(r,t),e&&Ns(r,e),i&&(r.l=i),r}(r.protocol,t?t+"."+r.hostname:r.hostname,+r.port,e)}return n.aa&&je(n.aa,function(r,a){Ft(i,a,r)}),e=n.sa,(t=n.D)&&e&&Ft(i,t,e),Ft(i,"VER",n.ma),Pe(n,i),i}function pn(n,t,e){if(t&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Xt(e&&n.Ba&&!n.qa?new Ui({ib:!0}):n.qa)).L=n.H,t}function Pn(){}function on(){if(cn&&!(10<=Number(yr)))throw Error("Environmental error: no available transport.")}function ie(n,t){Wt.call(this),this.g=new bt(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(n?n["X-WebChannel-Client-Profile"]=t.ya:n={"X-WebChannel-Client-Profile":t.ya}),this.g.P=n,(n=t&&t.httpHeadersOverwriteParam)&&!ot(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!ot(t)&&(this.g.D=t,null!==(n=this.h)&&t in n&&t in(n=this.h)&&delete n[t]),this.j=new Ee(this)}function ei(n){Ni.call(this);var t=n.__sm__;if(t){t:{for(const e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=null!==t&&n in t?t[n]:void 0),this.data=t}else this.data=n}function fn(){Pi.call(this),this.status=1}function Ee(n){this.g=n}(R=Xt.prototype).ea=function(n,t,e,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);t=t?t.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():qi.g(),this.C=function Ms(n){return n.h||(n.h=n.i())}(this.u?this.u:qi),this.g.onreadystatechange=gt(this.Fa,this);try{this.F=!0,this.g.open(t,String(n),!0),this.F=!1}catch(a){return void _(this,a)}n=e||"";const r=new Xn(this.headers);i&&qr(i,function(a,l){r.set(l,a)}),i=function de(n){t:{var t=Ya;const e=n.length,i="string"==typeof n?n.split(""):n;for(let r=0;r<e;r++)if(r in i&&t.call(void 0,i[r],r,n)){t=r;break t}t=-1}return 0>t?null:"string"==typeof n?n.charAt(t):n[t]}(r.T()),e=y.FormData&&n instanceof y.FormData,!(0<=Bt(Ga,t))||i||e||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach(function(a,l){this.g.setRequestHeader(l,a)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{f(this),0<this.B&&((this.K=function Ka(n){return cn&&function xr(){return function ds(n){var t=vr;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=n(9)}(function(){let n=0;const t=Rt(String(Un)).split("."),e=Rt("9").split("."),i=Math.max(t.length,e.length);for(let l=0;0==n&&l<i;l++){var r=t[l]||"",a=e[l]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==r[0].length&&0==a[0].length)break;n=Ae(0==r[1].length?0:parseInt(r[1],10),0==a[1].length?0:parseInt(a[1],10))||Ae(0==r[2].length,0==a[2].length)||Ae(r[2],a[2]),r=r[3],a=a[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=gt(this.pa,this)):this.A=Di(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(a){_(this,a)}},R.pa=function(){void 0!==j&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ne(this,"timeout"),this.abort(8))},R.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ne(this,"complete"),ne(this,"abort"),g(this))},R.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),g(this,!0)),Xt.Z.M.call(this)},R.Fa=function(){this.s||(this.F||this.v||this.l?c(this):this.cb())},R.cb=function(){c(this)},R.ba=function(){try{return 2<E(this)?this.g.status:-1}catch(n){return-1}},R.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},R.Qa=function(n){if(this.g){var t=this.g.responseText;return n&&0==t.indexOf(n)&&(t=t.substring(n.length)),Va(t)}},R.Da=function(){return this.m},R.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(R=bt.prototype).ma=8,R.G=1,R.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(t){}},R.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const r=new Ge(this,this.h,n,void 0);let a=this.s;if(this.P&&(a?(a=ve(a),hs(a,this.P)):a=this.P),null===this.o&&(r.H=a),this.ja)t:{for(var t=0,e=0;e<this.l.length;e++){var i=this.l[e];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=e;break t}if(4096===t||e===this.l.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=Ke(this,r,t),Ft(e=en(this.F),"RID",n),Ft(e,"CVER",22),this.D&&Ft(e,"X-HTTP-Session-Id",this.D),Pe(this,e),this.o&&a&&at(e,this.o,a),Fr(this.i,r),this.Ra&&Ft(e,"TYPE","init"),this.ja?(Ft(e,"$req",t),Ft(e,"SID","null"),r.$=!0,d(r,e,null)):d(r,e,t),this.G=2}}else 3==this.G&&(n?ce(this,n):0==this.l.length||No(this.i)||ce(this))},R.Ga=function(){if(this.u=null,mn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Mn(gt(this.bb,this),n)}},R.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,le(10),wt(this),mn(this))},R.ab=function(){null!=this.v&&(this.v=null,wt(this),nn(this),le(19))},R.jb=function(n){n?(this.h.info("Successfully pinged google.com"),le(2)):(this.h.info("Failed to ping google.com"),le(1))},(R=Pn.prototype).xa=function(){},R.wa=function(){},R.va=function(){},R.ua=function(){},R.Oa=function(){},on.prototype.g=function(n,t){return new ie(n,t)},pt(ie,Wt),ie.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,t=this.l,e=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),Oi(gt(n.hb,n,t))),le(0),n.W=t,n.aa=e||{},n.N=n.X,n.F=gn(n,null,n.W),St(n)},ie.prototype.close=function(){Lt(this.g)},ie.prototype.u=function(n){if("string"==typeof n){var t={};t.__data__=n,kt(this.g,t)}else this.v?((t={}).__data__=Ci(n),kt(this.g,t)):kt(this.g,n)},ie.prototype.M=function(){this.g.j=null,delete this.j,Lt(this.g),delete this.g,ie.Z.M.call(this)},pt(ei,Ni),pt(fn,Pi),pt(Ee,Pn),Ee.prototype.xa=function(){ne(this.g,"a")},Ee.prototype.wa=function(n){ne(this.g,new ei(n))},Ee.prototype.va=function(n){ne(this.g,new fn(n))},Ee.prototype.ua=function(){ne(this.g,"b")},on.prototype.createWebChannel=on.prototype.g,ie.prototype.send=ie.prototype.u,ie.prototype.open=ie.prototype.m,ie.prototype.close=ie.prototype.close,Hn.NO_ERROR=0,Hn.TIMEOUT=8,Hn.HTTP_ERROR=6,ks.COMPLETE="complete",Ds.EventType=Dn,Dn.OPEN="a",Dn.CLOSE="b",Dn.ERROR="c",Dn.MESSAGE="d",Wt.prototype.listen=Wt.prototype.N,Xt.prototype.listenOnce=Xt.prototype.O,Xt.prototype.getLastError=Xt.prototype.La,Xt.prototype.getLastErrorCode=Xt.prototype.Da,Xt.prototype.getStatus=Xt.prototype.ba,Xt.prototype.getResponseJson=Xt.prototype.Qa,Xt.prototype.getResponseText=Xt.prototype.ga,Xt.prototype.send=Xt.prototype.ea;var Ye=z.createWebChannelTransport=function(){return new on},Uo=z.getStatEventTarget=function(){return Yn()},js=z.ErrorCode=Hn,Qo=z.EventType=ks,ni=z.Event=Je,Fs=z.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Bo=z.FetchXmlHttpFactory=Ui,qn=z.WebChannel=Ds,an=z.XhrIo=Xt;const Br="@firebase/firestore";class se{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}se.UNAUTHENTICATED=new se(null),se.GOOGLE_CREDENTIALS=new se("google-credentials-uid"),se.FIRST_PARTY=new se("first-party-uid"),se.MOCK_USER=new se("mock-user");let vn="9.8.4";const qe=new Q.Yd("@firebase/firestore");function xn(){return qe.logLevel}function U(n,...t){if(qe.logLevel<=Q.in.DEBUG){const e=t.map($a);qe.debug(`Firestore (${vn}): ${n}`,...e)}}function Kt(n,...t){if(qe.logLevel<=Q.in.ERROR){const e=t.map($a);qe.error(`Firestore (${vn}): ${n}`,...e)}}function zo(n,...t){if(qe.logLevel<=Q.in.WARN){const e=t.map($a);qe.warn(`Firestore (${vn}): ${n}`,...e)}}function $a(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(e){return n}}function st(n="Unexpected state"){const t=`FIRESTORE (${vn}) INTERNAL ASSERTION FAILED: `+n;throw Kt(t),new Error(t)}function dt(n,t){n||st()}function X(n,t){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends P.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ye{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Hc{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Xd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(se.UNAUTHENTICATED))}shutdown(){}}class e_{constructor(t){this.t=t,this.currentUser=se.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){var i=this;let r=this.i;const a=m=>this.i!==r?(r=this.i,e(m)):Promise.resolve();let l=new ye;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new ye,t.enqueueRetryable(()=>a(this.currentUser))};const u=()=>{const m=l;t.enqueueRetryable((0,C.Z)(function*(){yield m.promise,yield a(i.currentUser)}))},h=m=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(m=>h(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?h(m):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new ye)}},0),u()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(i=>this.i!==t?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(dt("string"==typeof i.accessToken),new Hc(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return dt(null===t||"string"==typeof t),new se(t)}}class n_{constructor(t,e,i){this.type="FirstParty",this.user=se.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const r=t.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),i&&this.headers.set("X-Goog-Iam-Authorization-Token",i)}}class i_{constructor(t,e,i){this.h=t,this.l=e,this.m=i}getToken(){return Promise.resolve(new n_(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable(()=>e(se.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class $c{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class s_{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const i=a=>{null!=a.error&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const l=a.token!==this.p;return this.p=a.token,U("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?e(a.token):Promise.resolve()};this.o=a=>{t.enqueueRetryable(()=>i(a))};const r=a=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.appCheck.addTokenListener(this.o)};this.g.onInit(a=>r(a)),setTimeout(()=>{if(!this.appCheck){const a=this.g.getImmediate({optional:!0});a?r(a):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(dt("string"==typeof e.token),this.p=e.token,new $c(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function r_(n){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(let i=0;i<n;i++)e[i]=Math.floor(256*Math.random());return e}class Wc{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let i="";for(;i.length<20;){const r=r_(40);for(let a=0;a<r.length;++a)i.length<20&&r[a]<e&&(i+=t.charAt(r[a]%t.length))}return i}}function vt(n,t){return n<t?-1:n>t?1:0}function Us(n,t,e){return n.length===t.length&&n.every((i,r)=>e(i,t[r]))}class Yt{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new B(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new B(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new B(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new B(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Yt.fromMillis(Date.now())}static fromDate(t){return Yt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new Yt(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?vt(this.nanoseconds,t.nanoseconds):vt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ht{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ht(t)}static min(){return new ht(new Yt(0,0))}static max(){return new ht(new Yt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class zr{constructor(t,e,i){void 0===e?e=0:e>t.length&&st(),void 0===i?i=t.length-e:i>t.length-e&&st(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return 0===zr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof zr?t.forEach(i=>{e.push(i)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let r=0;r<i;r++){const a=t.get(r),l=e.get(r);if(a<l)return-1;if(a>l)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Tt extends zr{construct(t,e,i){return new Tt(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new B(D.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter(r=>r.length>0))}return new Tt(e)}static emptyPath(){return new Tt([])}}const o_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends zr{construct(t,e,i){return new ue(t,e,i)}static isValidIdentifier(t){return o_.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(t){const e=[];let i="",r=0;const a=()=>{if(0===i.length)throw new B(D.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""};let l=!1;for(;r<t.length;){const u=t[r];if("\\"===u){if(r+1===t.length)throw new B(D.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[r+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new B(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=h,r+=2}else"`"===u?(l=!l,r++):"."!==u||l?(i+=u,r++):(a(),r++)}if(a(),l)throw new B(D.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ue(e)}static emptyPath(){return new ue([])}}class ${constructor(t){this.path=t}static fromPath(t){return new $(Tt.fromString(t))}static fromName(t){return new $(Tt.fromString(t).popFirst(5))}static empty(){return new $(Tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Tt.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Tt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new $(new Tt(t.slice()))}}function eu(n){return new ze(n.readTime,n.key,-1)}class ze{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new ze(ht.min(),$.empty(),-1)}static max(){return new ze(ht.max(),$.empty(),-1)}}function Xa(n,t){let e=n.readTime.compareTo(t.readTime);return 0!==e?e:(e=$.comparator(n.documentKey,t.documentKey),0!==e?e:vt(n.largestBatchId,t.largestBatchId))}const nu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";function ii(n){return tl.apply(this,arguments)}function tl(){return tl=(0,C.Z)(function*(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==nu)throw n;U("LocalStore","Unexpectedly lost primary lease")}),tl.apply(this,arguments)}class k{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&st(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new k((i,r)=>{this.nextCallback=a=>{this.wrapSuccess(t,a).next(i,r)},this.catchCallback=a=>{this.wrapFailure(e,a).next(i,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof k?e:k.resolve(e)}catch(e){return k.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):k.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):k.reject(e)}static resolve(t){return new k((e,i)=>{e(t)})}static reject(t){return new k((e,i)=>{i(t)})}static waitFor(t){return new k((e,i)=>{let r=0,a=0,l=!1;t.forEach(u=>{++r,u.next(()=>{++a,l&&a===r&&e()},h=>i(h))}),l=!0,a===r&&e()})}static or(t){let e=k.resolve(!1);for(const i of t)e=e.next(r=>r?k.resolve(r):i());return e}static forEach(t,e){const i=[];return t.forEach((r,a)=>{i.push(e.call(this,r,a))}),this.waitFor(i)}static mapArray(t,e){return new k((i,r)=>{const a=t.length,l=new Array(a);let u=0;for(let h=0;h<a;h++){const m=h;e(t[m]).next(v=>{l[m]=v,++u,u===a&&i(l)},v=>r(v))}})}static doWhile(t,e){return new k((i,r)=>{const a=()=>{!0===t()?e().next(()=>{a()},r):i()};a()})}}function si(n){return"IndexedDbTransactionError"===n.name}class Fe{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=i=>this.it(i),this.rt=i=>e.writeSequenceNumber(i))}it(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.rt&&this.rt(t),t}}function su(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Ji(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function ru(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}Fe.ot=-1;class te{constructor(t,e){this.comparator=t,this.root=e||Ce.EMPTY}insert(t,e){return new te(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ce.BLACK,null,null))}remove(t){return new te(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ce.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(0===i)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(t,i.key);if(0===r)return e+i.left.size;r<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,i)=>(t(e,i),!1))}toString(){const t=[];return this.inorderTraversal((e,i)=>(t.push(`${e}:${i}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ko(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ko(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ko(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ko(this.root,t,this.comparator,!0)}}class Ko{constructor(t,e,i,r){this.isReverse=r,this.nodeStack=[];let a=1;for(;!t.isEmpty();)if(a=e?i(t.key,e):1,e&&r&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ce{constructor(t,e,i,r,a){this.key=t,this.value=e,this.color=null!=i?i:Ce.RED,this.left=null!=r?r:Ce.EMPTY,this.right=null!=a?a:Ce.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,r,a){return new Ce(null!=t?t:this.key,null!=e?e:this.value,null!=i?i:this.color,null!=r?r:this.left,null!=a?a:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let r=this;const a=i(t,r.key);return r=a<0?r.copy(null,null,null,r.left.insert(t,e,i),null):0===a?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ce.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Ce.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw st();const t=this.left.check();if(t!==this.right.check())throw st();return t+(this.isRed()?0:1)}}Ce.EMPTY=null,Ce.RED=!0,Ce.BLACK=!1,Ce.EMPTY=new class{constructor(){this.size=0}get key(){throw st()}get value(){throw st()}get color(){throw st()}get left(){throw st()}get right(){throw st()}copy(n,t,e,i,r){return this}insert(n,t,e){return new Ce(n,t)}remove(n,t){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Zt{constructor(t){this.comparator=t,this.data=new te(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,i)=>(t(e),!1))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let i;for(i=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ou(this.data.getIterator())}getIteratorFrom(t){return new ou(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(i=>{e=e.add(i)}),e}isEqual(t){if(!(t instanceof Zt)||this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const r=e.getNext().key,a=i.getNext().key;if(0!==this.comparator(r,a))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Zt(this.comparator);return e.data=t,e}}class ou{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ve{constructor(t){this.fields=t,t.sort(ue.comparator)}static empty(){return new Ve([])}unionWith(t){let e=new Zt(ue.comparator);for(const i of this.fields)e=e.add(i);for(const i of t)e=e.add(i);return new Ve(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Us(this.fields,t.fields,(e,i)=>e.isEqual(i))}}class me{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new me(e)}static fromUint8Array(t){const e=function(i){let r="";for(let a=0;a<i.length;++a)r+=String.fromCharCode(i[a]);return r}(t);return new me(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return vt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}me.EMPTY_BYTE_STRING=new me("");const d_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ri(n){if(dt(!!n),"string"==typeof n){let t=0;const e=d_.exec(n);if(dt(!!e),e[1]){let r=e[1];r=(r+"000000000").substr(0,9),t=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Gi(n){return"string"==typeof n?me.fromBase64String(n):me.fromUint8Array(n)}function nl(n){var t,e;return"server_timestamp"===(null===(e=((null===(t=null==n?void 0:n.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function au(n){const t=n.mapValue.fields.__previous_value__;return nl(t)?au(t):t}function Gr(n){const t=ri(n.mapValue.fields.__local_write_time__.timestampValue);return new Yt(t.seconds,t.nanos)}class __{constructor(t,e,i,r,a,l,u,h){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=r,this.ssl=a,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.useFetchStreams=h}}class oi{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new oi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof oi&&t.projectId===this.projectId&&t.database===this.database}}function Kr(n){return null==n}function Yr(n){return 0===n&&1/n==-1/0}const ai_mapValue={fields:{__type__:{stringValue:"__max__"}}};function Ki(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?nl(n)?4:du(n)?9007199254740991:10:st()}function yn(n,t){if(n===t)return!0;const e=Ki(n);if(e!==Ki(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Gr(n).isEqual(Gr(t));case 3:return function(i,r){if("string"==typeof i.timestampValue&&"string"==typeof r.timestampValue&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const a=ri(i.timestampValue),l=ri(r.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return r=t,Gi(n.bytesValue).isEqual(Gi(r.bytesValue));case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,r){return ee(i.geoPointValue.latitude)===ee(r.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(r.geoPointValue.longitude)}(n,t);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return ee(i.integerValue)===ee(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const a=ee(i.doubleValue),l=ee(r.doubleValue);return a===l?Yr(a)===Yr(l):isNaN(a)&&isNaN(l)}return!1}(n,t);case 9:return Us(n.arrayValue.values||[],t.arrayValue.values||[],yn);case 10:return function(i,r){const a=i.mapValue.fields||{},l=r.mapValue.fields||{};if(su(a)!==su(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(void 0===l[u]||!yn(a[u],l[u])))return!1;return!0}(n,t);default:return st()}var r}function Hr(n,t){return void 0!==(n.values||[]).find(e=>yn(e,t))}function li(n,t){if(n===t)return 0;const e=Ki(n),i=Ki(t);if(e!==i)return vt(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return vt(n.booleanValue,t.booleanValue);case 2:return function(r,a){const l=ee(r.integerValue||r.doubleValue),u=ee(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(n,t);case 3:return cu(n.timestampValue,t.timestampValue);case 4:return cu(Gr(n),Gr(t));case 5:return vt(n.stringValue,t.stringValue);case 6:return function(r,a){const l=Gi(r),u=Gi(a);return l.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(r,a){const l=r.split("/"),u=a.split("/");for(let h=0;h<l.length&&h<u.length;h++){const m=vt(l[h],u[h]);if(0!==m)return m}return vt(l.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(r,a){const l=vt(ee(r.latitude),ee(a.latitude));return 0!==l?l:vt(ee(r.longitude),ee(a.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(r,a){const l=r.values||[],u=a.values||[];for(let h=0;h<l.length&&h<u.length;++h){const m=li(l[h],u[h]);if(m)return m}return vt(l.length,u.length)}(n.arrayValue,t.arrayValue);case 10:return function(r,a){if(r===ai_mapValue&&a===ai_mapValue)return 0;if(r===ai_mapValue)return 1;if(a===ai_mapValue)return-1;const l=r.fields||{},u=Object.keys(l),h=a.fields||{},m=Object.keys(h);u.sort(),m.sort();for(let v=0;v<u.length&&v<m.length;++v){const x=vt(u[v],m[v]);if(0!==x)return x;const O=li(l[u[v]],h[m[v]]);if(0!==O)return O}return vt(u.length,m.length)}(n.mapValue,t.mapValue);default:throw st()}}function cu(n,t){if("string"==typeof n&&"string"==typeof t&&n.length===t.length)return vt(n,t);const e=ri(n),i=ri(t),r=vt(e.seconds,i.seconds);return 0!==r?r:vt(e.nanos,i.nanos)}function Bs(n){return il(n)}function il(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const r=ri(i);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Gi(n.bytesValue).toBase64():"referenceValue"in n?$.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(t=n.geoPointValue).latitude},${t.longitude})`:"arrayValue"in n?function(i){let r="[",a=!0;for(const l of i.values||[])a?a=!1:r+=",",r+=il(l);return r+"]"}(n.arrayValue):"mapValue"in n?function(i){const r=Object.keys(i.fields||{}).sort();let a="{",l=!0;for(const u of r)l?l=!1:a+=",",a+=`${u}:${il(i.fields[u])}`;return a+"}"}(n.mapValue):st();var t}function Yi(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function sl(n){return!!n&&"integerValue"in n}function $r(n){return!!n&&"arrayValue"in n}function uu(n){return!!n&&"nullValue"in n}function hu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ho(n){return!!n&&"mapValue"in n}function Wr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Ji(n.mapValue.fields,(e,i)=>t.mapValue.fields[e]=Wr(i)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Wr(n.arrayValue.values[e]);return t}return Object.assign({},n)}function du(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}class Oe{constructor(t){this.value=t}static empty(){return new Oe({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!Ho(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Wr(e)}setAll(t){let e=ue.emptyPath(),i={},r=[];t.forEach((l,u)=>{if(!e.isImmediateParentOf(u)){const h=this.getFieldsMap(e);this.applyChanges(h,i,r),i={},r=[],e=u.popLast()}l?i[u.lastSegment()]=Wr(l):r.push(u.lastSegment())});const a=this.getFieldsMap(e);this.applyChanges(a,i,r)}delete(t){const e=this.field(t.popLast());Ho(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return yn(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let r=e.mapValue.fields[t.get(i)];Ho(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,i){Ji(e,(r,a)=>t[r]=a);for(const r of i)delete t[r]}clone(){return new Oe(Wr(this.value))}}function gu(n){const t=[];return Ji(n.fields,(e,i)=>{const r=new ue([e]);if(Ho(i)){const a=gu(i.mapValue).fields;if(0===a.length)t.push(r);else for(const l of a)t.push(r.child(l))}else t.push(r)}),new Ve(t)}class Ut{constructor(t,e,i,r,a,l){this.key=t,this.documentType=e,this.version=i,this.readTime=r,this.data=a,this.documentState=l}static newInvalidDocument(t){return new Ut(t,0,ht.min(),ht.min(),Oe.empty(),0)}static newFoundDocument(t,e,i){return new Ut(t,1,e,ht.min(),i,0)}static newNoDocument(t,e){return new Ut(t,2,e,ht.min(),Oe.empty(),0)}static newUnknownDocument(t,e){return new Ut(t,3,e,ht.min(),Oe.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ht.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ut&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ut(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class p_{constructor(t,e=null,i=[],r=[],a=null,l=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=r,this.limit=a,this.startAt=l,this.endAt=u,this.ut=null}}function pu(n,t=null,e=[],i=[],r=null,a=null,l=null){return new p_(n,t,e,i,r,a,l)}function Hi(n){const t=X(n);if(null===t.ut){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(i=>{return(r=i).field.canonicalString()+r.op.toString()+Bs(r.value);var r}).join(","),e+="|ob:",e+=t.orderBy.map(i=>{return(r=i).field.canonicalString()+r.dir;var r}).join(","),Kr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>Bs(i)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>Bs(i)).join(",")),t.ut=e}return t.ut}function Xr(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<n.orderBy.length;r++)if(!I_(n.orderBy[r],t.orderBy[r]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let r=0;r<n.filters.length;r++)if((e=n.filters[r]).op!==(i=t.filters[r]).op||!e.field.isEqual(i.field)||!yn(e.value,i.value))return!1;var e,i;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!wu(n.startAt,t.startAt)&&wu(n.endAt,t.endAt)}function $o(n){return $.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class Se extends class{}{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?"in"===e||"not-in"===e?this.ct(t,e,i):new v_(t,e,i):"array-contains"===e?new w_(t,i):"in"===e?new b_(t,i):"not-in"===e?new T_(t,i):"array-contains-any"===e?new A_(t,i):new Se(t,e,i)}static ct(t,e,i){return"in"===e?new x_(t,i):new y_(t,i)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.at(li(e,this.value)):null!==e&&Ki(this.value)===Ki(e)&&this.at(li(e,this.value))}at(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return st()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class v_ extends Se{constructor(t,e,i){super(t,e,i),this.key=$.fromName(i.referenceValue)}matches(t){const e=$.comparator(t.key,this.key);return this.at(e)}}class x_ extends Se{constructor(t,e){super(t,"in",e),this.keys=xu(0,e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class y_ extends Se{constructor(t,e){super(t,"not-in",e),this.keys=xu(0,e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function xu(n,t){var e;return((null===(e=t.arrayValue)||void 0===e?void 0:e.values)||[]).map(i=>$.fromName(i.referenceValue))}class w_ extends Se{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return $r(e)&&Hr(e.arrayValue,this.value)}}class b_ extends Se{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Hr(this.value.arrayValue,e)}}class T_ extends Se{constructor(t,e){super(t,"not-in",e)}matches(t){if(Hr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Hr(this.value.arrayValue,e)}}class A_ extends Se{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!$r(e)||!e.arrayValue.values)&&e.arrayValue.values.some(i=>Hr(this.value.arrayValue,i))}}class ci{constructor(t,e){this.position=t,this.inclusive=e}}class zs{constructor(t,e="asc"){this.field=t,this.dir=e}}function I_(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}function yu(n,t,e){let i=0;for(let r=0;r<n.position.length;r++){const a=t[r],l=n.position[r];if(i=a.field.isKeyField()?$.comparator($.fromName(l.referenceValue),e.key):li(l,e.data.field(a.field)),"desc"===a.dir&&(i*=-1),0!==i)break}return i}function wu(n,t){if(null===n)return null===t;if(null===t||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!yn(n.position[e],t.position[e]))return!1;return!0}class Zn{constructor(t,e=null,i=[],r=[],a=null,l="F",u=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=r,this.limit=a,this.limitType=l,this.startAt=u,this.endAt=h,this.lt=null,this.ft=null}}function Vs(n){return new Zn(n)}function rl(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function ol(n){for(const t of n.filters)if(t.ht())return t.field;return null}function al(n){return null!==n.collectionGroup}function Js(n){const t=X(n);if(null===t.lt){t.lt=[];const e=ol(t),i=rl(t);if(null!==e&&null===i)e.isKeyField()||t.lt.push(new zs(e)),t.lt.push(new zs(ue.keyField(),"asc"));else{let r=!1;for(const a of t.explicitOrderBy)t.lt.push(a),a.field.isKeyField()&&(r=!0);if(!r){const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.lt.push(new zs(ue.keyField(),a))}}}return t.lt}function He(n){const t=X(n);if(!t.ft)if("F"===t.limitType)t.ft=pu(t.path,t.collectionGroup,Js(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const a of Js(t))e.push(new zs(a.field,"desc"===a.dir?"asc":"desc"));const i=t.endAt?new ci(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new ci(t.startAt.position,t.startAt.inclusive):null;t.ft=pu(t.path,t.collectionGroup,e,t.filters,t.limit,i,r)}return t.ft}function to(n,t){return Xr(He(n),He(t))&&n.limitType===t.limitType}function Au(n){return`${Hi(He(n))}|lt:${n.limitType}`}function ll(n){return`Query(target=${function f_(n){let t=n.path.canonicalString();return null!==n.collectionGroup&&(t+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(t+=`, filters: [${n.filters.map(e=>{return`${(i=e).field.canonicalString()} ${i.op} ${Bs(i.value)}`;var i}).join(", ")}]`),Kr(n.limit)||(t+=", limit: "+n.limit),n.orderBy.length>0&&(t+=`, orderBy: [${n.orderBy.map(e=>{return`${(i=e).field.canonicalString()} (${i.dir})`;var i}).join(", ")}]`),n.startAt&&(t+=", startAt: ",t+=n.startAt.inclusive?"b:":"a:",t+=n.startAt.position.map(e=>Bs(e)).join(",")),n.endAt&&(t+=", endAt: ",t+=n.endAt.inclusive?"a:":"b:",t+=n.endAt.position.map(e=>Bs(e)).join(",")),`Target(${t})`}(He(n))}; limitType=${n.limitType})`}function cl(n,t){return t.isFoundDocument()&&function(e,i){const r=i.key.path;return null!==e.collectionGroup?i.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):$.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(n,t)&&function(e,i){for(const r of e.explicitOrderBy)if(!r.field.isKeyField()&&null===i.data.field(r.field))return!1;return!0}(n,t)&&function(e,i){for(const r of e.filters)if(!r.matches(i))return!1;return!0}(n,t)&&(i=t,!((e=n).startAt&&!function(r,a,l){const u=yu(r,a,l);return r.inclusive?u<=0:u<0}(e.startAt,Js(e),i)||e.endAt&&!function(r,a,l){const u=yu(r,a,l);return r.inclusive?u>=0:u>0}(e.endAt,Js(e),i)));var e,i}function Eu(n){return(t,e)=>{let i=!1;for(const r of Js(n)){const a=C_(r,t,e);if(0!==a)return a;i=i||r.field.isKeyField()}return 0}}function C_(n,t,e){const i=n.field.isKeyField()?$.comparator(t.key,e.key):function(r,a,l){const u=a.data.field(r),h=l.data.field(r);return null!==u&&null!==h?li(u,h):st()}(n.field,t,e);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return st()}}function Cu(n,t){if(n.dt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yr(t)?"-0":t}}function Ou(n){return{integerValue:""+n}}function Su(n,t){return function lu(n){return"number"==typeof n&&Number.isInteger(n)&&!Yr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(t)?Ou(t):Cu(n,t)}class Xo{constructor(){this._=void 0}}function O_(n,t,e){return n instanceof Gs?function(i,r){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&(a.fields.__previous_value__=r),{mapValue:a}}(e,t):n instanceof $i?Mu(n,t):n instanceof Wi?Du(n,t):function(i,r){const a=ku(i,r),l=Ru(a)+Ru(i._t);return sl(a)&&sl(i._t)?Ou(l):Cu(i.wt,l)}(n,t)}function S_(n,t,e){return n instanceof $i?Mu(n,t):n instanceof Wi?Du(n,t):e}function ku(n,t){return n instanceof Ks?sl(e=t)||(i=e)&&"doubleValue"in i?t:{integerValue:0}:null;var i,e}class Gs extends Xo{}class $i extends Xo{constructor(t){super(),this.elements=t}}function Mu(n,t){const e=Lu(t);for(const i of n.elements)e.some(r=>yn(r,i))||e.push(i);return{arrayValue:{values:e}}}class Wi extends Xo{constructor(t){super(),this.elements=t}}function Du(n,t){let e=Lu(t);for(const i of n.elements)e=e.filter(r=>!yn(r,i));return{arrayValue:{values:e}}}class Ks extends Xo{constructor(t,e){super(),this.wt=t,this._t=e}}function Ru(n){return ee(n.integerValue||n.doubleValue)}function Lu(n){return $r(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class M_{constructor(t,e){this.version=t,this.transformResults=e}}class Ht{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ht}static exists(t){return new Ht(void 0,t)}static updateTime(t){return new Ht(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ta(n,t){return void 0!==n.updateTime?t.isFoundDocument()&&t.version.isEqual(n.updateTime):void 0===n.exists||n.exists===t.isFoundDocument()}class ea{}function Nu(n,t){if(!n.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return n.isNoDocument()?new Hs(n.key,Ht.none()):new Ys(n.key,n.data,Ht.none());{const e=n.data,i=Oe.empty();let r=new Zt(ue.comparator);for(let a of t.fields)if(!r.has(a)){let l=e.field(a);null===l&&a.length>1&&(a=a.popLast(),l=e.field(a)),null===l?i.delete(a):i.set(a,l),r=r.add(a)}return new jn(n.key,i,new Ve(r.toArray()),Ht.none())}}function D_(n,t,e){n instanceof Ys?function(i,r,a){const l=i.value.clone(),u=Zu(i.fieldTransforms,r,a.transformResults);l.setAll(u),r.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,t,e):n instanceof jn?function(i,r,a){if(!ta(i.precondition,r))return void r.convertToUnknownDocument(a.version);const l=Zu(i.fieldTransforms,r,a.transformResults),u=r.data;u.setAll(qu(i)),u.setAll(l),r.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,t,e):t.convertToNoDocument(e.version).setHasCommittedMutations()}function no(n,t,e,i){return n instanceof Ys?function(r,a,l,u){if(!ta(r.precondition,a))return l;const h=r.value.clone(),m=ju(r.fieldTransforms,u,a);return h.setAll(m),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(n,t,e,i):n instanceof jn?function(r,a,l,u){if(!ta(r.precondition,a))return l;const h=ju(r.fieldTransforms,u,a),m=a.data;return m.setAll(qu(r)),m.setAll(h),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null===l?null:l.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(v=>v.field))}(n,t,e,i):(l=e,ta(n.precondition,a=t)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l);var a,l}function R_(n,t){let e=null;for(const i of n.fieldTransforms){const r=t.data.field(i.field),a=ku(i.transform,r||null);null!=a&&(null===e&&(e=Oe.empty()),e.set(i.field,a))}return e||null}function Pu(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&(i=t.fieldTransforms,!!(void 0===(e=n.fieldTransforms)&&void 0===i||e&&i&&Us(e,i,(r,a)=>function k_(n,t){return n.field.isEqual(t.field)&&(i=t.transform,(e=n.transform)instanceof $i&&i instanceof $i||e instanceof Wi&&i instanceof Wi?Us(e.elements,i.elements,yn):e instanceof Ks&&i instanceof Ks?yn(e._t,i._t):e instanceof Gs&&i instanceof Gs);var e,i}(r,a))))&&(0===n.type?n.value.isEqual(t.value):1!==n.type||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask));var e,i}class Ys extends ea{constructor(t,e,i,r=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class jn extends ea{constructor(t,e,i,r,a=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=r,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function qu(n){const t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const i=n.data.field(e);t.set(e,i)}}),t}function Zu(n,t,e){const i=new Map;dt(n.length===e.length);for(let r=0;r<e.length;r++){const a=n[r],l=a.transform,u=t.data.field(a.field);i.set(a.field,S_(l,u,e[r]))}return i}function ju(n,t,e){const i=new Map;for(const r of n){const a=r.transform,l=e.data.field(r.field);i.set(r.field,O_(a,l,t))}return i}class Hs extends ea{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ul extends ea{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class L_{constructor(t){this.count=t}}var he,At;function Fu(n){switch(n){default:return st();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function Uu(n){if(void 0===n)return Kt("GRPC error has no .code"),D.UNKNOWN;switch(n){case he.OK:return D.OK;case he.CANCELLED:return D.CANCELLED;case he.UNKNOWN:return D.UNKNOWN;case he.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case he.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case he.INTERNAL:return D.INTERNAL;case he.UNAVAILABLE:return D.UNAVAILABLE;case he.UNAUTHENTICATED:return D.UNAUTHENTICATED;case he.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case he.NOT_FOUND:return D.NOT_FOUND;case he.ALREADY_EXISTS:return D.ALREADY_EXISTS;case he.PERMISSION_DENIED:return D.PERMISSION_DENIED;case he.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case he.ABORTED:return D.ABORTED;case he.OUT_OF_RANGE:return D.OUT_OF_RANGE;case he.UNIMPLEMENTED:return D.UNIMPLEMENTED;case he.DATA_LOSS:return D.DATA_LOSS;default:return st()}}(At=he||(he={}))[At.OK=0]="OK",At[At.CANCELLED=1]="CANCELLED",At[At.UNKNOWN=2]="UNKNOWN",At[At.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",At[At.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",At[At.NOT_FOUND=5]="NOT_FOUND",At[At.ALREADY_EXISTS=6]="ALREADY_EXISTS",At[At.PERMISSION_DENIED=7]="PERMISSION_DENIED",At[At.UNAUTHENTICATED=16]="UNAUTHENTICATED",At[At.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",At[At.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",At[At.ABORTED=10]="ABORTED",At[At.OUT_OF_RANGE=11]="OUT_OF_RANGE",At[At.UNIMPLEMENTED=12]="UNIMPLEMENTED",At[At.INTERNAL=13]="INTERNAL",At[At.UNAVAILABLE=14]="UNAVAILABLE",At[At.DATA_LOSS=15]="DATA_LOSS";class ui{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),i=this.inner[e];if(void 0!==i)for(const[r,a]of i)if(this.equalsFn(r,t))return a}has(t){return void 0!==this.get(t)}set(t,e){const i=this.mapKeyFn(t),r=this.inner[i];if(void 0===r)return this.inner[i]=[[t,e]],void this.innerSize++;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],t))return void(r[a]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),i=this.inner[e];if(void 0===i)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],t))return 1===i.length?delete this.inner[e]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ji(this.inner,(e,i)=>{for(const[r,a]of i)t(r,a)})}isEmpty(){return ru(this.inner)}size(){return this.innerSize}}const N_=new te($.comparator);function Ue(){return N_}const Qu=new te($.comparator);function io(...n){let t=Qu;for(const e of n)t=t.insert(e.key,e);return t}function Bu(n){let t=Qu;return n.forEach((e,i)=>t=t.insert(e,i.overlayedDocument)),t}function wn(){return so()}function zu(){return so()}function so(){return new ui(n=>n.toString(),(n,t)=>n.isEqual(t))}const P_=new te($.comparator),q_=new Zt($.comparator);function xt(...n){let t=q_;for(const e of n)t=t.add(e);return t}const Z_=new Zt(vt);function na(){return Z_}class ro{constructor(t,e,i,r,a){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(t,e){const i=new Map;return i.set(t,oo.createSynthesizedTargetChangeForCurrentChange(t,e)),new ro(ht.min(),i,na(),Ue(),xt())}}class oo{constructor(t,e,i,r,a){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(t,e){return new oo(me.EMPTY_BYTE_STRING,e,xt(),xt(),xt())}}class ia{constructor(t,e,i,r){this.gt=t,this.removedTargetIds=e,this.key=i,this.yt=r}}class Vu{constructor(t,e){this.targetId=t,this.It=e}}class Ju{constructor(t,e,i=me.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=r}}class Gu{constructor(){this.Tt=0,this.Et=Yu(),this.At=me.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(t){t.approximateByteSize()>0&&(this.bt=!0,this.At=t)}St(){let t=xt(),e=xt(),i=xt();return this.Et.forEach((r,a)=>{switch(a){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:i=i.add(r);break;default:st()}}),new oo(this.At,this.Rt,t,e,i)}Dt(){this.bt=!1,this.Et=Yu()}Ct(t,e){this.bt=!0,this.Et=this.Et.insert(t,e)}xt(t){this.bt=!0,this.Et=this.Et.remove(t)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class j_{constructor(t){this.Mt=t,this.Ft=new Map,this.$t=Ue(),this.Bt=Ku(),this.Lt=new Zt(vt)}Ut(t){for(const e of t.gt)t.yt&&t.yt.isFoundDocument()?this.qt(e,t.yt):this.Kt(e,t.key,t.yt);for(const e of t.removedTargetIds)this.Kt(e,t.key,t.yt)}Gt(t){this.forEachTarget(t,e=>{const i=this.Qt(e);switch(t.state){case 0:this.jt(e)&&i.Vt(t.resumeToken);break;case 1:i.kt(),i.Pt||i.Dt(),i.Vt(t.resumeToken);break;case 2:i.kt(),i.Pt||this.removeTarget(e);break;case 3:this.jt(e)&&(i.Ot(),i.Vt(t.resumeToken));break;case 4:this.jt(e)&&(this.Wt(e),i.Vt(t.resumeToken));break;default:st()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ft.forEach((i,r)=>{this.jt(r)&&e(r)})}zt(t){const e=t.targetId,i=t.It.count,r=this.Ht(e);if(r){const a=r.target;if($o(a))if(0===i){const l=new $(a.path);this.Kt(e,l,Ut.newNoDocument(l,ht.min()))}else dt(1===i);else this.Jt(e)!==i&&(this.Wt(e),this.Lt=this.Lt.add(e))}}Yt(t){const e=new Map;this.Ft.forEach((a,l)=>{const u=this.Ht(l);if(u){if(a.current&&$o(u.target)){const h=new $(u.target.path);null!==this.$t.get(h)||this.Xt(l,h)||this.Kt(l,h,Ut.newNoDocument(h,t))}a.vt&&(e.set(l,a.St()),a.Dt())}});let i=xt();this.Bt.forEach((a,l)=>{let u=!0;l.forEachWhile(h=>{const m=this.Ht(h);return!m||2===m.purpose||(u=!1,!1)}),u&&(i=i.add(a))}),this.$t.forEach((a,l)=>l.setReadTime(t));const r=new ro(t,e,this.Lt,this.$t,i);return this.$t=Ue(),this.Bt=Ku(),this.Lt=new Zt(vt),r}qt(t,e){if(!this.jt(t))return;const i=this.Xt(t,e.key)?2:0;this.Qt(t).Ct(e.key,i),this.$t=this.$t.insert(e.key,e),this.Bt=this.Bt.insert(e.key,this.Zt(e.key).add(t))}Kt(t,e,i){if(!this.jt(t))return;const r=this.Qt(t);this.Xt(t,e)?r.Ct(e,1):r.xt(e),this.Bt=this.Bt.insert(e,this.Zt(e).delete(t)),i&&(this.$t=this.$t.insert(e,i))}removeTarget(t){this.Ft.delete(t)}Jt(t){const e=this.Qt(t).St();return this.Mt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Nt(t){this.Qt(t).Nt()}Qt(t){let e=this.Ft.get(t);return e||(e=new Gu,this.Ft.set(t,e)),e}Zt(t){let e=this.Bt.get(t);return e||(e=new Zt(vt),this.Bt=this.Bt.insert(t,e)),e}jt(t){const e=null!==this.Ht(t);return e||U("WatchChangeAggregator","Detected inactive target",t),e}Ht(t){const e=this.Ft.get(t);return e&&e.Pt?null:this.Mt.te(t)}Wt(t){this.Ft.set(t,new Gu),this.Mt.getRemoteKeysForTarget(t).forEach(e=>{this.Kt(t,e,null)})}Xt(t,e){return this.Mt.getRemoteKeysForTarget(t).has(e)}}function Ku(){return new te($.comparator)}function Yu(){return new te($.comparator)}const F_={asc:"ASCENDING",desc:"DESCENDING"},U_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Q_{constructor(t,e){this.databaseId=t,this.dt=e}}function ao(n,t){return n.dt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Hu(n,t){return n.dt?t.toBase64():t.toUint8Array()}function B_(n,t){return ao(n,t.toTimestamp())}function we(n){return dt(!!n),ht.fromTimestamp(function(t){const e=ri(t);return new Yt(e.seconds,e.nanos)}(n))}function hl(n,t){return(e=n,new Tt(["projects",e.projectId,"databases",e.database])).child("documents").child(t).canonicalString();var e}function $u(n){const t=Tt.fromString(n);return dt(oh(t)),t}function lo(n,t){return hl(n.databaseId,t.path)}function bn(n,t){const e=$u(t);if(e.get(1)!==n.databaseId.projectId)throw new B(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new B(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new $(Xu(e))}function dl(n,t){return hl(n.databaseId,t)}function co(n){return new Tt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Xu(n){return dt(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function th(n,t,e){return{name:lo(n,t),fields:e.value.mapValue.fields}}function nh(n,t){return{documents:[dl(n,t.path)]}}function ih(n,t){const e={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(e.parent=dl(n,i),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=dl(n,i.popLast()),e.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(h){if(0===h.length)return;const m=h.map(v=>function(x){if("=="===x.op){if(hu(x.value))return{unaryFilter:{field:$s(x.field),op:"IS_NAN"}};if(uu(x.value))return{unaryFilter:{field:$s(x.field),op:"IS_NULL"}}}else if("!="===x.op){if(hu(x.value))return{unaryFilter:{field:$s(x.field),op:"IS_NOT_NAN"}};if(uu(x.value))return{unaryFilter:{field:$s(x.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$s(x.field),op:Y_(x.op),value:x.value}}}(v));return 1===m.length?m[0]:{compositeFilter:{op:"AND",filters:m}}}(t.filters);r&&(e.structuredQuery.where=r);const a=function(h){if(0!==h.length)return h.map(m=>{return{field:$s((v=m).field),direction:K_(v.dir)};var v})}(t.orderBy);a&&(e.structuredQuery.orderBy=a);const l=(m=t.limit,n.dt||Kr(m)?m:{value:m});var m,u,h;return null!==l&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(e.structuredQuery.endAt={before:!(h=t.endAt).inclusive,values:h.position}),e}function sh(n){let t=function Wu(n){const t=$u(n);return 4===t.length?Tt.emptyPath():Xu(t)}(n.parent);const e=n.structuredQuery,i=e.from?e.from.length:0;let r=null;if(i>0){dt(1===i);const v=e.from[0];v.allDescendants?r=v.collectionId:t=t.child(v.collectionId)}let a=[];e.where&&(a=rh(e.where));let l=[];e.orderBy&&(l=e.orderBy.map(v=>{return new zs(Ws((x=v).field),function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction));var x}));let u=null;e.limit&&(u=function(v){let x;return x="object"==typeof v?v.value:v,Kr(x)?null:x}(e.limit));let h=null;var v;e.startAt&&(h=new ci((v=e.startAt).values||[],!!v.before));let m=null;return e.endAt&&(m=function(v){return new ci(v.values||[],!v.before)}(e.endAt)),function bu(n,t,e,i,r,a,l,u){return new Zn(n,t,e,i,r,a,l,u)}(t,r,l,a,u,"F",h,m)}function rh(n){return n?void 0!==n.unaryFilter?[$_(n)]:void 0!==n.fieldFilter?[H_(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(t=>rh(t)).reduce((t,e)=>t.concat(e)):st():[]}function K_(n){return F_[n]}function Y_(n){return U_[n]}function $s(n){return{fieldPath:n.canonicalString()}}function Ws(n){return ue.fromServerFormat(n.fieldPath)}function H_(n){return Se.create(Ws(n.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return st()}}(n.fieldFilter.op),n.fieldFilter.value)}function $_(n){switch(n.unaryFilter.op){case"IS_NAN":const t=Ws(n.unaryFilter.field);return Se.create(t,"==",{doubleValue:NaN});case"IS_NULL":const e=Ws(n.unaryFilter.field);return Se.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ws(n.unaryFilter.field);return Se.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Ws(n.unaryFilter.field);return Se.create(r,"!=",{nullValue:"NULL_VALUE"});default:return st()}}function W_(n){const t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function oh(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class gl{constructor(t,e,i,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(t,e){const i=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const a=this.mutations[r];a.key.isEqual(t.key)&&D_(a,t,i[r])}}applyToLocalView(t,e){for(const i of this.baseMutations)i.key.isEqual(t.key)&&(e=no(i,t,e,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(t.key)&&(e=no(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const i=zu();return this.mutations.forEach(r=>{const a=t.get(r.key),l=a.overlayedDocument;let u=this.applyToLocalView(l,a.mutatedFields);u=e.has(r.key)?null:u;const h=Nu(l,u);null!==h&&i.set(r.key,h),l.isValidDocument()||l.convertToNoDocument(ht.min())}),i}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),xt())}isEqual(t){return this.batchId===t.batchId&&Us(this.mutations,t.mutations,(e,i)=>Pu(e,i))&&Us(this.baseMutations,t.baseMutations,(e,i)=>Pu(e,i))}}class pl{constructor(t,e,i,r){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=r}static from(t,e,i){dt(t.mutations.length===i.length);let r=P_;const a=t.mutations;for(let l=0;l<a.length;l++)r=r.insert(a[l].key,i[l].version);return new pl(t,e,i,r)}}class fl{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class hi{constructor(t,e,i,r,a=ht.min(),l=ht.min(),u=me.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u}withSequenceNumber(t){return new hi(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new hi(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new hi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class _h{constructor(t){this.ne=t}}function vl(n){const t=sh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?function Tu(n,t,e){return new Zn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}(t,t.limit,"L"):t}class ns{constructor(){}re(t,e){this.oe(t,e),e.ue()}oe(t,e){if("nullValue"in t)this.ce(e,5);else if("booleanValue"in t)this.ce(e,10),e.ae(t.booleanValue?1:0);else if("integerValue"in t)this.ce(e,15),e.ae(ee(t.integerValue));else if("doubleValue"in t){const i=ee(t.doubleValue);isNaN(i)?this.ce(e,13):(this.ce(e,15),Yr(i)?e.ae(0):e.ae(i))}else if("timestampValue"in t){const i=t.timestampValue;this.ce(e,20),"string"==typeof i?e.he(i):(e.he(`${i.seconds||""}`),e.ae(i.nanos||0))}else if("stringValue"in t)this.le(t.stringValue,e),this.fe(e);else if("bytesValue"in t)this.ce(e,30),e.de(Gi(t.bytesValue)),this.fe(e);else if("referenceValue"in t)this._e(t.referenceValue,e);else if("geoPointValue"in t){const i=t.geoPointValue;this.ce(e,45),e.ae(i.latitude||0),e.ae(i.longitude||0)}else"mapValue"in t?du(t)?this.ce(e,Number.MAX_SAFE_INTEGER):(this.we(t.mapValue,e),this.fe(e)):"arrayValue"in t?(this.me(t.arrayValue,e),this.fe(e)):st()}le(t,e){this.ce(e,25),this.ge(t,e)}ge(t,e){e.he(t)}we(t,e){const i=t.fields||{};this.ce(e,55);for(const r of Object.keys(i))this.le(r,e),this.oe(i[r],e)}me(t,e){const i=t.values||[];this.ce(e,50);for(const r of i)this.oe(r,e)}_e(t,e){this.ce(e,37),$.fromName(t).path.forEach(i=>{this.ce(e,60),this.ge(i,e)})}ce(t,e){t.ae(e)}fe(t){t.ae(2)}}ns.ye=new ns;class Am{constructor(){this.ze=new yl}addToCollectionParentIndex(t,e){return this.ze.add(e),k.resolve()}getCollectionParents(t,e){return k.resolve(this.ze.getEntries(e))}addFieldIndex(t,e){return k.resolve()}deleteFieldIndex(t,e){return k.resolve()}getDocumentsMatchingTarget(t,e){return k.resolve(null)}getIndexType(t,e){return k.resolve(0)}getFieldIndexes(t,e){return k.resolve([])}getNextCollectionGroupToUpdate(t){return k.resolve(null)}getMinOffset(t,e){return k.resolve(ze.min())}getMinOffsetFromCollectionGroup(t,e){return k.resolve(ze.min())}updateCollectionGroup(t,e,i){return k.resolve()}updateIndexEntries(t,e){return k.resolve()}}class yl{constructor(){this.index={}}add(t){const e=t.lastSegment(),i=t.popLast(),r=this.index[e]||new Zt(Tt.comparator),a=!r.has(i);return this.index[e]=r.add(i),a}has(t){const e=t.lastSegment(),i=t.popLast(),r=this.index[e];return r&&r.has(i)}getEntries(t){return(this.index[t]||new Zt(Tt.comparator)).toArray()}}new Uint8Array(0);class Qe{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new Qe(t,Qe.DEFAULT_COLLECTION_PERCENTILE,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Qe.DEFAULT_COLLECTION_PERCENTILE=10,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qe.DEFAULT=new Qe(41943040,Qe.DEFAULT_COLLECTION_PERCENTILE,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qe.DISABLED=new Qe(-1,0,0);class rs{constructor(t){this.En=t}next(){return this.En+=2,this.En}static An(){return new rs(0)}static Rn(){return new rs(-1)}}class Lm{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Lh{constructor(t,e,i,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=r}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(i=r,this.getBaseDocument(t,e,i))).next(r=>(null!==i&&no(i.mutation,r,Ve.empty(),Yt.now()),r))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.getLocalViewOfDocuments(t,i,xt()).next(()=>i))}getLocalViewOfDocuments(t,e,i=xt()){const r=wn();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,i).next(a=>{let l=io();return a.forEach((u,h)=>{l=l.insert(u,h.overlayedDocument)}),l}))}getOverlayedDocuments(t,e){const i=wn();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,xt()))}populateOverlays(t,e,i){const r=[];return i.forEach(a=>{e.has(a)||r.push(a)}),this.documentOverlayCache.getOverlays(t,r).next(a=>{a.forEach((l,u)=>{e.set(l,u)})})}computeViews(t,e,i,r){let a=Ue();const l=so(),u=so();return e.forEach((h,m)=>{const v=i.get(m.key);r.has(m.key)&&(void 0===v||v.mutation instanceof jn)?a=a.insert(m.key,m):void 0!==v&&(l.set(m.key,v.mutation.getFieldMask()),no(v.mutation,m,v.mutation.getFieldMask(),Yt.now()))}),this.recalculateAndSaveOverlays(t,a).next(h=>(h.forEach((m,v)=>l.set(m,v)),e.forEach((m,v)=>{var x;return u.set(m,new Lm(v,null!==(x=l.get(m))&&void 0!==x?x:null))}),u))}recalculateAndSaveOverlays(t,e){const i=so();let r=new te((l,u)=>l-u),a=xt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(l=>{for(const u of l)u.keys().forEach(h=>{const m=e.get(h);if(null===m)return;let v=i.get(h)||Ve.empty();v=u.applyToLocalView(m,v),i.set(h,v);const x=(r.get(u.batchId)||xt()).add(h);r=r.insert(u.batchId,x)})}).next(()=>{const l=[],u=r.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),m=h.key,v=h.value,x=zu();v.forEach(O=>{if(!a.has(O)){const N=Nu(e.get(O),i.get(O));null!==N&&x.set(O,N),a=a.add(O)}}),l.push(this.documentOverlayCache.saveOverlays(t,m,x))}return k.waitFor(l)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.recalculateAndSaveOverlays(t,i))}getDocumentsMatchingQuery(t,e,i){return $.isDocumentKey((r=e).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(t,e.path):al(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i):this.getDocumentsMatchingCollectionQuery(t,e,i);var r}getNextDocuments(t,e,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,r).next(a=>{const l=r-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,r-a.size):k.resolve(wn());let u=-1,h=a;return l.next(m=>k.forEach(m,(v,x)=>(u<x.largestBatchId&&(u=x.largestBatchId),a.get(v)?k.resolve():this.getBaseDocument(t,v,x).next(O=>{h=h.insert(v,O)}))).next(()=>this.populateOverlays(t,m,a)).next(()=>this.computeViews(t,h,m,xt())).next(v=>({batchId:u,changes:Bu(v)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new $(e)).next(i=>{let r=io();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(t,e,i){const r=e.collectionGroup;let a=io();return this.indexManager.getCollectionParents(t,r).next(l=>k.forEach(l,u=>{const h=(m=e,v=u.child(r),new Zn(v,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,v;return this.getDocumentsMatchingCollectionQuery(t,h,i).next(m=>{m.forEach((v,x)=>{a=a.insert(v,x)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,i){let r;return this.remoteDocumentCache.getAllFromCollection(t,e.path,i).next(a=>(r=a,this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId))).next(a=>{a.forEach((u,h)=>{const m=h.getKey();null===r.get(m)&&(r=r.insert(m,Ut.newInvalidDocument(m)))});let l=io();return r.forEach((u,h)=>{const m=a.get(u);void 0!==m&&no(m.mutation,h,Ve.empty(),Yt.now()),cl(e,h)&&(l=l.insert(u,h))}),l})}getBaseDocument(t,e,i){return null===i||1===i.mutation.type?this.remoteDocumentCache.getEntry(t,e):k.resolve(Ut.newInvalidDocument(e))}}class Nm{constructor(t){this.wt=t,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(t,e){return k.resolve(this.Jn.get(e))}saveBundleMetadata(t,e){var i;return this.Jn.set(e.id,{id:(i=e).id,version:i.version,createTime:we(i.createTime)}),k.resolve()}getNamedQuery(t,e){return k.resolve(this.Yn.get(e))}saveNamedQuery(t,e){return this.Yn.set(e.name,{name:(i=e).name,query:vl(i.bundledQuery),readTime:we(i.readTime)}),k.resolve();var i}}class Pm{constructor(){this.overlays=new te($.comparator),this.Xn=new Map}getOverlay(t,e){return k.resolve(this.overlays.get(e))}getOverlays(t,e){const i=wn();return k.forEach(e,r=>this.getOverlay(t,r).next(a=>{null!==a&&i.set(r,a)})).next(()=>i)}saveOverlays(t,e,i){return i.forEach((r,a)=>{this.ie(t,e,a)}),k.resolve()}removeOverlaysForBatchId(t,e,i){const r=this.Xn.get(i);return void 0!==r&&(r.forEach(a=>this.overlays=this.overlays.remove(a)),this.Xn.delete(i)),k.resolve()}getOverlaysForCollection(t,e,i){const r=wn(),a=e.length+1,l=new $(e.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,m=h.getKey();if(!e.isPrefixOf(m.path))break;m.path.length===a&&h.largestBatchId>i&&r.set(h.getKey(),h)}return k.resolve(r)}getOverlaysForCollectionGroup(t,e,i,r){let a=new te((m,v)=>m-v);const l=this.overlays.getIterator();for(;l.hasNext();){const m=l.getNext().value;if(m.getKey().getCollectionGroup()===e&&m.largestBatchId>i){let v=a.get(m.largestBatchId);null===v&&(v=wn(),a=a.insert(m.largestBatchId,v)),v.set(m.getKey(),m)}}const u=wn(),h=a.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((m,v)=>u.set(m,v)),!(u.size()>=r)););return k.resolve(u)}ie(t,e,i){const r=this.overlays.get(i.key);if(null!==r){const l=this.Xn.get(r.largestBatchId).delete(i.key);this.Xn.set(r.largestBatchId,l)}this.overlays=this.overlays.insert(i.key,new fl(e,i));let a=this.Xn.get(e);void 0===a&&(a=xt(),this.Xn.set(e,a)),this.Xn.set(e,a.add(i.key))}}class wl{constructor(){this.Zn=new Zt(Te.ts),this.es=new Zt(Te.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const i=new Te(t,e);this.Zn=this.Zn.add(i),this.es=this.es.add(i)}ss(t,e){t.forEach(i=>this.addReference(i,e))}removeReference(t,e){this.rs(new Te(t,e))}os(t,e){t.forEach(i=>this.removeReference(i,e))}us(t){const e=new $(new Tt([])),i=new Te(e,t),r=new Te(e,t+1),a=[];return this.es.forEachInRange([i,r],l=>{this.rs(l),a.push(l.key)}),a}cs(){this.Zn.forEach(t=>this.rs(t))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new $(new Tt([])),i=new Te(e,t),r=new Te(e,t+1);let a=xt();return this.es.forEachInRange([i,r],l=>{a=a.add(l.key)}),a}containsKey(t){const e=new Te(t,0),i=this.Zn.firstAfterOrEqual(e);return null!==i&&t.isEqual(i.key)}}class Te{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return $.comparator(t.key,e.key)||vt(t.ls,e.ls)}static ns(t,e){return vt(t.ls,e.ls)||$.comparator(t.key,e.key)}}class qm{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.fs=1,this.ds=new Zt(Te.ts)}checkEmpty(t){return k.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,i,r){const a=this.fs;this.fs++;const l=new gl(a,e,i,r);this.mutationQueue.push(l);for(const u of r)this.ds=this.ds.add(new Te(u.key,a)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return k.resolve(l)}lookupMutationBatch(t,e){return k.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const r=this.ws(e+1),a=r<0?0:r;return k.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(t){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const i=new Te(e,0),r=new Te(e,Number.POSITIVE_INFINITY),a=[];return this.ds.forEachInRange([i,r],l=>{const u=this._s(l.ls);a.push(u)}),k.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Zt(vt);return e.forEach(r=>{const a=new Te(r,0),l=new Te(r,Number.POSITIVE_INFINITY);this.ds.forEachInRange([a,l],u=>{i=i.add(u.ls)})}),k.resolve(this.gs(i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,r=i.length+1;let a=i;$.isDocumentKey(a)||(a=a.child(""));const l=new Te(new $(a),0);let u=new Zt(vt);return this.ds.forEachWhile(h=>{const m=h.key.path;return!!i.isPrefixOf(m)&&(m.length===r&&(u=u.add(h.ls)),!0)},l),k.resolve(this.gs(u))}gs(t){const e=[];return t.forEach(i=>{const r=this._s(i);null!==r&&e.push(r)}),e}removeMutationBatch(t,e){dt(0===this.ys(e.batchId,"removed")),this.mutationQueue.shift();let i=this.ds;return k.forEach(e.mutations,r=>{const a=new Te(r.key,e.batchId);return i=i.delete(a),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.ds=i})}In(t){}containsKey(t,e){const i=new Te(e,0),r=this.ds.firstAfterOrEqual(i);return k.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return k.resolve()}ys(t,e){return this.ws(t)}ws(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}_s(t){const e=this.ws(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Zm{constructor(t){this.ps=t,this.docs=new te($.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const i=e.key,r=this.docs.get(i),a=r?r.size:0,l=this.ps(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:l}),this.size+=l-a,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const i=this.docs.get(e);return k.resolve(i?i.document.mutableCopy():Ut.newInvalidDocument(e))}getEntries(t,e){let i=Ue();return e.forEach(r=>{const a=this.docs.get(r);i=i.insert(r,a?a.document.mutableCopy():Ut.newInvalidDocument(r))}),k.resolve(i)}getAllFromCollection(t,e,i){let r=Ue();const a=new $(e.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!e.isPrefixOf(u.path))break;u.path.length>e.length+1||Xa(eu(h),i)<=0||(r=r.insert(h.key,h.mutableCopy()))}return k.resolve(r)}getAllFromCollectionGroup(t,e,i,r){st()}Is(t,e){return k.forEach(this.docs,i=>e(i))}newChangeBuffer(t){return new jm(this)}getSize(t){return k.resolve(this.size)}}class jm extends class Mm{constructor(){this.changes=new ui(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ut.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const i=this.changes.get(e);return void 0!==i?k.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}{constructor(t){super(),this.zn=t}applyChanges(t){const e=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?e.push(this.zn.addEntry(t,r)):this.zn.removeEntry(i)}),k.waitFor(e)}getFromCache(t,e){return this.zn.getEntry(t,e)}getAllFromCache(t,e){return this.zn.getEntries(t,e)}}class Fm{constructor(t){this.persistence=t,this.Ts=new ui(e=>Hi(e),Xr),this.lastRemoteSnapshotVersion=ht.min(),this.highestTargetId=0,this.Es=0,this.As=new wl,this.targetCount=0,this.Rs=rs.An()}forEachTarget(t,e){return this.Ts.forEach((i,r)=>e(r)),k.resolve()}getLastRemoteSnapshotVersion(t){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return k.resolve(this.Es)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.Es&&(this.Es=e),k.resolve()}vn(t){this.Ts.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new rs(e),this.highestTargetId=e),t.sequenceNumber>this.Es&&(this.Es=t.sequenceNumber)}addTargetData(t,e){return this.vn(e),this.targetCount+=1,k.resolve()}updateTargetData(t,e){return this.vn(e),k.resolve()}removeTargetData(t,e){return this.Ts.delete(e.target),this.As.us(e.targetId),this.targetCount-=1,k.resolve()}removeTargets(t,e,i){let r=0;const a=[];return this.Ts.forEach((l,u)=>{u.sequenceNumber<=e&&null===i.get(u.targetId)&&(this.Ts.delete(l),a.push(this.removeMatchingKeysForTargetId(t,u.targetId)),r++)}),k.waitFor(a).next(()=>r)}getTargetCount(t){return k.resolve(this.targetCount)}getTargetData(t,e){const i=this.Ts.get(e)||null;return k.resolve(i)}addMatchingKeys(t,e,i){return this.As.ss(e,i),k.resolve()}removeMatchingKeys(t,e,i){this.As.os(e,i);const r=this.persistence.referenceDelegate,a=[];return r&&e.forEach(l=>{a.push(r.markPotentiallyOrphaned(t,l))}),k.waitFor(a)}removeMatchingKeysForTargetId(t,e){return this.As.us(e),k.resolve()}getMatchingKeysForTargetId(t,e){const i=this.As.hs(e);return k.resolve(i)}containsKey(t,e){return k.resolve(this.As.containsKey(e))}}class Nh{constructor(t,e){this.bs={},this.overlays={},this.Ps=new Fe(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new Fm(this),this.indexManager=new Am,this.remoteDocumentCache=new Zm(i=>this.referenceDelegate.Ss(i)),this.wt=new _h(e),this.Ds=new Nm(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Pm,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.bs[t.toKey()];return i||(i=new qm(e,this.referenceDelegate),this.bs[t.toKey()]=i),i}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(t,e,i){U("MemoryPersistence","Starting transaction:",t);const r=new Um(this.Ps.next());return this.referenceDelegate.Cs(),i(r).next(a=>this.referenceDelegate.xs(r).next(()=>a)).toPromise().then(a=>(r.raiseOnCommittedEvent(),a))}Ns(t,e){return k.or(Object.values(this.bs).map(i=>()=>i.containsKey(t,e)))}}class Um extends class a_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}{constructor(t){super(),this.currentSequenceNumber=t}}class da{constructor(t){this.persistence=t,this.ks=new wl,this.Os=null}static Ms(t){return new da(t)}get Fs(){if(this.Os)return this.Os;throw st()}addReference(t,e,i){return this.ks.addReference(i,e),this.Fs.delete(i.toString()),k.resolve()}removeReference(t,e,i){return this.ks.removeReference(i,e),this.Fs.add(i.toString()),k.resolve()}markPotentiallyOrphaned(t,e){return this.Fs.add(e.toString()),k.resolve()}removeTarget(t,e){this.ks.us(e.targetId).forEach(r=>this.Fs.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next(r=>{r.forEach(a=>this.Fs.add(a.toString()))}).next(()=>i.removeTargetData(t,e))}Cs(){this.Os=new Set}xs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.Fs,i=>{const r=$.fromPath(i);return this.$s(t,r).next(a=>{a||e.removeEntry(r,ht.min())})}).next(()=>(this.Os=null,e.apply(t)))}updateLimboDocument(t,e){return this.$s(t,e).next(i=>{i?this.Fs.delete(e.toString()):this.Fs.add(e.toString())})}Ss(t){return 0}$s(t,e){return k.or([()=>k.resolve(this.ks.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ns(t,e)])}}class Il{constructor(t,e,i,r){this.targetId=t,this.fromCache=e,this.Pi=i,this.vi=r}static Vi(t,e){let i=xt(),r=xt();for(const a of e.docChanges)switch(a.type){case 0:i=i.add(a.doc.key);break;case 1:r=r.add(a.doc.key)}return new Il(t,e.fromCache,i,r)}}class qh{constructor(){this.Si=!1}initialize(t,e){this.Di=t,this.indexManager=e,this.Si=!0}getDocumentsMatchingQuery(t,e,i,r){return this.Ci(t,e).next(a=>a||this.xi(t,e,r,i)).next(a=>a||this.Ni(t,e))}Ci(t,e){return k.resolve(null)}xi(t,e,i,r){return function E_(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}(e)||r.isEqual(ht.min())?this.Ni(t,e):this.Di.getDocuments(t,i).next(a=>{const l=this.ki(e,a);return this.Oi(e,l,i,r)?this.Ni(t,e):(xn()<=Q.in.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ll(e)),this.Mi(t,l,e,function tu(n,t){const e=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=ht.fromTimestamp(1e9===i?new Yt(e+1,0):new Yt(e,i));return new ze(r,$.empty(),t)}(r,-1)))})}ki(t,e){let i=new Zt(Eu(t));return e.forEach((r,a)=>{cl(t,a)&&(i=i.add(a))}),i}Oi(t,e,i,r){if(null===t.limit)return!1;if(i.size!==e.size)return!0;const a="F"===t.limitType?e.last():e.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(r)>0)}Ni(t,e){return xn()<=Q.in.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",ll(e)),this.Di.getDocumentsMatchingQuery(t,e,ze.min())}Mi(t,e,i,r){return this.Di.getDocumentsMatchingQuery(t,i,r).next(a=>(e.forEach(l=>{a=a.insert(l.key,l)}),a))}}class Bm{constructor(t,e,i,r){this.persistence=t,this.Fi=e,this.wt=r,this.$i=new te(vt),this.Bi=new ui(a=>Hi(a),Xr),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(i)}qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Lh(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.$i))}}function jh(n,t){return El.apply(this,arguments)}function El(){return El=(0,C.Z)(function*(n,t){const e=X(n);return yield e.persistence.runTransaction("Handle user change","readonly",i=>{let r;return e.mutationQueue.getAllMutationBatches(i).next(a=>(r=a,e.qi(t),e.mutationQueue.getAllMutationBatches(i))).next(a=>{const l=[],u=[];let h=xt();for(const m of r){l.push(m.batchId);for(const v of m.mutations)h=h.add(v.key)}for(const m of a){u.push(m.batchId);for(const v of m.mutations)h=h.add(v.key)}return e.localDocuments.getDocuments(i,h).next(m=>({Ki:m,removedBatchIds:l,addedBatchIds:u}))})})}),El.apply(this,arguments)}function zm(n,t){const e=X(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=t.batch.keys(),a=e.Ui.newChangeBuffer({trackRemovals:!0});return function(l,u,h,m){const v=h.batch,x=v.keys();let O=k.resolve();return x.forEach(N=>{O=O.next(()=>m.getEntry(u,N)).next(q=>{const nt=h.docVersions.get(N);dt(null!==nt),q.version.compareTo(nt)<0&&(v.applyToRemoteDocument(q,h),q.isValidDocument()&&(q.setReadTime(h.commitVersion),m.addEntry(q)))})}),O.next(()=>l.mutationQueue.removeMutationBatch(u,v))}(e,i,t,a).next(()=>a.apply(i)).next(()=>e.mutationQueue.performConsistencyCheck(i)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(i,r,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(l){let u=xt();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u}(t))).next(()=>e.localDocuments.getDocuments(i,r))})}function Fh(n){const t=X(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Vs.getLastRemoteSnapshotVersion(e))}function Vm(n,t){const e=X(n),i=t.snapshotVersion;let r=e.$i;return e.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const l=e.Ui.newChangeBuffer({trackRemovals:!0});r=e.$i;const u=[];t.targetChanges.forEach((v,x)=>{const O=r.get(x);if(!O)return;u.push(e.Vs.removeMatchingKeys(a,v.removedDocuments,x).next(()=>e.Vs.addMatchingKeys(a,v.addedDocuments,x)));let N=O.withSequenceNumber(a.currentSequenceNumber);var q,nt,ut;t.targetMismatches.has(x)?N=N.withResumeToken(me.EMPTY_BYTE_STRING,ht.min()).withLastLimboFreeSnapshotVersion(ht.min()):v.resumeToken.approximateByteSize()>0&&(N=N.withResumeToken(v.resumeToken,i)),r=r.insert(x,N),nt=N,ut=v,(0===(q=O).resumeToken.approximateByteSize()||nt.snapshotVersion.toMicroseconds()-q.snapshotVersion.toMicroseconds()>=3e8||ut.addedDocuments.size+ut.modifiedDocuments.size+ut.removedDocuments.size>0)&&u.push(e.Vs.updateTargetData(a,N))});let h=Ue(),m=xt();if(t.documentUpdates.forEach(v=>{t.resolvedLimboDocuments.has(v)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(a,v))}),u.push(function Uh(n,t,e){let i=xt(),r=xt();return e.forEach(a=>i=i.add(a)),t.getEntries(n,i).next(a=>{let l=Ue();return e.forEach((u,h)=>{const m=a.get(u);h.isFoundDocument()!==m.isFoundDocument()&&(r=r.add(u)),h.isNoDocument()&&h.version.isEqual(ht.min())?(t.removeEntry(u,h.readTime),l=l.insert(u,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||0===h.version.compareTo(m.version)&&m.hasPendingWrites?(t.addEntry(h),l=l.insert(u,h)):U("LocalStore","Ignoring outdated watch update for ",u,". Current version:",m.version," Watch version:",h.version)}),{Gi:l,Qi:r}})}(a,l,t.documentUpdates).next(v=>{h=v.Gi,m=v.Qi})),!i.isEqual(ht.min())){const v=e.Vs.getLastRemoteSnapshotVersion(a).next(x=>e.Vs.setTargetsMetadata(a,a.currentSequenceNumber,i));u.push(v)}return k.waitFor(u).next(()=>l.apply(a)).next(()=>e.localDocuments.getLocalViewOfDocuments(a,h,m)).next(()=>h)}).then(a=>(e.$i=r,a))}function Jm(n,t){const e=X(n);return e.persistence.runTransaction("Get next mutation batch","readonly",i=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t)))}function er(n,t){const e=X(n);return e.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return e.Vs.getTargetData(i,t).next(a=>a?(r=a,k.resolve(r)):e.Vs.allocateTargetId(i).next(l=>(r=new hi(t,l,0,i.currentSequenceNumber),e.Vs.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=e.$i.get(i.targetId);return(null===r||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.$i=e.$i.insert(i.targetId,i),e.Bi.set(t,i.targetId)),i})}function nr(n,t,e){return Cl.apply(this,arguments)}function Cl(){return Cl=(0,C.Z)(function*(n,t,e){const i=X(n),r=i.$i.get(t),a=e?"readwrite":"readwrite-primary";try{e||(yield i.persistence.runTransaction("Release target",a,l=>i.persistence.referenceDelegate.removeTarget(l,r)))}catch(l){if(!si(l))throw l;U("LocalStore",`Failed to update sequence numbers for target ${t}: ${l}`)}i.$i=i.$i.remove(t),i.Bi.delete(r.target)}),Cl.apply(this,arguments)}function ma(n,t,e){const i=X(n);let r=ht.min(),a=xt();return i.persistence.runTransaction("Execute query","readonly",l=>function(u,h,m){const v=X(u),x=v.Bi.get(m);return void 0!==x?k.resolve(v.$i.get(x)):v.Vs.getTargetData(h,m)}(i,l,He(t)).next(u=>{if(u)return r=u.lastLimboFreeSnapshotVersion,i.Vs.getMatchingKeysForTargetId(l,u.targetId).next(h=>{a=h})}).next(()=>i.Fi.getDocumentsMatchingQuery(l,t,e?r:ht.min(),e?a:xt())).next(u=>(function zh(n,t,e){let i=ht.min();e.forEach((r,a)=>{a.readTime.compareTo(i)>0&&(i=a.readTime)}),n.Li.set(t,i)}(i,function Iu(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(t),u),{documents:u,ji:a})))}class Dl{constructor(){this.activeTargetIds=na()}Xi(t){this.activeTargetIds=this.activeTargetIds.add(t)}Zi(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Yi(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Gh{constructor(){this.Fr=new Dl,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t){return this.Fr.Xi(t),this.$r[t]||"not-current"}updateQueryState(t,e,i){this.$r[t]=e}removeLocalQueryTarget(t){this.Fr.Zi(t)}isLocalQueryTarget(t){return this.Fr.activeTargetIds.has(t)}clearQueryState(t){delete this.$r[t]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(t){return this.Fr.activeTargetIds.has(t)}start(){return this.Fr=new Dl,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Ym{Br(t){}shutdown(){}}class Kh{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(t){this.Gr.push(t)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){U("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Gr)t(0)}Kr(){U("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Gr)t(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Hm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class $m{constructor(t){this.jr=t.jr,this.Wr=t.Wr}zr(t){this.Hr=t}Jr(t){this.Yr=t}onMessage(t){this.Xr=t}close(){this.Wr()}send(t){this.jr(t)}Zr(){this.Hr()}eo(t){this.Yr(t)}no(t){this.Xr(t)}}class Wm extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.so=(t.ssl?"https":"http")+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(t,e,i,r,a){const l=this.oo(t,e);U("RestConnection","Sending: ",l,i);const u={};return this.uo(u,r,a),this.co(t,l,u,i).then(h=>(U("RestConnection","Received: ",h),h),h=>{throw zo("RestConnection",`${t} failed with error: `,h,"url: ",l,"request:",i),h})}ao(t,e,i,r,a,l){return this.ro(t,e,i,r,a)}uo(t,e,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+vn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((r,a)=>t[a]=r),i&&i.headers.forEach((r,a)=>t[a]=r)}oo(t,e){return`${this.so}/v1/${e}:${Hm[t]}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}co(t,e,i,r){return new Promise((a,l)=>{const u=new an;u.listenOnce(Qo.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case js.NO_ERROR:const m=u.getResponseJson();U("Connection","XHR received:",JSON.stringify(m)),a(m);break;case js.TIMEOUT:U("Connection",'RPC "'+t+'" timed out'),l(new B(D.DEADLINE_EXCEEDED,"Request time out"));break;case js.HTTP_ERROR:const v=u.getStatus();if(U("Connection",'RPC "'+t+'" failed with status:',v,"response text:",u.getResponseText()),v>0){const x=u.getResponseJson().error;if(x&&x.status&&x.message){const O=function(N){const q=N.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(q)>=0?q:D.UNKNOWN}(x.status);l(new B(O,x.message))}else l(new B(D.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new B(D.UNAVAILABLE,"Connection failed."));break;default:st()}}finally{U("Connection",'RPC "'+t+'" completed.')}});const h=JSON.stringify(r);u.send(e,"POST",h,i,15)})}ho(t,e,i){const r=[this.so,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ye(),l=Uo(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new Bo({})),this.uo(u.initMessageHeaders,e,i),(0,P.uI)()||(0,P.b$)()||(0,P.d)()||(0,P.w1)()||(0,P.Mn)()||(0,P.ru)()||(u.httpHeadersOverwriteParam="$httpHeaders");const h=r.join("");U("Connection","Creating WebChannel: "+h,u);const m=a.createWebChannel(h,u);let v=!1,x=!1;const O=new $m({jr:q=>{x?U("Connection","Not sending because WebChannel is closed:",q):(v||(U("Connection","Opening WebChannel transport."),m.open(),v=!0),U("Connection","WebChannel sending:",q),m.send(q))},Wr:()=>m.close()}),N=(q,nt,ut)=>{q.listen(nt,qt=>{try{ut(qt)}catch(Vt){setTimeout(()=>{throw Vt},0)}})};return N(m,qn.EventType.OPEN,()=>{x||U("Connection","WebChannel transport opened.")}),N(m,qn.EventType.CLOSE,()=>{x||(x=!0,U("Connection","WebChannel transport closed"),O.eo())}),N(m,qn.EventType.ERROR,q=>{x||(x=!0,zo("Connection","WebChannel transport errored:",q),O.eo(new B(D.UNAVAILABLE,"The operation could not be completed")))}),N(m,qn.EventType.MESSAGE,q=>{var nt;if(!x){const ut=q.data[0];dt(!!ut);const qt=ut,Vt=qt.error||(null===(nt=qt[0])||void 0===nt?void 0:nt.error);if(Vt){U("Connection","WebChannel received error:",Vt);const $t=Vt.status;let Le=function(oe){const Be=he[oe];if(void 0!==Be)return Uu(Be)}($t),fe=Vt.message;void 0===Le&&(Le=D.INTERNAL,fe="Unknown error status: "+$t+" with message "+Vt.message),x=!0,O.eo(new B(Le,fe)),m.close()}else U("Connection","WebChannel received:",ut),O.no(ut)}}),N(l,ni.STAT_EVENT,q=>{q.stat===Fs.PROXY?U("Connection","Detected buffering proxy"):q.stat===Fs.NOPROXY&&U("Connection","Detected no buffering proxy")}),setTimeout(()=>{O.Zr()},0),O}}function fa(){return"undefined"!=typeof document?document:null}function yo(n){return new Q_(n,!0)}class Ll{constructor(t,e,i=1e3,r=1.5,a=6e4){this.js=t,this.timerId=e,this.lo=i,this.fo=r,this._o=a,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(t){this.cancel();const e=Math.floor(this.wo+this.To()),i=Math.max(0,Date.now()-this.yo),r=Math.max(0,e-i);r>0&&U("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.wo} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,r,()=>(this.yo=Date.now(),t())),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class Hh{constructor(t,e,i,r,a,l,u,h){this.js=t,this.Ao=i,this.Ro=r,this.bo=a,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Ll(t,e)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}stop(){var t=this;return(0,C.Z)(function*(){t.Do()&&(yield t.close(0))})()}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,()=>this.Oo()))}Mo(t){this.Fo(),this.stream.send(t)}Oo(){var t=this;return(0,C.Z)(function*(){if(t.Co())return t.close(0)})()}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}close(t,e){var i=this;return(0,C.Z)(function*(){i.Fo(),i.$o(),i.So.cancel(),i.Po++,4!==t?i.So.reset():e&&e.code===D.RESOURCE_EXHAUSTED?(Kt(e.toString()),Kt("Using maximum backoff delay to prevent overloading the backend."),i.So.po()):e&&e.code===D.UNAUTHENTICATED&&3!==i.state&&(i.authCredentialsProvider.invalidateToken(),i.appCheckCredentialsProvider.invalidateToken()),null!==i.stream&&(i.Bo(),i.stream.close(),i.stream=null),i.state=t,yield i.listener.Jr(e)})()}Bo(){}auth(){this.state=1;const t=this.Lo(this.Po),e=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.Po===e&&this.Uo(i,r)},i=>{t(()=>{const r=new B(D.UNKNOWN,"Fetching auth token failed: "+i.message);return this.qo(r)})})}Uo(t,e){const i=this.Lo(this.Po);this.stream=this.Ko(t,e),this.stream.zr(()=>{i(()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,()=>(this.Co()&&(this.state=3),Promise.resolve())),this.listener.zr()))}),this.stream.Jr(r=>{i(()=>this.qo(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}xo(){var t=this;this.state=5,this.So.Io((0,C.Z)(function*(){t.state=0,t.start()}))}qo(t){return U("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Lo(t){return e=>{this.js.enqueueAndForget(()=>this.Po===t?e():(U("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Xm extends Hh{constructor(t,e,i,r,a,l){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,r,l),this.wt=a}Ko(t,e){return this.bo.ho("Listen",t,e)}onMessage(t){this.So.reset();const e=function V_(n,t){let e;if("targetChange"in t){const i="NO_CHANGE"===(h=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:st(),r=t.targetChange.targetIds||[],a=function(h,m){return h.dt?(dt(void 0===m||"string"==typeof m),me.fromBase64String(m||"")):(dt(void 0===m||m instanceof Uint8Array),me.fromUint8Array(m||new Uint8Array))}(n,t.targetChange.resumeToken),l=t.targetChange.cause,u=l&&function(h){const m=void 0===h.code?D.UNKNOWN:Uu(h.code);return new B(m,h.message||"")}(l);e=new Ju(i,r,a,u||null)}else if("documentChange"in t){const i=t.documentChange,r=bn(n,i.document.name),a=we(i.document.updateTime),l=new Oe({mapValue:{fields:i.document.fields}}),u=Ut.newFoundDocument(r,a,l);e=new ia(i.targetIds||[],i.removedTargetIds||[],u.key,u)}else if("documentDelete"in t){const i=t.documentDelete,r=bn(n,i.document),a=i.readTime?we(i.readTime):ht.min(),l=Ut.newNoDocument(r,a);e=new ia([],i.removedTargetIds||[],l.key,l)}else if("documentRemove"in t){const i=t.documentRemove,r=bn(n,i.document);e=new ia([],i.removedTargetIds||[],r,null)}else{if(!("filter"in t))return st();{const i=t.filter,a=new L_(i.count||0);e=new Vu(i.targetId,a)}}var h;return e}(this.wt,t),i=function(r){if(!("targetChange"in r))return ht.min();const a=r.targetChange;return a.targetIds&&a.targetIds.length?ht.min():a.readTime?we(a.readTime):ht.min()}(t);return this.listener.Go(e,i)}Qo(t){const e={};e.database=co(this.wt),e.addTarget=function(r,a){let l;const u=a.target;return l=$o(u)?{documents:nh(r,u)}:{query:ih(r,u)},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0?l.resumeToken=Hu(r,a.resumeToken):a.snapshotVersion.compareTo(ht.min())>0&&(l.readTime=ao(r,a.snapshotVersion.toTimestamp())),l}(this.wt,t);const i=function G_(n,t){const e=function(i,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return st()}}(0,t.purpose);return null==e?null:{"goog-listen-tags":e}}(0,t);i&&(e.labels=i),this.Mo(e)}jo(t){const e={};e.database=co(this.wt),e.removeTarget=t,this.Mo(e)}}class tg extends Hh{constructor(t,e,i,r,a,l){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,r,l),this.wt=a,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(t,e){return this.bo.ho("Write",t,e)}onMessage(t){if(dt(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Wo){this.So.reset();const e=function J_(n,t){return n&&n.length>0?(dt(void 0!==t),n.map(e=>function(i,r){let a=we(i.updateTime?i.updateTime:r);return a.isEqual(ht.min())&&(a=we(r)),new M_(a,i.transformResults||[])}(e,t))):[]}(t.writeResults,t.commitTime),i=we(t.commitTime);return this.listener.Jo(i,e)}return dt(!t.writeResults||0===t.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const t={};t.database=co(this.wt),this.Mo(t)}Ho(t){const e={streamToken:this.lastStreamToken,writes:t.map(i=>function uo(n,t){let e;if(t instanceof Ys)e={update:th(n,t.key,t.value)};else if(t instanceof Hs)e={delete:lo(n,t.key)};else if(t instanceof jn)e={update:th(n,t.key,t.data),updateMask:W_(t.fieldMask)};else{if(!(t instanceof ul))return st();e={verify:lo(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(i=>function(r,a){const l=a.transform;if(l instanceof Gs)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof $i)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Wi)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ks)return{fieldPath:a.field.canonicalString(),increment:l._t};throw st()}(0,i))),t.precondition.isNone||(e.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:B_(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:st()),e;var r}(this.wt,i))};this.Mo(e)}}class eg extends class{}{constructor(t,e,i,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.bo=i,this.wt=r,this.Zo=!1}tu(){if(this.Zo)throw new B(D.FAILED_PRECONDITION,"The client has already been terminated.")}ro(t,e,i){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,a])=>this.bo.ro(t,e,i,r,a)).catch(r=>{throw"FirebaseError"===r.name?(r.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new B(D.UNKNOWN,r.toString())})}ao(t,e,i,r){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.bo.ao(t,e,i,a,l,r)).catch(a=>{throw"FirebaseError"===a.name?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new B(D.UNKNOWN,a.toString())})}terminate(){this.Zo=!0}}class ng{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve())))}uu(t){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ru("Offline")))}set(t){this.cu(),this.eu=0,"Online"===t&&(this.su=!1),this.ru(t)}ru(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ou(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(Kt(e),this.su=!1):U("OnlineStateTracker",e)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class ig{constructor(t,e,i,r,a){var l=this;this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=a,this.du.Br(u=>{i.enqueueAndForget((0,C.Z)(function*(){var h;mi(l)&&(U("RemoteStore","Restarting streams for network reachability change."),yield(h=(0,C.Z)(function*(m){const v=X(m);v.lu.add(4),yield ir(v),v._u.set("Unknown"),v.lu.delete(4),yield wo(v)}),function(m){return h.apply(this,arguments)})(l))}))}),this._u=new ng(i,r)}}function wo(n){return Nl.apply(this,arguments)}function Nl(){return Nl=(0,C.Z)(function*(n){if(mi(n))for(const t of n.fu)yield t(!0)}),Nl.apply(this,arguments)}function ir(n){return Pl.apply(this,arguments)}function Pl(){return Pl=(0,C.Z)(function*(n){for(const t of n.fu)yield t(!1)}),Pl.apply(this,arguments)}function va(n,t){const e=X(n);e.hu.has(t.targetId)||(e.hu.set(t.targetId,t),jl(e)?Zl(e):rr(e).Co()&&ql(e,t))}function bo(n,t){const e=X(n),i=rr(e);e.hu.delete(t),i.Co()&&$h(e,t),0===e.hu.size&&(i.Co()?i.ko():mi(e)&&e._u.set("Unknown"))}function ql(n,t){n.wu.Nt(t.targetId),rr(n).Qo(t)}function $h(n,t){n.wu.Nt(t),rr(n).jo(t)}function Zl(n){n.wu=new j_({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),te:t=>n.hu.get(t)||null}),rr(n).start(),n._u.iu()}function jl(n){return mi(n)&&!rr(n).Do()&&n.hu.size>0}function mi(n){return 0===X(n).lu.size}function Wh(n){n.wu=void 0}function sg(n){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,C.Z)(function*(n){n.hu.forEach((t,e)=>{ql(n,t)})}),Fl.apply(this,arguments)}function rg(n,t){return Ul.apply(this,arguments)}function Ul(){return Ul=(0,C.Z)(function*(n,t){Wh(n),jl(n)?(n._u.uu(t),Zl(n)):n._u.set("Unknown")}),Ul.apply(this,arguments)}function og(n,t,e){return Ql.apply(this,arguments)}function Ql(){return Ql=(0,C.Z)(function*(n,t,e){if(n._u.set("Online"),t instanceof Ju&&2===t.state&&t.cause)try{yield(i=(0,C.Z)(function*(r,a){const l=a.cause;for(const u of a.targetIds)r.hu.has(u)&&(yield r.remoteSyncer.rejectListen(u,l),r.hu.delete(u),r.wu.removeTarget(u))}),function(r,a){return i.apply(this,arguments)})(n,t)}catch(i){U("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),yield xa(n,i)}else if(t instanceof ia?n.wu.Ut(t):t instanceof Vu?n.wu.zt(t):n.wu.Gt(t),!e.isEqual(ht.min()))try{const i=yield Fh(n.localStore);e.compareTo(i)>=0&&(yield function(r,a){const l=r.wu.Yt(a);return l.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const m=r.hu.get(h);m&&r.hu.set(h,m.withResumeToken(u.resumeToken,a))}}),l.targetMismatches.forEach(u=>{const h=r.hu.get(u);if(!h)return;r.hu.set(u,h.withResumeToken(me.EMPTY_BYTE_STRING,h.snapshotVersion)),$h(r,u);const m=new hi(h.target,u,1,h.sequenceNumber);ql(r,m)}),r.remoteSyncer.applyRemoteEvent(l)}(n,e))}catch(i){U("RemoteStore","Failed to raise snapshot:",i),yield xa(n,i)}var i}),Ql.apply(this,arguments)}function xa(n,t,e){return Bl.apply(this,arguments)}function Bl(){return Bl=(0,C.Z)(function*(n,t,e){if(!si(t))throw t;n.lu.add(1),yield ir(n),n._u.set("Offline"),e||(e=()=>Fh(n.localStore)),n.asyncQueue.enqueueRetryable((0,C.Z)(function*(){U("RemoteStore","Retrying IndexedDB access"),yield e(),n.lu.delete(1),yield wo(n)}))}),Bl.apply(this,arguments)}function Xh(n,t){return t().catch(e=>xa(n,e,t))}function sr(n){return zl.apply(this,arguments)}function zl(){return zl=(0,C.Z)(function*(n){const t=X(n),e=gi(t);let i=t.au.length>0?t.au[t.au.length-1].batchId:-1;for(;ag(t);)try{const r=yield Jm(t.localStore,i);if(null===r){0===t.au.length&&e.ko();break}i=r.batchId,lg(t,r)}catch(r){yield xa(t,r)}td(t)&&ed(t)}),zl.apply(this,arguments)}function ag(n){return mi(n)&&n.au.length<10}function lg(n,t){n.au.push(t);const e=gi(n);e.Co()&&e.zo&&e.Ho(t.mutations)}function td(n){return mi(n)&&!gi(n).Do()&&n.au.length>0}function ed(n){gi(n).start()}function cg(n){return Vl.apply(this,arguments)}function Vl(){return Vl=(0,C.Z)(function*(n){gi(n).Xo()}),Vl.apply(this,arguments)}function ug(n){return Jl.apply(this,arguments)}function Jl(){return Jl=(0,C.Z)(function*(n){const t=gi(n);for(const e of n.au)t.Ho(e.mutations)}),Jl.apply(this,arguments)}function hg(n,t,e){return Gl.apply(this,arguments)}function Gl(){return Gl=(0,C.Z)(function*(n,t,e){const i=n.au.shift(),r=pl.from(i,t,e);yield Xh(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield sr(n)}),Gl.apply(this,arguments)}function dg(n,t){return Kl.apply(this,arguments)}function Kl(){return Kl=(0,C.Z)(function*(n,t){var e;t&&gi(n).zo&&(yield(e=(0,C.Z)(function*(i,r){if(Fu(a=r.code)&&a!==D.ABORTED){const l=i.au.shift();gi(i).No(),yield Xh(i,()=>i.remoteSyncer.rejectFailedWrite(l.batchId,r)),yield sr(i)}var a}),function(i,r){return e.apply(this,arguments)})(n,t)),td(n)&&ed(n)}),Kl.apply(this,arguments)}function nd(n,t){return Yl.apply(this,arguments)}function Yl(){return Yl=(0,C.Z)(function*(n,t){const e=X(n);e.asyncQueue.verifyOperationInProgress(),U("RemoteStore","RemoteStore received new credentials");const i=mi(e);e.lu.add(3),yield ir(e),i&&e._u.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.lu.delete(3),yield wo(e)}),Yl.apply(this,arguments)}function $l(){return $l=(0,C.Z)(function*(n,t){const e=X(n);t?(e.lu.delete(2),yield wo(e)):t||(e.lu.add(2),yield ir(e),e._u.set("Unknown"))}),$l.apply(this,arguments)}function rr(n){return n.mu||(n.mu=function(t,e,i){const r=X(t);return r.tu(),new Xm(e,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,i)}(n.datastore,n.asyncQueue,{zr:sg.bind(null,n),Jr:rg.bind(null,n),Go:og.bind(null,n)}),n.fu.push(function(){var t=(0,C.Z)(function*(e){e?(n.mu.No(),jl(n)?Zl(n):n._u.set("Unknown")):(yield n.mu.stop(),Wh(n))});return function(e){return t.apply(this,arguments)}}())),n.mu}function gi(n){return n.gu||(n.gu=function(t,e,i){const r=X(t);return r.tu(),new tg(e,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,i)}(n.datastore,n.asyncQueue,{zr:cg.bind(null,n),Jr:dg.bind(null,n),Yo:ug.bind(null,n),Jo:hg.bind(null,n)}),n.fu.push(function(){var t=(0,C.Z)(function*(e){e?(n.gu.No(),yield sr(n)):(yield n.gu.stop(),n.au.length>0&&(U("RemoteStore",`Stopping write stream with ${n.au.length} pending writes`),n.au=[]))});return function(e){return t.apply(this,arguments)}}())),n.gu}class Wl{constructor(t,e,i,r,a){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=r,this.removalCallback=a,this.deferred=new ye,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(l=>{})}static createAndSchedule(t,e,i,r,a){const l=Date.now()+i,u=new Wl(t,e,l,r,a);return u.start(i),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new B(D.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function or(n,t){if(Kt("AsyncQueue",`${t}: ${n}`),si(n))return new B(D.UNAVAILABLE,`${t}: ${n}`);throw n}class ar{constructor(t){this.comparator=t?(e,i)=>t(e,i)||$.comparator(e.key,i.key):(e,i)=>$.comparator(e.key,i.key),this.keyedMap=io(),this.sortedSet=new te(this.comparator)}static emptySet(t){return new ar(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,i)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof ar)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){const r=e.getNext().key,a=i.getNext().key;if(!r.isEqual(a))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const i=new ar;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}}class id{constructor(){this.yu=new te($.comparator)}track(t){const e=t.doc.key,i=this.yu.get(e);i?0!==t.type&&3===i.type?this.yu=this.yu.insert(e,t):3===t.type&&1!==i.type?this.yu=this.yu.insert(e,{type:i.type,doc:t.doc}):2===t.type&&2===i.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===i.type?this.yu=this.yu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===i.type?this.yu=this.yu.remove(e):1===t.type&&2===i.type?this.yu=this.yu.insert(e,{type:1,doc:i.doc}):0===t.type&&1===i.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):st():this.yu=this.yu.insert(e,t)}pu(){const t=[];return this.yu.inorderTraversal((e,i)=>{t.push(i)}),t}}class lr{constructor(t,e,i,r,a,l,u,h){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=a,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h}static fromInitialDocuments(t,e,i,r){const a=[];return e.forEach(l=>{a.push({type:0,doc:l})}),new lr(t,e,ar.emptySet(e),a,i,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&to(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==i[r].type||!e[r].doc.isEqual(i[r].doc))return!1;return!0}}class _g{constructor(){this.Iu=void 0,this.listeners=[]}}class mg{constructor(){this.queries=new ui(t=>Au(t),to),this.onlineState="Unknown",this.Tu=new Set}}function Xl(n,t){return tc.apply(this,arguments)}function tc(){return tc=(0,C.Z)(function*(n,t){const e=X(n),i=t.query;let r=!1,a=e.queries.get(i);if(a||(r=!0,a=new _g),r)try{a.Iu=yield e.onListen(i)}catch(l){const u=or(l,`Initialization of query '${ll(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,a),a.listeners.push(t),t.Eu(e.onlineState),a.Iu&&t.Au(a.Iu)&&ic(e)}),tc.apply(this,arguments)}function ec(n,t){return nc.apply(this,arguments)}function nc(){return nc=(0,C.Z)(function*(n,t){const e=X(n),i=t.query;let r=!1;const a=e.queries.get(i);if(a){const l=a.listeners.indexOf(t);l>=0&&(a.listeners.splice(l,1),r=0===a.listeners.length)}if(r)return e.queries.delete(i),e.onUnlisten(i)}),nc.apply(this,arguments)}function gg(n,t){const e=X(n);let i=!1;for(const r of t){const l=e.queries.get(r.query);if(l){for(const u of l.listeners)u.Au(r)&&(i=!0);l.Iu=r}}i&&ic(e)}function pg(n,t,e){const i=X(n),r=i.queries.get(t);if(r)for(const a of r.listeners)a.onError(e);i.queries.delete(t)}function ic(n){n.Tu.forEach(t=>{t.next()})}class sc{constructor(t,e,i){this.query=t,this.Ru=e,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=i||{}}Au(t){if(!this.options.includeMetadataChanges){const i=[];for(const r of t.docChanges)3!==r.type&&i.push(r);t=new lr(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.bu?this.vu(t)&&(this.Ru.next(t),e=!0):this.Vu(t,this.onlineState)&&(this.Su(t),e=!0),this.Pu=t,e}onError(t){this.Ru.error(t)}Eu(t){this.onlineState=t;let e=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,t)&&(this.Su(this.Pu),e=!0),e}Vu(t,e){return!t.fromCache||!(this.options.Du&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)}vu(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Pu&&this.Pu.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Su(t){t=lr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.bu=!0,this.Ru.next(t)}}class od{constructor(t){this.key=t}}class ad{constructor(t){this.key=t}}class ld{constructor(t,e){this.query=t,this.Fu=e,this.$u=null,this.current=!1,this.Bu=xt(),this.mutatedKeys=xt(),this.Lu=Eu(t),this.Uu=new ar(this.Lu)}get qu(){return this.Fu}Ku(t,e){const i=e?e.Gu:new id,r=e?e.Uu:this.Uu;let a=e?e.mutatedKeys:this.mutatedKeys,l=r,u=!1;const h="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,m="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((v,x)=>{const O=r.get(v),N=cl(this.query,x)?x:null,q=!!O&&this.mutatedKeys.has(O.key),nt=!!N&&(N.hasLocalMutations||this.mutatedKeys.has(N.key)&&N.hasCommittedMutations);let ut=!1;O&&N?O.data.isEqual(N.data)?q!==nt&&(i.track({type:3,doc:N}),ut=!0):this.Qu(O,N)||(i.track({type:2,doc:N}),ut=!0,(h&&this.Lu(N,h)>0||m&&this.Lu(N,m)<0)&&(u=!0)):!O&&N?(i.track({type:0,doc:N}),ut=!0):O&&!N&&(i.track({type:1,doc:O}),ut=!0,(h||m)&&(u=!0)),ut&&(N?(l=l.add(N),a=nt?a.add(v):a.delete(v)):(l=l.delete(v),a=a.delete(v)))}),null!==this.query.limit)for(;l.size>this.query.limit;){const v="F"===this.query.limitType?l.last():l.first();l=l.delete(v.key),a=a.delete(v.key),i.track({type:1,doc:v})}return{Uu:l,Gu:i,Oi:u,mutatedKeys:a}}Qu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i){const r=this.Uu;this.Uu=t.Uu,this.mutatedKeys=t.mutatedKeys;const a=t.Gu.pu();a.sort((m,v)=>function(x,O){const N=q=>{switch(q){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return st()}};return N(x)-N(O)}(m.type,v.type)||this.Lu(m.doc,v.doc)),this.ju(i);const l=e?this.Wu():[],u=0===this.Bu.size&&this.current?1:0,h=u!==this.$u;return this.$u=u,0!==a.length||h?{snapshot:new lr(this.query,t.Uu,r,a,t.mutatedKeys,0===u,h,!1),zu:l}:{zu:l}}Eu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new id,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(t){return!this.Fu.has(t)&&!!this.Uu.has(t)&&!this.Uu.get(t).hasLocalMutations}ju(t){t&&(t.addedDocuments.forEach(e=>this.Fu=this.Fu.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Fu=this.Fu.delete(e)),this.current=t.current)}Wu(){if(!this.current)return[];const t=this.Bu;this.Bu=xt(),this.Uu.forEach(i=>{this.Hu(i.key)&&(this.Bu=this.Bu.add(i.key))});const e=[];return t.forEach(i=>{this.Bu.has(i)||e.push(new ad(i))}),this.Bu.forEach(i=>{t.has(i)||e.push(new od(i))}),e}Ju(t){this.Fu=t.ji,this.Bu=xt();const e=this.Ku(t.documents);return this.applyChanges(e,!0)}Yu(){return lr.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class xg{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}}class yg{constructor(t){this.key=t,this.Xu=!1}}class wg{constructor(t,e,i,r,a,l){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=r,this.currentUser=a,this.maxConcurrentLimboResolutions=l,this.Zu={},this.tc=new ui(u=>Au(u),to),this.ec=new Map,this.nc=new Set,this.sc=new te($.comparator),this.ic=new Map,this.rc=new wl,this.oc={},this.uc=new Map,this.cc=rs.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}function bg(n,t){return rc.apply(this,arguments)}function rc(){return rc=(0,C.Z)(function*(n,t){const e=Oc(n);let i,r;const a=e.tc.get(t);if(a)i=a.targetId,e.sharedClientState.addLocalQueryTarget(i),r=a.view.Yu();else{const l=yield er(e.localStore,He(t));e.isPrimaryClient&&va(e.remoteStore,l);const u=e.sharedClientState.addLocalQueryTarget(l.targetId);i=l.targetId,r=yield oc(e,t,i,"current"===u)}return r}),rc.apply(this,arguments)}function oc(n,t,e,i){return ac.apply(this,arguments)}function ac(){return ac=(0,C.Z)(function*(n,t,e,i){n.hc=(v,x,O)=>{return(N=(0,C.Z)(function*(q,nt,ut,qt){let Vt=nt.view.Ku(ut);Vt.Oi&&(Vt=yield ma(q.localStore,nt.query,!1).then(({documents:fe})=>nt.view.Ku(fe,Vt)));const $t=qt&&qt.targetChanges.get(nt.targetId),Le=nt.view.applyChanges(Vt,q.isPrimaryClient,$t);return fc(q,nt.targetId,Le.zu),Le.snapshot}),function(q,nt,ut,qt){return N.apply(this,arguments)})(n,v,x,O);var N};const r=yield ma(n.localStore,t,!0),a=new ld(t,r.ji),l=a.Ku(r.documents),u=oo.createSynthesizedTargetChangeForCurrentChange(e,i&&"Offline"!==n.onlineState),h=a.applyChanges(l,n.isPrimaryClient,u);fc(n,e,h.zu);const m=new xg(t,e,a);return n.tc.set(t,m),n.ec.has(e)?n.ec.get(e).push(t):n.ec.set(e,[t]),h.snapshot}),ac.apply(this,arguments)}function Tg(n,t){return lc.apply(this,arguments)}function lc(){return lc=(0,C.Z)(function*(n,t){const e=X(n),i=e.tc.get(t),r=e.ec.get(i.targetId);if(r.length>1)return e.ec.set(i.targetId,r.filter(a=>!to(a,t))),void e.tc.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||(yield nr(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),bo(e.remoteStore,i.targetId),cr(e,i.targetId)}).catch(ii))):(cr(e,i.targetId),yield nr(e.localStore,i.targetId,!0))}),lc.apply(this,arguments)}function cc(){return cc=(0,C.Z)(function*(n,t,e){const i=Sc(n);try{const r=yield function(a,l){const u=X(a),h=Yt.now(),m=l.reduce((O,N)=>O.add(N.key),xt());let v,x;return u.persistence.runTransaction("Locally write mutations","readwrite",O=>{let N=Ue(),q=xt();return u.Ui.getEntries(O,m).next(nt=>{N=nt,N.forEach((ut,qt)=>{qt.isValidDocument()||(q=q.add(ut))})}).next(()=>u.localDocuments.getOverlayedDocuments(O,N)).next(nt=>{v=nt;const ut=[];for(const qt of l){const Vt=R_(qt,v.get(qt.key).overlayedDocument);null!=Vt&&ut.push(new jn(qt.key,Vt,gu(Vt.value.mapValue),Ht.exists(!0)))}return u.mutationQueue.addMutationBatch(O,h,ut,l)}).next(nt=>{x=nt;const ut=nt.applyToLocalDocumentSet(v,q);return u.documentOverlayCache.saveOverlays(O,nt.batchId,ut)})}).then(()=>({batchId:x.batchId,changes:Bu(v)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(r.batchId),function(a,l,u){let h=a.oc[a.currentUser.toKey()];h||(h=new te(vt)),h=h.insert(l,u),a.oc[a.currentUser.toKey()]=h}(i,r.batchId,e),yield Fn(i,r.changes),yield sr(i.remoteStore)}catch(r){const a=or(r,"Failed to persist write");e.reject(a)}}),cc.apply(this,arguments)}function cd(n,t){return uc.apply(this,arguments)}function uc(){return uc=(0,C.Z)(function*(n,t){const e=X(n);try{const i=yield Vm(e.localStore,t);t.targetChanges.forEach((r,a)=>{const l=e.ic.get(a);l&&(dt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?l.Xu=!0:r.modifiedDocuments.size>0?dt(l.Xu):r.removedDocuments.size>0&&(dt(l.Xu),l.Xu=!1))}),yield Fn(e,i,t)}catch(i){yield ii(i)}}),uc.apply(this,arguments)}function ud(n,t,e){const i=X(n);if(i.isPrimaryClient&&0===e||!i.isPrimaryClient&&1===e){const r=[];i.tc.forEach((a,l)=>{const u=l.view.Eu(t);u.snapshot&&r.push(u.snapshot)}),function(a,l){const u=X(a);u.onlineState=l;let h=!1;u.queries.forEach((m,v)=>{for(const x of v.listeners)x.Eu(l)&&(h=!0)}),h&&ic(u)}(i.eventManager,t),r.length&&i.Zu.Go(r),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}function Ig(n,t,e){return hc.apply(this,arguments)}function hc(){return hc=(0,C.Z)(function*(n,t,e){const i=X(n);i.sharedClientState.updateQueryState(t,"rejected",e);const r=i.ic.get(t),a=r&&r.key;if(a){let l=new te($.comparator);l=l.insert(a,Ut.newNoDocument(a,ht.min()));const u=xt().add(a),h=new ro(ht.min(),new Map,new Zt(vt),l,u);yield cd(i,h),i.sc=i.sc.remove(a),i.ic.delete(t),vc(i)}else yield nr(i.localStore,t,!1).then(()=>cr(i,t,e)).catch(ii)}),hc.apply(this,arguments)}function Eg(n,t){return dc.apply(this,arguments)}function dc(){return dc=(0,C.Z)(function*(n,t){const e=X(n),i=t.batch.batchId;try{const r=yield zm(e.localStore,t);pc(e,i,null),gc(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),yield Fn(e,r)}catch(r){yield ii(r)}}),dc.apply(this,arguments)}function Cg(n,t,e){return _c.apply(this,arguments)}function _c(){return _c=(0,C.Z)(function*(n,t,e){const i=X(n);try{const r=yield function(a,l){const u=X(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let m;return u.mutationQueue.lookupMutationBatch(h,l).next(v=>(dt(null!==v),m=v.keys(),u.mutationQueue.removeMutationBatch(h,v))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,m,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,m)).next(()=>u.localDocuments.getDocuments(h,m))})}(i.localStore,t);pc(i,t,e),gc(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),yield Fn(i,r)}catch(r){yield ii(r)}}),_c.apply(this,arguments)}function gc(n,t){(n.uc.get(t)||[]).forEach(e=>{e.resolve()}),n.uc.delete(t)}function pc(n,t,e){const i=X(n);let r=i.oc[i.currentUser.toKey()];if(r){const a=r.get(t);a&&(e?a.reject(e):a.resolve(),r=r.remove(t)),i.oc[i.currentUser.toKey()]=r}}function cr(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const i of n.ec.get(t))n.tc.delete(i),e&&n.Zu.lc(i,e);n.ec.delete(t),n.isPrimaryClient&&n.rc.us(t).forEach(i=>{n.rc.containsKey(i)||hd(n,i)})}function hd(n,t){n.nc.delete(t.path.canonicalString());const e=n.sc.get(t);null!==e&&(bo(n.remoteStore,e),n.sc=n.sc.remove(t),n.ic.delete(e),vc(n))}function fc(n,t,e){for(const i of e)i instanceof od?(n.rc.addReference(i.key,t),Sg(n,i)):i instanceof ad?(U("SyncEngine","Document no longer in limbo: "+i.key),n.rc.removeReference(i.key,t),n.rc.containsKey(i.key)||hd(n,i.key)):st()}function Sg(n,t){const e=t.key,i=e.path.canonicalString();n.sc.get(e)||n.nc.has(i)||(U("SyncEngine","New document in limbo: "+e),n.nc.add(i),vc(n))}function vc(n){for(;n.nc.size>0&&n.sc.size<n.maxConcurrentLimboResolutions;){const t=n.nc.values().next().value;n.nc.delete(t);const e=new $(Tt.fromString(t)),i=n.cc.next();n.ic.set(i,new yg(e)),n.sc=n.sc.insert(e,i),va(n.remoteStore,new hi(He(Vs(e.path)),i,2,Fe.ot))}}function Fn(n,t,e){return xc.apply(this,arguments)}function xc(){return xc=(0,C.Z)(function*(n,t,e){const i=X(n),r=[],a=[],l=[];var u;i.tc.isEmpty()||(i.tc.forEach((u,h)=>{l.push(i.hc(h,t,e).then(m=>{if(m){i.isPrimaryClient&&i.sharedClientState.updateQueryState(h.targetId,m.fromCache?"not-current":"current"),r.push(m);const v=Il.Vi(h.targetId,m);a.push(v)}}))}),yield Promise.all(l),i.Zu.Go(r),yield(u=(0,C.Z)(function*(h,m){const v=X(h);try{yield v.persistence.runTransaction("notifyLocalViewChanges","readwrite",x=>k.forEach(m,O=>k.forEach(O.Pi,N=>v.persistence.referenceDelegate.addReference(x,O.targetId,N)).next(()=>k.forEach(O.vi,N=>v.persistence.referenceDelegate.removeReference(x,O.targetId,N)))))}catch(x){if(!si(x))throw x;U("LocalStore","Failed to update sequence numbers: "+x)}for(const x of m){const O=x.targetId;if(!x.fromCache){const N=v.$i.get(O),nt=N.withLastLimboFreeSnapshotVersion(N.snapshotVersion);v.$i=v.$i.insert(O,nt)}}}),function(h,m){return u.apply(this,arguments)})(i.localStore,a))}),xc.apply(this,arguments)}function kg(n,t){return yc.apply(this,arguments)}function yc(){return yc=(0,C.Z)(function*(n,t){const e=X(n);if(!e.currentUser.isEqual(t)){U("SyncEngine","User change. New user:",t.toKey());const i=yield jh(e.localStore,t);e.currentUser=t,(r=e).uc.forEach(l=>{l.forEach(u=>{u.reject(new B(D.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.uc.clear(),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),yield Fn(e,i.Ki)}var r}),yc.apply(this,arguments)}function Mg(n,t){const e=X(n),i=e.ic.get(t);if(i&&i.Xu)return xt().add(i.key);{let r=xt();const a=e.ec.get(t);if(!a)return r;for(const l of a){const u=e.tc.get(l);r=r.unionWith(u.view.qu)}return r}}function Oc(n){const t=X(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=cd.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ig.bind(null,t),t.Zu.Go=gg.bind(null,t.eventManager),t.Zu.lc=pg.bind(null,t.eventManager),t}function Sc(n){const t=X(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Eg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Cg.bind(null,t),t}class Fg{constructor(){this.synchronizeTabs=!1}initialize(t){var e=this;return(0,C.Z)(function*(){e.wt=yo(t.databaseInfo.databaseId),e.sharedClientState=e.dc(t),e.persistence=e._c(t),yield e.persistence.start(),e.localStore=e.wc(t),e.gcScheduler=e.mc(t,e.localStore),e.indexBackfillerScheduler=e.gc(t,e.localStore)})()}mc(t,e){return null}gc(t,e){return null}wc(t){return function Zh(n,t,e,i){return new Bm(n,t,e,i)}(this.persistence,new qh,t.initialUser,this.wt)}_c(t){return new Nh(da.Ms,this.wt)}dc(t){return new Gh}terminate(){var t=this;return(0,C.Z)(function*(){t.gcScheduler&&t.gcScheduler.stop(),yield t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}class kc{initialize(t,e){var i=this;return(0,C.Z)(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(e),i.remoteStore=i.createRemoteStore(e),i.eventManager=i.createEventManager(e),i.syncEngine=i.createSyncEngine(e,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=r=>ud(i.syncEngine,r,1),i.remoteStore.remoteSyncer.handleCredentialChange=kg.bind(null,i.syncEngine),yield function Hl(n,t){return $l.apply(this,arguments)}(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new mg}createDatastore(t){const e=yo(t.databaseInfo.databaseId),i=new Wm(t.databaseInfo);return new eg(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return e=this.localStore,i=this.datastore,r=t.asyncQueue,a=u=>ud(this.syncEngine,u,0),l=Kh.V()?new Kh:new Ym,new ig(e,i,r,a,l);var e,i,r,a,l}createSyncEngine(t,e){return function(i,r,a,l,u,h,m){const v=new wg(i,r,a,l,u,h);return m&&(v.ac=!0),v}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return(t=(0,C.Z)(function*(e){const i=X(e);U("RemoteStore","RemoteStore shutting down."),i.lu.add(5),yield ir(i),i.du.shutdown(),i._u.set("Unknown")}),function(e){return t.apply(this,arguments)})(this.remoteStore);var t}}class ya{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ic(this.observer.next,t)}error(t){this.observer.error?this.Ic(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Tc(){this.muted=!0}Ic(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Jg{constructor(t,e,i,r){var a=this;this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=r,this.user=se.UNAUTHENTICATED,this.clientId=Wc.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,function(){var l=(0,C.Z)(function*(u){U("FirestoreClient","Received user=",u.uid),yield a.authCredentialListener(u),a.user=u});return function(u){return l.apply(this,arguments)}}()),this.appCheckCredentials.start(i,l=>(U("FirestoreClient","Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}getConfiguration(){var t=this;return(0,C.Z)(function*(){return{asyncQueue:t.asyncQueue,databaseInfo:t.databaseInfo,clientId:t.clientId,authCredentials:t.authCredentials,appCheckCredentials:t.appCheckCredentials,initialUser:t.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new B(D.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var t=this;this.asyncQueue.enterRestrictedMode();const e=new ye;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,C.Z)(function*(){try{t.onlineComponents&&(yield t.onlineComponents.terminate()),t.offlineComponents&&(yield t.offlineComponents.terminate()),t.authCredentials.shutdown(),t.appCheckCredentials.shutdown(),e.resolve()}catch(i){const r=or(i,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}function gd(n,t){return Mc.apply(this,arguments)}function Mc(){return Mc=(0,C.Z)(function*(n,t){n.asyncQueue.verifyOperationInProgress(),U("FirestoreClient","Initializing OfflineComponentProvider");const e=yield n.getConfiguration();yield t.initialize(e);let i=e.initialUser;n.setCredentialChangeListener(function(){var r=(0,C.Z)(function*(a){i.isEqual(a)||(yield jh(t.localStore,a),i=a)});return function(a){return r.apply(this,arguments)}}()),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=t}),Mc.apply(this,arguments)}function pd(n,t){return Dc.apply(this,arguments)}function Dc(){return Dc=(0,C.Z)(function*(n,t){n.asyncQueue.verifyOperationInProgress();const e=yield Rc(n);U("FirestoreClient","Initializing OnlineComponentProvider");const i=yield n.getConfiguration();yield t.initialize(e,i),n.setCredentialChangeListener(r=>nd(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,a)=>nd(t.remoteStore,a)),n.onlineComponents=t}),Dc.apply(this,arguments)}function Rc(n){return Lc.apply(this,arguments)}function Lc(){return Lc=(0,C.Z)(function*(n){return n.offlineComponents||(U("FirestoreClient","Using default OfflineComponentProvider"),yield gd(n,new Fg)),n.offlineComponents}),Lc.apply(this,arguments)}function wa(n){return Nc.apply(this,arguments)}function Nc(){return Nc=(0,C.Z)(function*(n){return n.onlineComponents||(U("FirestoreClient","Using default OnlineComponentProvider"),yield pd(n,new kc)),n.onlineComponents}),Nc.apply(this,arguments)}function ur(n){return Zc.apply(this,arguments)}function Zc(){return Zc=(0,C.Z)(function*(n){const t=yield wa(n),e=t.eventManager;return e.onListen=bg.bind(null,t.syncEngine),e.onUnlisten=Tg.bind(null,t.syncEngine),e}),Zc.apply(this,arguments)}const wd=new Map;function jc(n,t,e){if(!e)throw new B(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function bd(n){if(!$.isDocumentKey(n))throw new B(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Td(n){if($.isDocumentKey(n))throw new B(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ba(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const t=(e=n).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}}var e;return"function"==typeof n?"a function":st()}function It(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new B(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=ba(n);throw new B(D.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}class Id{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new B(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new B(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function ep(n,t,e,i){if(!0===t&&!0===i)throw new B(D.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class To{constructor(t,e,i){this._authCredentials=e,this._appCheckCredentials=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Id({}),this._settingsFrozen=!1,t instanceof oi?this._databaseId=t:(this._app=t,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new B(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oi(r.options.projectId)}(t))}get app(){if(!this._app)throw new B(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new B(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Id(t),void 0!==t.credentials&&(this._authCredentials=function(e){if(!e)return new Xd;switch(e.type){case"gapi":const i=e.client;return dt(!("object"!=typeof i||null===i||!i.auth||!i.auth.getAuthHeaderValueForFirstParty)),new i_(i,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new B(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=wd.get(t);e&&(U("ComponentProvider","Removing Datastore"),wd.delete(t),e.terminate())}(this),Promise.resolve()}}class re{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new An(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new re(this.firestore,t,this._key)}}class Re{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new Re(this.firestore,t,this._query)}}class An extends Re{constructor(t,e,i){super(t,e,Vs(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new re(this.firestore,null,new $(t))}withConverter(t){return new An(this.firestore,t,this._path)}}function Ao(n,t,...e){if(n=(0,P.m9)(n),jc("collection","path",t),n instanceof To){const i=Tt.fromString(t,...e);return Td(i),new An(n,null,i)}{if(!(n instanceof re||n instanceof An))throw new B(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Tt.fromString(t,...e));return Td(i),new An(n.firestore,null,i)}}function hr(n,t,...e){if(n=(0,P.m9)(n),1===arguments.length&&(t=Wc.I()),jc("doc","path",t),n instanceof To){const i=Tt.fromString(t,...e);return bd(i),new re(n,null,new $(i))}{if(!(n instanceof re||n instanceof An))throw new B(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Tt.fromString(t,...e));return bd(i),new re(n.firestore,n instanceof An?n.converter:null,new $(i))}}class ip{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Ll(this,"async_queue_retry"),this.Kc=()=>{const e=fa();e&&U("AsyncQueue","Visibility state changed to "+e.visibilityState),this.So.Eo()};const t=fa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Gc(),this.Qc(t)}enterRestrictedMode(t){if(!this.Fc){this.Fc=!0,this.Uc=t||!1;const e=fa();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Kc)}}enqueue(t){if(this.Gc(),this.Fc)return new Promise(()=>{});const e=new ye;return this.Qc(()=>this.Fc&&this.Uc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Mc.push(t),this.jc()))}jc(){var t=this;return(0,C.Z)(function*(){if(0!==t.Mc.length){try{yield t.Mc[0](),t.Mc.shift(),t.So.reset()}catch(e){if(!si(e))throw e;U("AsyncQueue","Operation failed with retryable error: "+e)}t.Mc.length>0&&t.So.Io(()=>t.jc())}})()}Qc(t){const e=this.Oc.then(()=>(this.Lc=!0,t().catch(i=>{throw this.Bc=i,this.Lc=!1,Kt("INTERNAL UNHANDLED ERROR: ",function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),l}(i)),i}).then(i=>(this.Lc=!1,i))));return this.Oc=e,e}enqueueAfterDelay(t,e,i){this.Gc(),this.qc.indexOf(t)>-1&&(e=0);const r=Wl.createAndSchedule(this,t,e,i,a=>this.Wc(a));return this.$c.push(r),r}Gc(){this.Bc&&st()}verifyOperationInProgress(){}zc(){var t=this;return(0,C.Z)(function*(){let e;do{e=t.Oc,yield e}while(e!==t.Oc)})()}Hc(t){for(const e of this.$c)if(e.timerId===t)return!0;return!1}Jc(t){return this.zc().then(()=>{this.$c.sort((e,i)=>e.targetTimeMs-i.targetTimeMs);for(const e of this.$c)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.zc()})}Yc(t){this.qc.push(t)}Wc(t){const e=this.$c.indexOf(t);this.$c.splice(e,1)}}function Fc(n){return function(t,e){if("object"!=typeof t||null===t)return!1;const i=t;for(const r of["next","error","complete"])if(r in i&&"function"==typeof i[r])return!0;return!1}(n)}class zt extends To{constructor(t,e,i){super(t,e,i),this.type="firestore",this._queue=new ip,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Ed(this),this._firestoreClient.terminate()}}function Uc(n=(0,et.getApp)()){return(0,et._getProvider)(n,"firestore").getImmediate()}function ge(n){return n._firestoreClient||Ed(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Ed(n){var t;const e=n._freezeSettings(),i=(a=(null===(t=n._app)||void 0===t?void 0:t.options.appId)||"",new __(n._databaseId,a,n._persistenceKey,(u=e).host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,u.useFetchStreams));var a,u;n._firestoreClient=new Jg(n._authCredentials,n._appCheckCredentials,n._queue,i)}class dr{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new B(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class as{constructor(t){this._byteString=t}static fromBase64String(t){try{return new as(me.fromBase64String(t))}catch(e){throw new B(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new as(me.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Sd{constructor(t){this._methodName=t}}class Qc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new B(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new B(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return vt(this._lat,t._lat)||vt(this._long,t._long)}}const op=/^__.*__$/;class ap{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return null!==this.fieldMask?new jn(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ys(t,this.data,e,this.fieldTransforms)}}function Md(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw st()}}class Ta{constructor(t,e,i,r,a,l){this.settings=t,this.databaseId=e,this.wt=i,this.ignoreUndefinedProperties=r,void 0===a&&this.Xc(),this.fieldTransforms=a||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(t){return new Ta(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(t){var e;const i=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ta({path:i,na:!1});return r.sa(t),r}ia(t){var e;const i=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ta({path:i,na:!1});return r.Xc(),r}ra(t){return this.ta({path:void 0,na:!0})}oa(t){return Ia(t,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Xc(){if(this.path)for(let t=0;t<this.path.length;t++)this.sa(this.path.get(t))}sa(t){if(0===t.length)throw this.oa("Document fields must not be empty");if(Md(this.Zc)&&op.test(t))throw this.oa('Document fields cannot begin and end with "__"')}}class lp{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.wt=i||yo(t)}aa(t,e,i,r=!1){return new Ta({Zc:t,methodName:e,ca:i,path:ue.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function _r(n){const t=n._freezeSettings(),e=yo(n._databaseId);return new lp(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Bc(n,t,e,i,r,a={}){const l=n.aa(a.merge||a.mergeFields?2:0,t,e,r);Vc("Data must be an object, but it was:",l,i);const u=Pd(i,l);let h,m;if(a.merge)h=new Ve(l.fieldMask),m=l.fieldTransforms;else if(a.mergeFields){const v=[];for(const x of a.mergeFields){const O=Jc(t,x,e);if(!l.contains(O))throw new B(D.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);Zd(v,O)||v.push(O)}h=new Ve(v),m=l.fieldTransforms.filter(x=>h.covers(x.field))}else h=null,m=l.fieldTransforms;return new ap(new Oe(u),h,m)}function ls(n,t){if(qd(n=(0,P.m9)(n)))return Vc("Unsupported field value:",t,n),Pd(n,t);if(n instanceof Sd)return function(e,i){if(!Md(i.Zc))throw i.oa(`${e._methodName}() can only be used with update() and set()`);if(!i.path)throw i.oa(`${e._methodName}() is not currently supported inside arrays`);const r=e._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(n,t),null;if(void 0===n&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.na&&4!==t.Zc)throw t.oa("Nested arrays are not supported");return function(e,i){const r=[];let a=0;for(const l of e){let u=ls(l,i.ra(a));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),a++}return{arrayValue:{values:r}}}(n,t)}return function(e,i){if(null===(e=(0,P.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Su(i.wt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const r=Yt.fromDate(e);return{timestampValue:ao(i.wt,r)}}if(e instanceof Yt){const r=new Yt(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ao(i.wt,r)}}if(e instanceof Qc)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof as)return{bytesValue:Hu(i.wt,e._byteString)};if(e instanceof re){const r=i.databaseId,a=e.firestore._databaseId;if(!a.isEqual(r))throw i.oa(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:hl(e.firestore._databaseId||i.databaseId,e._key.path)}}throw i.oa(`Unsupported field value: ${ba(e)}`)}(n,t)}function Pd(n,t){const e={};return ru(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ji(n,(i,r)=>{const a=ls(r,t.ea(i));null!=a&&(e[i]=a)}),{mapValue:{fields:e}}}function qd(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Yt||n instanceof Qc||n instanceof as||n instanceof re||n instanceof Sd)}function Vc(n,t,e){if(!qd(e)||"object"!=typeof(i=e)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const i=ba(e);throw t.oa("an object"===i?n+" a custom object":n+" "+i)}var i}function Jc(n,t,e){if((t=(0,P.m9)(t))instanceof dr)return t._internalPath;if("string"==typeof t)return Aa(n,t);throw Ia("Field path arguments must be of type string or ",n,!1,void 0,e)}const dp=new RegExp("[~\\*/\\[\\]]");function Aa(n,t,e){if(t.search(dp)>=0)throw Ia(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new dr(...t.split("."))._internalPath}catch(i){throw Ia(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Ia(n,t,e,i,r){const a=i&&!i.isEmpty(),l=void 0!==r;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(a||l)&&(h+=" (found",a&&(h+=` in field ${i}`),l&&(h+=` in document ${r}`),h+=")"),new B(D.INVALID_ARGUMENT,u+n+h)}function Zd(n,t){return n.some(e=>e.isEqual(t))}class Gc{constructor(t,e,i,r,a){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=r,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new re(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new _p(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Ea("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class _p extends Gc{data(){return super.data()}}function Ea(n,t){return"string"==typeof t?Aa(n,t):t instanceof dr?t._internalPath:t._delegate._internalPath}class cs{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class mr extends Gc{constructor(t,e,i,r,a,l){super(t,e,i,r,l),this._firestore=t,this._firestoreImpl=t,this.metadata=a}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ca(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const i=this._document.data.field(Ea("DocumentSnapshot.get",t));if(null!==i)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}}class Ca extends mr{data(t={}){return super.data(t)}}class gr{constructor(t,e,i,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new cs(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(i=>{t.call(e,new Ca(this._firestore,this._userDataWriter,i.key,i,new cs(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new B(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>({type:"added",doc:new Ca(i._firestore,i._userDataWriter,l.doc.key,l.doc,new cs(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>r||3!==l.type).map(l=>{const u=new Ca(i._firestore,i._userDataWriter,l.doc.key,l.doc,new cs(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,m=-1;return 0!==l.type&&(h=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),1!==l.type&&(a=a.add(l.doc),m=a.indexOf(l.doc.key)),{type:mp(l.type),doc:u,oldIndex:h,newIndex:m}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function mp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return st()}}function jd(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new B(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Fd(n,...t){for(const e of t)n=e._apply(n);return n}class pp extends class gp{}{constructor(t,e,i){super(),this.fa=t,this.da=e,this._a=i,this.type="where"}_apply(t){const e=_r(t.firestore),i=function(r,a,l,u,h,m,v){let x;if(h.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new B(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){Gd(v,m);const N=[];for(const q of v)N.push(Jd(u,r,q));x={arrayValue:{values:N}}}else x=Jd(u,r,v)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||Gd(v,m),x=function Nd(n,t,e,i=!1){return ls(e,n.aa(i?4:3,t))}(l,"where",v,"in"===m||"not-in"===m);const O=Se.create(h,m,x);return function(N,q){if(q.ht()){const ut=ol(N);if(null!==ut&&!ut.isEqual(q.field))throw new B(D.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${ut.toString()}' and '${q.field.toString()}'`);const qt=rl(N);null!==qt&&function Kd(n,t,e){if(!e.isEqual(t))throw new B(D.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${e.toString()}' instead.`)}(0,q.field,qt)}const nt=function(ut,qt){for(const Vt of ut.filters)if(qt.indexOf(Vt.op)>=0)return Vt.op;return null}(N,function(ut){switch(ut){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(q.op));if(null!==nt)throw new B(D.INVALID_ARGUMENT,nt===q.op?`Invalid query. You cannot use more than one '${q.op.toString()}' filter.`:`Invalid query. You cannot use '${q.op.toString()}' filters with '${nt.toString()}' filters.`)}(r,O),O}(t._query,0,e,t.firestore._databaseId,this.fa,this.da,this._a);return new Re(t.firestore,t.converter,function(r,a){const l=r.filters.concat([a]);return new Zn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),l,r.limit,r.limitType,r.startAt,r.endAt)}(t._query,i))}}function Ud(n,t,e){const i=t,r=Ea("where",n);return new pp(r,i,e)}function Jd(n,t,e){if("string"==typeof(e=(0,P.m9)(e))){if(""===e)throw new B(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!al(t)&&-1!==e.indexOf("/"))throw new B(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const i=t.path.child(Tt.fromString(e));if(!$.isDocumentKey(i))throw new B(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Yi(n,new $(i))}if(e instanceof re)return Yi(n,e._key);throw new B(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ba(e)}.`)}function Gd(n,t){if(!Array.isArray(n)||0===n.length)throw new B(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(n.length>10)throw new B(D.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}class us extends class xp{convertValue(t,e="none"){switch(Ki(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ee(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Gi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw st()}}convertObject(t,e){const i={};return Ji(t.fields,(r,a)=>{i[r]=this.convertValue(a,e)}),i}convertGeoPoint(t){return new Qc(ee(t.latitude),ee(t.longitude))}convertArray(t,e){return(t.values||[]).map(i=>this.convertValue(i,e))}convertServerTimestamp(t,e){switch(e){case"previous":const i=au(t);return null==i?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(Gr(t));default:return null}}convertTimestamp(t){const e=ri(t);return new Yt(e.seconds,e.nanos)}convertDocumentKey(t,e){const i=Tt.fromString(t);dt(oh(i));const r=new oi(i.get(1),i.get(3)),a=new $(i.popFirst(5));return r.isEqual(e)||Kt(`Document ${a} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),a}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new as(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new re(this.firestore,null,e)}}function Yd(n){n=It(n,Re);const t=It(n.firestore,zt),e=ge(t),i=new us(t);return jd(n._query),function yd(n,t,e={}){const i=new ye;return n.asyncQueue.enqueueAndForget((0,C.Z)(function*(){return function(r,a,l,u,h){const m=new ya({next:x=>{a.enqueueAndForget(()=>ec(r,v)),x.fromCache&&"server"===u.source?h.reject(new B(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(x)},error:x=>h.reject(x)}),v=new sc(l,m,{includeMetadataChanges:!0,Du:!0});return Xl(r,v)}(yield ur(n),n.asyncQueue,t,e,i)})),i.promise}(e,n._query).then(r=>new gr(t,i,n,r))}function Hd(n,t,e){n=It(n,re);const i=It(n.firestore,zt),r=function Kc(n,t,e){let i;return i=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,i}(n.converter,t,e);return Eo(i,[Bc(_r(i),"setDoc",n._key,r,null!==n.converter,e).toMutation(n._key,Ht.none())])}function Sa(n,...t){var e,i,r;n=(0,P.m9)(n);let a={includeMetadataChanges:!1},l=0;"object"!=typeof t[l]||Fc(t[l])||(a=t[l],l++);const u={includeMetadataChanges:a.includeMetadataChanges};if(Fc(t[l])){const x=t[l];t[l]=null===(e=x.next)||void 0===e?void 0:e.bind(x),t[l+1]=null===(i=x.error)||void 0===i?void 0:i.bind(x),t[l+2]=null===(r=x.complete)||void 0===r?void 0:r.bind(x)}let h,m,v;if(n instanceof re)m=It(n.firestore,zt),v=Vs(n._key.path),h={next:x=>{t[l]&&t[l](Yc(m,n,x))},error:t[l+1],complete:t[l+2]};else{const x=It(n,Re);m=It(x.firestore,zt),v=x._query;const O=new us(m);h={next:N=>{t[l]&&t[l](new gr(m,O,x,N))},error:t[l+1],complete:t[l+2]},jd(n._query)}return function(x,O,N,q){const nt=new ya(q),ut=new sc(O,nt,N);return x.asyncQueue.enqueueAndForget((0,C.Z)(function*(){return Xl(yield ur(x),ut)})),()=>{nt.Tc(),x.asyncQueue.enqueueAndForget((0,C.Z)(function*(){return ec(yield ur(x),ut)}))}}(ge(m),v,u,h)}function Eo(n,t){return function(e,i){const r=new ye;return e.asyncQueue.enqueueAndForget((0,C.Z)(function*(){return function Ag(n,t,e){return cc.apply(this,arguments)}(yield function qc(n){return wa(n).then(t=>t.syncEngine)}(e),i,r)})),r.promise}(ge(n),t)}function Yc(n,t,e){const i=e.docs.get(t._key),r=new us(n);return new mr(n,r,t._key,i,new cs(e.hasPendingWrites,e.fromCache),t.converter)}!function(n,t=!0){vn=et.SDK_VERSION,(0,et._registerComponent)(new M.wA("firestore",(e,{options:i})=>{const r=e.getProvider("app").getImmediate(),a=new zt(r,new e_(e.getProvider("auth-internal")),new s_(e.getProvider("app-check-internal")));return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC")),(0,et.registerVersion)(Br,"3.4.11",n),(0,et.registerVersion)(Br,"3.4.11","esm2017")}();var pe=w(34202),Wd=w(92340),ka=w(5e3),Ap=w(75929),Ip=w(88386),Ep=w(35018);let Cp=(()=>{class n{constructor(e,i,r){this.firestoreServiceApi=e,this.userService=i,this.commonSerivce=r,this.firestoreDbs={},this.listSubscribers={},this.app=(0,o.ZF)(Wd.N.firestoreConfig_app1,"firestoreapp")}examSessions_read(e){return new pe.y(i=>{this.getFirestoreDb(!1).subscribe(r=>(0,s.mG)(this,void 0,void 0,function*(){if(r&&1==r.success)try{var a=yield this._getDocument(r.data,"exam_sessions/"+e,this.getUserId());i.next({success:1,data:a,message:"successful"}),i.complete()}catch(u){console.log(u),i.next({success:0,data:"",message:""+u}),i.complete()}else i.next({success:0,data:"",message:r.message}),i.complete()}))})}examSessions_write(e,i){return new pe.y(r=>{this.getFirestoreDb(!1).subscribe(a=>(0,s.mG)(this,void 0,void 0,function*(){if(a&&1==a.success)try{var l=yield this._saveDocument(a.data,"exam_sessions/"+e,this.getUserId(),i);r.next({success:1,data:l,message:"successful"}),r.complete()}catch(h){console.log(h),r.next({success:0,data:"",message:""+h}),r.complete()}else r.next({success:0,data:"",message:a.message}),r.complete()}))})}examSessions_writeUserMap(e,i){return new pe.y(r=>{this.getFirestoreDbForStudentExam(!1,e).subscribe(a=>(0,s.mG)(this,void 0,void 0,function*(){if(a&&1==a.success&&a.data)try{var l=yield this._saveDocumentMerge(a.data,"exam_sessions/"+e,"user_map",i);r.next({success:1,data:l,message:"successful"}),r.complete()}catch(h){console.log(h),r.next({success:0,data:"",message:""+h}),r.complete()}else r.next({success:0,data:"",message:a.message}),r.complete()}))})}examSessions_delete(e){return new pe.y(i=>{this.getFirestoreDb(!1).subscribe(r=>(0,s.mG)(this,void 0,void 0,function*(){if(r&&1==r.success)try{yield this._removeDocument(r.data,"exam_sessions/"+e,this.getUserId()),i.next({success:1,data:"",message:"successful"}),i.complete()}catch(l){console.log(l),i.next({success:0,data:"",message:""+l}),i.complete()}else i.next({success:0,data:"",message:r.message}),i.complete()}))})}examSessions_subscribeUserMap(e){return new pe.y(i=>{this.getFirestoreDbForTeacherExam(!1,e).subscribe(r=>(0,s.mG)(this,void 0,void 0,function*(){if(r&&1==r.success)try{var a=this.myOnSnapshot(r.data,"exam_sessions/"+e,"user_map",h=>{i.next({success:1,data:h,message:"successful"}),i.complete()});this.addUnsubscribe("exam_sessions_"+e,a)}catch(h){console.log(h),i.next({success:0,data:void 0,message:""+h}),i.complete()}else i.next({success:0,data:void 0,message:r.message}),i.complete()}))})}examSessions_subscribe(e){return new pe.y(i=>{this.getFirestoreDb(!1).subscribe(r=>(0,s.mG)(this,void 0,void 0,function*(){if(r&&1==r.success)try{var a=this.myOnSnapshot(r.data,"exam_sessions/"+e,this.getUserId(),h=>{i.next({success:1,data:h,message:"successful"}),i.complete()});this.addUnsubscribe("exam_sessions_"+e,a)}catch(h){console.log(h),i.next({success:0,data:void 0,message:""+h}),i.complete()}else i.next({success:0,data:void 0,message:r.message}),i.complete()}))})}examSessions_unsubscribe(e){this.removeAllunsubscribe("exam_sessions_"+e)}examSessions_subscribeWithQuery(e,i){return new pe.y(i&&3==i.length?r=>{this.getFirestoreDb(!1).subscribe(a=>(0,s.mG)(this,void 0,void 0,function*(){if(a&&1==a.success)try{var l=this.myOnSnapshotCollectionWithQuery(a.data,"exam_sessions/"+e,i,m=>{r.next({success:1,data:m,message:"successful"}),r.complete()});this.addUnsubscribe("exam_sessions_"+e,l)}catch(m){console.log(m),r.next({success:0,data:void 0,message:""+m}),r.complete()}else r.next({success:0,data:void 0,message:a.message}),r.complete()}))}:r=>{r.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),r.complete(),r.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(e){return new pe.y(i=>{this.getFirestoreDbForStudentExam(!1,e).subscribe(r=>(0,s.mG)(this,void 0,void 0,function*(){if(r&&1==r.success)try{var a=this.myOnSnapshotCollection(r.data,"exam_live_teachers/"+e,l=>{i.next({success:1,data:l})});this.addUnsubscribe("exam_live_teachers_"+e,a)}catch(l){console.log(l),i.next({success:0,message:"EXCEPTION",ex:l.toString()})}else i.next(r)}))})}examLiveTeachers_student_unbsubscribe(e){this.removeAllunsubscribe("exam_live_teachers_"+e)}examLiveTeachers_teacher_saveChange(e,i){return new pe.y(r=>{this.getFirestoreDbForTeacherExam(!1,e).subscribe(a=>(0,s.mG)(this,void 0,void 0,function*(){if(a&&1==a.success)try{var l=yield this._saveDocument(a.data,"exam_live_teachers/"+e,this.getUserId(),i);r.next({success:1,data:l})}catch(u){console.log(u),r.next({success:0,message:"EXCEPTION",ex:u.toString()})}else r.next(a)}))})}examLives_teacher_getDocumentByUserIds(e,i){return new pe.y(r=>{this.getFirestoreDbForTeacherExam(!1,e).subscribe(a=>(0,s.mG)(this,void 0,void 0,function*(){if(a&&1==a.success)try{var l=yield this._getDocuments(a.data,"exam_lives/"+e,i);r.next({success:1,data:l})}catch(u){console.log(u),r.next({success:0,message:"EXCEPTION",ex:u.toString()})}else r.next(a)}))})}examLiveStudents_student_subscribe(e){return new pe.y(i=>{this.getFirestoreDbForStudentExam(!1,e).subscribe(r=>(0,s.mG)(this,void 0,void 0,function*(){if(r&&1==r.success)try{var a=this.myOnSnapshot(r.data,"exam_live_students/"+e,this.getUserId(),l=>{i.next({success:1,data:l})});this.addUnsubscribe("exam_live_students_"+e,a)}catch(l){console.log(l),i.next({success:0,message:"EXCEPTION",ex:l.toString()})}else i.next(r)}))})}examLiveStudents_student_unbsubscribe(e){this.removeAllunsubscribe("exam_live_students_"+e)}examLiveStudents_teacher_subscribe(e,i){return new pe.y(r=>{this.getFirestoreDbForTeacherExam(!1,e).subscribe(a=>(0,s.mG)(this,void 0,void 0,function*(){if(a&&1==a.success)try{var l=this.myOnSnapshot(a.data,"exam_live_students/"+e,i,u=>{r.next({success:1,data:u})});this.addUnsubscribe("exam_live_students_"+e,l)}catch(u){console.log(u),r.next({success:0,message:"EXCEPTION",ex:u.toString()})}else r.next(a)}))})}examLiveStudents_teacher_unbsubscribe(e){this.removeAllunsubscribe("exam_live_students_"+e)}examLiveStudents_student_saveChange(e,i){return new pe.y(r=>{this.getFirestoreDbForStudentExam(!1,e).subscribe(a=>(0,s.mG)(this,void 0,void 0,function*(){if(a&&1==a.success)try{var l=yield this._saveDocument(a.data,"exam_live_students/"+e,this.getUserId(),i);r.next({success:1,data:l})}catch(u){console.log(u),r.next({success:0,message:"EXCEPTION",ex:u.toString()})}else r.next(a)}))})}examLiveStudents_teacher_saveChange(e,i,r){return new pe.y(a=>{this.getFirestoreDbForTeacherExam(!1,e).subscribe(l=>(0,s.mG)(this,void 0,void 0,function*(){if(l&&1==l.success)try{var u=yield this._saveDocumentMerge(l.data,"exam_live_students/"+e,i,r);a.next({success:1,data:u})}catch(h){console.log(h),a.next({success:0,message:"EXCEPTION",ex:h.toString()})}else a.next(l)}))})}getFirestoreDb(e){return new pe.y(i=>{var r=this.createFirestoreKey("firestore_db"),a=this.getLocalFirestoreDb(r);null!=a&&0==e?(i.next({success:1,data:a,message:"successful"}),i.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(u=>{var h,m,v;if(u&&1==u.success)(0,J._p)(this.getAuthApp(),null!==(m=null===(h=null==u?void 0:u.data)||void 0===h?void 0:h.token)&&void 0!==m?m:"").then(()=>{var O=Uc(this.app);this.setLocalFirestoreDb(r,O),i.next({success:1,data:O,message:"successful"}),i.complete()}).catch(O=>{"auth/invalid-custom-token"===O.code?(i.next({success:0,data:void 0,message:"EXPIRED"}),i.complete()):(i.next({success:0,data:void 0,message:"AUTH_ERROR"}),i.complete())});else{var x={success:0,data:void 0,message:null!==(v=u.message)&&void 0!==v?v:""};i.next(x),i.complete()}})})}getFirestoreDbForStudentExam(e,i){return new pe.y(r=>{var a=this.createFirestoreKey("firestore_db_student_"+i),l=this.getLocalFirestoreDb(a);null!=l&&0==e?(r.next({success:1,data:l,message:"successful"}),r.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(i).subscribe(h=>{var m,v,x;if(h&&1==h.success)(0,J._p)(this.getAuthApp(),null!==(v=null===(m=null==h?void 0:h.data)||void 0===m?void 0:m.token)&&void 0!==v?v:"").then(()=>{var N=Uc(this.app);this.setLocalFirestoreDb(a,N),r.next({success:1,data:N,message:"successful"}),r.complete()}).catch(N=>{"auth/invalid-custom-token"===N.code?(r.next({success:0,data:void 0,message:"EXPIRED"}),r.complete()):(r.next({success:0,data:void 0,message:"AUTH_ERROR"}),r.complete())});else{var O={success:0,data:void 0,message:null!==(x=h.message)&&void 0!==x?x:""};r.next(O),r.complete()}})})}getFirestoreDbForTeacherExam(e,i){return new pe.y(r=>{var a=this.createFirestoreKey("firestore_db_teacher_"+i),l=this.getLocalFirestoreDb(a);null!=l&&0==e?(r.next({success:1,data:l,message:"successful"}),r.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(i).subscribe(h=>{var m,v,x;if(h&&1==h.success)(0,J._p)(this.getAuthApp(),null!==(v=null===(m=null==h?void 0:h.data)||void 0===m?void 0:m.token)&&void 0!==v?v:"").then(()=>{var N=Uc(this.app);this.setLocalFirestoreDb(a,N),r.next({success:1,data:N,message:"successful"}),r.complete()}).catch(N=>{"auth/invalid-custom-token"===N.code?(r.next({success:0,data:void 0,message:"EXPIRED"}),r.complete()):(r.next({success:0,data:void 0,message:"AUTH_ERROR"}),r.complete())});else{var O={success:0,data:void 0,message:null!==(x=h.message)&&void 0!==x?x:""};r.next(O),r.complete()}})})}signInUserByToken(e){return new pe.y(i=>{(0,J._p)(this.getAuthApp(),e).then(()=>{i.next({success:1,data:"",message:"successful"}),i.complete()}).catch(r=>{"auth/invalid-custom-token"===r.code?(i.next({success:0,data:"",message:"EXPIRED"}),i.complete()):(i.next({success:0,data:"",message:"AUTH_ERROR"}),i.complete())})})}setLocalFirestoreDb(e,i){this.firestoreDbs[e]=i}getLocalFirestoreDb(e){if(this.firestoreDbs.hasOwnProperty(e))return this.firestoreDbs[e]}removeLocalFirestoreDb(e){this.firestoreDbs.hasOwnProperty(e)&&delete this.firestoreDbs[e]}createFirestoreKey(e){return this.userService.getUserObj().id+"_"+e}getUserId(){var e,i;return null!==(i=null===(e=this.userService.getUserObj().id)||void 0===e?void 0:e.toString())&&void 0!==i?i:"0"}addUnsubscribe(e,i){e=this.getUserId()+"_"+e,this.listSubscribers.hasOwnProperty(e)||(this.listSubscribers[e]=[]),this.listSubscribers[e].push(i)}removeAllunsubscribe(e){if(e=this.getUserId()+"_"+e,this.listSubscribers.hasOwnProperty(e)){for(var i=0;i<this.listSubscribers[e].length;i++)this.listSubscribers[e][i]();delete this.listSubscribers[e]}}_saveDocument(e,i,r,a){return(0,s.mG)(this,void 0,void 0,function*(){return i=this.getBaseFirestore()+"/"+i,yield Hd(hr(e,i,r),this.commonSerivce.myClone(a)),r})}_saveDocumentMerge(e,i,r,a){return(0,s.mG)(this,void 0,void 0,function*(){return i=this.getBaseFirestore()+"/"+i,yield Hd(hr(e,i,r),this.commonSerivce.myClone(a),{merge:!0}),r})}_getCollection(e,i){return(0,s.mG)(this,void 0,void 0,function*(){i=this.getBaseFirestore()+"/"+i;const r=Ao(e,i);return(yield Yd(r)).docs.map(u=>u.data())})}_getDocument(e,i,r){return(0,s.mG)(this,void 0,void 0,function*(){i=this.getBaseFirestore()+"/"+i;const a=hr(e,i,r),l=yield function wp(n){n=It(n,re);const t=It(n.firestore,zt);return function xd(n,t,e={}){const i=new ye;return n.asyncQueue.enqueueAndForget((0,C.Z)(function*(){return function(r,a,l,u,h){const m=new ya({next:x=>{a.enqueueAndForget(()=>ec(r,v));const O=x.docs.has(l);!O&&x.fromCache?h.reject(new B(D.UNAVAILABLE,"Failed to get document because the client is offline.")):O&&x.fromCache&&u&&"server"===u.source?h.reject(new B(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(x)},error:x=>h.reject(x)}),v=new sc(Vs(l.path),m,{includeMetadataChanges:!0,Du:!0});return Xl(r,v)}(yield ur(n),n.asyncQueue,t,e,i)})),i.promise}(ge(t),n._key).then(e=>Yc(t,n,e))}(a);return l.exists()?l.data():null})}_getDocuments(e,i,r){return(0,s.mG)(this,void 0,void 0,function*(){var a={};i=this.getBaseFirestore()+"/"+i;const l=Fd(Ao(e,i),Ud(function rp(){return new dr("__name__")}(),"in",r));return(yield Yd(l)).forEach(h=>{a[h.id]=h.data()}),a})}_removeDocument(e,i,r){return(0,s.mG)(this,void 0,void 0,function*(){i=this.getBaseFirestore()+"/"+i,yield function bp(n){return Eo(It(n.firestore,zt),[new Hs(n._key,Ht.none())])}(hr(e,i,r))})}myOnSnapshot(e,i,r,a){return Sa(hr(e,i=this.getBaseFirestore()+"/"+i,r),u=>{a(u.data())})}myOnSnapshotCollection(e,i,r){return Sa(Ao(e,i=this.getBaseFirestore()+"/"+i),l=>(0,s.mG)(this,void 0,void 0,function*(){var u=[];l.forEach(h=>{u.push(h.data())}),r(u)}))}myOnSnapshotOnlyChangeInCollection(e,i,r){return Sa(Ao(e,i=this.getBaseFirestore()+"/"+i),l=>(0,s.mG)(this,void 0,void 0,function*(){var u=[];l.docChanges().forEach(h=>{u.push(h.doc.data())}),r(u)}))}myOnSnapshotCollectionWithQuery(e,i,r,a){return Sa(Fd(Ao(e,i=this.getBaseFirestore()+"/"+i),Ud(r[0],r[1],r[2])),h=>(0,s.mG)(this,void 0,void 0,function*(){var m=[];h.docChanges().forEach(v=>{m.push(v.doc.data())}),a(m)}))}getBaseFirestore(){return Wd.N.firestoreBase}getInitApp(){return this.app}getAuthApp(){return(0,J.v0)(this.app)}}return n.\u0275fac=function(e){return new(e||n)(ka.LFG(Ap.C),ka.LFG(Ip.K),ka.LFG(Ep.v))},n.\u0275prov=ka.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},88974:(Qt,tt,w)=>{w.d(tt,{M:()=>J});var s=w(5e3),o=w(41752);let J=(()=>{class C{constructor(M){this.envService=M}getTmpVersionMonitor(){var M=this.envService.getEnvValue("classliveUrl"),Q="1.0";if(M){var P=M.split("=");P.length>1&&(Q=P[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+Q}getMNoteVer(){var M=this.envService.getEnvValue("classliveUrl"),Q="1.0";if(M){var P=M.split("=");P.length>1&&(Q=P[1])}return Q}checkValidForSetUpMonitor(){return!0}}return C.\u0275fac=function(M){return new(M||C)(s.LFG(o.D))},C.\u0275prov=s.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},30345:(Qt,tt,w)=>{w.d(tt,{$:()=>C});var s=w(76944),o=w(25482),J=w(13041);class C extends J.N{constructor(M,Q,P){super(),this.cdnService=M,this.commonService=Q,this.callBack=P}render(M,Q,P){var K;if(M.indexOf("@[]")<0)return M;console.log("imgLinkRender",M);let y,z=/@\[\]\{[^@]+\}@\[\]/g,R=M,j=new Map;for(;null!==(y=z.exec(M));){let T=y[0],V=T.split("@[]")[1],H=this.commonService.willDeleteParseJson(V),Z=H.link,W=s.G.generateIdRequired(10);R=R.replace(T,`<img id='${W}' class='img-docx' alt="Loading..."></div>`),j.has(Z)?null===(K=j.get(Z))||void 0===K||K.push({id:W,data:H.data}):j.set(Z,[{id:W,data:H.data}])}return this.startLoadImage(j),R}startLoadImage(M){M.forEach((Q,P)=>{this.loadImage(P).then(K=>{if(this.processImageQuestion(K,Q),this.loadingManager.delete(K.id),this.callBack){console.log("loadLink",Q);for(let z of Q)this.callBack(z.id,z.renderStr)}}).catch(()=>{})})}loadImage(M){return new Promise((Q,P)=>{const K=new Image;K.crossOrigin="anonymous",K.setAttribute("count","1");let z=s.G.generateIdRequired(10);this.loadingManager.set(z,M),K.onload=()=>{Q(K)},K.onerror=()=>{const R=K.getAttribute("count");R&&1==Number(R)?(K.src=this.cdnService.getMyCdn(M),K.setAttribute("count","2")):R&&Number(R)<5?(K.setAttribute("count",R+1),K.src=this.cdnService.getRawCdnLink(M)+(new Date).getTime()):P(new Error)},K.src=this.cdnService.getRawCdnLink(M)})}processImageQuestion(M,Q){Q.forEach(P=>{const K=document.createElement("canvas");P.data.width=-1===P.data.width?M.width:P.data.width,P.data.height=-1===P.data.height?M.height:P.data.height,K.width=P.data.width,K.height=P.data.height;const z=K.getContext("2d");if(z){z.drawImage(M,P.data.x,P.data.y,P.data.width,P.data.height,0,0,K.width,K.height);const R=this.isCropImage?o.rj.cropCanvas(K):K;P.renderStr=`<img id='${P.id}' class='img-docx' alt='error...' src='${R.toDataURL()}' style='width: ${R.width*this.ratioImage}px;height: auto'>`}})}}},13041:(Qt,tt,w)=>{w.d(tt,{N:()=>s});class s{constructor(){this.isCropImage=!0,this.loadingManager=new Map,this.ratioImage=.65}setCallback(J){}setApiCache(J){}setLoadingManager(J){this.loadingManager=J}}}}]);